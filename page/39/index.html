<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"><meta property="og:type" content="website"><meta property="og:title" content="Clay 的技术空间"><meta property="og:url" content="https://www.techgrow.cn/page/39/index.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"><meta property="og:locale" content="zh_CN"><meta property="article:author" content="Clay"><meta property="article:tag" content="Java"><meta property="article:tag" content="微服务"><meta property="article:tag" content="分布式系统"><meta property="article:tag" content="系统架构"><meta property="article:tag" content="大数据"><meta property="article:tag" content="人工智能"><meta property="article:tag" content="物联网"><meta property="article:tag" content="虚拟化"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.techgrow.cn/page/39/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/39/index.html","title":""}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><h1 class="site-title">Clay 的技术空间</h1><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-overview-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">733</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner index posts-expand post-container" id="readmore-container"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang=""><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/b728042a.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Clay 的技术空间"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/posts/b728042a.html" class="post-title-link" itemprop="url">基于 Kubeadm 方式搭建 Kubernetes 集群</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-03-11 22:34:29" itemprop="dateCreated datePublished" datetime="2021-03-11T22:34:29+08:00">2021-03-11</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-08-02 22:34:29" itemprop="dateModified" datetime="2025-08-02T22:34:29+08:00">2025-08-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/b728042a.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/b728042a.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>7.6k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>7 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/ccd6f2d4.html">基于二进制包方式搭建 Kubernetes 集群</a></li><li><a href="/posts/b728042a.html">基于 Kubeadm 方式搭建 Kubernetes 集群</a></li></ul><h2 id="Kubernetes-集群架构介绍"><a href="#Kubernetes-集群架构介绍" class="headerlink" title="Kubernetes 集群架构介绍"></a>Kubernetes 集群架构介绍</h2><h3 id="集群部署架构分类"><a href="#集群部署架构分类" class="headerlink" title="集群部署架构分类"></a>集群部署架构分类</h3><ul><li>无中心节点架构的系统，比如：GlusterFS</li><li> 有中心节点架构的系统，比如：HDFS、K8s</li></ul><h3 id="Kubernetes-核心概念"><a href="#Kubernetes-核心概念" class="headerlink" title="Kubernetes 核心概念"></a>Kubernetes 核心概念</h3><p>Kubernetes 三个核心概念（Pod、Controller、Service）的介绍如下：</p><ul><li><p>Pod（最小部署单元）</p><ul><li>Pod 是 Kubernetes 中最小的调度和运行单元。</li><li>本质上是一组容器的集合（通常是一个容器）。</li><li>容器之间共享网络（IP、端口）和存储卷。</li><li>Pod 的生命周期可以是短暂的，比如用于运行临时任务或被控制器自动重建。</li></ul></li><li><p>Controller（控制器）</p><ul><li>用于管理和自动化 Pod 的部署与副本数量。</li><li>支持无状态应用部署（如 Deployment）。</li><li>支持有状态应用部署（如 StatefulSet）。</li><li>可实现以下功能：<ul><li>保证指定数量的 Pod 实例持续运行。</li><li>在多个节点上部署同一类 Pod（如 DaemonSet）。</li><li>支持一次性任务（Job）和定时任务（CronJob）。</li></ul></li></ul></li><li><p>Service（服务）</p><ul><li>负责定义一组 Pod 的访问规则。</li><li>提供统一的访问入口（Cluster IP、NodePort、LoadBalancer 等），实现服务发现与负载均衡。</li><li>解决 Pod 动态 IP 和短生命周期带来的访问不稳定问题。</li></ul></li></ul><p>这三个核心概念的关系：</p><ul><li>Pod 是具体运行的实例。</li><li>Controller 管理 Pod 的创建、副本和调度。</li><li>Service 让外部或内部服务可以稳定地访问 Pod。</li></ul><h3 id="Kubernetes-集群架构概览"><a href="#Kubernetes-集群架构概览" class="headerlink" title="Kubernetes 集群架构概览"></a>Kubernetes 集群架构概览</h3><p><img data-src="../../../asset/2021/03/kubernetes-framework-2.png" alt="kubernetes-framework-2"></p><h3 id="Kubernetes-集群架构组件"><a href="#Kubernetes-集群架构组件" class="headerlink" title="Kubernetes 集群架构组件"></a>Kubernetes 集群架构组件</h3><p><img data-src="../../../asset/2021/03/kubernetes-framework-1.png" alt="kubernetes-framework-1"></p><ul><li><p><code>Master（主控节点）</code>：Kubernetes 集群控制节点，负责对集群进行调度管理，接受集群外的用户去集群操作请求。Master 由 API Server、Scheduler、Controller Manager、Etcd 存储系统组成</p><ul><li>Scheduler：节点调度，选择 Node 节点来应用部署</li><li> API Server：集群统一入口，以 RESTful 接口将数据交给 Etcd 进行存储</li><li> Controller Manager：处理集群中的常规后台任务，一个资源对应一个控制器</li><li> Etcd 存储系统：用于存储集群相关的数据</li></ul></li><li><p><code>Node（工作节点）</code>：Kubernetes 集群工作节点，负责运行用户业务应用容器，Node 由 Kubelet、Kube-Proxy 和 Container Runtime 组成</p><ul><li>Kubelet：负责 Pod 对应的容器的创建、启停管理，与 Master 节点协作，实现集群管理的基本功能</li><li> Kube-Proxy：提供 Kubernetes 的通信与负载均衡功能的重要组件</li></ul></li></ul><hr><p>Kubernetes 依赖容器运行时（Container Runtime）来管理和运行容器。</p><ul><li>历史上，Kubernetes 主要使用 Docker 作为容器运行时。Kubernetes 通过内置的 <code>dockershim</code> 组件与 Docker 实现兼容。</li><li>从 Kubernetes <code>1.20</code> 版本开始，官方宣布弃用内置的 <code>dockershim</code> 组件，逐步移除对 Docker 作为直接容器运行时的支持。</li><li>现代 Kubernetes 推荐使用符合 <a target="_blank" rel="external nofollow" href="https://kubernetes.io/docs/concepts/architecture/cri/">Container Runtime Interface (CRI)</a> 标准的容器运行时，主要有：<ul><li>containerd：由 Docker 社区捐赠的轻量级容器运行时，稳定且高效，广泛使用。</li><li>CRI-O：专门为 Kubernetes 设计的容器运行时，注重轻量和安全。</li></ul></li></ul><div class="admonition note"><p class="admonition-title">Etcd 是什么</p><ul><li>在分布式系统中，Etcd 是一个高可用、强一致性的分布式键值存储系统，在 Kubernetes 等系统中扮演着核心元数据存储和协调中心的角色。</li><li>Etcd 属于更底层的基础组件，使用 Raft 算法实现强一致性（满足 CAP 中的 C 和 P），提供了一致性的 KV 存储、watch、lease、事务等机制。</li></ul></div><h2 id="Kubernetes-集群搭建说明"><a href="#Kubernetes-集群搭建说明" class="headerlink" title="Kubernetes 集群搭建说明"></a>Kubernetes 集群搭建说明</h2><h3 id="集群搭建要求"><a href="#集群搭建要求" class="headerlink" title="集群搭建要求"></a>集群搭建要求</h3><p>搭建 Kubernetes 集群需要满足以下几个条件：</p><ul><li>一台或多台机器，建议操作系统 CentOS 7（64 位）</li><li>Master 节点的硬件配置：2GB 或更多 RAM，2 个 CPU 或更多 CPU，硬盘 20GB 或更多</li><li> Node 节点的硬件配置：4GB 或更多 RAM，4 个 CPU 或更多 CPU，硬盘 40GB 或更多</li><li>集群中所有机器之间的网络可以互通</li><li>系统内可以访问外网，需要拉取镜像</li><li>禁用 Swap 分区（必须）</li></ul><h3 id="集群搭建类型"><a href="#集群搭建类型" class="headerlink" title="集群搭建类型"></a>集群搭建类型</h3><p>Kubernetes 集群搭建类型分为单 Master 集群和多 Master 集群两种，为了提高集群的高可用性，生产环境一般采用后者的规划方案，如下图所示：</p><p><img data-src="../../../asset/2021/03/kubernetes-cluster-plan.png" alt="kubernetes-cluster-plan"></p><h2 id="Kubeadm-方式搭建单-Master-集群"><a href="#Kubeadm-方式搭建单-Master-集群" class="headerlink" title="Kubeadm 方式搭建单 Master 集群"></a>Kubeadm 方式搭建单 Master 集群</h2><div class="admonition note"><p class="admonition-title">术语说明</p><p>为了方便描述，本文使用 <code>Node 节点</code> 来替代 Kubernetes 的 <code>Worker Node</code>，使用 <code>Master 节点</code> 来替代 <code>Master Node</code>。</p></div><h3 id="搭建目标"><a href="#搭建目标" class="headerlink" title="搭建目标"></a>搭建目标</h3><ul><li>(1) 在所有节点上分别安装 Docker、Kubeadm、Kubectl、Kubelet</li><li>(2) 初始化 Kubernetes 的 Master 节点</li><li> (3) 部署 CNI 网络插件（Flannel）</li><li>(4) 将 Node 节点加入到 Kubernetes 集群中</li><li> (5) 部署 Dashboard 可视化插件，可视化监控 Kubernetes 资源</li></ul><h3 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h3><table><thead><tr><th>软件</th><th>版本</th><th>安装方式</th></tr></thead><tbody><tr><td> CentOS</td><td><code>7.9</code></td><td>虚拟机</td></tr><tr><td> Docker</td><td><code>18.06.1</code></td><td>YUM</td></tr><tr><td>Kubelet</td><td><code>1.18.0</code></td><td>YUM</td></tr><tr><td>Kubectl</td><td><code>1.18.0</code></td><td>YUM</td></tr><tr><td>Kubeadm</td><td><code>1.18.0</code></td><td>YUM</td></tr><tr><td>Dashboard</td><td><code>2.0.3</code></td><td>Kubernetes</td></tr></tbody></table><h3 id="服务器规划"><a href="#服务器规划" class="headerlink" title="服务器规划"></a>服务器规划</h3><p><img data-src="../../../asset/2021/03/kubernetes-kubeadm-1.png" alt="kubernetes-kubeadm-1"></p><table><thead><tr><th>Host 名称</th><th>角色</th><th> IP</th><th>CPU 核数</th><th>内存</th><th>磁盘</th></tr></thead><tbody><tr><td> k8s-master</td><td>master</td><td>192.168.31.61</td><td>&gt;= 2C</td><td>&gt;=2G</td><td>&gt;=20G</td></tr><tr><td>k8s-node1</td><td>node（worker）</td><td>192.168.31.62</td><td>&gt;= 4C</td><td>&gt;=4G</td><td>&gt;=40G</td></tr><tr><td>k8s-node2</td><td>node（worker）</td><td>192.168.31.63</td><td>&gt;= 4C</td><td>&gt;=4G</td><td>&gt;=40G</td></tr><tr><td>k8s-node3</td><td>node（worker）</td><td>192.168.31.64</td><td>&gt;= 4C</td><td>&gt;=4G</td><td>&gt;=40G</td></tr></tbody></table><h3 id="操作系统初始化"><a href="#操作系统初始化" class="headerlink" title="操作系统初始化"></a>操作系统初始化</h3><div class="admonition warning"><p class="admonition-title">t 特别注意</p><ul><li><strong>以下系统初始化操作都必须在所有节点（包括 Master 和 Node）上都执行一次，重点是安装 Docker、Kubeadm、Kubectl、Kubelet</strong>。</li><li><strong>这里要求 Kubelet、Kubeadm、Kubectl 的版本与 Docker 的版本互相匹配（兼容），不建议安装最新版本的 Docker，因为 Kubernetes 对最新版的 Docker 兼容不够及时，容易导致使用 Kubeadm 方式搭建 Kubernetes 集群失败。</strong></li></ul></div><p>关闭防火墙</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时关闭</span></span><br><span class="line"><span class="keyword"># systemctl</span> stop firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 永久关闭</span></span><br><span class="line"><span class="keyword"># systemctl</span> <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></tbody></table></figure><p>关闭 selinux</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时关闭</span></span><br><span class="line"><span class="keyword"># setenforce</span> 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 永久关闭</span></span><br><span class="line"><span class="keyword"># sed</span><span class="params"> -i</span> <span class="string">'s/enforcing/disabled/'</span> /etc/selinux/config</span><br></pre></td></tr></tbody></table></figure><p>关闭 swap 分区</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时关闭</span></span><br><span class="line"><span class="keyword">$ swapoff</span><span class="params"> -a</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 永久关闭</span></span><br><span class="line"><span class="keyword"># sed</span><span class="params"> -i</span> <span class="string">'s/.*swap.*/#&amp;/'</span> /etc/fstab</span><br></pre></td></tr></tbody></table></figure><p>系统时间同步（强烈建议使用 chrony 而不是 ntpdate）</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 卸载ntpdate服务</span></span><br><span class="line"><span class="keyword"># yum</span> remove<span class="params"> -y</span> ntpdate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装chrony服务</span></span><br><span class="line"><span class="keyword"># yum</span> install<span class="params"> -y</span> chrony</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开机自启动chrony服务</span></span><br><span class="line"><span class="keyword"># systemctl</span> <span class="built_in">enable</span> chronyd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动chrony服务</span></span><br><span class="line"><span class="keyword"># systemctl</span> start chronyd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置NTP源，添加国内公共的NTP服务器</span></span><br><span class="line"><span class="keyword"># vim</span> /etc/chrony.conf</span><br><span class="line">server ntp.aliyun.com iburst</span><br><span class="line">server ntp1.tencent.com iburst</span><br><span class="line">server cn.pool.ntp.org iburst</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启chrony服务</span></span><br><span class="line"><span class="keyword"># systemctl</span> restart chronyd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查chrony服务的运行状态</span></span><br><span class="line"><span class="keyword"># systemctl</span> status chronyd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看chrony服务的时间同步状态</span></span><br><span class="line"><span class="keyword"># chronyc</span> tracking</span><br><span class="line"></span><br><span class="line"><span class="comment"># 强制同步一次时间（只在刚部署、时间差很多的时候用）</span></span><br><span class="line"><span class="keyword"># sudo</span> chronyc makestep</span><br></pre></td></tr></tbody></table></figure><p>设置主机名（比如 <code>k8s-master</code>、<code>k8s-node1</code>、<code>k8s-node2</code>、<code>k8s-node3</code>）</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword"># hostnamectl</span> <span class="built_in">set</span>-hostname &lt;hostname&gt;</span><br></pre></td></tr></tbody></table></figure><p>添加 hosts 配置信息</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加hosts信息</span></span><br><span class="line"><span class="keyword"># vim</span> /etc/hosts</span><br><span class="line">192.168.31.61 k8s-master</span><br><span class="line">192.168.31.62 k8s-node1</span><br><span class="line">192.168.31.63 k8s-node2</span><br><span class="line">192.168.31.64 k8s-node3</span><br></pre></td></tr></tbody></table></figure><hr><p>将桥接的 IPv4 流量传递到 iptables 的链</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建系统配置文件，并添加路由规则</span></span><br><span class="line"><span class="keyword"># vim</span> /etc/sysctl.d/k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使配置生效</span></span><br><span class="line"><span class="keyword"># sysctl</span><span class="params"> --system</span></span><br></pre></td></tr></tbody></table></figure><p>安装特定版本的 Docker，这是由于 Kubernetes 默认的 CRI（容器运行时）为 Docker</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加YUM源</span></span><br><span class="line"><span class="keyword"># wget</span> https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<span class="params"> -O</span> /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装Docker（指定版本号，否则默认安装最新版本）</span></span><br><span class="line"><span class="keyword"># yum</span><span class="params"> -y</span> install docker-ce-18.06.1.ce-3.el7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开机自启动Docker</span></span><br><span class="line"><span class="keyword"># systemctl</span> <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动Docker</span></span><br><span class="line"><span class="keyword"># systemctl</span> start docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Docker的配置目录</span></span><br><span class="line"><span class="keyword"># mkdir</span> /etc/docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置阿里的Docker镜像加速（请更换自己的镜像地址，或者使用国内公共的镜像地址）</span></span><br><span class="line"><span class="keyword"># cat</span> &gt; /etc/docker/daemon.json &lt;&lt; EOF</span><br><span class="line">{</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [</span><br><span class="line">     <span class="string">"https://b9pmyelo.mirror.aliyuncs.com"</span>,</span><br><span class="line">     <span class="string">"https://ustc-edu-cn.mirror.aliyuncs.com"</span>,</span><br><span class="line">     <span class="string">"https://mirror.iscas.ac.cn"</span>,</span><br><span class="line">     <span class="string">"https://docker.nju.edu.cn"</span>,</span><br><span class="line">     <span class="string">"https://docker.m.daocloud.io"</span>,</span><br><span class="line">     <span class="string">"https://ccr.ccs.tencentyun.com"</span>,</span><br><span class="line">     <span class="string">"https://dockerhub.timeweb.cloud"</span></span><br><span class="line">    ]</span><br><span class="line">}</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启Docker</span></span><br><span class="line"><span class="keyword"># systemctl</span> restart docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Docker的运行状态</span></span><br><span class="line"><span class="keyword"># systemctl</span> status docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Docker的版本</span></span><br><span class="line"><span class="keyword"># docker</span><span class="params"> --version</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Docker的安装信息</span></span><br><span class="line"><span class="keyword"># docker</span> info</span><br></pre></td></tr></tbody></table></figure><p>安装特定版本的 Kubeadm、Kubectl、Kubelet</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加YUm源</span></span><br><span class="line"><span class="keyword"># vim</span> /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装（指定版本号，否则默认会安装最新版本）</span></span><br><span class="line"><span class="keyword"># yum</span> install<span class="params"> -y</span> kubelet-1.18.0 kubeadm-1.18.0 kubectl-1.18.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开机自启动Kubelet</span></span><br><span class="line"><span class="keyword"># systemctl</span> <span class="built_in">enable</span> kubelet</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提示：Kubelet安装完成后不需要手动启动，因为在Node节点成功加入集群之前，Kubelet自身会不断重启（期间会伴随着各种启动错误，这点不用在意）</span></span><br></pre></td></tr></tbody></table></figure><p>Kubelet、Kubeadm、Kubectl 的作用</p><table><thead><tr><th>组件</th><th>作用</th><th>使用场景</th></tr></thead><tbody><tr><td> Kubelet</td><td> 每个 Node 上的核心组件，负责管理 Pod 生命周期，与 API Server 通信，执行容器操作</td><td>每个 Node 上都必须运行 Kubelet，确保容器按 PodSpec 正确运行</td></tr><tr><td> Kubectl</td><td>Kubernetes 的命令行客户端工具，用于与 API Server 通信，管理资源</td><td>查询资源（<code>kubectl get</code>）、创建资源（<code>kubectl apply</code>）、调试排查（<code>kubectl logs</code>）</td></tr><tr><td>Kubeadm</td><td> 用于快速部署和管理 Kubernetes 集群的工具</td><td>初始化主节点（<code>kubeadm init</code>）、加入工作节点（<code>kubeadm join</code>）、升级集群等</td></tr></tbody></table><h3 id="初始化-Master-节点"><a href="#初始化-Master-节点" class="headerlink" title="初始化 Master 节点"></a>初始化 Master 节点</h3><p>在 Master 节点上，通过 Kubeadm 初始化 Master 节点，<strong>命令行参数 <code>--service-cidr</code> 与 <code>--pod-network-cidr</code> 一般都不需要更改，其他参数请根据自己的实际情况进行修改</strong>，详细参数说明如下，<a href="../../../asset/2021/03/kubernetes-install-log.png">点击</a>查看详细的初始化日志信息</p><ul><li><code>--apiserver-advertise-address</code>：Master 节点的 IP 地址（<strong>需要自行更改</strong>），还可以指定为 Haproxy + Keepalived 的 VIP</li><li><code>--kubernetes-version</code>：Kubernetes 的版本号，必须与上面 Kubelet 的版本号一致</li><li><code>--image-repository</code>：由于默认拉取镜像的地址 <code>k8s.gcr.io</code> 在国内无法访问，所以需要指定阿里云镜像仓库地址</li><li><code>--pod-network-cidr</code>：指定 Pod Network 的地址范围，由于 Kubernetes 支持多种网络方案，而且不同网络方案对参数有各自要求，设置为 <code>10.244.0.0/16</code> 表示使用 Flannel 网络方案</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始化Master节点</span></span><br><span class="line"><span class="keyword"># kubeadm</span> init \<span class="params"></span></span><br><span class="line"><span class="params">--apiserver</span>-advertise-address=192.168.31.61 \<span class="params"></span></span><br><span class="line"><span class="params">--image</span>-repository registry.aliyuncs.com/google_containers \<span class="params"></span></span><br><span class="line"><span class="params">--kubernetes</span>-version v1.18.0 \<span class="params"></span></span><br><span class="line"><span class="params">--service</span>-cidr=10.96.0.0/12 \<span class="params"></span></span><br><span class="line"><span class="params">--pod</span>-network-cidr=10.244.0.0/16</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当终端打印如下的提示信息，则说明Docker开始拉取镜像，这个过程比较耗时（严重依赖网速），当镜像拉取完成后，会自动启动相关的Docker容器</span></span><br><span class="line">[preflight] Pulling images required <span class="keyword">for</span> setting up a Kubernetes cluster</span><br><span class="line">[preflight] This might take a minute or two, depending on the speed of your internet connection</span><br><span class="line">[preflight] You can also perform this action <span class="keyword">in</span> beforehand using <span class="string">'kubeadm config images pull'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化完成后，记录下终端最后打印的Kubeadm命令（如下所示），后续添加Node节点到K8s集群时会使用到</span></span><br><span class="line"><span class="comment">### kubeadm join 192.168.1.109:6443 --token jve1cd.3ulp5fqifsptti23 --discovery-token-ca-cert-hash sha256:01229ee179cf13855dbf38bc050b3251928571996d60878f30ce13c08aaa62d5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看已拉取的Docker镜像列表</span></span><br><span class="line"><span class="keyword"># docker</span> images</span><br><span class="line">REPOSITORY                                                        TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-proxy                v1.18.0             43940c34f24f        11 months ago       117MB</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-apiserver            v1.18.0             74060cea7f70        11 months ago       173MB</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-controller-manager   v1.18.0             d3e55153f52f        11 months ago       162MB</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-scheduler            v1.18.0             a31f78c7c8ce        11 months ago       95.3MB</span><br><span class="line">registry.aliyuncs.com/google_containers/pause                     3.2                 80d28bedfe5d        13 months ago       683kB</span><br><span class="line">registry.aliyuncs.com/google_containers/coredns                   1.6.7               67da37a9a360        13 months ago       43.8MB</span><br><span class="line">registry.aliyuncs.com/google_containers/etcd                      3.4.3-0             303ce5db0e90        16 months ago       288MB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看正在运行的Docker容器列表</span></span><br><span class="line"><span class="keyword"># docker</span> ps<span class="params"> -a</span></span><br><span class="line">CONTAINER ID        IMAGE                                               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">8902ba7f9c36        43940c34f24f                                        <span class="string">"/usr/local/bin/kube…"</span>   6 minutes ago       Up 6 minutes                            k8s_kube-proxy_kube-proxy-5wbfw_kube-system_feace9db-cf7f-44c0-8cb0-9cb057e9833c_0</span><br><span class="line">9657b36dd4e4        registry.aliyuncs.com/google_containers/pause:3.2   <span class="string">"/pause"</span>                 6 minutes ago       Up 6 minutes                            k8s_POD_kube-proxy-5wbfw_kube-system_feace9db-cf7f-44c0-8cb0-9cb057e9833c_0</span><br><span class="line">563fa6cc803d        74060cea7f70                                        <span class="string">"kube-apiserver --ad…"</span>   7 minutes ago       Up 7 minutes                            k8s_kube-apiserver_kube-apiserver-k8s-master_kube-system_f3e487c167f719bc8a1a89c83db337de_0</span><br><span class="line">487a0a0789f0        303ce5db0e90                                        <span class="string">"etcd --advertise-cl…"</span>   7 minutes ago       Up 7 minutes                            k8s_etcd_etcd-k8s-master_kube-system_f81fbe2336e90a6be7ee4138c7f4cf4a_0</span><br><span class="line">24b369e313bf        a31f78c7c8ce                                        <span class="string">"kube-scheduler --au…"</span>   7 minutes ago       Up 7 minutes                            k8s_kube-scheduler_kube-scheduler-k8s-master_kube-system_ca2aa1b3224c37fa1791ef6c7d883bbe_0</span><br><span class="line">bcce27087ebe        d3e55153f52f                                        <span class="string">"kube-controller-man…"</span>   7 minutes ago       Up 7 minutes                            k8s_kube-controller-manager_kube-controller-manager-k8s-master_kube-system_c4d2dd4abfffdee4d424ce839b0de402_0</span><br><span class="line">cb06c651871a        registry.aliyuncs.com/google_containers/pause:3.2   <span class="string">"/pause"</span>                 7 minutes ago       Up 7 minutes                            k8s_POD_kube-scheduler-k8s-master_kube-system_ca2aa1b3224c37fa1791ef6c7d883bbe_0</span><br><span class="line">e8aea6d3013c        registry.aliyuncs.com/google_containers/pause:3.2   <span class="string">"/pause"</span>                 7 minutes ago       Up 7 minutes                            k8s_POD_kube-controller-manager-k8s-master_kube-system_c4d2dd4abfffdee4d424ce839b0de402_0</span><br><span class="line">f204181916d3        registry.aliyuncs.com/google_containers/pause:3.2   <span class="string">"/pause"</span>                 7 minutes ago       Up 7 minutes                            k8s_POD_kube-apiserver-k8s-master_kube-system_f3e487c167f719bc8a1a89c83db337de_0</span><br><span class="line">2f8174b2abff        registry.aliyuncs.com/google_containers/pause:3.2   <span class="string">"/pause"</span>                 7 minutes ago       Up 7 minutes                            k8s_POD_etcd-k8s-master_kube-system_f81fbe2336e90a6be7ee4138c7f4cf4a_0</span><br></pre></td></tr></tbody></table></figure><p>在 Master 节点配置 Kubectl 工具</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建目录</span></span><br><span class="line"><span class="keyword"># mkdir</span><span class="params"> -p</span> <span class="variable">$HOME</span>/.kube</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝配置文件</span></span><br><span class="line"><span class="keyword"># cp</span><span class="params"> -i</span> /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件授权</span></span><br><span class="line"><span class="keyword"># chown</span> $(id<span class="params"> -u</span>):$(id<span class="params"> -g</span>) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看组件的运行状态</span></span><br><span class="line"><span class="keyword"># kubectl</span> get cs</span><br><span class="line">NAME                 STATUS    MESSAGE             ERROR</span><br><span class="line">controller-manager   Healthy   ok                  </span><br><span class="line">scheduler            Healthy   ok                  </span><br><span class="line">etcd-0               Healthy   {<span class="string">"health"</span>:<span class="string">"true"</span>}   </span><br><span class="line"></span><br><span class="line"><span class="comment"># 提示：当上面的 STATUS 都变更为 "Healthy"（可能需要等待一段时间），则表示组件都处于健康状态，否则需要检查错误；如果排除不了问题，可以使用 "kubeadm reset" 命令重置 Master 节点，然后再重新执行 "kubeadm init" 命令初始化 Master 节点</span></span><br></pre></td></tr></tbody></table></figure><h3 id="Master-节点安装-CNI-网络插件"><a href="#Master-节点安装-CNI-网络插件" class="headerlink" title="Master 节点安装 CNI 网络插件"></a>Master 节点安装 CNI 网络插件</h3><div class="admonition warning"><p class="admonition-title">CNI 网络插件的安装细节</p><p>特别注意，网上有部分资料是在将 Node 节点加入到 Kubernetes 集群之后，才开始安装 CNI 网络插件的，本文给出的教程刚好相反。由于 <code>kubectl apply</code> 这个命令会创建一个 DaemonSet 类型的资源，而 DaemonSet 的特性是：会在 Kubernetes 集群中所有「可调度」的 Node 节点上运行一个副本。所以，即使在安装 CNI 网络插件时，Node 节点还没加入 Kubernetes 集群，一旦执行 <code>kubeadm join</code> 操作，新加入的 Node 节点会被 Kubernetes 集群感知到，Kubelet 连接成功后，DaemonSet 就会在新 Node 节点上自动调度一个 Pod（比如 Flannel Pod）。换言之，在 Master 节点上，通过 <code>kubectl apply</code> 命令安装 CNI 网络插件后，默认会将 CNI 网络插件部署到整个 Kubernetes 集群的所有节点（包括 Master 和 Node），无需手动在每个节点上重复执行 <code>kubectl apply</code> 命令来安装 CNI 网络插件。</p></div><div class="admonition note"><p class="admonition-title">为什么必须安装 CNI 网络插件</p><ul><li>Kubernetes 本身不包含网络实现，但它要求集群中的所有 Pod 能够彼此通信（无论位于哪个节点），这是 Kubernetes 网络模型的基本要求。</li><li>使用 <code>kubeadm init</code> 初始化 Master 节点后，默认只有控制平面功能，没有网络功能。</li><li>当没有安装 CNI 网络插件时，Pod 会卡在 <code>ContainerCreating</code> 状态，因为找不到网络（CNI）配置。</li><li>当安装 CNI 网络插件（如 Flannel）后，多个节点之间的 Pod 才能通信和正常运行。</li></ul></div><p>在 Master 节点查看所有节点的运行状态，此时 Master 节点处于 <code>NotReady</code>（未就绪）状态，这是因为集群中尚未安装 Flannel 网络插件，安装完网络插件后状态会自动变为 <code>Ready</code></p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有节点的运行状态</span></span><br><span class="line"><span class="keyword"># kubectl</span> get nodes</span><br><span class="line">NAME         STATUS     ROLES    AGE   VERSION</span><br><span class="line">k8s-master   NotReady   master   12m   v1.18.0</span><br></pre></td></tr></tbody></table></figure><p>在 Master 节点安装 Flannel 网络插件，若 <code>kubectl apply -f</code> 命令执行后提示网络连接失败，可留意文章后面给出的解决方案</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装Flannel网络插件</span></span><br><span class="line"><span class="keyword"># kubectl</span> apply<span class="params"> -f</span> https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></tbody></table></figure><p>在 Master 节点查看 Pod 的运行状态，当所有 Pod 的运行状态都变更为 <code>Running</code>（可能需要等待十几分钟甚至几十分钟），则说明所有 Pod 都正常运行</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询Pod的运行状态</span></span><br><span class="line"><span class="keyword"># kubectl</span> get pods<span class="params"> -n</span> kube-system</span><br><span class="line">NAME                                 READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-7ff77c879f-67rjn             1/1     Running   0          4m35s</span><br><span class="line">coredns-7ff77c879f-xpq9h             1/1     Running   0          4m35s</span><br><span class="line">etcd-k8s-master                      1/1     Running   0          4m44s</span><br><span class="line">kube-apiserver-k8s-master            1/1     Running   0          4m44s</span><br><span class="line">kube-controller-manager-k8s-master   1/1     Running   0          4m44s</span><br><span class="line">kube-flannel-ds-4jtp4                1/1     Running   0          2m36s</span><br><span class="line">kube-proxy-8bbhk                     1/1     Running   0          4m34s</span><br><span class="line">kube-scheduler-k8s-master            1/1     Running   0          4m44s</span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">特别注意</p><p>Flannel 网络插件安装完成后，需要耐心等待一段较长的时间（可能需要等待十几分钟甚至几十分钟），直到使用 <code>kubectl get pods -n kube-system</code> 命令查看到的所有 Pod 的运行状态都变更为 <code>Running</code> 为止，也就是说 Pod 的状态最终不能为 <code>Pending</code>，否则说明 Pod 的运行存在一定的问题，需要进一步定位错误原因。</p></div><p>在 Master 节点再次查看所有节点的运行状态，当 Master 节点的运行状态变更为 <code>Ready</code> 状态，就可以开始将 Node 节点加入集群了</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有节点的运行状态</span></span><br><span class="line"><span class="keyword"># kubectl</span> get nodes</span><br><span class="line">NAME         STATUS     ROLES    AGE   VERSION</span><br><span class="line">k8s-master   Ready      master   12m   v1.18.0</span><br></pre></td></tr></tbody></table></figure><h3 id="将-Node-节点加入到-Kubernetes-集群"><a href="#将-Node-节点加入到-Kubernetes-集群" class="headerlink" title="将 Node 节点加入到 Kubernetes 集群"></a>将 Node 节点加入到 Kubernetes 集群</h3><p>在各个 Node 节点里分别执行以下命令（<strong>请自行更改，切忌直接复制执行</strong>），向 Kubernetes 集群添加新节点，该命令是上面 <code>kubeadm init</code> 命令执行完成后在终端记录下来的</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加Node节点到集群</span></span><br><span class="line"><span class="keyword"># kubeadm</span> join 192.168.1.109:6443<span class="params"> --token</span> jve1cd.3ulp5fqifsptti23<span class="params"> --discovery</span>-token-ca-cert-<span class="built_in">hash</span> sha256:01229ee179cf13855dbf38bc050b3251928571996d60878f30ce13c08aaa62d5</span><br></pre></td></tr></tbody></table></figure><p>在 Master 节点执行以下命令，查看集群中所有 Node 节点的运行状态，当它们的运行状态都变更为 <code>Ready</code> 时（需要等待一段较长的时间），则表示所有 Node 节点都成功加入了集群</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有节点的运行状态</span></span><br><span class="line"><span class="keyword"># kubectl</span> get nodes</span><br><span class="line">NAME         STATUS   ROLES    AGE   VERSION</span><br><span class="line">k8s-master   Ready    master   24h   v1.18.0</span><br><span class="line">k8s-node1    Ready    &lt;none&gt;   92m   v1.18.0</span><br><span class="line">k8s-node2    Ready    &lt;none&gt;   91m   v1.18.0</span><br><span class="line">k8s-node3    Ready    &lt;none&gt;   91m   v1.18.0</span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">特别注意</p><p>这里通过 <code>kubeadm join</code> 命令将各个 Node 节点加入集群后，需要等待一段较长的时间（可能十几分钟甚至几十分钟），才能看到集群中所有 Node 节点的运行状态从 <code>NotReady</code> 变更为 <code>Ready</code>。</p></div><h3 id="测试-Kubernetes-集群是否正常运行"><a href="#测试-Kubernetes-集群是否正常运行" class="headerlink" title="测试 Kubernetes 集群是否正常运行"></a>测试 Kubernetes 集群是否正常运行</h3><p>在 Master 节点执行以下命令，查看集群中所有节点的运行状态，当它们的运行状态都变更为 <code>Ready</code> 时，则表示 Kubernetes 集群已经成功搭建起来了</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有节点的运行状态</span></span><br><span class="line"><span class="keyword"># kubectl</span> get nodes</span><br><span class="line">NAME         STATUS   ROLES    AGE   VERSION</span><br><span class="line">k8s-master   Ready    master   24h   v1.18.0</span><br><span class="line">k8s-node1    Ready    &lt;none&gt;   92m   v1.18.0</span><br><span class="line">k8s-node2    Ready    &lt;none&gt;   91m   v1.18.0</span><br><span class="line">k8s-node3    Ready    &lt;none&gt;   91m   v1.18.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询Pod的运行状态</span></span><br><span class="line"><span class="keyword"># kubectl</span> get pods<span class="params"> -n</span> kube-system</span><br><span class="line">NAME                                 READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-7ff77c879f-67rjn             1/1     Running   0          30m</span><br><span class="line">coredns-7ff77c879f-xpq9h             1/1     Running   0          30m</span><br><span class="line">etcd-k8s-master                      1/1     Running   0          30m</span><br><span class="line">kube-apiserver-k8s-master            1/1     Running   0          30m</span><br><span class="line">kube-controller-manager-k8s-master   1/1     Running   0          30m</span><br><span class="line">kube-flannel-ds-4jtp4                1/1     Running   0          28m</span><br><span class="line">kube-flannel-ds-6k8sp                1/1     Running   0          23m</span><br><span class="line">kube-flannel-ds-bzwrt                1/1     Running   0          23m</span><br><span class="line">kube-flannel-ds-rc8vv                1/1     Running   0          23m</span><br><span class="line">kube-proxy-8bbhk                     1/1     Running   0          30m</span><br><span class="line">kube-proxy-9f96v                     1/1     Running   0          23m</span><br><span class="line">kube-proxy-9j6qh                     1/1     Running   0          23m</span><br><span class="line">kube-proxy-bqm7t                     1/1     Running   0          23m</span><br><span class="line">kube-scheduler-k8s-master            1/1     Running   0          30m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看集群版本</span></span><br><span class="line"><span class="keyword"># kubectl</span> version<span class="params"> --short</span></span><br><span class="line">Client Version: v1.18.0</span><br><span class="line">Server Version: v1.18.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提示：当各节点的 Linux 系统重启后，Kubernetes 集群里对应的组件会自动启动，不需要人为干预</span></span><br></pre></td></tr></tbody></table></figure><p>在 Master 节点执行以下命令，目的是在 Kubernetes 集群里创建一个 Nginx 的 Deployment，验证 Kubernetes 集群是否正常运行</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建Nginx</span></span><br><span class="line"><span class="keyword"># kubectl</span> create deployment nginx<span class="params"> --image</span>=nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露Nginx的端口</span></span><br><span class="line"><span class="keyword"># kubectl</span> expose deployment nginx<span class="params"> --port</span>=80<span class="params"> --type</span>=NodePort<span class="params"> --target</span>-port=80</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Pod</span></span><br><span class="line"><span class="keyword"># kubectl</span> get pod</span><br><span class="line">NAME                        READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/nginx-f89759699-59cb7   1/1     Running   0          2m1s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Service</span></span><br><span class="line"><span class="keyword"># kubectl</span> get svc</span><br><span class="line">NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">service/kubernetes   ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP        48m</span><br><span class="line">service/nginx        NodePort    10.102.129.11   &lt;none&gt;        80:32517/TCP   10s</span><br></pre></td></tr></tbody></table></figure><p>通过浏览器访问 <code>http://192.168.31.62:32517</code>，请自行更改 IP 和端口；其中 IP 可以是任意节点的 IP 地址，端口由 <code>kubectl get svc</code> 命令可得知。若 Ngninx 容器在 Kubernetes 集群中创建并启动成功，则默认会打开 Nginx 的首页，如下图所示：</p><p><img data-src="../../../asset/2025/07/k8s-nginx.png"></p><p>若希望删除刚在 Kubernetes 集群创建的 Nginx 容器，可以在 Master 节点执行以下命令：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除Service</span></span><br><span class="line"><span class="keyword"># kubectl</span> delete service nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除Deployment</span></span><br><span class="line"><span class="keyword"># kubectl</span> delete deployment nginx</span><br></pre></td></tr></tbody></table></figure><h2 id="Kubeadm-部署-Dashboard-可视化插件"><a href="#Kubeadm-部署-Dashboard-可视化插件" class="headerlink" title="Kubeadm 部署 Dashboard 可视化插件"></a>Kubeadm 部署 Dashboard 可视化插件</h2><p>在 Kubernetes 集群部署 Dashboard 可视化插件的过程中，以下所有操作都是直接在 Master 节点里执行，后续不再累述。</p><h3 id="Dashboard-简介"><a href="#Dashboard-简介" class="headerlink" title="Dashboard 简介"></a>Dashboard 简介</h3><p>在 Kubernetes 社区中，有一个很受欢迎的 Dashboard 项目，它可以给用户提供一个可视化的 Web 界面来查看当前集群的各种信息。用户可以用 Kubernetes Dashboard 部署容器化的应用、监控应用的运行状态、执行故障排查任务以及管理 Kubernetes 各种资源。</p><ul><li><a target="_blank" rel="external nofollow" href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">Dashboard 官方文档</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/kubernetes/dashboard">Dashboard 官方项目</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/kubernetes/dashboard/releases">Dashboard 版本说明</a></li></ul><div class="admonition warning"><p class="admonition-title">特别注意</p><p>Dashboard 的版本必须与 Kubernetes 版本相匹配（兼容），否则 Dashboard 可能无法正常运行。</p></div><h3 id="Dashboard-部署"><a href="#Dashboard-部署" class="headerlink" title="Dashboard 部署"></a>Dashboard 部署</h3><p>通过 YAML 文件直接部署 Dashboard，这里的 Kubernetes <code>1.8</code> 版本对应的 Dashboard 版本为 <code>v2.0.3</code>，两者的版本号必须匹配</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署Dashboard</span></span><br><span class="line"><span class="keyword"># kubectl</span> apply<span class="params"> -f</span> https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.3/aio/deploy/recommended.yaml</span><br></pre></td></tr></tbody></table></figure><p>查看 Dashboard 的运行状态，可以看到运行了 2 个 Pod 及 2 个 Service</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看Pod的运行状态</span></span><br><span class="line"><span class="keyword"># kubectl</span><span class="params"> -n</span> kubernetes-dashboard get pods</span><br><span class="line">NAME                                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">dashboard-metrics-scraper-69b5dcbfcb-zq9sd   1/1     Running   0          9m36s</span><br><span class="line">kubernetes-dashboard-5795496d75-jfmfq        1/1     Running   0          9m15s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Service的运行状态</span></span><br><span class="line"><span class="keyword"># kubectl</span><span class="params"> -n</span> kubernetes-dashboard get svc</span><br><span class="line">NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">dashboard-metrics-scraper   ClusterIP   10.96.115.247   &lt;none&gt;        8000/TCP   117s</span><br><span class="line">kubernetes-dashboard        ClusterIP   10.100.88.170   &lt;none&gt;        443/TCP    117s</span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>使用 <code>kubectl -n kubernetes-dashboard get pods</code> 命令查看 Dashboard 的运行状态时，必须确保 Pod 的状态为 <code>Running</code>，且 <code>RESTARTS = 0</code>，否则 Dashboard 可能无法正常运行。当 Dashboard 无法正常运行，可以执行以下两个命令重启 Dashboard：</li><li>(1) 重启 Dashboard Metrics Scraper：<code>kubectl -n kubernetes-dashboard rollout restart deployment dashboard-metrics-scraper</code></li><li>(2) 重启 Dashboard：<code>kubectl -n kubernetes-dashboard rollout restart deployment kubernetes-dashboard</code></li></ul></div><h3 id="Dashboard-暴露服务"><a href="#Dashboard-暴露服务" class="headerlink" title="Dashboard 暴露服务"></a>Dashboard 暴露服务</h3><p>这里作为演示，使用 NodePort 方式将 Dashboard 的服务暴露在集群外，指定使用 <code>30443</code> 端口（可自定义）</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 暴露Service</span></span><br><span class="line"><span class="keyword"># kubectl</span>  patch svc kubernetes-dashboard<span class="params"> -n</span> kubernetes-dashboard<span class="params"> -p</span> <span class="string">'{"spec":{"type":"NodePort","ports":[{"port":443,"targetPort":8443,"nodePort":30443}]}}'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看暴露的Service</span></span><br><span class="line"><span class="keyword"># kubectl</span><span class="params"> -n</span> kubernetes-dashboard get svc</span><br><span class="line">NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE</span><br><span class="line">dashboard-metrics-scraper   ClusterIP   10.96.115.247   &lt;none&gt;        8000/TCP        6m2s</span><br><span class="line">kubernetes-dashboard        NodePort    10.100.88.170   &lt;none&gt;        443:30443/TCP   6m2s</span><br></pre></td></tr></tbody></table></figure><p>或者下载 YAML 文件，手动更改 Service 部分的端口，并以 NodePort 方式进行部署</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载YAML文件</span></span><br><span class="line"><span class="keyword"># wget</span> https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.3/aio/deploy/recommended.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更改YAML文件</span></span><br><span class="line"><span class="keyword"># vim</span> recommended.yaml</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">  name: kubernetes-dashboard</span><br><span class="line">  namespace: kubernetes-dashboard</span><br><span class="line">spec:</span><br><span class="line">  <span class="built_in">type</span>: NodePort</span><br><span class="line">  ports:</span><br><span class="line">    - port: 443</span><br><span class="line">      targetPort: 8443</span><br><span class="line">      nodePort: 30443</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新配置</span></span><br><span class="line"><span class="keyword"># kubectl</span> apply<span class="params"> -f</span> recommended.yaml</span><br></pre></td></tr></tbody></table></figure><h3 id="Dashboard-认证方式登录"><a href="#Dashboard-认证方式登录" class="headerlink" title="Dashboard 认证方式登录"></a>Dashboard 认证方式登录</h3><p>Dashboard 支持 Kubeconfig 和 Token 两种认证方式，这里选择 Token 认证方式登录，首先执行以下操作创建登录用户</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建YAML配置文件，复制下面的配置内容到文件中</span></span><br><span class="line"><span class="keyword"># vim</span> dashboard-adminuser.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Dashboard登录用户</span></span><br><span class="line"><span class="keyword"># kubectl</span> apply<span class="params"> -f</span> dashboard-adminuser.yaml</span><br></pre></td></tr></tbody></table></figure><p>YAML 配置文件 <code>dashboard-adminuser.yaml</code> 的完整内容如下，指定了一个名称为 <code>admin-user</code> 的服务账号，并放在 <code>kubernetes-dashboard</code> 命名空间下，同时将 <code>cluster-admin</code> 角色绑定到 <code>admin-user</code> 账户，这样 <code>admin-user</code> 账户就有了管理员的权限。默认情况下，Kubeadm 创建集群时已经创建了 <code>cluster-admin</code> 角色，只需直接绑定即可</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-admin</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br></pre></td></tr></tbody></table></figure><p>查看 <code>admin-user</code> 账户的 Token</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看Token</span></span><br><span class="line"><span class="keyword"># kubectl</span><span class="params"> -n</span> kubernetes-dashboard describe secret $(kubectl<span class="params"> -n</span> kubernetes-dashboard get secret | grep admin-user | awk <span class="string">'{print $1}'</span>)</span><br></pre></td></tr></tbody></table></figure><p>通过火狐浏览器访问 Dashboard 的登录界面，URL 是 <code>https://&lt;any_node_ip&gt;:30443</code>，其中 <code>any_node_ip</code> 可以是任意一个集群节点的 IP 地址。由于谷歌浏览器会强制使用 HTTPS 协议，这将导致无法访问 Dashboard 的登录页面，因此建议使用火狐浏览器进行访问</p><p><img data-src="../../../asset/2021/03/kubernetes-dashboard-1.png" alt="kubernetes-dashboard-1"></p><p>将获取到的 Token 复制到登录界面的 Token 输入框中，这样就可以正常登录 Dashboard</p><p><img data-src="../../../asset/2021/03/kubernetes-dashboard-2.png" alt="kubernetes-dashboard-2"></p><h3 id="Dashboard-配置登录超时"><a href="#Dashboard-配置登录超时" class="headerlink" title="Dashboard 配置登录超时"></a>Dashboard 配置登录超时</h3><div class="admonition note"><p class="admonition-title">提示</p><p>Dashboard 默认登录超时时间是 15min，可以为 Dashboard 容器增加 <code>--token-ttl</code> 参数来自定义登录超时时间。</p></div><p>下载并打开对应的 YAML 配置文件</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载YAML文件</span></span><br><span class="line"><span class="keyword"># wget</span> https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.3/aio/deploy/recommended.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑YAML文件</span></span><br><span class="line"><span class="keyword"># vim</span> recommended.yaml</span><br></pre></td></tr></tbody></table></figure><p>然后找到 <code>--auto-generate-certificates</code> 配置项（如下所示），在它后面添加 <code>--token-ttl=43200</code> 配置项</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">kubernetesui/dashboard:v2.0.3</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8443</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--auto-generate-certificates</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--namespace=kubernetes-dashboard</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--token-ttl=43200</span>   <span class="comment"># 只需要添加这行配置内容</span></span><br></pre></td></tr></tbody></table></figure><p>最后更新配置信息</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新配置信息</span></span><br><span class="line"><span class="keyword"># kubectl</span> apply<span class="params"> -f</span> recommended.yaml</span><br></pre></td></tr></tbody></table></figure><h2 id="Kubeadm-搭建集群问题总结"><a href="#Kubeadm-搭建集群问题总结" class="headerlink" title="Kubeadm 搭建集群问题总结"></a>Kubeadm 搭建集群问题总结</h2><h3 id="集群搭建问题一"><a href="#集群搭建问题一" class="headerlink" title="集群搭建问题一"></a>集群搭建问题一</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ERROR NumCPU]: the number of available CPUs 1 is less than the required 2</span><br></pre></td></tr></tbody></table></figure><p>执行 <code>kubeadm init</code> 命令时，提示 CPU 核心数少于 2，可以添加命令参数 <code>--ignore-preflight-errors=NumCPU</code> 忽略警告</p><h3 id="集群搭建问题二"><a href="#集群搭建问题二" class="headerlink" title="集群搭建问题二"></a>集群搭建问题二</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ERROR Swap]: running with swap on is not supported. Please disable swap</span><br></pre></td></tr></tbody></table></figure><p>执行 <code>kubeadm init</code> 命令时，提示启用了 swap 分区，可以添加命令参数 <code>--ignore-preflight-errors 'Swap'</code> 忽略错误，<strong>强烈建议禁用 Swap 分区，而不是忽略该错误信息</strong></p><h3 id="集群搭建问题三"><a href="#集群搭建问题三" class="headerlink" title="集群搭建问题三"></a>集群搭建问题三</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[WARNING SystemVerification]: this Docker version is not on the list of validated versions: 19.03.1. Latest validated version: 18.09</span><br></pre></td></tr></tbody></table></figure><p>执行 <code>kubeadm init</code> 命令时，提示 Docker 的版本过高，可能与 Kubernetes 的版本不兼容</p><h3 id="集群搭建问题四"><a href="#集群搭建问题四" class="headerlink" title="集群搭建问题四"></a>集群搭建问题四</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The connection to the server raw.githubusercontent.com was refused - did you specify the right host or port?</span><br></pre></td></tr></tbody></table></figure><p>执行 <code>kubectl apply -f https://raw.githubusercontent.com/xxx</code> 命令时，提示网络链接失败，这是国内无法访问 <code>raw.githubusercontent.com</code> 导致，临时解决方法如下：</p><ul><li>在 <code>https://www.ipaddress.com</code> 网站上查询 <code>raw.githubusercontent.com</code> 域名的真实 IP 地址</li><li>更改系统的 <code>/etc/hosts</code> 配置文件，添加一行内容 <code>185.199.108.133 raw.githubusercontent.com</code>，将 <code>185.199.108.133</code> 替换为查询到真实的 IP 地址</li><li>重新执行 <code>kubectl apply -f https://raw.githubusercontent.com/xxx</code> 命令即可</li></ul><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a target="_blank" rel="external nofollow" href="https://blog.csdn.net/networken/article/details/85607593">Kubernetes 部署 Dashboard 可视化插件</a></li><li><a target="_blank" rel="external nofollow" href="https://blog.csdn.net/u010948569/article/details/107059535/">Kubeadm 部署单 Master 节点 Kubernetes 集群</a></li></ul></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang=""><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/ffd8d40a.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Clay 的技术空间"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/posts/ffd8d40a.html" class="post-title-link" itemprop="url">LeetCode 刷题教程之一</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-03-11 21:55:33" itemprop="dateCreated datePublished" datetime="2021-03-11T21:55:33+08:00">2021-03-11</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/ffd8d40a.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/ffd8d40a.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>2.9k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>3 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/ffd8d40a.html">LeetCode 刷题教程之一</a></li><li><a href="/posts/d43b3761.html">LeetCode 刷题教程之二</a></li></ul><h2 id="第-1-道题-两数之和"><a href="#第-1-道题-两数之和" class="headerlink" title="第 1 道题 - 两数之和"></a>第 1 道题 - 两数之和</h2><div class="admonition note"><p class="admonition-title">题目来源</p><p>这是 LeetCode 的 第 1 道算法题 - <a target="_blank" rel="external nofollow" href="https://leetcode.cn/problems/two-sum/">两数之和</a>，难度为简单。</p></div><div class="post-button"> <a class="btn" href="/posts/ffd8d40a.html#more" rel="contents">阅读全文 »</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang=""><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/e2246230.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Clay 的技术空间"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/posts/e2246230.html" class="post-title-link" itemprop="url">Knife4j 基础使用教程</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-03-09 21:12:29" itemprop="dateCreated datePublished" datetime="2021-03-09T21:12:29+08:00">2021-03-09</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-03-11 21:12:29" itemprop="dateModified" datetime="2023-03-11T21:12:29+08:00">2023-03-11</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/e2246230.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/e2246230.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>2.5k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>2 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h2><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/xiaoymin/swagger-bootstrap-ui">Knife4j Github 项目</a></li><li><a target="_blank" rel="external nofollow" href="https://gitee.com/xiaoym/swagger-bootstrap-ui-demo">Knife4j 官方示例代码</a></li><li><a target="_blank" rel="external nofollow" href="https://doc.xiaominfo.com/">Knife4j 官方中文文档 - 最新</a></li><li><a target="_blank" rel="external nofollow" href="https://doc.xiaominfo.com/v2/">Knife4j 官方中文文档 - 旧版</a></li></ul><div class="admonition warning"><p class="admonition-title">特别注意</p><p>如何没有特别标注说明，本文默认使用的 Knife4j 版本是 <code>2.x</code>。</p></div><h3 id="1-1、Knife4j-简介"><a href="#1-1、Knife4j-简介" class="headerlink" title="1.1、Knife4j 简介"></a>1.1、Knife4j 简介</h3><p>Knife4j 是为 Java MVC 框架集成 Swagger 生成 Api 文档的增强解决方案，前身是 <code>swagger-bootstrap-ui</code>，致力于 <code>springfox-swagger</code> 的增强 UI 实现。knife4j 为了契合微服务的架构发展，由于原来 <code>swagger-bootstrap-ui</code> 采用的是后端 Java 代码 + 前端 UI 混合打包的方式，在微服务架构下显的很臃肿，因此项目正式更名为 knife4j，更名后主要专注的方面如下：</p><ul><li>后端 Java 代码以及前端 UI 模块进行了分离，在微服务架构下使用更加灵活</li><li>提供专注于 Swagger 的增强解决方案，不同于只是单纯增强前端 UI 部分</li></ul><h3 id="1-2、Knife4j-模块"><a href="#1-2、Knife4j-模块" class="headerlink" title="1.2、Knife4j 模块"></a>1.2、Knife4j 模块</h3><table><thead><tr><th>模块名称</th><th>说明</th></tr></thead><tbody><tr><td> knife4j</td><td> 为 Java MVC 框架集成 Swagger 的增强解决方案</td></tr><tr><td> knife4j-admin</td><td> 云端 Swagger 接口文档注册管理中心，集成 gateway 网关对任意微服务文档进行组合集成</td></tr><tr><td> knife4j-extension</td><td>chrome 浏览器的增强 swagger 接口文档 ui, 快速渲染 swagger 资源</td></tr><tr><td> knife4j-service</td><td> 为 swagger 服务的一系列接口服务程序</td></tr><tr><td> knife4j-front</td><td>knife4j-spring-ui 的纯前端静态版本，用于集成非 Java 语言使用</td></tr><tr><td> swagger-bootstrap-ui</td><td>knife4j 的前身，最后发布版本是 1.9.6</td></tr></tbody></table><div class="post-button"> <a class="btn" href="/posts/e2246230.html#more" rel="contents">阅读全文 »</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang=""><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/1b9bb05b.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Clay 的技术空间"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/posts/1b9bb05b.html" class="post-title-link" itemprop="url">JWT 基础使用教程</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-03-02 21:32:22" itemprop="dateCreated datePublished" datetime="2021-03-02T21:32:22+08:00">2021-03-02</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/1b9bb05b.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/1b9bb05b.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>3.8k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>3 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="JWT-的概述"><a href="#JWT-的概述" class="headerlink" title="JWT 的概述"></a>JWT 的概述</h2><p>JWT（JSON Web Token）是目前最流行的跨域身份验证解决方案。</p><h3 id="传统的身份验证"><a href="#传统的身份验证" class="headerlink" title="传统的身份验证"></a>传统的身份验证</h3><ul><li>用户向服务器发送用户名和密码</li><li>验证服务器后，相关数据（如用户角色，登录时间等）将保存在当前会话中</li><li>服务器向用户返回 <code>session_id</code>，Session 信息都会写入到用户的 Cookie 中</li><li>用户的每个后续请求都将通过在 Cookie 中取出 <code>session_id</code> 并传递给服务器</li><li>服务器收到 <code>session_id</code> 并对比之前保存的数据，确认用户的身份</li></ul><p>这种模式最大的问题是，没有分布式架构，无法支持横向扩展。如果使用一个服务器，该模式完全没有问题。但是，如果它是服务器群集或面向服务的跨域体系结构的话，则需要一个统一的 Session 数据库（Redis）来保存会话数据实现共享，如果保存 Session 的数据库（Redis）挂掉，整个认证体系都会挂掉。</p><div class="post-button"> <a class="btn" href="/posts/1b9bb05b.html#more" rel="contents">阅读全文 »</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang=""><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/3644bd49.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Clay 的技术空间"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/posts/3644bd49.html" class="post-title-link" itemprop="url">JetBrains IDEA 2020.3.2 破解激活教程</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-02-28 21:18:36" itemprop="dateCreated datePublished" datetime="2021-02-28T21:18:36+08:00">2021-02-28</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-10-26 21:18:36" itemprop="dateModified" datetime="2021-10-26T21:18:36+08:00">2021-10-26</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/3644bd49.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/3644bd49.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>1.4k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>1 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="最新公告"><a href="#最新公告" class="headerlink" title="最新公告"></a>最新公告</h2><p><strong>本教程提供的激活码已失效，建议参考<a href="/posts/cfba1e15.html">这篇博客</a>，使用最新的方式来激活 JetBrains IDEA 2020.3.2 或者更新的版本。</strong></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本教程适用于 JetBrains IDEA 2020.3.2 以下所有版本（包括 IDEA 2020 全系列），支持将 IDEA 2020.3.2 激活到 2099 年，亲测激活成功！！！</p><h2 id="资源下载"><a href="#资源下载" class="headerlink" title="资源下载"></a>资源下载</h2><ul><li>JetBrains IDEA 下载：<a target="_blank" rel="external nofollow" href="https://www.jetbrains.com/idea/">官网</a></li><li> JetBrains IDEA&nbsp;破解补丁下载：<a href="/downloads/2021/02/jetbrains-idea-2020.3.2-crack.zip">本站</a></li></ul><h2 id="激活步骤"><a href="#激活步骤" class="headerlink" title="激活步骤"></a>激活步骤</h2><h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3><p>更改 hosts 文件，将 hosts 文件中有关 Jetbrains 的配置行全部删除掉，若没有则请忽略此步骤。Windows 系统的 hosts 文件路径为：<code>C:\Windows\System32\drivers\etc\hosts</code>，Linux 和 Mac 系统的 hosts 文件路径为：<code>/etc/hosts</code>，一般情况下只需删除以下两行内容即可：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0.0.0.0 www.jetbrains.com</span><br><span class="line">0.0.0.0 account.jetbrains.com</span><br></pre></td></tr></tbody></table></figure><div class="post-button"> <a class="btn" href="/posts/3644bd49.html#more" rel="contents">阅读全文 »</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang=""><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/f838cf2a.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Clay 的技术空间"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/posts/f838cf2a.html" class="post-title-link" itemprop="url">Redisson 分布式锁使用教程</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-02-15 23:42:21" itemprop="dateCreated datePublished" datetime="2021-02-15T23:42:21+08:00">2021-02-15</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-02-23 23:42:21" itemprop="dateModified" datetime="2023-02-23T23:42:21+08:00">2023-02-23</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/f838cf2a.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/f838cf2a.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>3.1k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>3 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/150bedf.html">Redis 缓存与分布式锁</a></li><li><a href="/posts/f838cf2a.html">Redisson 分布式锁使用教程</a></li><li><a href="/posts/51ce4ef9.html">Redis 分布式锁中 Lua 脚本的使用</a></li><li><a href="/posts/912f33ba.html">Java 基于 MySQL 实现分布式锁</a></li><li><a href="/posts/f4b8817b.html">基于 ZooKeeper 原生 API 实现分布式锁</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h3><ul><li><a target="_blank" rel="external nofollow" href="https://redisson.org/">Redisson 官网</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/redisson/redisson/wiki/%E7%9B%AE%E5%BD%95">Redisson 官方文档</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/redisson/redisson">Redisson GitHub 仓库</a></li></ul><h2 id="Redisson-简介"><a href="#Redisson-简介" class="headerlink" title="Redisson 简介"></a>Redisson 简介</h2><p>Redisson 是架设在 Redis 基础上的一个 Java 驻内存数据网格（In-Memory Data Grid）。充分地利用了 Redis 键值数据库提供的一系列优势，基于 Java 实用工具包中的常用接口，为使用者提供了一系列具有分布式特性的常用工具类。使得原本作为协调单机多线程并发程序的工具包获得了协调分布式多机多线程并发系统的能力，大大降低了设计和研发大规模分布式系统的难度。同时结合各富特色的分布式服务，更进一步简化了分布式环境中程序相互之间的协作。Redisson 的宗旨是促进使用者对 Redis 的关注分离（Separation of Concern），从而让使用者能够将精力更集中地放在处理业务逻辑上。值得一提的是，Redisson 底层采用的是 Netty 框架。支持 Redis 2.8 以上版本，支持 Java 1.6+ 以上版本。</p><div class="post-button"> <a class="btn" href="/posts/f838cf2a.html#more" rel="contents">阅读全文 »</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang=""><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/51ce4ef9.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Clay 的技术空间"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/posts/51ce4ef9.html" class="post-title-link" itemprop="url">Redis 分布式锁中 Lua 脚本的使用</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-02-11 23:42:21" itemprop="dateCreated datePublished" datetime="2021-02-11T23:42:21+08:00">2021-02-11</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-02-25 23:42:21" itemprop="dateModified" datetime="2023-02-25T23:42:21+08:00">2023-02-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/51ce4ef9.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/51ce4ef9.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>2.2k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>2 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/150bedf.html">Redis 缓存与分布式锁</a></li><li><a href="/posts/f838cf2a.html">Redisson 分布式锁使用教程</a></li><li><a href="/posts/51ce4ef9.html">Redis 分布式锁中 Lua 脚本的使用</a></li><li><a href="/posts/912f33ba.html">Java 基于 MySQL 实现分布式锁</a></li><li><a href="/posts/f4b8817b.html">基于 ZooKeeper 原生 API 实现分布式锁</a></li></ul><h2 id="Lua-简介"><a href="#Lua-简介" class="headerlink" title="Lua 简介"></a>Lua 简介</h2><p>从 Redis 2.6.0 版本开始，通过内置的 Lua 解释器，可以使用 <code>EVAL</code> 命令对 Lua 脚本进行求值。Redis 使用单个 Lua 解释器去运行所有脚本，并且 Redis 也保证脚本会以原子性 (atomic) 的方式执行。当某个脚本正在运行的时候，不会有其他脚本或 Redis 命令被执行。这和使用 <code>MULTI / EXEC</code> 包围的事务很类似。在其他别的客户端看来，脚本的效果 (effect) 要么是不可见的 (not visible)，要么就是已完成的 (already completed)。在 Lua 脚本中，可以使用 <code>redis.call ()</code> 函数来执行 Redis 命令。</p><h2 id="Lua-在-Reids-中的使用方式"><a href="#Lua-在-Reids-中的使用方式" class="headerlink" title="Lua 在 Reids 中的使用方式"></a>Lua 在 Reids 中的使用方式</h2><p>​Redis 中内嵌了 Lua 脚本的解释器，并提供了执行 Lua 脚本的入口 <code>eval</code> 命令，格式为 <code>eval script numkeys key [key ...] arg [arg...]</code>。其中 <code>eval</code> 为命令，<code>script</code> 为执行的命令脚本，<code>numkeys</code> 为脚本中共涉及到的 <code>key</code> 的数量，后续接收若干个 <code>key</code> 的输入和若干个 <code>arg</code> 的输入。​在 Lua 脚本中使用 <code>KEYS[index]</code>， 和 <code>ARGV[index]</code> 来获取实际输入的参数，这有点类似于 SQL 的占位符。另外一层原因由于 Redis 集群的固有模式导致 <code>EVAL</code> 命令在集群中涉及多个 KEY 的操作时，要求所有的 KEY 都在同一个 Hash Solt 上。在集群环境中调用 <code>EVAL</code> 命令，Redis 会对脚本先做一个的校验。<code>KEYS[1] KEYS[2]</code> 是要操作的键，可以指定多个，在 Lua 脚本中可以通过 <code>KEYS[1]</code>、<code>KEYS[2]</code> 获取 Key 的值。特别注意，这些键要在 Redis 中存在，不然就获取不到对应的值。<code>ARGV[1] ARGV[2]</code> 参数在 Lua 脚本中可以通过 <code>ARGV[1]</code>、<code>ARGV[2]</code> 获取值。</p><div class="post-button"> <a class="btn" href="/posts/51ce4ef9.html#more" rel="contents">阅读全文 »</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang=""><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/150bedf.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Clay 的技术空间"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/posts/150bedf.html" class="post-title-link" itemprop="url">Redis 缓存与分布式锁</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-02-08 23:42:21" itemprop="dateCreated datePublished" datetime="2021-02-08T23:42:21+08:00">2021-02-08</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-05-21 23:42:21" itemprop="dateModified" datetime="2024-05-21T23:42:21+08:00">2024-05-21</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/150bedf.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/150bedf.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>5k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>5 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/150bedf.html">Redis 缓存与分布式锁</a></li><li><a href="/posts/f838cf2a.html">Redisson 分布式锁使用教程</a></li><li><a href="/posts/51ce4ef9.html">Redis 分布式锁中 Lua 脚本的使用</a></li><li><a href="/posts/912f33ba.html">Java 基于 MySQL 实现分布式锁</a></li><li><a href="/posts/f4b8817b.html">基于 ZooKeeper 原生 API 实现分布式锁</a></li></ul><h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><h3 id="缓存使用"><a href="#缓存使用" class="headerlink" title="缓存使用"></a>缓存使用</h3><p>为了系统性能的提升，一般都会将部分数据放入缓存中，加快业务服务的处理速度，而数据库则承担数据落盘的工作。</p><div class="admonition note"><p class="admonition-title">哪些数据适合放入缓存？</p><ul><li>即时性、数据一致性要求不高的数据</li><li>访问量大且更新频率不高的数据（读多写少）</li></ul></div><p>比如在电商类应用中，商品分类，商品列表等数据适合缓存，并加一个失效时间 (根据数据更新频率来决定)，后台如果发布一个商品，买家需要 5 分钟后才能看到新的商品，这一般还是可以接受的。</p><div class="post-button"> <a class="btn" href="/posts/150bedf.html#more" rel="contents">阅读全文 »</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang=""><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/vbd8mmaf.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Clay 的技术空间"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/posts/vbd8mmaf.html" class="post-title-link" itemprop="url">Linux 管理 Crontab 服务</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-01-26 20:43:29" itemprop="dateCreated datePublished" datetime="2021-01-26T20:43:29+08:00">2021-01-26</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-01-08 20:43:29" itemprop="dateModified" datetime="2022-01-08T20:43:29+08:00">2022-01-08</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/vbd8mmaf.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/vbd8mmaf.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>1.1k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>1 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><div class="admonition note"><p class="admonition-title">前言</p><p>本文主要介绍如何在 Linux 系统上安装和管理 Crontab 服务，适用于 Debian 9、CentOS 7 系统。</p></div><h2 id="Crontab-安装"><a href="#Crontab-安装" class="headerlink" title="Crontab 安装"></a>Crontab 安装</h2><h3 id="Crontab-安装（CentOS-7）"><a href="#Crontab-安装（CentOS-7）" class="headerlink" title="Crontab 安装（CentOS 7）"></a>Crontab 安装（CentOS 7）</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword"># yum</span> instal crontabs</span><br></pre></td></tr></tbody></table></figure><h3 id="Crontab-安装（Debian-9）"><a href="#Crontab-安装（Debian-9）" class="headerlink" title="Crontab 安装（Debian 9）"></a>Crontab 安装（Debian 9）</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword"># apt</span>-get install cron</span><br></pre></td></tr></tbody></table></figure><div class="post-button"> <a class="btn" href="/posts/vbd8mmaf.html#more" rel="contents">阅读全文 »</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang=""><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/4d31c632.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content=" | Clay 的技术空间"><meta itemprop="description" content=""></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> <a href="/posts/4d31c632.html" class="post-title-link" itemprop="url">Centos7 安装 ExpressVPN 客户端</a></h2><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-01-23 09:12:32" itemprop="dateCreated datePublished" datetime="2021-01-23T09:12:32+08:00">2021-01-23</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-10-25 22:18:46" itemprop="dateModified" datetime="2021-10-25T22:18:46+08:00">2021-10-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/4d31c632.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/4d31c632.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>1.8k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>2 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="ExpressVPN-介绍"><a href="#ExpressVPN-介绍" class="headerlink" title="ExpressVPN 介绍"></a>ExpressVPN 介绍</h3><ul><li><a target="_blank" rel="external nofollow" href="https://www.expressvpn.com/">ExpressVPN 官网</a></li><li><a href="../../../asset/2021/01/expressvpn-features.png">ExpressVPN 的优势</a></li><li><a target="_blank" rel="external nofollow" href="https://www.expressvpn.com/vpn-software/vpn-router">ExpressVPN 支持的路由器型号</a></li><li><a href="../../../asset/2021/01/expressvpn-devices-support.png">ExpressVPN 支持的所有设备类型</a></li><li><a href="../../../asset/2021/01/expressvpn-devices-limit.png">ExpressVPN 支持同一个账号最多 5 个设备同时使用</a></li><li><a href="../../../asset/2021/01/expressvpn-devices-limit-2.png">ExpressVPN 如何支持 5 个以上的设备同时使用一个账号</a></li></ul><div class="post-button"> <a class="btn" href="/posts/4d31c632.html#more" rel="contents">阅读全文 »</a></div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></div><nav class="pagination"><a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/38/"><i class="fa fa-angle-left"></i></a> <a class="page-number" href="/">1</a><span class="space">…</span><a class="page-number" href="/page/38/">38</a><span class="page-number current">39</span><a class="page-number" href="/page/40/">40</a><span class="space">…</span><a class="page-number" href="/page/74/">74</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/40/"><i class="fa fa-angle-right"></i></a></nav><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"no",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">30:43</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/page/39/"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>