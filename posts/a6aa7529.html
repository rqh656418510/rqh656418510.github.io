<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 MySQL 数据库读写分离的解决方案。"><meta property="og:type" content="article"><meta property="og:title" content="数据库读写分离解决方案介绍"><meta property="og:url" content="https://www.techgrow.cn/posts/a6aa7529.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 MySQL 数据库读写分离的解决方案。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2023/10/mysql-ha-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2023/10/mysql-ha-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2023/10/mysql-read-write-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2023/10/mysql-read-write-2.png"><meta property="article:published_time" content="2019-07-10T14:45:21.000Z"><meta property="article:modified_time" content="2025-08-20T14:45:21.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="Java"><meta property="article:tag" content="数据库"><meta property="article:tag" content="分布式"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2023/10/mysql-ha-1.png"><link rel="canonical" href="https://www.techgrow.cn/posts/a6aa7529.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/a6aa7529.html","path":"posts/a6aa7529.html","title":"数据库读写分离解决方案介绍"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>数据库读写分离解决方案介绍 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="nav-text">数据库中间件介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">读写分离解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">客户端解决方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">中间件解决方案</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-text">读写分离最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ShardingSphere"><span class="nav-text">ShardingSphere</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ShardingSphere-Proxy"><span class="nav-text">ShardingSphere-Proxy</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ShardingSphere-JDBC"><span class="nav-text">ShardingSphere-JDBC</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dynamic-Datasource"><span class="nav-text">Dynamic-Datasource</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB"><span class="nav-text">扩展阅读</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL-%E5%85%B6%E4%BB%96%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="nav-text">MySQL 其他中间件介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL-%E5%B8%B8%E7%94%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%80%BB%E7%BB%93"><span class="nav-text">MySQL 常用解决方案总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96-MySQL-%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE"><span class="nav-text">其他 MySQL 中间件开源项目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="nav-text">参考文献</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">736</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/a6aa7529.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="数据库读写分离解决方案介绍 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 MySQL 数据库读写分离的解决方案。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 数据库读写分离解决方案介绍</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-07-10 22:45:21" itemprop="dateCreated datePublished" datetime="2019-07-10T22:45:21+08:00">2019-07-10</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-08-20 22:45:21" itemprop="dateModified" datetime="2025-08-20T22:45:21+08:00">2025-08-20</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/a6aa7529.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/a6aa7529.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>5.2k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>5 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>读写分离要做的事情就是决定一条 SQL 该到哪个数据库去执行，至于谁来做决定数据库这件事，要么数据库中间件去做，要么应用程序自己去做。首先针对应用程序自己去做的场景，读写分离的职责应该属于数据访问层而不是业务层，其次读写分离不应该入侵到代码中。因此在 Service—DAO—ORM— 数据库驱动的调用链中，要想做到代码弱入侵性或者零入侵性，只能将读写分离写在 ORM 层或者数据库驱动层，写在 ORM 层就和具体 ORM 框架耦合，写在数据库驱动层，就和具体数据库耦合。至于在 ORM 层还是在数据库驱动层实现读写分离，主要看更换 ORM 框架和数据库哪个成本更高和实现的难易程度。一般来讲，读写分离的核心方案主要有以下几种：</p><ul><li>第一种构建多套环境，优势是方便控制也容易集成一些简单的分布式事务，缺点是非动态同时代码量较多，配置难度大；</li><li>第二种是依靠数据库中间件（例如：MyCat），由中间件做读写分离，优势是对整个应用程序都是透明的，缺点是降低性能，不支持多数据源事务；</li><li>第三种是应用程序自己去做，例如使用支持读写分离的数据库驱动、使用 Spring 原生提供的 AbstractRoutingDataSource。后者需要控制只读事务和读写事务切换到主库，写操作切换到主库，读操作切换到从库；同时保证单个事务里面所有的 SQL 都是在同一个数据源里执行。缺点是多数据源的配置不灵活，不支持多数据源事务。具体实现方式可参考 <a target="_blank" rel="external nofollow" href="https://www.cnblogs.com/cjsblog/p/9712457.html">基于 Service 层的 Spring 路由数据源 + AOP / Annotation</a>、<a target="_blank" rel="external nofollow" href="https://blog.csdn.net/weixin_42604515/article/details/82010808">基于 ORM 层的 Spring 路由数据源 + Mybatis 插件 / Annotation</a>。</li></ul><span id="more"></span><h2 id="数据库中间件介绍"><a href="#数据库中间件介绍" class="headerlink" title="数据库中间件介绍"></a>数据库中间件介绍</h2><p>读写分离、分库分表中间件通常分为 Proxy 层和 Client 层两种类型，不同中间件的优缺点如下所示：</p><ul><li><p><strong><a target="_blank" rel="external nofollow" href="https://github.com/alibaba/tb_tddl">TDDL</a></strong></p><ul><li> 出身：淘宝团队研发，大概在 2008 年左右就在淘宝内部投入使用，是一种 Client 层方案。</li><li>状态：目前已很久未更新，已几乎被废弃，不建议使用。</li><li>优势：支持基本 CRUD 操作和读写分离。</li><li>局限：不支持 JOIN 和多表查询，依赖淘宝内部的 Diamond 配置系统，社区采用不多，适用性有限。</li></ul></li><li><p><strong><a target="_blank" rel="external nofollow" href="https://github.com/alibaba/cobar">Cobar</a></strong></p><ul><li> 出身：阿里巴巴 B2B 团队开发，诞生时间大约在 2009~2010 年，后来在 2012 年开源，是一种 Proxy 层方案。</li><li>状态：目前已很久未更新，已几乎被废弃，不建议使用。</li><li>局限：不支持读写分离、存储过程、跨库 JOIN、跨库分页等功能。</li></ul></li><li><p><strong><a target="_blank" rel="external nofollow" href="https://github.com/Qihoo360/Atlas">Atlas</a></strong></p><ul><li> 出身：360 开源，是一种 Proxy 层方案。</li><li>状态：目前已很久未更新，已几乎被废弃，不建议使用。</li><li>局限：功能上较为简单，仅支持 MySQL 协议代理，主要实现读写分离、简单分表，不支持复杂的分库分表场景。</li></ul></li><li><p><strong><a target="_blank" rel="external nofollow" href="https://github.com/vitessio/vitess">Vitess</a></strong></p><ul><li> 出身：Google 开发，用于构建云原生、水平可扩展的分布式数据库系统，主要是 Proxy/Cluster 层方案。</li><li>优势：提供分片、水平扩展、透明 SQL 分布式查询、事务支持等功能；适合大规模、高并发的 MySQL 场景；云原生友好，可与 Kubernetes 等集群管理系统集成。</li><li>局限：架构相对复杂，需要额外的运维和学习成本；主要面向大规模场景，对小型项目可能过于重量级；部分高级功能（如跨分片事务）需要谨慎使用。</li></ul></li><li><p><strong><a target="_blank" rel="external nofollow" href="https://github.com/sysown/proxysql">ProxySQL</a></strong></p><ul><li> 出身：国外开源社区开发，专注于高性能 MySQL 代理，是一种 Proxy 层方案。</li><li>优势：支持读写分离、负载均衡、查询路由、连接池、查询缓存等功能；部署灵活，性能高，可支持高并发场景；多语言客户端透明接入。</li><li>局限：需要额外部署和运维中间件，网络跳转会带来一定延迟；对复杂分库分表逻辑需要额外配置，学习成本相对较高；社区活跃度高，但中文文档和案例相对少。</li></ul></li><li><p><strong><a target="_blank" rel="external nofollow" href="https://github.com/apache/shardingsphere">ShardingSphere</a></strong></p><ul><li> 项目源起：<ul><li>由 Sharding-JDBC 演化成如今的 Apache ShardingSphere，包含多个组件：JDBC（Client 层）、Proxy（Proxy 层）、Sidecar 等。</li></ul></li><li>Sharding-JDBC（Client 层方案）：<ul><li>优点：以 <code>.jar</code> 形式嵌入项目，运维轻松，性能接近原生 JDBC，低侵入性。</li><li>局限：仅支持 Java，升级依赖分散到各个应用，需要统一发布更新。</li></ul></li><li>ShardingSphere-Proxy（Proxy 层方案）：<ul><li>优点：作为独立进程部署，支持多语言客户端，接入透明，便于统一管理、运维，适合 OLAP 操作和 DBA 管理。</li><li>局限：多了网络跳转，性能略逊于 JDBC，且需额外部署、维护中间件。</li><li>社区活跃度：社区活跃、版本持续迭代，功能丰富，包括读写分离、分布式事务、治理、安全、多数据源等。</li></ul></li></ul></li><li><p><strong><a target="_blank" rel="external nofollow" href="https://github.com/MyCATApache/Mycat-Server">MyCAT</a></strong></p><ul><li> 出身：基于 Cobar 改造，是一种 Proxy 层方案。</li><li>优势：功能全面，支持事务、跨库分片、聚合计算等，不少企业已有应用案例。</li><li>局限：社区更新不算频繁，相较 ShardingSphere 较年轻，稳定性和成熟度略逊，最新公开版本发布时间较早。</li></ul></li></ul><p>终上所述，目前常见的分库分表中间件，主要建议考虑 Sharding-JDBC 和 MyCAT 这两个。</p><ul><li><p>Sharding-JDBC（Client 层方案）：</p><ul><li>优点：无需单独部署中间件，运维成本低，不涉及代理层的二次转发，性能高。</li><li>缺点：如果版本升级，需要每个业务系统单独升级并重新发布，而且各个系统必须耦合 Sharding-JDBC 的依赖。</li></ul></li><li><p>MyCAT（Proxy 层方案）：</p><ul><li>优点：作为独立中间件部署，对各个项目透明，系统接入方便。如果需要升级，只需要在中间件层处理即可，不需要各业务系统修改。</li><li>缺点：需要额外部署和运维中间件，运维成本更高。</li></ul></li><li><p>适用场景：</p><ul><li>中小型公司：推荐使用 Sharding-JDBC 这类 Client 层方案。因为系统复杂度相对较低，项目数量不多，运维人力有限，使用 Client 层方案更轻便，维护成本低。</li><li>中大型公司：更适合 MyCAT 这类 Proxy 层方案。因为系统和项目数量多，团队规模大，可以安排专人研究和维护 MyCAT，而大量项目能直接透明接入，整体更易管理。</li></ul></li></ul><h2 id="读写分离解决方案"><a href="#读写分离解决方案" class="headerlink" title="读写分离解决方案"></a>读写分离解决方案</h2><h3 id="客户端解决方案"><a href="#客户端解决方案" class="headerlink" title="客户端解决方案"></a>客户端解决方案</h3><blockquote><p>方案的概述</p></blockquote><ul><li><code>客户端解决方案（持久化层）</code>：TDDL、ShardingSphere-JDBC</li></ul><p><img data-src="../../../asset/2023/10/mysql-ha-1.png"></p><blockquote><p>方案的优缺点</p></blockquote><ul><li><p>优点</p><ul><li>数据源方便由应用直接管理</li><li>运维不需要额外维护中间件</li><li>理论上支持任何数据库（SQL 标准）</li></ul></li><li><p>缺点</p><ul><li>增加了开发成本、对代码有一定的入侵性</li><li>不能做到动态增加数据源</li><li>开发人员开发完成后，运维人员参与不了</li></ul></li></ul><h3 id="中间件解决方案"><a href="#中间件解决方案" class="headerlink" title="中间件解决方案"></a>中间件解决方案</h3><blockquote><p>方案的概述</p></blockquote><ul><li><code>中间件解决方案（代理层）</code>：MySQL Proxy、MyCat、Altas</li></ul><p><img data-src="../../../asset/2023/10/mysql-ha-2.png"></p><blockquote><p>方案的优缺点</p></blockquote><ul><li><p>优点</p><ul><li>持久化层不需要管数据库方面的事情</li><li>数据源增加了对应用没有任何影响（不需要重启应用）</li></ul></li><li><p>缺点</p><ul><li>应用依赖了中间件，导致切换数据库变得困难</li><li>增加了 Proxy 中间件，导致数据库性能下降</li><li>增加了维护难度、高可用等问题</li></ul></li></ul><h2 id="读写分离最佳实践"><a href="#读写分离最佳实践" class="headerlink" title="读写分离最佳实践"></a>读写分离最佳实践</h2><h3 id="ShardingSphere"><a href="#ShardingSphere" class="headerlink" title="ShardingSphere"></a>ShardingSphere</h3><p><a href="(https://github.com/apache/incubator-shardingsphere)">ShardingSphere</a> 是 Apache 的一款分布式的数据库生态系统，它包含两大产品：ShardingSphere-Proxy、ShardingSphere-JDBC。<strong>值得一提的是，ShardingSphere-JDBC 提供了读写分离、数据分片等功能的支持。</strong></p><h4 id="ShardingSphere-Proxy"><a href="#ShardingSphere-Proxy" class="headerlink" title="ShardingSphere-Proxy"></a>ShardingSphere-Proxy</h4><p>ShardingSphere-Proxy 被定位为透明化的数据库代理端，提供封装了数据库二进制协议的服务端版本，用于完成对异构语言的支持。代理层介于应用程序与数据库间，每次请求都需要做一次转发，请求会存在额外的时延。这种方式对于应用非常友好，应用基本零改动，和语言无关，可以通过连接共享减少连接数消耗。</p><p><img data-src="../../../asset/2023/10/mysql-read-write-1.png"></p><h4 id="ShardingSphere-JDBC"><a href="#ShardingSphere-JDBC" class="headerlink" title="ShardingSphere-JDBC"></a>ShardingSphere-JDBC</h4><p>ShardingSphere-JDBC 是 ShardingSphere 的第一个产品，也是 ShardingSphere 的前身，业界经常简称之为 Sharding-JDBC。它定位为轻量级 Java 框架，在 Java 的 JDBC 层提供的额外服务。它使用客户端直连数据库，以 Jar 包形式提供服务，无需额外部署和依赖，可理解为增强版的 JDBC 驱动，完全兼容 JDBC 和各种 ORM 框架。</p><ul><li>适用于任何基于 JDBC 的 ORM 框架，如：JPA、Hibernate、Mybatis、Spring JDBC Template 或直接使用 JDBC。</li><li>支持任何第三方的数据库连接池，如：C3P0、DBCP、Druid、HikariCP、BoneCP 等。</li><li>支持任意实现 JDBC 规范的数据库，目前支持 MySQL、PostgreSQL、Oracle、SQL Server 以及任何可使用 JDBC 访问的数据库。</li></ul><p><img data-src="../../../asset/2023/10/mysql-read-write-2.png"></p><h3 id="Dynamic-Datasource"><a href="#Dynamic-Datasource" class="headerlink" title="Dynamic-Datasource"></a>Dynamic-Datasource</h3><p><a target="_blank" rel="external nofollow" href="https://github.com/baomidou/dynamic-datasource-spring-boot-starter">Dynamic-Datasource</a> 是 MyBatis-Plus 官方的读写分离框架。如果数据源较少，场景不复杂，不需要使用多数据源事务，可以选择上述任意一种读写分离方案。如果需要更多特性，又不想引入数据库中间件，可尝试 Dynamic-Datasource，具体的使用方式建议阅读 <a target="_blank" rel="external nofollow" href="https://gitee.com/baomidou/dynamic-datasource-spring-boot-starter/wikis/pages">官方文档一</a>、<a target="_blank" rel="external nofollow" href="https://www.oschina.net/p/dynamic-datasource-spring-boot-starter/related">官方文档二</a>。</p><ul><li><p>优势：</p><ul><li>项目启动后支持动态增减数据源</li><li>简化 Druid 和 HikariCp 配置，提供全局参数配置</li><li>提供自定义数据源来源（默认使用 yml 或 properties 配置）</li><li>数据源分组，适用于多种场景，包括纯粹多库、读写分离、一主多从、多主多从、混合模式</li><li>使用 Spel 动态参数解析数据源，如从 session，header 和参数中获取数据源。（多租户架构神器）</li><li>简单集成 Druid 数据源监控多数据源，简单集成 Mybatis-Plus 简化单表，简单集成 P6sy 格式化 SQL，简单集成 Jndi 数据源</li><li>使用正则匹配或 Spel 表达式来切换数据源（实验性功能）</li><li>默认支持通过 @DS 注解来动态选择数据源（代码入侵性强），额外支持使用 MyBatis 插件在 ORM 层实现纯读写分离（代码零入侵性），但两者不能同时使用</li><li>使用 @DS 注解的时候，支持多层数据源嵌套切换。（一个业务 ServiceA 调用 ServiceB，ServiceB 调用 ServiceC，每个 Service 都是不同的数据源）</li></ul></li><li><p>劣势</p><ul><li>不支持多数据源事务（同一个数据源下支持事务），网上绝大多数普通方案（基于 Spring 路由数据源 ）也都不能支持</li><li>如果需要使用到分布式事务，那么架构应该到了微服务化的时候</li><li>提示：如果项目中只有几个数据库，但是有强烈使用分布式事务的需求，建议还是使用传统方式自己构建多套环境集成 Atomic 这类方案</li></ul></li><li><p>约定</p><ul><li>只做切换数据源这件核心的事情，并不限制具体操作，切换了数据源可以做任何 CRUD 操作</li><li>配置文件中所有以下划线 _ 分割的数据源，首部即为组的名称，相同组名称的数据源会放在一个组下</li><li>切换数据源即可以是组名，也可以是具体数据源名称，切换时默认采用负载均衡机制切换</li><li>默认的数据源名称为 master，可以通过 spring.datasource.dynamic.primary 修改</li><li>方法上的注解优先于类上注解</li></ul></li></ul><h2 id="扩展阅读"><a href="#扩展阅读" class="headerlink" title="扩展阅读"></a>扩展阅读</h2><h3 id="MySQL-其他中间件介绍"><a href="#MySQL-其他中间件介绍" class="headerlink" title="MySQL 其他中间件介绍"></a>MySQL 其他中间件介绍</h3><p>其他实现 MySQL 读写分离与分库分表的其他中间件如下：</p><table><thead><tr><th>名称</th><th>代码仓库地址</th><th>简介</th></tr></thead><tbody><tr><td> MySQL-Proxy（Oracle）</td><td><a target="_blank" rel="external nofollow" href="https://github.com/mysql/mysql-proxy">MySQL-Proxy</a></td><td>Oracle 早期开源的 MySQL Proxy 项目，功能有限，长期不维护。</td></tr><tr><td>MySQL-Router（Oracle）</td><td><a target="_blank" rel="external nofollow" href="https://github.com/mysql/mysql-router">MySQL-Router</a></td><td>Oracle 官方的 MySQL Router，主要用于 InnoDB Cluster、复制拓扑路由。</td></tr><tr><td>Atlas（Qihoo 360）</td><td><a target="_blank" rel="external nofollow" href="https://github.com/Qihoo360/Atlas">Atlas</a></td><td>360 开源的 MySQL Proxy 中间件，早期被广泛使用，但已停止维护。</td></tr><tr><td>TDDL（淘宝团队研发）</td><td><a target="_blank" rel="external nofollow" href="https://github.com/alibaba/tddl">TDDL</a></td><td> 阿里早期开源的客户端层数据库中间件（Smart Client 模式），已停止维护。</td></tr><tr><td>Cobar（阿里巴巴 B2B 部门）</td><td><a target="_blank" rel="external nofollow" href="https://github.com/alibaba/cobar">Cobar</a></td><td> 阿里早期开源的分布式数据库中间件，Proxy 方案，已停止维护。</td></tr><tr><td>MyCat</td><td><a target="_blank" rel="external nofollow" href="https://github.com/MyCATApache/Mycat-Server">MyCat</a></td><td> 基于 Cobar 二次开发的数据库中间件，国内用户较多，但更新速度放缓。</td></tr><tr><td>Oceanus（58 同城）</td><td><a target="_blank" rel="external nofollow" href="https://github.com/58code/Oceanus">Oceanus</a></td><td>58 同城开源的 MySQL 中间件，Proxy 方案，分库分表支持。</td></tr><tr><td>Heisenberg（百度）</td><td><a target="_blank" rel="external nofollow" href="https://github.com/brucexx/heisenberg">Heisenberg</a></td><td> 百度开源的数据库中间件，支持 MySQL 分库分表，已不活跃。</td></tr><tr><td>TSharding（蘑菇街）</td><td><a target="_blank" rel="external nofollow" href="https://github.com/baihui212/tsharding">TSharding</a></td><td> 蘑菇街工程师白辉开发的分库分表中间件，更新停滞。</td></tr><tr><td>Kingshard（金山）</td><td><a target="_blank" rel="external nofollow" href="https://github.com/flike/kingshard">Kingshard</a></td><td> 金山云团队开源的 MySQL Proxy 中间件，支持读写分离。</td></tr><tr><td>Sharding-JDBC（当当）</td><td><a target="_blank" rel="external nofollow" href="https://github.com/apache/shardingsphere">Sharding-JDBC</a></td><td> 当当网开源，后并入 Apache 基金会，发展为 ShardingSphere 生态。</td></tr><tr><td>Vitess（Google）</td><td><a target="_blank" rel="external nofollow" href="https://github.com/vitessio/vitess">Vitess</a></td><td>Google 开源的云原生分布式数据库中间件，Kubernetes 生态支持完善。</td></tr><tr><td>ProxySQL</td><td><a target="_blank" rel="external nofollow" href="https://github.com/sysown/proxysql">ProxySQL</a></td><td> 国外流行的高性能 MySQL Proxy 中间件，活跃度高，支持企业生产环境。</td></tr></tbody></table><h3 id="MySQL-常用解决方案总结"><a href="#MySQL-常用解决方案总结" class="headerlink" title="MySQL 常用解决方案总结"></a>MySQL 常用解决方案总结</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">MySQL 复制方案：</span><br><span class="line">    1.一主一从，高可用</span><br><span class="line">    2.一主一从，读写分离</span><br><span class="line">    3.一主多从，读写分离</span><br><span class="line">    4.一主多从，负载均衡</span><br><span class="line">    5.主主复制，双写</span><br><span class="line">    6.主主复制，单写</span><br><span class="line">    7.双主双从</span><br><span class="line"></span><br><span class="line">MySQL 高性能架构方案：</span><br><span class="line">    1.代码级别</span><br><span class="line">    2.读写分离架构（读性能较高）</span><br><span class="line">          MySQL Proxy（Atlas、mysql router、proxySQL、maxscale、amoeba、xx-dbproxy等）</span><br><span class="line">    3.分布式架构（读写性能都提高）</span><br><span class="line">          分库分表---&gt;Cobar---&gt;TDDL---&gt;DRDS</span><br><span class="line">          Mycat----&gt;DBLE自主研发等</span><br><span class="line">          NewSQL---&gt;TiDB</span><br><span class="line"></span><br><span class="line">MySQL 高可用架构方案：</span><br><span class="line">    单活：MMM架构---&gt;mysql-mmm（Google）</span><br><span class="line">    单活：MHA架构---&gt;mysql-master-ha（日本DeNa），T-MHA</span><br><span class="line">    多活：MGR架构---&gt;mysql 5.7新特性 MySQL Group Replication（5.7.17）---&gt;Innodb Cluster</span><br><span class="line">    多活：</span><br><span class="line">        Percona XtraDB Cluster（PXC）</span><br><span class="line">        MySQL Cluster（Oracle RAC）</span><br><span class="line">        MariaDB Galera Cluster</span><br><span class="line"></span><br><span class="line">Oracle 高可用架构方案：</span><br><span class="line">    1.RAC</span><br><span class="line">    2.DG</span><br><span class="line">    3.OGG</span><br></pre></td></tr></tbody></table></figure><h3 id="其他-MySQL-中间件开源项目"><a href="#其他-MySQL-中间件开源项目" class="headerlink" title="其他 MySQL 中间件开源项目"></a>其他 MySQL 中间件开源项目</h3><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/chenlei2/spring-boot-mybatis-rw">spring-boot-mybatis-rw</a></li><li><a target="_blank" rel="external nofollow" href="https://mp.weixin.qq.com/s/O8DfUjIw18WehILOWsR8ug">spring-boot-mybatis-rw 文档</a></li></ul><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ul><li><a target="_blank" rel="external nofollow" href="https://www.sohu.com/a/165286736_575744">基于 MyBatis 的读写分离插件</a></li><li><a target="_blank" rel="external nofollow" href="https://www.jianshu.com/p/459cd97a11f7">读写分离 Spring + Mybatis 解决方案</a></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/a6aa7529.html" title="数据库读写分离解决方案介绍">https://www.techgrow.cn/posts/a6aa7529.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"><i class="fa fa-tag"></i> 数据库</a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/7d8f3d89.html" rel="prev" title="MyBatis-Plus 入门教程之三"><i class="fa fa-angle-left"></i> MyBatis-Plus 入门教程之三</a></div><div class="post-nav-item"> <a href="/posts/2cbf33d2.html" rel="next" title="MyBatis-Plus 入门教程之四">MyBatis-Plus 入门教程之四<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">30:49</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/a6aa7529.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>