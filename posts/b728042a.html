<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍Kubernetes的特性和使用Kubeadm方式搭建集群，包括Dashboard可视化插件的部署。"><meta property="og:type" content="article"><meta property="og:title" content="Kubernetes 之一特性与 Kubeadm 方式搭建集群"><meta property="og:url" content="https://www.techgrow.cn/posts/b728042a.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍Kubernetes的特性和使用Kubeadm方式搭建集群，包括Dashboard可视化插件的部署。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2021/03/kubernetes-framework-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2021/03/kubernetes-framework-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2021/03/kubernetes-framework-3.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2021/03/kubernetes-cluster-plan.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2021/03/kubernetes-kubeadm-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2021/03/kubernetes-dashboard-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2021/03/kubernetes-dashboard-2.png"><meta property="article:published_time" content="2021-03-11T14:34:29.000Z"><meta property="article:modified_time" content="2021-03-11T14:34:29.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="容器化"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2021/03/kubernetes-framework-2.png"><link rel="canonical" href="https://www.techgrow.cn/posts/b728042a.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/b728042a.html","path":"posts/b728042a.html","title":"Kubernetes 之一特性与 Kubeadm 方式搭建集群"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Kubernetes 之一特性与 Kubeadm 方式搭建集群 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/app/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Kubernetes-%E6%A6%82%E8%BF%B0"><span class="nav-text">Kubernetes 概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Kubernetes-%E7%AE%80%E4%BB%8B"><span class="nav-text">Kubernetes 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%84%E7%A7%8D%E9%83%A8%E7%BD%B2%E6%96%B9%E5%BC%8F%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-text">各种部署方式的区别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kubernetes-%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D"><span class="nav-text">Kubernetes 功能介绍</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kubernetes-%E6%9E%B6%E6%9E%84"><span class="nav-text">Kubernetes 架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2%E6%9E%B6%E6%9E%84%E5%88%86%E7%B1%BB"><span class="nav-text">应用部署架构分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kubernetes-%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84"><span class="nav-text">Kubernetes 集群架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kubernetes-%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84%E8%8A%82%E7%82%B9%E8%A7%92%E8%89%B2"><span class="nav-text">Kubernetes 集群架构节点角色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kubernetes-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text">Kubernetes 核心概念</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kubernetes-%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="nav-text">Kubernetes 集群搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%96%B9%E5%BC%8F"><span class="nav-text">集群搭建方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E8%A6%81%E6%B1%82"><span class="nav-text">集群搭建要求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E8%A7%84%E5%88%92"><span class="nav-text">集群搭建规划</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kubeadm-%E6%96%B9%E5%BC%8F%E6%90%AD%E5%BB%BA%E5%8D%95-Master-%E9%9B%86%E7%BE%A4"><span class="nav-text">Kubeadm 方式搭建单 Master 集群</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%90%AD%E5%BB%BA%E7%9B%AE%E6%A0%87"><span class="nav-text">搭建目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AF%E4%BB%B6%E7%8E%AF%E5%A2%83"><span class="nav-text">软件环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A7%84%E5%88%92"><span class="nav-text">服务器规划</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-text">系统初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2-Master-%E8%8A%82%E7%82%B9"><span class="nav-text">部署 Master 节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Master-%E8%8A%82%E7%82%B9%E5%AE%89%E8%A3%85-Flannel-%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6"><span class="nav-text">Master 节点安装 Flannel 网络插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86-Node-%E8%8A%82%E7%82%B9%E5%8A%A0%E5%85%A5%E5%88%B0-Kubernetes-%E9%9B%86%E7%BE%A4"><span class="nav-text">将 Node 节点加入到 Kubernetes 集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95-Kubernetes-%E9%9B%86%E7%BE%A4%E5%8A%9F%E8%83%BD"><span class="nav-text">测试 Kubernetes 集群功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kubeadm-%E9%83%A8%E7%BD%B2-Dashboard-%E5%8F%AF%E8%A7%86%E5%8C%96%E6%8F%92%E4%BB%B6"><span class="nav-text">Kubeadm 部署 Dashboard 可视化插件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Dashboard-%E7%AE%80%E4%BB%8B"><span class="nav-text">Dashboard 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dashboard-%E9%83%A8%E7%BD%B2"><span class="nav-text">Dashboard 部署</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dashboard-%E6%9A%B4%E9%9C%B2%E6%9C%8D%E5%8A%A1"><span class="nav-text">Dashboard 暴露服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dashboard-%E8%AE%A4%E8%AF%81%E6%96%B9%E5%BC%8F%E7%99%BB%E5%BD%95"><span class="nav-text">Dashboard 认证方式登录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dashboard-%E7%99%BB%E5%BD%95%E8%B6%85%E6%97%B6"><span class="nav-text">Dashboard 登录超时</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kubeadm-%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93"><span class="nav-text">Kubeadm 搭建集群问题总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">590</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">54</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/b728042a.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Kubernetes 之一特性与 Kubeadm 方式搭建集群 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍Kubernetes的特性和使用Kubeadm方式搭建集群，包括Dashboard可视化插件的部署。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Kubernetes 之一特性与 Kubeadm 方式搭建集群</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-03-11 22:34:29" itemprop="dateCreated datePublished" datetime="2021-03-11T22:34:29+08:00">2021-03-11</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/b728042a.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/b728042a.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>5.7k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>5 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="Kubernetes-概述"><a href="#Kubernetes-概述" class="headerlink" title="Kubernetes 概述"></a>Kubernetes 概述</h2><h3 id="Kubernetes-简介"><a href="#Kubernetes-简介" class="headerlink" title="Kubernetes 简介"></a>Kubernetes 简介</h3><p>Kubernetes 是 Google 开源的一个容器编排引擎，简称 K8s，是用 8 代替 8 个字符 <code>ubernete</code> 而成的缩写。Kubernetes 可用于管理云平台中多个主机上的容器化的应用，支持自动化部署、大规模扩缩容、应用容器化管理。在生产环境中部署一个应用程序时，通常要部署该应用的多个实例以便对应用请求进行负载均衡。Kubernetes 提供了应用部署、规划、更新、维护的一种机制。在 Kubernetes 中，可以创建多个容器，每个容器里面运行一个应用实例，然后通过内置的负载均衡策略，实现对这一组应用实例的管理、发现、访问，而这些细节都不需要运维人员去进行复杂的手工配置和处理。</p><h3 id="各种部署方式的区别"><a href="#各种部署方式的区别" class="headerlink" title="各种部署方式的区别"></a>各种部署方式的区别</h3><p>传统的应用部署方式是通过插件或脚本来安装应用，这样做的缺点是应用的运行、配置、管理、所有生存周期将与当前操作系统绑定，这样做并不利于应用的升级更新、回滚等操作；当然也可以通过创建虚拟机的方式来实现某些功能，但是虚拟机非常重，并不利于可移植性。新的方式是通过部署容器方式实现，每个容器之间互相隔离，每个容器有自己的文件系统，容器之间进程不会相互影响，能区分计算资源。相对于虚拟机，容器能够快速部署，由于容器与底层设施、机器文件系统解耦的，所以它能在不同云、不同版本操作系统间进行迁移。容器占用资源少、部署快，每个应用可以被打包成一个容器镜像，每个应用与容器间成一对一关系也使容器有更大优势，使用容器可以在 <code>build</code> 或 <code>release</code> 的阶段，为应用创建容器镜像，因为每个应用不需要与其余的应用堆栈组合，也不依赖于生产环境基础结构，这使得从研发到测试、生产能提供一致环境。类似地，容器比虚拟机轻量、更 “透明”，这更便于监控和管理。</p><span id="more"></span><h3 id="Kubernetes-功能介绍"><a href="#Kubernetes-功能介绍" class="headerlink" title="Kubernetes 功能介绍"></a>Kubernetes 功能介绍</h3><ul><li>自动装箱：基于容器对应用运行环境的资源配置要求自动部署应用容器</li><li>自我修复：当容器运行失败时，会对容器进行重启；当所部署的 Node 节点有问题时，会对容器进行重新部署和重新调度；当容器未通过监控检查时，会关闭此容器直到容器正常运行时，才会对外提供服务</li><li>水平扩展：通过简单的命令、用户 UI 界面或基于 CPU 等资源使用情况，对应用容器进行规模扩大或规模剪裁</li><li>服务发现：用户不需使用额外的服务发现机制，就能够基于 Kubernetes 自身能力实现服务发现和负载均衡</li><li>滚动更新：可以根据应用的变化，对应用容器运行的应用，进行一次性或批量式更新</li><li>版本回退：可以根据应用部署情况，对应用容器运行的应用，进行历史版本即时回退</li><li>密钥和配置管理：在不需要重新构建镜像的情况下，可以部署和更新密钥和应用配置，类似热部署</li><li>存储编排：自动实现存储系统挂载及应用，这特别对有状态应用实现数据持久化非常重要；存储系统可以来自于本地目录、网络存储（NFS、Gluster、Ceph 等）、公共云存储服务</li><li>批处理：提供一次性任务，定时任务，满足批量数据处理和分析的场景</li></ul><h2 id="Kubernetes-架构"><a href="#Kubernetes-架构" class="headerlink" title="Kubernetes 架构"></a>Kubernetes 架构</h2><h3 id="应用部署架构分类"><a href="#应用部署架构分类" class="headerlink" title="应用部署架构分类"></a>应用部署架构分类</h3><ul><li>无中心节点架构：GlusterFS</li><li> 有中心节点架构：HDFS、K8S</li></ul><h3 id="Kubernetes-集群架构"><a href="#Kubernetes-集群架构" class="headerlink" title="Kubernetes 集群架构"></a>Kubernetes 集群架构</h3><p><img data-src="../../../asset/2021/03/kubernetes-framework-2.png" alt="kubernetes-framework-2"></p><h3 id="Kubernetes-集群架构节点角色"><a href="#Kubernetes-集群架构节点角色" class="headerlink" title="Kubernetes 集群架构节点角色"></a>Kubernetes 集群架构节点角色</h3><p><img data-src="../../../asset/2021/03/kubernetes-framework-1.png" alt="kubernetes-framework-1"></p><ul><li><p><code>Master（主控节点）</code>：Kubernetes 集群控制节点，负责对集群进行调度管理，接受集群外的用户去集群操作请求。Master 由 API Server、Scheduler、ClusterState Store（ETCD 存储系统）和 Controller MangerServer 组成</p><ul><li>Scheduler：节点调度，选择 Node 节点来应用部署</li><li> API Server：集群统一入口，以 RESTful 接口将数据交给 ETCD 存储系统</li><li> Controller MangerServer：处理集群中的常规后台任务，一个资源对应一个控制器</li></ul></li><li><p><code>Node（工作节点）</code>：Kubernetes 集群工作节点，负责运行用户业务应用容器，Node 由 Kubelet、Kube-Proxy 和 ContainerRuntime 组成</p><ul><li>Kubelet：负责 Pod 对应的容器的创建、启停管理，与 Master 节点协作，实现集群管理的基本功能</li><li> Kube-Proxy：提供 Kubernetes 的通信与负载均衡功能的重要组件</li></ul></li></ul><h3 id="Kubernetes-核心概念"><a href="#Kubernetes-核心概念" class="headerlink" title="Kubernetes 核心概念"></a>Kubernetes 核心概念</h3><p><img data-src="../../../asset/2021/03/kubernetes-framework-3.png" alt="kubernetes-framework-3"></p><h2 id="Kubernetes-集群搭建"><a href="#Kubernetes-集群搭建" class="headerlink" title="Kubernetes 集群搭建"></a>Kubernetes 集群搭建</h2><h3 id="集群搭建方式"><a href="#集群搭建方式" class="headerlink" title="集群搭建方式"></a>集群搭建方式</h3><p>目前生产环境搭建 Kubernetes 集群主要有以下两种方式：</p><ul><li><p><code>Kubeadm</code>：<a target="_blank" rel="external nofollow" href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/">Kubeadm</a> 是一个 Kubernetes 部署工具，提供 <code>kubeadm init</code> 和 <code>kubeadm join</code> 命令，可用于快速搭建 Kubernetes 集群</p></li><li><p><code>二进制包</code>：从 Github 下载发行版的二进制包，手动部署每个组件，组成 Kubernetes 集群。Kubeadm 虽然降低部署门槛，但屏蔽了很多细节，遇到问题很难排查。如果想更容易可控，生产环境推荐使用二进制包搭建 Kubernetes 集群，虽然手动部署比较麻烦，但期间可以学习很多工作原理，也利于后期维护</p></li></ul><h3 id="集群搭建要求"><a href="#集群搭建要求" class="headerlink" title="集群搭建要求"></a>集群搭建要求</h3><p>搭建 Kubernetes 集群需要满足以下几个条件：</p><ul><li>一台或多台机器，建议操作系统 CentOS 7.x86_64</li><li>Master 节点的硬件配置：2GB 或更多 RAM，2 个 CPU 或更多 CPU，硬盘 20GB 或更多</li><li> Node 节点的硬件配置：4GB 或更多 RAM，4 个 CPU 或更多 CPU，硬盘 40GB 或更多</li><li>集群中所有机器之间的网络可以互通</li><li>系统内可以访问外网，需要拉取镜像</li><li>禁用 swap 分区</li></ul><h3 id="集群搭建规划"><a href="#集群搭建规划" class="headerlink" title="集群搭建规划"></a>集群搭建规划</h3><p>Kubernetes 集群搭建规划分为单 Master 集群和多 Master 集群两种，为了提高集群的高可用性，生产环境一般采用后者的规划方案，如下图所示：</p><p><img data-src="../../../asset/2021/03/kubernetes-cluster-plan.png" alt="kubernetes-cluster-plan"></p><h2 id="Kubeadm-方式搭建单-Master-集群"><a href="#Kubeadm-方式搭建单-Master-集群" class="headerlink" title="Kubeadm 方式搭建单 Master 集群"></a>Kubeadm 方式搭建单 Master 集群</h2><h3 id="搭建目标"><a href="#搭建目标" class="headerlink" title="搭建目标"></a>搭建目标</h3><p>-（1）在所有节点上安装 Docker 和 kubeadm<br>-（2）部署 Kubernetes Master<br>-（3）部署容器网络插件<br>-（4）部署 Kubernetes Node，将节点加入 Kubernetes 集群中<br>-（5）部署 Dashboard Web 页面，可视化查看 Kubernetes 资源</p><h3 id="软件环境"><a href="#软件环境" class="headerlink" title="软件环境"></a>软件环境</h3><table><thead><tr><th>软件</th><th>版本</th><th>安装方式</th></tr></thead><tbody><tr><td> CentOS 7.9</td><td>3.10.0-1160.15.2.el7.x86_64</td><td> 虚拟机</td></tr><tr><td> Docker</td><td>docker-ce-18.06.1.ce-3.el7</td><td>YUM</td></tr><tr><td>Kubelet</td><td>1.18.0</td><td>YUM</td></tr><tr><td>Kubeadm</td><td>1.18.0</td><td>YUM</td></tr><tr><td>Kubectl</td><td>1.18.0</td><td>YUM</td></tr><tr><td>Dashboard</td><td>2.0.3</td><td>Kubernetes</td></tr></tbody></table><h3 id="服务器规划"><a href="#服务器规划" class="headerlink" title="服务器规划"></a>服务器规划</h3><p><img data-src="../../../asset/2021/03/kubernetes-kubeadm-1.png" alt="kubernetes-kubeadm-1"></p><table><thead><tr><th>Host Name</th><th> 角色</th><th> IP</th><th>CPU</th><th>Memory</th><th>Disk</th></tr></thead><tbody><tr><td>k8s-master</td><td>master</td><td>192.168.31.61</td><td>&gt;= 2C</td><td>&gt;=2G</td><td>&gt;=20G</td></tr><tr><td>k8s-node1</td><td>node</td><td>192.168.31.62</td><td>&gt;= 4C</td><td>&gt;=4G</td><td>&gt;=40G</td></tr><tr><td>k8s-node2</td><td>node</td><td>192.168.31.63</td><td>&gt;= 4C</td><td>&gt;=4G</td><td>&gt;=40G</td></tr><tr><td>k8s-node3</td><td>node</td><td>192.168.31.64</td><td>&gt;= 4C</td><td>&gt;=4G</td><td>&gt;=40G</td></tr></tbody></table><h3 id="系统初始化"><a href="#系统初始化" class="headerlink" title="系统初始化"></a>系统初始化</h3><p>值得一提的是，以下系统初始化操作都必须在所有节点上执行一次，重点包括在所有节点里安装 Docker、Kubelet、Kubeadm。这里要求 Kubelet、Kubeadm、Kubectl 的版本与 Docker 的版本互相匹配（兼容），不建议安装最新版本的 Docker，因为 Kubernetes 对最新版的 Docker 兼容不够及时，容易导致 Kubeadm 方式搭建 Kubernetes 集群失败。</p><hr><p>关闭防火墙</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时关闭</span></span><br><span class="line"><span class="keyword"># systemctl</span> stop firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment"># 永久关闭</span></span><br><span class="line"><span class="keyword"># systemctl</span> <span class="built_in">disable</span> firewalld</span><br></pre></td></tr></tbody></table></figure><p>关闭 selinux</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时关闭</span></span><br><span class="line"><span class="keyword"># setenforce</span> 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 永久关闭</span></span><br><span class="line"><span class="keyword"># sed</span><span class="params"> -i</span> <span class="string">'s/enforcing/disabled/'</span> /etc/selinux/config</span><br></pre></td></tr></tbody></table></figure><p>关闭 swap</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时关闭</span></span><br><span class="line"><span class="keyword">$ swapoff</span><span class="params"> -a</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 永久关闭</span></span><br><span class="line"><span class="keyword"># sed</span><span class="params"> -i</span> <span class="string">'s/.*swap.*/#&amp;/'</span> /etc/fstab</span><br></pre></td></tr></tbody></table></figure><p>系统时间同步</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装时间同步工具</span></span><br><span class="line"><span class="keyword"># yum</span> install ntpdate<span class="params"> -y</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置时间同步服务器</span></span><br><span class="line"><span class="keyword"># ntpdate</span> time.windows.com</span><br></pre></td></tr></tbody></table></figure><hr><p>安装 Docker，这是由于 Kubernetes 默认的 CRI（容器运行时）为 Docker</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加YUM源</span></span><br><span class="line"><span class="keyword"># wget</span> https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<span class="params"> -O</span> /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装Docker（指定版本号，否则默认安装最新版本）</span></span><br><span class="line"><span class="keyword"># yum</span><span class="params"> -y</span> install docker-ce-18.06.1.ce-3.el7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开机自启动Docker</span></span><br><span class="line"><span class="keyword"># systemctl</span> <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动Docker</span></span><br><span class="line"><span class="keyword"># systemctl</span> start docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置阿里的Docker镜像加速</span></span><br><span class="line"><span class="keyword"># vim</span> /etc/docker/daemon.json</span><br><span class="line">{</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://b9pmyelo.mirror.aliyuncs.com"</span>]</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启Docker</span></span><br><span class="line"><span class="keyword"># systemctl</span> restart docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Docker的版本</span></span><br><span class="line"><span class="keyword"># docker</span><span class="params"> --version</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Docker的安装信息</span></span><br><span class="line"><span class="keyword"># docker</span> info</span><br></pre></td></tr></tbody></table></figure><p>安装 Kubelet、Kubeadm、Kubectl</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加YUm源</span></span><br><span class="line"><span class="keyword"># vim</span> /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装（指定版本号，否则默认会安装最新版本）</span></span><br><span class="line"><span class="keyword"># yum</span> install<span class="params"> -y</span> kubelet-1.18.0 kubeadm-1.18.0 kubectl-1.18.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开机自启动Kubelet</span></span><br><span class="line"><span class="keyword"># systemctl</span> <span class="built_in">enable</span> kubelet</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提示：Kubelet安装完成后不需要手动启动，因为在Node节点成功加入集群之前，Kubelet自身会不断重启（期间会伴随着各种启动错误，这点不用在意）</span></span><br></pre></td></tr></tbody></table></figure><p>将桥接的 IPv4 流量传递到 iptables 的链</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加路由规则</span></span><br><span class="line"><span class="keyword"># vim</span> /etc/sysctl.d/k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置生效</span></span><br><span class="line"><span class="keyword"># sysctl</span><span class="params"> --system</span></span><br></pre></td></tr></tbody></table></figure><hr><p>设置主机名</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword"># hostnamectl</span> <span class="built_in">set</span>-hostname &lt;hostname&gt;</span><br></pre></td></tr></tbody></table></figure><p>添加 hosts（Master 和各 Node 节点都配置）</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加hosts</span></span><br><span class="line"><span class="keyword"># vim</span> /etc/hosts</span><br><span class="line">192.168.31.61 k8s-master</span><br><span class="line">192.168.31.62 k8s-node1</span><br><span class="line">192.168.31.63 k8s-node2</span><br><span class="line">192.168.31.64 k8s-node3</span><br></pre></td></tr></tbody></table></figure><h3 id="部署-Master-节点"><a href="#部署-Master-节点" class="headerlink" title="部署 Master 节点"></a>部署 Master 节点</h3><p>在 Master 节点执行 Kubeadm 初始化操作，<code>--service-cidr</code> 与 <code>--pod-network-cidr</code> 一般都不需要更改，详细参数说明如下，<a href="../../../asset/2021/03/kubernetes-install-log.png">点击</a>查看详细的安装日志信息</p><ul><li><code>--apiserver-advertise-address</code>：Master 节点的 IP 地址</li><li><code>--kubernetes-version</code>：Kubernetes 的版本号，必须与上面 Kubelet 的版本号一致</li><li><code>--apiserver-advertise-address</code>：一般指定为 Haproxy + Keepalived 的 VIP</li><li><code>--image-repository</code>：由于默认拉取镜像地址 <code>k8s.gcr.io</code> 国内无法访问，指定阿里云镜像仓库地址</li><li><code>--pod-network-cidr</code>：指定 Pod Network 的地址范围，由于 Kubernetes 支持多种网络方案，而且不同网络方案对参数有各自要求，设置为 <code>10.244.0.0/16</code> 表示使用 Flannel 网络方案</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行初始化</span></span><br><span class="line"><span class="keyword"># kubeadm</span> init \<span class="params"></span></span><br><span class="line"><span class="params">--apiserver</span>-advertise-address=192.168.31.61 \<span class="params"></span></span><br><span class="line"><span class="params">--image</span>-repository registry.aliyuncs.com/google_containers \<span class="params"></span></span><br><span class="line"><span class="params">--kubernetes</span>-version v1.18.0 \<span class="params"></span></span><br><span class="line"><span class="params">--service</span>-cidr=10.96.0.0/12 \<span class="params"></span></span><br><span class="line"><span class="params">--pod</span>-network-cidr=10.244.0.0/16</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当终端打印如下的提示信息，则说明Docker开始拉取镜像，这个过程比较耗时（严重依赖网速）</span></span><br><span class="line">[preflight] Pulling images required <span class="keyword">for</span> setting up a Kubernetes cluster</span><br><span class="line">[preflight] This might take a minute or two, depending on the speed of your internet connection</span><br><span class="line">[preflight] You can also perform this action <span class="keyword">in</span> beforehand using <span class="string">'kubeadm config images pull'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化完成后，记录下终端最后打印的Kubeadm命令（如下），后续添加Node节点到集群时会使用到</span></span><br><span class="line"><span class="comment">### kubeadm join 192.168.1.109:6443 --token jve1cd.3ulp5fqifsptti23 --discovery-token-ca-cert-hash sha256:01229ee179cf13855dbf38bc050b3251928571996d60878f30ce13c08aaa62d5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Docker的镜像列表</span></span><br><span class="line"><span class="keyword"># docker</span> images</span><br><span class="line">REPOSITORY                                                        TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-proxy                v1.18.0             43940c34f24f        11 months ago       117MB</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-apiserver            v1.18.0             74060cea7f70        11 months ago       173MB</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-controller-manager   v1.18.0             d3e55153f52f        11 months ago       162MB</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-scheduler            v1.18.0             a31f78c7c8ce        11 months ago       95.3MB</span><br><span class="line">registry.aliyuncs.com/google_containers/pause                     3.2                 80d28bedfe5d        13 months ago       683kB</span><br><span class="line">registry.aliyuncs.com/google_containers/coredns                   1.6.7               67da37a9a360        13 months ago       43.8MB</span><br><span class="line">registry.aliyuncs.com/google_containers/etcd                      3.4.3-0             303ce5db0e90        16 months ago       288MB</span><br></pre></td></tr></tbody></table></figure><p>在 Master 节点配置 Kubectl 工具</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建目录</span></span><br><span class="line"><span class="keyword"># mkdir</span><span class="params"> -p</span> <span class="variable">$HOME</span>/.kube</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝配置文件</span></span><br><span class="line"><span class="keyword"># cp</span><span class="params"> -i</span> /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件授权</span></span><br><span class="line"><span class="keyword"># chown</span> $(id<span class="params"> -u</span>):$(id<span class="params"> -g</span>) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询组件的状态</span></span><br><span class="line"><span class="keyword"># kubectl</span> get cs</span><br><span class="line">NAME                STATUS  MESSAGE</span><br><span class="line">ERROR etcd-0        Healthy  {<span class="string">"health"</span>:<span class="string">"true"</span>}</span><br><span class="line">controller-manager  Healthy  ok</span><br><span class="line">scheduler           Healthy  ok</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提示：当上面的 STATUS 结果都为 "Healthy"，表示组件处于健康状态，否则需要检查错误，如果排除不了问题，可以使用 "kubeadm reset" 命令重置集群后重新初始化</span></span><br></pre></td></tr></tbody></table></figure><h3 id="Master-节点安装-Flannel-网络插件"><a href="#Master-节点安装-Flannel-网络插件" class="headerlink" title="Master 节点安装 Flannel 网络插件"></a>Master 节点安装 Flannel 网络插件</h3><p>查看集群状态，此时的 Master 处于 “NotReady”（未就绪），这是因为集群中尚未安装 Flannel 网络插件，部署完网络插件后状态会自动变为 <code>Ready</code></p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看集群状态</span></span><br><span class="line"><span class="keyword"># kubectl</span> get nodes</span><br><span class="line">NAME         STATUS     ROLES    AGE   VERSION</span><br><span class="line">k8s-master   NotReady   master   12m   v1.18.0</span><br></pre></td></tr></tbody></table></figure><p>安装 Flannel 网络插件，若 <code>kubectl apply -f</code> 命令执行后提示网络连接失败，可留意文章后面给出的解决方案</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装Flannel网络插件</span></span><br><span class="line"><span class="keyword"># kubectl</span> apply<span class="params"> -f</span> https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询Pod组件的状态</span></span><br><span class="line"><span class="keyword"># kubectl</span> get pods<span class="params"> -n</span> kube-system</span><br><span class="line">NAME                                 READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-7ff77c879f-67rjn             1/1     Running   0          4m35s</span><br><span class="line">coredns-7ff77c879f-xpq9h             1/1     Running   0          4m35s</span><br><span class="line">etcd-k8s-master                      1/1     Running   0          4m44s</span><br><span class="line">kube-apiserver-k8s-master            1/1     Running   0          4m44s</span><br><span class="line">kube-controller-manager-k8s-master   1/1     Running   0          4m44s</span><br><span class="line">kube-flannel-ds-4jtp4                1/1     Running   0          2m36s</span><br><span class="line">kube-proxy-8bbhk                     1/1     Running   0          4m34s</span><br><span class="line">kube-scheduler-k8s-master            1/1     Running   0          4m44s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提示：Flannel 网络插件安装完成后，需要耐心等待一段时间，直到 "kubectl get pods -n kube-system" 命令查询到的所有 Pod 组件的状态都为 Running 为止</span></span><br></pre></td></tr></tbody></table></figure><p>当 Master 节点处于 <code>Ready</code> 状态，就可以开始将 Node 节点加入集群</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看集群状态</span></span><br><span class="line"><span class="keyword"># kubectl</span> get nodes</span><br><span class="line">NAME         STATUS     ROLES    AGE   VERSION</span><br><span class="line">k8s-master   Ready      master   12m   v1.18.0</span><br></pre></td></tr></tbody></table></figure><h3 id="将-Node-节点加入到-Kubernetes-集群"><a href="#将-Node-节点加入到-Kubernetes-集群" class="headerlink" title="将 Node 节点加入到 Kubernetes 集群"></a>将 Node 节点加入到 Kubernetes 集群</h3><p>在各个 Node 节点里执行以下命令，向 Kubernetes 集群添加新节点，该命令是上述 <code>kubeadm init</code> 命令执行完成后在终端记录下来的</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加Node节点到集群</span></span><br><span class="line"><span class="keyword"># kubeadm</span> join 192.168.1.109:6443<span class="params"> --token</span> jve1cd.3ulp5fqifsptti23<span class="params"> --discovery</span>-token-ca-cert-<span class="built_in">hash</span> sha256:01229ee179cf13855dbf38bc050b3251928571996d60878f30ce13c08aaa62d5</span><br></pre></td></tr></tbody></table></figure><h3 id="测试-Kubernetes-集群功能"><a href="#测试-Kubernetes-集群功能" class="headerlink" title="测试 Kubernetes 集群功能"></a>测试 Kubernetes 集群功能</h3><p>在 Master 节点执行以下命令，查看集群中所有节点的状态，当它们的状态都为 <code>Ready</code> 时，表示 Kubernetes 集群已经成功搭建起来了。值得一提的是，集群中所有节点的状态变更为 <code>Ready</code>，这需要花较长时间，可能花十几分钟甚至几十分钟</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看集群状态</span></span><br><span class="line"><span class="keyword"># kubectl</span> get nodes</span><br><span class="line">NAME         STATUS     ROLES    AGE     VERSION</span><br><span class="line">k8s-master   Ready   master   9m37s   v1.18.0</span><br><span class="line">k8s-node1    Ready   &lt;none&gt;   2m43s   v1.18.0</span><br><span class="line">k8s-node2    Ready   &lt;none&gt;   11s     v1.18.0</span><br><span class="line">k8s-node3    Ready   &lt;none&gt;   1s      v1.18.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询Pod组件的状态</span></span><br><span class="line"><span class="keyword"># kubectl</span> get pods<span class="params"> -n</span> kube-system</span><br><span class="line">NAME                                 READY   STATUS    RESTARTS   AGE</span><br><span class="line">coredns-7ff77c879f-67rjn             1/1     Running   0          30m</span><br><span class="line">coredns-7ff77c879f-xpq9h             1/1     Running   0          30m</span><br><span class="line">etcd-k8s-master                      1/1     Running   0          30m</span><br><span class="line">kube-apiserver-k8s-master            1/1     Running   0          30m</span><br><span class="line">kube-controller-manager-k8s-master   1/1     Running   0          30m</span><br><span class="line">kube-flannel-ds-4jtp4                1/1     Running   0          28m</span><br><span class="line">kube-flannel-ds-6k8sp                1/1     Running   0          23m</span><br><span class="line">kube-flannel-ds-bzwrt                1/1     Running   0          23m</span><br><span class="line">kube-flannel-ds-rc8vv                1/1     Running   0          23m</span><br><span class="line">kube-proxy-8bbhk                     1/1     Running   0          30m</span><br><span class="line">kube-proxy-9f96v                     1/1     Running   0          23m</span><br><span class="line">kube-proxy-9j6qh                     1/1     Running   0          23m</span><br><span class="line">kube-proxy-bqm7t                     1/1     Running   0          23m</span><br><span class="line">kube-scheduler-k8s-master            1/1     Running   0          30m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看集群版本</span></span><br><span class="line"><span class="keyword"># kubectl</span> version<span class="params"> --short</span></span><br><span class="line">Client Version: v1.18.0</span><br><span class="line">Server Version: v1.18.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提示：当各节点的 Linux 系统重启后，Kubernetes 集群里对应的组件会自动启动，不需要人为干预</span></span><br></pre></td></tr></tbody></table></figure><p>在 Master 节点里创建一个 Nginx 容器，验证 Kubernetes 集群是否正常运行</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建Nginx容器</span></span><br><span class="line"><span class="keyword"># kubectl</span> create deployment nginx<span class="params"> --image</span>=nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露Nginx的端口</span></span><br><span class="line"><span class="keyword"># kubectl</span> expose deployment nginx<span class="params"> --port</span>=80<span class="params"> --type</span>=NodePort</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Pod组件</span></span><br><span class="line"><span class="keyword"># kubectl</span> get pod</span><br><span class="line">NAME                        READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/nginx-f89759699-59cb7   1/1     Running   0          2m1s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Svc</span></span><br><span class="line"><span class="keyword"># kubectl</span> get svc</span><br><span class="line">NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">service/kubernetes   ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP        48m</span><br><span class="line">service/nginx        NodePort    10.102.129.11   &lt;none&gt;        80:32517/TCP   10s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提示：浏览器访问 "http://&lt;any_node_ip&gt;:32517"，若 Ngninx 容器在集群中创建并启动成功，则默认会打开 Nginx 的首页</span></span><br></pre></td></tr></tbody></table></figure><h2 id="Kubeadm-部署-Dashboard-可视化插件"><a href="#Kubeadm-部署-Dashboard-可视化插件" class="headerlink" title="Kubeadm 部署 Dashboard 可视化插件"></a>Kubeadm 部署 Dashboard 可视化插件</h2><p>在 Kubeadm 部署 Dashboard 可视化插件的流程中，以下所有操作都是直接在 Master 节点里执行，后续不再累述。</p><hr><h3 id="Dashboard-简介"><a href="#Dashboard-简介" class="headerlink" title="Dashboard 简介"></a>Dashboard 简介</h3><p>在 Kubernetes 社区中，有一个很受欢迎的 Dashboard 项目，它可以给用户提供一个可视化的 Web 界面来查看当前集群的各种信息。用户可以用 Kubernetes Dashboard 部署容器化的应用、监控应用的状态、执行故障排查任务以及管理 Kubernetes 各种资源。</p><ul><li><a target="_blank" rel="external nofollow" href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">Dashboard 官方参考文档</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/kubernetes/dashboard">Dashboard Github 项目地址</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/kubernetes/dashboard/releases">Dashboard 各版本说明</a>，Dashboard 版本与 Kubernetes 版本必须匹配（兼容）</li></ul><h3 id="Dashboard-部署"><a href="#Dashboard-部署" class="headerlink" title="Dashboard 部署"></a>Dashboard 部署</h3><p>执行 YAML 文件直接部署 Dashboard，这里的 Kubernetes 1.8 版本对应的 Dashboard 版本为 v2.0.3，两者的版本号必须匹配</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 部署</span></span><br><span class="line"><span class="keyword"># kubectl</span> apply<span class="params"> -f</span> https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.3/aio/deploy/recommended.yaml</span><br></pre></td></tr></tbody></table></figure><p>查看 Dashboard 的运行状态，可以看到以 <code>deployment</code> 方式部署，运行了 2 个 Pod 及 2 个 Service</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看Pod的状态</span></span><br><span class="line"><span class="keyword"># kubectl</span><span class="params"> -n</span> kubernetes-dashboard get pods</span><br><span class="line">NAME                                         READY   STATUS              RESTARTS   AGE</span><br><span class="line">dashboard-metrics-scraper-6b4884c9d5-wn22s   0/1     ContainerCreating   0          48s</span><br><span class="line">kubernetes-dashboard-7f99b75bf4-fn956        0/1     ContainerCreating   0          48s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Svc的状态</span></span><br><span class="line"><span class="keyword"># kubectl</span><span class="params"> -n</span> kubernetes-dashboard get svc</span><br><span class="line">NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">dashboard-metrics-scraper   ClusterIP   10.96.115.247   &lt;none&gt;        8000/TCP   117s</span><br><span class="line">kubernetes-dashboard        ClusterIP   10.100.88.170   &lt;none&gt;        443/TCP    117s</span><br></pre></td></tr></tbody></table></figure><h3 id="Dashboard-暴露服务"><a href="#Dashboard-暴露服务" class="headerlink" title="Dashboard 暴露服务"></a>Dashboard 暴露服务</h3><p>这里作为演示，使用 NodePort 方式将 Dashboard 的服务暴露在集群外，指定使用 30443 端口（可自定义）</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 暴露Service</span></span><br><span class="line"><span class="keyword"># kubectl</span>  patch svc kubernetes-dashboard<span class="params"> -n</span> kubernetes-dashboard<span class="params"> -p</span> <span class="string">'{"spec":{"type":"NodePort","ports":[{"port":443,"targetPort":8443,"nodePort":30443}]}}'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看暴露的Service</span></span><br><span class="line"><span class="keyword"># kubectl</span><span class="params"> -n</span> kubernetes-dashboard get svc</span><br><span class="line">NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE</span><br><span class="line">dashboard-metrics-scraper   ClusterIP   10.96.115.247   &lt;none&gt;        8000/TCP        6m2s</span><br><span class="line">kubernetes-dashboard        NodePort    10.100.88.170   &lt;none&gt;        443:30443/TCP   6m2s</span><br></pre></td></tr></tbody></table></figure><p>或者下载 YAML 文件，手动更改 Service 部分的端口，并以为 NodePort 方式进行部署</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载YAML文件</span></span><br><span class="line"><span class="keyword"># wget</span> https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.3/aio/deploy/recommended.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更改YAML文件</span></span><br><span class="line"><span class="keyword"># vim</span> recommended.yaml</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">  name: kubernetes-dashboard</span><br><span class="line">  namespace: kubernetes-dashboard</span><br><span class="line">spec:</span><br><span class="line">  <span class="built_in">type</span>: NodePort</span><br><span class="line">  ports:</span><br><span class="line">    - port: 443</span><br><span class="line">      targetPort: 8443</span><br><span class="line">      nodePort: 30443</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新配置</span></span><br><span class="line"><span class="keyword"># kubectl</span> apply<span class="params"> -f</span> recommended.yaml</span><br></pre></td></tr></tbody></table></figure><h3 id="Dashboard-认证方式登录"><a href="#Dashboard-认证方式登录" class="headerlink" title="Dashboard 认证方式登录"></a>Dashboard 认证方式登录</h3><p>Dashboard 支持 Kubeconfig 和 Token 两种认证方式，这里选择 Token 认证方式登录，首先执行以下操作创建登录用户</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建YAML配置文件，复制下面的内容到文件中</span></span><br><span class="line"><span class="keyword"># vim</span> dashboard-adminuser.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建登录用户</span></span><br><span class="line"><span class="keyword"># kubectl</span> apply<span class="params"> -f</span> dashboard-adminuser.yaml</span><br></pre></td></tr></tbody></table></figure><p>YAML 配置文件 <code>dashboard-adminuser.yaml</code> 的完整内容如下，指定了一个名称为 <code>admin-user</code> 的服务账号，并放在 <code>kubernetes-dashboard</code> 命名空间下，并将 <code>cluster-admin</code> 角色绑定到 <code>admin-user</code> 账户，这样 <code>admin-user</code> 账户就有了管理员的权限。默认情况下，Kubeadm 创建集群时已经创建了 <code>cluster-admin</code> 角色，只需直接绑定即可</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-admin</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kubernetes-dashboard</span></span><br></pre></td></tr></tbody></table></figure><p>查看 <code>admin-user</code> 账户的 Token</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看Token</span></span><br><span class="line"><span class="keyword"># kubectl</span><span class="params"> -n</span> kubernetes-dashboard describe secret $(kubectl<span class="params"> -n</span> kubernetes-dashboard get secret | grep admin-user | awk <span class="string">'{print $1}'</span>)</span><br></pre></td></tr></tbody></table></figure><p>使用火狐浏览器打开 <code>https://&lt;any_node_ip&gt;:30443</code>，访问 Dashboard 的登录界面，由于谷歌浏览器会强制使用 HTTPS 协议，这将导致无法访问 Dashboard 的登录页面，因此建议使用火狐浏览器进行访问</p><p><img data-src="../../../asset/2021/03/kubernetes-dashboard-1.png" alt="kubernetes-dashboard-1"></p><p>将获取到的 Token 复制到登录界面的 Token 输入框中，成功登陆 Dashboard</p><p><img data-src="../../../asset/2021/03/kubernetes-dashboard-2.png" alt="kubernetes-dashboard-2"></p><h3 id="Dashboard-登录超时"><a href="#Dashboard-登录超时" class="headerlink" title="Dashboard 登录超时"></a>Dashboard 登录超时</h3><p>Dashboard 默认登录超时时间是 15min，可以为 Dashboard 容器增加 <code>--token-ttl</code> 参数来自定义超时时间，配置示例如下：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载YAML文件</span></span><br><span class="line"><span class="keyword"># wget</span> https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.3/aio/deploy/recommended.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更改YAML文件</span></span><br><span class="line"><span class="keyword"># vim</span> recommended.yaml</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">args:</span><br><span class="line">  -<span class="params"> --auto</span>-generate-certificates</span><br><span class="line">  -<span class="params"> --namespace</span>=kubernetes-dashboard</span><br><span class="line">  -<span class="params"> --token</span>-ttl=43200</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新配置</span></span><br><span class="line"><span class="keyword"># kubectl</span> apply<span class="params"> -f</span> recommended.yaml</span><br></pre></td></tr></tbody></table></figure><h2 id="Kubeadm-搭建集群问题总结"><a href="#Kubeadm-搭建集群问题总结" class="headerlink" title="Kubeadm 搭建集群问题总结"></a>Kubeadm 搭建集群问题总结</h2><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ERROR NumCPU]: the number of available CPUs 1 is less than the required 2</span><br></pre></td></tr></tbody></table></figure><p>执行 <code>kubeadm init</code> 命令，提示 CPU 核心数少于 2，可以添加命令参数 <code>--ignore-preflight-errors=NumCPU</code> 忽略警告</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ERROR Swap]: running with swap on is not supported. Please disable swap</span><br></pre></td></tr></tbody></table></figure><p>执行 <code>kubeadm init</code> 命令，提示启用了 swap 分区，可以添加命令参数 <code>--ignore-preflight-errors 'Swap'</code> 忽略错误</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[WARNING SystemVerification]: this Docker version is not on the list of validated versions: 19.03.1. Latest validated version: 18.09</span><br></pre></td></tr></tbody></table></figure><p>执行 <code>kubeadm init</code> 命令，提示 Docker 的版本过高，可能与 Kubernetes 的版本不兼容</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The connection to the server raw.githubusercontent.com was refused - did you specify the right host or port?</span><br></pre></td></tr></tbody></table></figure><p>执行 <code>kubectl apply -f</code> 命令，提示网络链接失败，这是国内无法访问 <code>raw.githubusercontent.com</code> 导致，临时解决方法如下：</p><ul><li>在 <code>https://www.ipaddress.com</code> 网站上查询 <code>raw.githubusercontent.com</code> 域名的真实 IP 地址</li><li>更改系统的 <code>/etc/hosts</code> 配置文件，添加一行内容 <code>185.199.108.133 raw.githubusercontent.com</code>，将 <code>185.199.108.133</code> 替换为查询到真实的 IP 地址</li><li>重新执行 <code>kubectl apply -f</code> 命令即可</li></ul><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a target="_blank" rel="external nofollow" href="https://blog.csdn.net/networken/article/details/85607593">Kubernetes 部署 Dashboard 可视化插件</a></li><li><a target="_blank" rel="external nofollow" href="https://blog.csdn.net/u010948569/article/details/107059535/">Kubeadm 部署单 Master 节点 Kubernetes 集群</a></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/b728042a.html" title="Kubernetes 之一特性与 Kubeadm 方式搭建集群">https://www.techgrow.cn/posts/b728042a.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%AE%B9%E5%99%A8%E5%8C%96/" rel="tag"><i class="fa fa-tag"></i> 容器化</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/ffd8d40a.html" rel="prev" title="LeetCode 刷题教程之一"><i class="fa fa-angle-left"></i> LeetCode 刷题教程之一</a></div><div class="post-nav-item"> <a href="/posts/d43b3761.html" rel="next" title="LeetCode 刷题教程之二">LeetCode 刷题教程之二<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">1.4m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">20:34</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤 ICP 备 19024664 号</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035 号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/app/api/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/app/api/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/b728042a.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>