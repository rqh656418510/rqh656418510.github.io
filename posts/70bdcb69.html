<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍如何在 Linux 生产环境部署 Kafka-Eagle（EFAK）集群，实现对 Kafka 集群的监控。"><meta property="og:type" content="article"><meta property="og:title" content="Linux 生产环境部署 Kafka-Eagle（EFAK）集群"><meta property="og:url" content="https://www.techgrow.cn/posts/70bdcb69.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍如何在 Linux 生产环境部署 Kafka-Eagle（EFAK）集群，实现对 Kafka 集群的监控。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/linux-efak-cluster-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/linux-efak-cluster-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/linux-efak-cluster-3.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/linux-efak-cluster-4.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/linux-efak-cluster-8.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/linux-efak-cluster-6.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/linux-efak-cluster-7.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/linux-efak-cluster-5.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/linux-efak-cluster-9.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/linux-efak-cluster-10.png"><meta property="article:published_time" content="2024-11-18T13:30:00.000Z"><meta property="article:modified_time" content="2024-12-07T13:30:00.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="Linux运维"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2024/12/linux-efak-cluster-1.png"><link rel="canonical" href="https://www.techgrow.cn/posts/70bdcb69.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/70bdcb69.html","path":"posts/70bdcb69.html","title":"Linux 生产环境部署 Kafka-Eagle（EFAK）集群"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Linux 生产环境部署 Kafka-Eagle（EFAK）集群 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%98%E6%96%B9%E8%B5%84%E6%BA%90"><span class="nav-text">官方资源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-text">准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E4%BE%9D%E8%B5%96%E6%9C%8D%E5%8A%A1"><span class="nav-text">部署依赖服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">初始化数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kafka-Eagle-%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2"><span class="nav-text">Kafka Eagle 集群部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%84%E5%88%92%E9%9B%86%E7%BE%A4"><span class="nav-text">规划集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E9%9B%86%E7%BE%A4"><span class="nav-text">安装集群</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E6%96%87%E4%BB%B6"><span class="nav-text">下载安装文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">更改配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-text">添加环境变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SSH-%E5%85%8D%E7%A7%98%E9%92%A5%E7%99%BB%E5%BD%95"><span class="nav-text">SSH 免秘钥登录</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4"><span class="nav-text">配置集群</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E4%B8%80"><span class="nav-text">配置集群节点一</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E4%BA%8C"><span class="nav-text">配置集群节点二</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9%E4%B8%89"><span class="nav-text">配置集群节点三</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E9%9B%86%E7%BE%A4"><span class="nav-text">启动集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E9%9B%86%E7%BE%A4"><span class="nav-text">管理集群</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E6%95%B4%E4%B8%AA%E9%9B%86%E7%BE%A4"><span class="nav-text">管理整个集群</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9"><span class="nav-text">管理集群节点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4%E6%B1%87%E6%80%BB"><span class="nav-text">管理命令汇总</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E9%9B%86%E7%BE%A4"><span class="nav-text">验证集群</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kafka-Eagle-%E9%83%A8%E7%BD%B2%E9%97%AE%E9%A2%98"><span class="nav-text">Kafka Eagle 部署问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E6%B3%95%E7%9B%91%E6%8E%A7-Kafka-%E9%9B%86%E7%BE%A4"><span class="nav-text">无法监控 Kafka 集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kafka-Eagle-%E6%97%A0%E6%B3%95%E7%9B%91%E6%8E%A7%E8%87%AA%E5%B7%B1"><span class="nav-text">Kafka Eagle 无法监控自己</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E4%B8%8D%E8%B6%B3%E5%AF%BC%E8%87%B4%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5"><span class="nav-text">内存不足导致服务启动失败</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%91%E6%8E%A7%E5%A4%A7%E5%B1%8F%E6%97%A0%E6%B3%95%E5%AE%9E%E6%97%B6%E6%9B%B4%E6%96%B0%E6%98%BE%E7%A4%BA"><span class="nav-text">监控大屏无法实时更新显示</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kafka-Eagle-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-text">Kafka Eagle 工作原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Kafka-Eagle-%E9%9B%86%E7%BE%A4%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="nav-text">Kafka Eagle 集群整体架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kafka-Eagle-%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E5%8E%9F%E7%90%86"><span class="nav-text">Kafka Eagle 数据采集原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%95%99%E7%A8%8B"><span class="nav-text">参考教程</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">742</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/70bdcb69.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Linux 生产环境部署 Kafka-Eagle（EFAK）集群 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍如何在 Linux 生产环境部署 Kafka-Eagle（EFAK）集群，实现对 Kafka 集群的监控。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Linux 生产环境部署 Kafka-Eagle（EFAK）集群</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2024-11-18 21:30:00" itemprop="dateCreated datePublished" datetime="2024-11-18T21:30:00+08:00">2024-11-18</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-12-07 21:30:00" itemprop="dateModified" datetime="2024-12-07T21:30:00+08:00">2024-12-07</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/70bdcb69.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/70bdcb69.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>6k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>5 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/d2fe844e.html">Linux 部署 Kafka Eagle（EFAK）单机</a></li><li><a href="/posts/73b15688.html">Docker 部署 Kafka Eagle（EFAK）单机</a></li><li><a href="/posts/70bdcb69.html">Linux 生产环境部署 Kafka Eagle（EFAK）集群</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文将介绍在三台服务器上，手动部署 Kafka-Eagle（EFAK）的集群服务，实现对 Kafka 集群的管理和监控，适用于 CentOS/Debian/Ubuntu 等发行版。</p><h2 id="官方资源"><a href="#官方资源" class="headerlink" title="官方资源"></a>官方资源</h2><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/smartloli/EFAK">Kafka Eagle（EFAK）官方项目</a></li><li><a target="_blank" rel="external nofollow" href="https://docs.kafka-eagle.org/">Kafka Eagle（EFAK）官方文档</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/smartloli/kafka-eagle-bin/tags">Kafka Eagle（EFAK）官方下载</a></li></ul><span id="more"></span><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="部署依赖服务"><a href="#部署依赖服务" class="headerlink" title="部署依赖服务"></a>部署依赖服务</h3><ul><li>在部署 Kafka Eagle（EFAK）集群之前，请确保已经部署好 ZooKeeper 集群、Kafka 集群、MySQL。</li></ul><table><thead><tr><th>服务</th><th>版本</th><th>说明</th></tr></thead><tbody><tr><td> ZooKeeper</td><td><code>3.8.4</code></td><td>集群（三节点）</td></tr><tr><td>Kafka</td><td><code>3.9.0</code></td><td>集群（三节点）</td></tr><tr><td>MySQL</td><td><code>8.4.2</code></td><td>单机</td></tr></tbody></table><div class="admonition note"><p class="admonition-title">提示</p><ul><li>从 Kafka <code>2.8.0</code> 版本开始，Kafka 自身实现了 <code>Raft</code> 分布式一致性机制，这意味着 Kafka 集群是可以脱离 ZooKeeper 独立运行的。但是，本文使用的 Kafka 集群是依赖于 ZooKeeper 的，因此需要提前将 ZooKeeper 集群部署好。</li><li>Kafka Eagle（EFAK）集群需要一个数据库来统一存储其配置数据，如用户数据、Kafka 集群的监控指标数据等。当不使用 MySQL 来存储 Kafka 的监控指标数据时，Kafka Eagle（EFAK）默认使用的是 SQLite，而 SQLite 是存储在 EFAK 安装位置的嵌入式数据库。</li></ul></div><h3 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h3><ul><li>创建数据库，用于 Kafka Eagle（EFAK）存储 Kafka 的监控指标数据</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 创建数据库</span><br><span class="line">CREATE DATABASE efak DEFAULT CHARACTER SET utf8mb4;</span><br></pre></td></tr></tbody></table></figure><ul><li>创建数据库用户并授权访问，用于 Kafka Eagle（EFAK）连接 MySQL</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 创建用户</span><br><span class="line">CREATE USER <span class="string">'efak'</span>@<span class="string">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class="string">'123456'</span>;</span><br><span class="line"></span><br><span class="line">-- 用户授权</span><br><span class="line">GRANT ALL PRIVILEGES ON efak.* TO <span class="string">'efak'</span>@<span class="string">'%'</span>;</span><br><span class="line"></span><br><span class="line">-- 刷新权限</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">提示</p><p>在初始化 MySQL 数据库时，只需要创建数据库，而不需要手动创建数据库表。这是因为 Kafka Eagle（EFAK）会在启动的时候自动创建所需的 <a href="../../../asset/2024/12/linux-efak-cluster-db-tables.png">数据库表</a>，前提是 Kafka Eagle（EFAK）用于连接 MySQL 的用户有对应的数据库操作权限。</p></div><h2 id="Kafka-Eagle-集群部署"><a href="#Kafka-Eagle-集群部署" class="headerlink" title="Kafka Eagle 集群部署"></a>Kafka Eagle 集群部署</h2><p>本节将部署 Kafka Eagle（EFAK）集群服务，以实现对 Kafka 集群的管理和监控。值得一提的是，Kafka Eagle（EFAK）的运行依赖于 JDK 1.8+，请提前在各个服务器上安装并配置好 Java 运行环境，包括添加 <code>JAVA_HOME</code> 系统环境变量。</p><h3 id="规划集群"><a href="#规划集群" class="headerlink" title="规划集群"></a>规划集群</h3><table><thead><tr><th>节点</th><th> IP</th><th>Web UI 端口</th><th>集群通信端口</th><th>版本</th><th>说明</th></tr></thead><tbody><tr><td> Kafka Eagle（EFAK）节点一</td><td><code>192.168.2.127</code></td><td><code>8048</code></td><td><code>8085</code></td><td><code>3.0.1</code></td><td>Master 节点</td></tr><tr><td> Kafka Eagle（EFAK）节点二</td><td><code>192.168.2.150</code></td><td><code>8048</code></td><td><code>8085</code></td><td><code>3.0.1</code></td><td>Slave 节点</td></tr><tr><td> Kafka Eagle（EFAK）节点三</td><td><code>192.168.2.203</code></td><td><code>8048</code></td><td><code>8085</code></td><td><code>3.0.1</code></td><td>Slave 节点</td></tr></tbody></table><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>(1) 由于服务器资源有限，本文部署的 Kafka Eagle（EFAK）集群只包含 1 个 Master 节点和 2 个 Slave 节点。</li><li>(2) 在生产环境部署 Kafka Eagle（EFAK）集群时，强烈建议至少申请四台服务器，然后至少部署 1 个 Master 节点和 3 个 Slave 节点（即一主三从），以此保证高可用性。</li></ul></div><h3 id="安装集群"><a href="#安装集群" class="headerlink" title="安装集群"></a>安装集群</h3><p>首先在三台服务器上，根据以下步骤分别安装好 Kafka Eagle（EFAK），安装完成后就形成了三个 Kafka Eagle 集群节点。</p><div class="admonition note"><p class="admonition-title">提示</p><ul><li>为了操作方便，当安装和配置好一个集群节点后，可以使用 <code>scp</code> 命令将安装目录和系统配置文件直接拷贝到其他集群节点上，比如：</li><li>(1) 拷贝安装文件：<code>scp -r /opt/efak root@192.168.2.150:/opt</code></li><li>(2) 拷贝系统文件：<code>scp -r /etc/profile root@192.168.2.150:/etc</code></li></ul></div><h4 id="下载安装文件"><a href="#下载安装文件" class="headerlink" title="下载安装文件"></a>下载安装文件</h4><ul><li>浏览器访问 Kafka Eagle（EFAK）的 <a target="_blank" rel="external nofollow" href="https://github.com/smartloli/kafka-eagle-bin/tags">GitHub 项目</a>，然后选择最新版本的二进制包进行下载并解压</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载文件</span></span><br><span class="line">$ wget https://github.com/smartloli/kafka-eagle-bin/archive/refs/tags/v3.0.1.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压文件</span></span><br><span class="line">$ tar -xvf v3.0.1.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入解压目录</span></span><br><span class="line">$ <span class="built_in">cd</span> kafka-eagle-bin-3.0.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次解压文件</span></span><br><span class="line">$ tar -xvf efak-web-3.0.1-bin.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移动解压目录</span></span><br><span class="line">$ sudo mv efak-web-3.0.1 /opt/efak</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件统一授权</span></span><br><span class="line">$ sudo chmod -R 777 /opt/efak</span><br><span class="line"></span><br><span class="line"><span class="comment"># 脚本授权执行</span></span><br><span class="line">$ sudo chmod +x /opt/efak/bin/ke.sh</span><br></pre></td></tr></tbody></table></figure><h4 id="更改配置文件"><a href="#更改配置文件" class="headerlink" title="更改配置文件"></a>更改配置文件</h4><div class="admonition note"><p class="admonition-title">提示</p><p>Kafka Eagle（EFAK）是支持管理多个 Kafka 集群的，由于笔者只部署了一个 Kafka 集群，因此在下述配置内容中只配置了一个 Kafka 集群。</p></div><ul><li>编辑 Kafka Eagle（EFAK）的配置文件 <code>system-config.properties</code></li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份配置文件</span></span><br><span class="line">$ cp /opt/efak/conf/system-config.properties /opt/efak/conf/system-config.properties.bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑配置文件</span></span><br><span class="line">$ vi /opt/efak/conf/system-config.properties</span><br></pre></td></tr></tbody></table></figure><ul><li>然后更改配置文件的内容，更改后的完整配置内容如下所示</li></ul><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># multi zookeeper &amp; kafka cluster list</span></span><br><span class="line"><span class="comment"># Settings prefixed with 'kafka.eagle.' will be deprecated, use 'efak.' instead</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.zk.cluster.alias</span>=<span class="string">cluster1</span></span><br><span class="line"><span class="meta">cluster1.zk.list</span>=<span class="string">192.168.2.102:2181,192.168.2.103:2181,192.168.2.104:2181/kafka</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># zookeeper enable acl</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">cluster1.zk.acl.enable</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">cluster1.zk.acl.schema</span>=<span class="string">digest</span></span><br><span class="line"><span class="meta">cluster1.zk.acl.username</span>=<span class="string">test</span></span><br><span class="line"><span class="meta">cluster1.zk.acl.password</span>=<span class="string">test123</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># broker size online list</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">cluster1.efak.broker.size</span>=<span class="string">20</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># zk client thread limit</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">kafka.zk.limit.size</span>=<span class="string">32</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># EFAK webui port</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.webui.port</span>=<span class="string">8048</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># EFAK enable distributed</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.distributed.enable</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># efak.cluster.mode.status=master</span></span><br><span class="line"><span class="comment"># efak.worknode.master.host=localhost</span></span><br><span class="line"><span class="comment"># efak.worknode.port=8085</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># kafka jmx acl and ssl authenticate</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">cluster1.efak.jmx.acl</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">cluster1.efak.jmx.user</span>=<span class="string">keadmin</span></span><br><span class="line"><span class="meta">cluster1.efak.jmx.password</span>=<span class="string">keadmin123</span></span><br><span class="line"><span class="meta">cluster1.efak.jmx.ssl</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">cluster1.efak.jmx.truststore.location</span>=<span class="string">/data/ssl/certificates/kafka.truststore</span></span><br><span class="line"><span class="meta">cluster1.efak.jmx.truststore.password</span>=<span class="string">ke123456</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># kafka offset storage</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">cluster1.efak.offset.storage</span>=<span class="string">kafka</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># kafka jmx uri</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">cluster1.efak.jmx.uri</span>=<span class="string">service:jmx:rmi:///jndi/rmi://%s/jmxrmi</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># kafka metrics, 15 days by default</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.metrics.charts</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">efak.metrics.retain</span>=<span class="string">30</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># kafka sql topic records max</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.sql.topic.records.max</span>=<span class="string">5000</span></span><br><span class="line"><span class="meta">efak.sql.topic.preview.records.max</span>=<span class="string">10</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># delete kafka topic token</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.topic.token</span>=<span class="string">keadmin</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># kafka sasl authenticate</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">cluster1.efak.sasl.enable</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">cluster1.efak.sasl.protocol</span>=<span class="string">SASL_PLAINTEXT</span></span><br><span class="line"><span class="meta">cluster1.efak.sasl.mechanism</span>=<span class="string">SCRAM-SHA-256</span></span><br><span class="line"><span class="meta">cluster1.efak.sasl.jaas.config</span>=<span class="string">org.apache.kafka.common.security.scram.ScramLoginModule required username="kafka" password="kafka-eagle";</span></span><br><span class="line"><span class="meta">cluster1.efak.sasl.client.id</span>=<span class="string"></span></span><br><span class="line"><span class="meta">cluster1.efak.blacklist.topics</span>=<span class="string"></span></span><br><span class="line"><span class="meta">cluster1.efak.sasl.cgroup.enable</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">cluster1.efak.sasl.cgroup.topics</span>=<span class="string"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># kafka ssl authenticate</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">cluster1.efak.ssl.enable</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">cluster1.efak.ssl.protocol</span>=<span class="string">SSL</span></span><br><span class="line"><span class="meta">cluster1.efak.ssl.truststore.location</span>=<span class="string"></span></span><br><span class="line"><span class="meta">cluster1.efak.ssl.truststore.password</span>=<span class="string"></span></span><br><span class="line"><span class="meta">cluster1.efak.ssl.keystore.location</span>=<span class="string"></span></span><br><span class="line"><span class="meta">cluster1.efak.ssl.keystore.password</span>=<span class="string"></span></span><br><span class="line"><span class="meta">cluster1.efak.ssl.key.password</span>=<span class="string"></span></span><br><span class="line"><span class="meta">cluster1.efak.ssl.endpoint.identification.algorithm</span>=<span class="string">https</span></span><br><span class="line"><span class="meta">cluster1.efak.blacklist.topics</span>=<span class="string"></span></span><br><span class="line"><span class="meta">cluster1.efak.ssl.cgroup.enable</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">cluster1.efak.ssl.cgroup.topics</span>=<span class="string"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># kafka sqlite jdbc driver address</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># efak.driver=org.sqlite.JDBC</span></span><br><span class="line"><span class="comment"># It is important to note that the '/opt/efak/db' path must exist.</span></span><br><span class="line"><span class="comment"># efak.url=jdbc:sqlite:/opt/efak/db/ke.db</span></span><br><span class="line"><span class="comment"># efak.username=root</span></span><br><span class="line"><span class="comment"># efak.password=smartloli</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># kafka mysql jdbc driver address</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">efak.url</span>=<span class="string">jdbc:mysql://192.168.2.107:3306/efak?useUnicode=true&amp;characterEncoding=UTF-8&amp;zeroDateTimeBehavior=convertToNull</span></span><br><span class="line"><span class="meta">efak.username</span>=<span class="string">efak</span></span><br><span class="line"><span class="meta">efak.password</span>=<span class="string">123456</span></span><br></pre></td></tr></tbody></table></figure><ul><li>在上述配置内容中，最重要的是以下几个配置项，其他配置项一般使用默认值即可</li></ul><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># multi zookeeper &amp; kafka cluster list</span></span><br><span class="line"><span class="comment"># Settings prefixed with 'kafka.eagle.' will be deprecated, use 'efak.' instead</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.zk.cluster.alias</span>=<span class="string">cluster1</span></span><br><span class="line"><span class="meta">cluster1.zk.list</span>=<span class="string">192.168.2.102:2181,192.168.2.103:2181,192.168.2.104:2181/kafka</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># kafka offset storage</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">cluster1.efak.offset.storage</span>=<span class="string">kafka</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># kafka metrics, 15 days by default</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.metrics.charts</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">efak.metrics.retain</span>=<span class="string">30</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># kafka jdbc driver address</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">efak.url</span>=<span class="string">jdbc:mysql://192.168.2.107:3306/efak?useUnicode=true&amp;characterEncoding=UTF-8&amp;zeroDateTimeBehavior=convertToNull</span></span><br><span class="line"><span class="meta">efak.username</span>=<span class="string">efak</span></span><br><span class="line"><span class="meta">efak.password</span>=<span class="string">123456</span></span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">重要参数说明</p><ul><li><code>cluster1.zk.list</code>：指定 Kafka 集群一连接的 ZooKeeper 节点列表。</li><li><code>cluster1.efak.offset.storage</code>：指定 Kafka 集群一存储 Offset 的位置。</li><li><code>efak.username</code>：指定 Kafka Eagle（EFAK）连接数据库的用户名。</li><li><code>efak.password</code>：指定 Kafka Eagle（EFAK）连接数据库的密码。</li><li><code>efak.driver</code>：指定 Kafka Eagle（EFAK）连接数据库的驱动。</li><li><code>efak.url</code>：指定 Kafka Eagle（EFAK）连接数据库的 URL。</li><li><code>efak.metrics.charts</code>：在 Kafka Eagle（EFAK）的 UI 中，是否允许实时显示 Kafka 的监控指标图表。</li><li><code>efak.metrics.retain</code>：Kafka Eagle（EFAK）保留 Kafka 监控指标数据的最长时间（比如 30 天），超过设定的时间监控指标数据就会被删除。</li></ul></div><h4 id="添加环境变量"><a href="#添加环境变量" class="headerlink" title="添加环境变量"></a>添加环境变量</h4><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更改系统配置文件，添加环境变量</span></span><br><span class="line">$ sudo vi /etc/profile</span><br><span class="line"><span class="built_in">export</span> KE_HOME=/opt/efak</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$KE_HOME</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使系统配置文件的更改生效</span></span><br><span class="line">$ sudo <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></tbody></table></figure><h4 id="SSH-免秘钥登录"><a href="#SSH-免秘钥登录" class="headerlink" title="SSH 免秘钥登录"></a>SSH 免秘钥登录</h4><p>Kafka Eagle（EFAK）集群管理的 Shell 脚本是依赖于 SSH 免秘钥登录执行的，因此需要提前配置好各个集群节点之间的 SSH 免秘钥登录，否则执行官方的 <code>ke.sh</code> 脚本会出错。请分别在所有 Kafka Eagle（EFAK）集群节点上，依次执行以下操作。</p><ul><li>配置 SSH 服务允许使用公钥登录</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑 SSH 服务的配置文件</span></span><br><span class="line">$ sudo vi /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保以下配置项存在，并且未被注释</span></span><br><span class="line">PubkeyAuthentication yes</span><br></pre></td></tr></tbody></table></figure><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重启 SSH 服务</span></span><br><span class="line">$ sudo systemctl restart sshd</span><br></pre></td></tr></tbody></table></figure><ul><li>生成 SSH 密钥对</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果需要使用密码保护私钥，则可以输入密码，否则直接按回车键跳过即可</span></span><br><span class="line">$ ssh-keygen -t rsa -b 4096</span><br></pre></td></tr></tbody></table></figure><ul><li>将公钥传输到其他集群节点（比如，在节点一上进行操作，请自行更改节点的登录用户和 IP 地址）</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-copy-id node1-user@node1-ip</span><br><span class="line">$ ssh-copy-id node2-user@node2-ip</span><br><span class="line">$ ssh-copy-id node3-user@node3-ip</span><br></pre></td></tr></tbody></table></figure><ul><li>验证 SSH 免密登录（比如，在节点一上进行操作，请自行更改节点的登录用户和 IP 地址）</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ssh node1-user@node1-ip</span><br><span class="line">$ ssh node2-user@node2-ip</span><br><span class="line">$ ssh node3-user@node3-ip</span><br></pre></td></tr></tbody></table></figure><h3 id="配置集群"><a href="#配置集群" class="headerlink" title="配置集群"></a>配置集群</h3><h4 id="配置集群节点一"><a href="#配置集群节点一" class="headerlink" title="配置集群节点一"></a>配置集群节点一</h4><ul><li>更改 Kafka Eagle（EFAK）集群节点一的配置文件 <code>/opt/efak/conf/system-config.properties</code>，指定其作为 Master 节点，同时指定其 IP 地址与集群通信端口（不能使用 Web UI 端口 <code>8048</code>，否则端口会冲突）</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi /opt/efak/conf/system-config.properties</span><br></pre></td></tr></tbody></table></figure><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># EFAK enable distributed</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.distributed.enable</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">efak.cluster.mode.status</span>=<span class="string">master</span></span><br><span class="line"><span class="meta">efak.worknode.master.host</span>=<span class="string">192.168.2.127</span></span><br><span class="line"><span class="meta">efak.worknode.port</span>=<span class="string">8085</span></span><br></pre></td></tr></tbody></table></figure><ul><li>更改 Kafka Eagle（EFAK）集群节点一的配置文件 <code>/opt/efak/conf/works</code>，添加 Kafka Eagle（EFAK）集群的 Slave 节点列表</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi /opt/efak/conf/works</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.2.150</span><br><span class="line">192.168.2.203</span><br></pre></td></tr></tbody></table></figure><h4 id="配置集群节点二"><a href="#配置集群节点二" class="headerlink" title="配置集群节点二"></a>配置集群节点二</h4><ul><li>更改 Kafka Eagle（EFAK）集群节点二的配置文件 <code>system-config.properties</code>，指定其作为 Slave 节点，同时指定其 IP 地址与集群通信端口（不能使用 Web UI 端口 <code>8048</code>，否则端口会冲突）</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi /opt/efak/conf/system-config.properties</span><br></pre></td></tr></tbody></table></figure><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># EFAK enable distributed</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.distributed.enable</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">efak.cluster.mode.status</span>=<span class="string">slave</span></span><br><span class="line"><span class="meta">efak.worknode.master.host</span>=<span class="string">192.168.2.150</span></span><br><span class="line"><span class="meta">efak.worknode.port</span>=<span class="string">8085</span></span><br></pre></td></tr></tbody></table></figure><ul><li>更改 Kafka Eagle（EFAK）集群节点二的配置文件 <code>/opt/efak/conf/works</code>，添加 Kafka Eagle（EFAK）集群的 Slave 节点列表</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi /opt/efak/conf/works</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.2.150</span><br><span class="line">192.168.2.203</span><br></pre></td></tr></tbody></table></figure><h4 id="配置集群节点三"><a href="#配置集群节点三" class="headerlink" title="配置集群节点三"></a>配置集群节点三</h4><ul><li>更改 Kafka Eagle（EFAK）集群节点三的配置文件 <code>system-config.properties</code>，指定其作为 Slave 节点，同时指定其 IP 地址与集群通信端口（不能使用 Web UI 端口 <code>8048</code>，否则端口会冲突）</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi /opt/efak/conf/system-config.properties</span><br></pre></td></tr></tbody></table></figure><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># EFAK enable distributed</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.distributed.enable</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">efak.cluster.mode.status</span>=<span class="string">slave</span></span><br><span class="line"><span class="meta">efak.worknode.master.host</span>=<span class="string">192.168.2.203</span></span><br><span class="line"><span class="meta">efak.worknode.port</span>=<span class="string">8085</span></span><br></pre></td></tr></tbody></table></figure><ul><li>更改 Kafka Eagle（EFAK）集群节点三的配置文件 <code>/opt/efak/conf/works</code>，添加 Kafka Eagle（EFAK）集群的 Slave 节点列表</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vi /opt/efak/conf/works</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">192.168.2.150</span><br><span class="line">192.168.2.203</span><br></pre></td></tr></tbody></table></figure><h3 id="启动集群"><a href="#启动集群" class="headerlink" title="启动集群"></a>启动集群</h3><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>(1) 在启动 Kafka Eagle（EFAK）集群之前，必须保证 ZooKeeper 集群、Kafka 集群 和 MySQL 已经启动并正常运行。</li><li>(2) <strong>在启动 Kafka Eagle（EFAK）集群之前，必须保证 ZooKeeper 集群、Kafka 集群 和 MySQL 的各个服务端口可以被外部正常访问；如果外部访问不了，请检查操作系统的防火墙配置。</strong></li></ul></div><ul><li>在任意一个 Kafka Eagle（EFAK）集群节点上，执行脚本来启动集群（只需在任意一个节点上执行一次即可）</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ke.sh cluster start</span><br></pre></td></tr></tbody></table></figure><ul><li>Kafka Eagle（EFAK）集群正常启动后，终端输出的日志信息如下所示</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Welcome to</span><br><span class="line">    ______    ______    ___     __ __</span><br><span class="line">   / ____/   / ____/   /   |   / //_/</span><br><span class="line">  / __/     / /_      / /| |  / ,&lt;   </span><br><span class="line"> / /___    / __/     / ___ | / /| |  </span><br><span class="line">/_____/   /_/       /_/  |_|/_/ |_|  </span><br><span class="line">( Eagle For Apache Kafka® )</span><br><span class="line"></span><br><span class="line">Version v3.0.1 -- Copyright 2016-2022</span><br><span class="line">*******************************************************************</span><br><span class="line">* EFAK Service has started success.</span><br><span class="line">* Welcome, Now you can visit 'http://192.168.2.127:8048'</span><br><span class="line">* Account:admin ,Password:123456</span><br><span class="line">*******************************************************************</span><br><span class="line">* &lt;Usage&gt; ke.sh [start|status|stop|restart|stats] &lt;/Usage&gt;</span><br><span class="line">* &lt;Usage&gt; https://www.kafka-eagle.org/ &lt;/Usage&gt;</span><br><span class="line">*******************************************************************</span><br><span class="line">[2024-12-07 21:38:36] INFO: EFAK Master-192.168.2.127 WebConsole Start Success.</span><br><span class="line">[2024-12-07 21:38:36] INFO: EFAK Slave-192.168.2.150 WebConsole Start Success.</span><br><span class="line">[2024-12-07 21:38:36] INFO: EFAK Slave-192.168.2.203 WebConsole Start Success.</span><br><span class="line">[2024-12-07 21:38:55] INFO: EFAK Master WorkNodeServer Start Success.</span><br><span class="line">[2024-12-07 21:39:01] INFO: EFAK Slave WorkNodeServer-192.168.2.150 Start Success.</span><br><span class="line">[2024-12-07 21:39:02] INFO: EFAK Slave WorkNodeServer-192.168.2.203 Start Success.</span><br></pre></td></tr></tbody></table></figure><ul><li>若 Kafka Eagle（EFAK）集群启动失败，可以在各个集群节点上通过查看日志信息来排查问题</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看错误日志</span></span><br><span class="line">$ vi /opt/efak/logs/error.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看工作节点日志</span></span><br><span class="line">$ vi /opt/efak/logs/worknode.log</span><br></pre></td></tr></tbody></table></figure><h3 id="管理集群"><a href="#管理集群" class="headerlink" title="管理集群"></a>管理集群</h3><h4 id="管理整个集群"><a href="#管理整个集群" class="headerlink" title="管理整个集群"></a>管理整个集群</h4><ul><li>关闭 Kafka Eagle（EFAK）集群</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ke.sh cluster stop</span><br></pre></td></tr></tbody></table></figure><ul><li>重启 Kafka Eagle（EFAK）集群</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ke.sh cluster restart</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 Kafka Eagle（EFAK）集群的状态</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ke.sh cluster status</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[2024-12-07 22:39:35] INFO: EFAK WebConsole Status.</span><br><span class="line">[2024-12-07 22:39:35] INFO : EFAK-192.168.2.127 is running, [2434] .</span><br><span class="line">[2024-12-07 22:39:37] INFO : EFAK-192.168.2.150 is running, [2542] .</span><br><span class="line">[2024-12-07 22:39:39] INFO : EFAK-192.168.2.203 is running, [2538] .</span><br><span class="line">[2024-12-07 22:39:35] INFO: EFAK WorkNodeServer Status.</span><br><span class="line">[2024-12-07 22:39:41] INFO : WorkNodeServer-192.168.2.127 is running, [2568] .</span><br><span class="line">[2024-12-07 22:39:42] INFO : WorkNodeServer-192.168.2.150 is running, [2457] .</span><br><span class="line">[2024-12-07 22:39:43] INFO : WorkNodeServer-192.168.2.203 is running, [2452] .</span><br><span class="line">Time taken: 2 seconds.</span><br></pre></td></tr></tbody></table></figure><h4 id="管理集群节点"><a href="#管理集群节点" class="headerlink" title="管理集群节点"></a>管理集群节点</h4><ul><li>关闭 Kafka Eagle（EFAK）集群中的某个节点</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ke.sh stop</span><br></pre></td></tr></tbody></table></figure><ul><li>重启 Kafka Eagle（EFAK）集群中的某个节点</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ke.sh restart</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 Kafka Eagle（EFAK）集群中某个节点的进程信息</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ke.sh status</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2024-12-07 22:11:50] INFO : EFAK-fd34:dd83:8cb9::b3e 192.168.2.127 is running, [3346] .</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 Kafka Eagle（EFAK）集群中某个节点在 Linux 操作系统中的句柄数</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ke.sh stats</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">===================== TCP Connections Count  ==========================</span><br><span class="line">(Not all processes could be identified, non-owned process info</span><br><span class="line"> will not be shown, you would have to be root to see it all.)</span><br><span class="line">     39 2434/java</span><br><span class="line">===================== ESTABLISHED/TIME_OUT Status  ====================</span><br><span class="line">      1 192.168.2.203</span><br><span class="line">      1 192.168.2.150</span><br><span class="line">===================== Connection Number Of Different States ===========</span><br><span class="line">LISTEN 13</span><br><span class="line">ESTABLISHED 71</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 Kafka Eagle（EFAK）集群中某个节点的垃圾回收（GC）情况</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ke.sh gc</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[2024-12-07 23:40:29] INFO : EFAK Process[52129] GC.</span><br><span class="line">  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT    CGC    CGCT     GCT   </span><br><span class="line">  0.00 100.00  63.29   3.99  97.86  92.33     98    0.702     0    0.000     0    0.000    0.702</span><br><span class="line">  0.00 100.00  63.29   3.99  97.86  92.33     98    0.702     0    0.000     0    0.000    0.702</span><br><span class="line">  0.00 100.00  63.29   3.99  97.86  92.33     98    0.702     0    0.000     0    0.000    0.702</span><br></pre></td></tr></tbody></table></figure><h4 id="管理命令汇总"><a href="#管理命令汇总" class="headerlink" title="管理命令汇总"></a>管理命令汇总</h4><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td> ke.sh start</td><td> 启动 EFAK 服务器。</td></tr><tr><td>ke.sh status</td><td> 查看 EFAK 运行状态。</td></tr><tr><td>ke.sh stop</td><td> 停止 EFAK 服务器。</td></tr><tr><td>ke.sh restart</td><td> 重新启动 EFAK 服务器。</td></tr><tr><td>ke.sh stats</td><td> 查看 Linux 操作系统中的 EFAK 句柄数。</td></tr><tr><td>ke.sh find [ClassName]</td><td> 在 Jar 中找到类名的位置。</td></tr><tr><td>ke.sh gc</td><td> 查看 EFAK 进程的 GC 情况。</td></tr><tr><td>ke.sh version</td><td> 查看 EFAK 版本。</td></tr><tr><td>ke.sh jdk</td><td> 查看 EFAK 安装的 JDK 详细信息。</td></tr><tr><td>ke.sh sdate</td><td> 查看 EFAK 启动日期。</td></tr><tr><td>ke.sh cluster start</td><td> 启动 EFAK 集群。</td></tr><tr><td>ke.sh cluster stop</td><td> 停止 EFAK 集群。</td></tr><tr><td>ke.sh cluster restart</td><td> 重启 EFAK 集群。</td></tr><tr><td>ke.sh cluster status</td><td> 查看 EFAK 集群的状态。</td></tr></tbody></table><h3 id="验证集群"><a href="#验证集群" class="headerlink" title="验证集群"></a>验证集群</h3><ul><li>(1) 浏览器通过 <code>http://192.168.2.127:8048</code> 访问 Kafka Eagle（EFAK）的控制台管理页面（如下所示），默认的登录账号和密码是 <code>admin/123456</code>，请记得将 <code>192.168.2.127</code> 更改为你自己服务器的 IP 地址。</li></ul><p><img data-src="../../../asset/2024/12/linux-efak-cluster-1.png"></p><ul><li>(2) 浏览器通过 <code>http://192.168.2.127:8048/tv</code> 就可以访问监控数据大屏的页面（如下所示），请记得将 <code>192.168.2.127</code> 更改为你自己服务器的 IP 地址。</li></ul><p><img data-src="../../../asset/2024/12/linux-efak-cluster-2.png"></p><ul><li>(3) 浏览器通过 <code>http://192.168.2.127:8048/cluster/kafka</code> 就可以访问 Kafka 的监控页面（如下所示），请记得将 <code>192.168.2.127</code> 更改为你自己服务器的 IP 地址。</li></ul><p><img data-src="../../../asset/2024/12/linux-efak-cluster-3.png"></p><ul><li>(4) 浏览器通过 <code>http://192.168.2.127:8048/cluster/zookeeper</code> 就可以访问 ZooKeeper 的监控页面（如下所示），请记得将 <code>192.168.2.127</code> 更改为你自己服务器的 IP 地址。</li></ul><p><img data-src="../../../asset/2024/12/linux-efak-cluster-4.png"></p><ul><li>(5) 浏览器通过 <code>http://192.168.2.127:8048/cluster/efakserver</code> 就可以访问 EfakServer 的监控页面（如下所示），请记得将 <code>192.168.2.127</code> 更改为你自己服务器的 IP 地址。</li></ul><p><img data-src="../../../asset/2024/12/linux-efak-cluster-8.png"></p><h2 id="Kafka-Eagle-部署问题"><a href="#Kafka-Eagle-部署问题" class="headerlink" title="Kafka Eagle 部署问题"></a>Kafka Eagle 部署问题</h2><h3 id="无法监控-Kafka-集群"><a href="#无法监控-Kafka-集群" class="headerlink" title="无法监控 Kafka 集群"></a>无法监控 Kafka 集群</h3><p>在 Kafka Eagle（EFAK）的控制台中访问 Kafka 的监控页面时，发现无法正常显示 Kafka 的运行状态，如下图所示：</p><p><img data-src="../../../asset/2024/12/linux-efak-cluster-6.png"></p><p>这通常是由于 Kafka 服务没有配置 JMX 服务或者 JMX 服务配置不正确导致的，因为 Kafka Eagle（EFAK）是基于 JMX 服务来实现 Kafka 运行状态的监控。解决办法是，为 Kafka 服务添加对应的 JMX 配置。</p><ul><li>(1) 如果 Kafka 服务是通过手动部署的（基于二进制安装包），那么可以在执行 <code>kafka-server-start.sh</code> 启动脚本时，添加 <code>JMX_PORT</code> 环境变量来启用 JMX 服务（如下所示），详细教程请参考 <a target="_blank" rel="external nofollow" href="https://stackoverflow.com/questions/36708384/how-to-enable-remote-jmx-on-kafka-brokers-for-jmxtool">这里</a></li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JMX_PORT=19999 ./kafka-server-start.sh -daemon ../config/server.properties</span><br></pre></td></tr></tbody></table></figure><ul><li>(2) 如果 Kafka 服务是通过 Docker-Compose 部署的，那么可以参考以下配置内容，详细教程请参考 <a href="/posts/73b15688.html">这里</a></li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.5'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitnami/kafka:3.9.0</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9092</span><span class="string">:9092</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">19999</span><span class="string">:19999</span>   <span class="comment"># 映射 JMX 端口</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">KAFKA_JMX_PORT:</span> <span class="number">19999</span>   <span class="comment"># 指定 JMX 端口</span></span><br><span class="line">      <span class="attr">KAFKA_JMX_OPTS:</span> <span class="string">'-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=kafka -Dcom.sun.management.jmxremote.port=19999'</span></span><br></pre></td></tr></tbody></table></figure><h3 id="Kafka-Eagle-无法监控自己"><a href="#Kafka-Eagle-无法监控自己" class="headerlink" title="Kafka Eagle 无法监控自己"></a>Kafka Eagle 无法监控自己</h3><p>在 Kafka Eagle（EFAK）的控制台中访问 EfakServer 的监控页面时，发现无法正常显示 EfakServer 的运行状态，监控页面一直显示提示信息 <code>Processing</code> 或者节点状态显示为 <code>Offline</code>，如下图所示：</p><p><img data-src="../../../asset/2024/12/linux-efak-cluster-7.png"></p><p>这通常是因为 Kafka Eagle（EFAK）没有启用集群模式或者集群模式配置不正确导致的，请检查各个集群节点的配置，其中的 <code>8085</code> 端口是 EFAK 集群的通信端口（不能使用 Web UI 端口 <code>8048</code>，否则端口会冲突），如下所示：</p><ul><li>Master 节点的 <code>/opt/efak/conf/system-config.properties</code> 配置文件</li></ul><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># EFAK enable distributed</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.distributed.enable</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">efak.cluster.mode.status</span>=<span class="string">master</span></span><br><span class="line"><span class="meta">efak.worknode.master.host</span>=<span class="string">192.168.2.127</span></span><br><span class="line"><span class="meta">efak.worknode.port</span>=<span class="string">8085</span></span><br></pre></td></tr></tbody></table></figure><ul><li>Slave 节点一的 <code>/opt/efak/conf/system-config.properties</code> 配置文件</li></ul><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># EFAK enable distributed</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.distributed.enable</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">efak.cluster.mode.status</span>=<span class="string">slave</span></span><br><span class="line"><span class="meta">efak.worknode.master.host</span>=<span class="string">192.168.2.150</span></span><br><span class="line"><span class="meta">efak.worknode.port</span>=<span class="string">8085</span></span><br></pre></td></tr></tbody></table></figure><ul><li>Slave 节点二的 <code>/opt/efak/conf/system-config.properties</code> 配置文件</li></ul><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="comment"># EFAK enable distributed</span></span><br><span class="line"><span class="comment">######################################</span></span><br><span class="line"><span class="meta">efak.distributed.enable</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">efak.cluster.mode.status</span>=<span class="string">slave</span></span><br><span class="line"><span class="meta">efak.worknode.master.host</span>=<span class="string">192.168.2.203</span></span><br><span class="line"><span class="meta">efak.worknode.port</span>=<span class="string">8085</span></span><br></pre></td></tr></tbody></table></figure><ul><li>Master 节点与 Slave 节点的 <code>/opt/efak/conf/works</code> 配置文件</li></ul><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">192.168.2.150</span></span><br><span class="line"><span class="attr">192.168.2.203</span></span><br></pre></td></tr></tbody></table></figure><h3 id="内存不足导致服务启动失败"><a href="#内存不足导致服务启动失败" class="headerlink" title="内存不足导致服务启动失败"></a>内存不足导致服务启动失败</h3><p>在 Kafka Eagle（EFAK）的项目源码中，有一个 <code>ke.sh</code> <a target="_blank" rel="external nofollow" href="https://github.com/smartloli/EFAK/blob/main/efak-web/src/main/resources/bin/ke.sh">启动脚本</a>，该脚本里面有以下一行代码：</p><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> KE_JAVA_OPTS=<span class="string">"-server -Xmx2g -Xms2g -XX:MaxGCPauseMillis=20 -XX:+UseG1GC -XX:MetaspaceSize=128m -XX:InitiatingHeapOccupancyPercent=35 -XX:G1HeapRegionSize=16M -XX:MinMetaspaceFreeRatio=50 -XX:MaxMetaspaceFreeRatio=80"</span></span><br></pre></td></tr></tbody></table></figure><p>其中 JVM 参数 <code>-Xms2g</code> 指定了初始堆内存为 <code>2G</code>，因此当操作系统的空闲内存不足 <code>2G</code> 时，会导致 Kafka Eagle（EFAK）服务启动失败。解决办法是，更改 Shell 脚本代码，或者增加机器的物理内存（强烈推荐）。</p><h3 id="监控大屏无法实时更新显示"><a href="#监控大屏无法实时更新显示" class="headerlink" title="监控大屏无法实时更新显示"></a>监控大屏无法实时更新显示</h3><p>在 Kafka Eagle（EFAK）的控制台中访问监控大屏页面时，发现即使有生产者正在发送消息和消费者正在消费消息，Kafka 集群的监控指标图表也无法实时更新显示或者没有任何监控数据显示（如下图所示）。这是因为 Kafka Eagle（EFAK）禁用了 Kafka 集群的监控指标图表实时更新。</p><p><img data-src="../../../asset/2024/12/linux-efak-cluster-5.png"></p><p>解决办法是，在 Kafka Eagle（EFAK）的 <code>system-config.properties</code> 配置文件中，更改或添加以下配置：</p><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">efak.metrics.charts</span>=<span class="string">true</span></span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">特别注意</p><p>在 Kafka Eagle（EFAK）的控制台中，Kafka 集群监控指标图表的渲染和数据获取会消耗一定的资源。如果 Kafka 的集群规模较大或者系统资源有限，建议通过禁用 <code>efak.metrics.charts</code> 选项来减少系统负载。</p></div><h2 id="Kafka-Eagle-工作原理"><a href="#Kafka-Eagle-工作原理" class="headerlink" title="Kafka Eagle 工作原理"></a>Kafka Eagle 工作原理</h2><h3 id="Kafka-Eagle-集群整体架构"><a href="#Kafka-Eagle-集群整体架构" class="headerlink" title="Kafka Eagle 集群整体架构"></a>Kafka Eagle 集群整体架构</h3><p>当 Kafka Eagle（EFAK）以集群（分布式）模式部署，并且一共有 5 个节点（包括 1 个 Master 和 4 个 Slave）时，各个节点的角色如下图所示：</p><p><img data-src="../../../asset/2024/12/linux-efak-cluster-9.png"></p><h3 id="Kafka-Eagle-数据采集原理"><a href="#Kafka-Eagle-数据采集原理" class="headerlink" title="Kafka Eagle 数据采集原理"></a>Kafka Eagle 数据采集原理</h3><p>Kafka Eagle（EFAK）针对 Kafka 可以采集以下数据：</p><ul><li>Kafka Broker 常用机器加载信息：内存、CPU、IP、版本信息等</li><li>应用程序监控：消费者组、消费者、生产者、主题等</li><li>服务监控数据：TPS、QPS、RT 等</li></ul><p><img data-src="../../../asset/2024/12/linux-efak-cluster-10.png"></p><h2 id="参考教程"><a href="#参考教程" class="headerlink" title="参考教程"></a>参考教程</h2><ul><li><a target="_blank" rel="external nofollow" href="https://docs.kafka-eagle.org/2.installation/2.installonlinuxmac">Kafka Eagle（EFAK）官方安装文档</a></li><li><a href="/posts/d2fe844e.html">Linux 部署 Kafka-Eagle（EFAK）单机</a></li><li><a href="/posts/73b15688.html">Docker 部署 Kafka Eagle（EFAK）单机</a></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/70bdcb69.html" title="Linux 生产环境部署 Kafka-Eagle（EFAK）集群">https://www.techgrow.cn/posts/70bdcb69.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/Linux%E8%BF%90%E7%BB%B4/" rel="tag"><i class="fa fa-tag"></i> Linux运维</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/53122199.html" rel="prev" title="Dubbo 3 配合 Java 接口使用 Triple 协议"><i class="fa fa-angle-left"></i> Dubbo 3 配合 Java 接口使用 Triple 协议</a></div><div class="post-nav-item"> <a href="/posts/435a9cbc.html" rel="next" title="Dubbo 3 配合 Protobuf（IDL）使用 Triple 协议">Dubbo 3 配合 Protobuf（IDL）使用 Triple 协议<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2.1m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">31:23</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/70bdcb69.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>