<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="Docker安装Webdis与Redis，实现Redis的HTTP API服务。"><meta property="og:type" content="article"><meta property="og:title" content="Docker 安装 Webdis"><meta property="og:url" content="https://www.techgrow.cn/posts/c87853c9.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="Docker安装Webdis与Redis，实现Redis的HTTP API服务。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2019-03-22T15:32:12.000Z"><meta property="article:modified_time" content="2019-04-02T13:23:33.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="容器化"><meta property="article:tag" content="缓存"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.techgrow.cn/posts/c87853c9.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/c87853c9.html","path":"posts/c87853c9.html","title":"Docker 安装 Webdis"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Docker 安装 Webdis | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-overview-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">673</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/c87853c9.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Docker 安装 Webdis | Clay 的技术空间"><meta itemprop="description" content="Docker安装Webdis与Redis，实现Redis的HTTP API服务。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Docker 安装 Webdis</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-03-22 23:32:12" itemprop="dateCreated datePublished" datetime="2019-03-22T23:32:12+08:00">2019-03-22</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2019-04-02 21:23:33" itemprop="dateModified" datetime="2019-04-02T21:23:33+08:00">2019-04-02</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/c87853c9.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/c87853c9.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>973</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>1 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><blockquote><p><strong>前言</strong></p></blockquote><p>Webdis 是一个非常简单的 Web 服务器，专门为 Redis 提供 HTTP 接口，使用 hiredis、jansson、libevent、http-parser 等组件。下面将介绍 Docker 安装部署 Webdis 与 Redis，由于篇幅有限不会详细介绍部署过程，但会给出 Docker 相关的主要配置内容。如需更详细的教程内容，可参考 <a target="_blank" rel="external nofollow" href="https://github.com/nicolasff/webdis">Webdis Github</a> 上的说明文档。</p><blockquote><p><strong>软件环境</strong></p></blockquote><table><thead><tr><th>环境名称</th><th>版本</th></tr></thead><tbody><tr><td> docker-ce</td><td>18.09.3</td></tr><tr><td>docker-compose</td><td>1.24.0-rc1</td></tr><tr><td>linux 发行版</td><td> CentOS Linux release 7.6.1810 (Core)</td></tr></tbody></table><span id="more"></span><blockquote><p><strong>Webdis 镜像的 DockerFile</strong></p></blockquote><figure class="highlight docker"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> debian:stretch</span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span> clay&lt;clay@gmail.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> cp /etc/apt/sources.list /etc/apt/backup.sources.list</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"deb http://mirrors.aliyun.com/debian/ stretch main non-free contrib"</span> &gt; /etc/apt/sources.list</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"deb http://mirrors.aliyun.com/debian-security stretch/updates main"</span> &gt;&gt; /etc/apt/sources.list</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"deb http://mirrors.aliyun.com/debian/ stretch-updates main non-free contrib"</span> &gt;&gt; /etc/apt/sources.list</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"deb http://mirrors.aliyun.com/debian/ stretch-backports main non-free contrib"</span> &gt;&gt; /etc/apt/sources.list</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get -y update &amp;&amp; apt-get -y upgrade</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get -y install apt-utils vim net-tools telnet git curl wget make gcc libevent-dev</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get -y autoclean &amp;&amp; apt-get -y autoremove</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> version <span class="number">0.1</span>.<span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /usr/<span class="built_in">local</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> wget --no-check-certificate https://github.com/nicolasff/webdis/archive/<span class="variable">$version</span>.tar.gz -O webdis-<span class="variable">$version</span>.tar.gz</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> tar -xvzf webdis-<span class="variable">$version</span>.tar.gz</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">cd</span> webdis-<span class="variable">$version</span> &amp;&amp; make &amp;&amp; make install &amp;&amp; <span class="built_in">cd</span> ..</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> rm -rf webdis-<span class="variable">$version</span>.tag.gz</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /usr/<span class="built_in">local</span>/webdis-<span class="variable">$version</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">7379</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> /usr/<span class="built_in">local</span>/bin/webdis /etc/webdis.prod.json &amp;&amp; bash</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>构建 Webdis 镜像</strong></p></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建DockerFile</span></span><br><span class="line"><span class="keyword"># touch</span> Dockerfile-Webdis</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将上述内容写入到DockerFile中</span></span><br><span class="line"><span class="keyword"># vim</span> Dockerfile-Webdis</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建Webdis镜像</span></span><br><span class="line"><span class="keyword"># docker</span> build<span class="params"> -f</span> Dockerfile-Webdis<span class="params"> -t</span> clay/webdis:0.1.4 .</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>Redis 的配置文件</strong></p></blockquote><p>Redis 配置文件中的主要内容（redis.conf）如下：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注释掉下面这一行，不绑定任何主机IP</span></span><br><span class="line"><span class="keyword"># bind</span> 127.0.0.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置Redis密码</span></span><br><span class="line">requirepass C6v8TMQv@oc%4HkznfKJ5jy&amp;zBUencAL</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>Webdis 的配置文件</strong></p></blockquote><p>Webdis 配置文件（webdis.prod.json）的完整内容如下，具体的 ACL 规则可参考 <a target="_blank" rel="external nofollow" href="https://github.com/nicolasff/webdis">Github</a> 上的说明文档。考虑到服务器安全，下面配置了 Http Auth 的用户名和密码。</p><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"redis_host"</span>: <span class="string">"172.89.0.2"</span>,</span><br><span class="line">  <span class="attr">"redis_port"</span>: <span class="number">6379</span>,</span><br><span class="line">  <span class="attr">"redis_auth"</span>: <span class="string">"C6v8TMQv@oc%4HkznfKJ5jy&amp;zBUencAL"</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">"http_host"</span>: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">  <span class="attr">"http_port"</span>: <span class="number">7379</span>,</span><br><span class="line">  <span class="attr">"threads"</span>: <span class="number">4</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">"daemonize"</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">"database"</span>: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">  <span class="attr">"acl"</span>: [</span><br><span class="line">    {</span><br><span class="line">      <span class="attr">"disabled"</span>:	[<span class="string">"DEBUG"</span>, <span class="string">"FLUSHDB"</span>, <span class="string">"FLUSHALL"</span>, <span class="string">"GET"</span>, <span class="string">"SET"</span>, <span class="string">"DEL"</span>]</span><br><span class="line">    },</span><br><span class="line">    {</span><br><span class="line">      <span class="attr">"http_basic_auth"</span>: <span class="string">"admin:123456"</span>,</span><br><span class="line">      <span class="attr">"enabled"</span>: [<span class="string">"DEBUG"</span>, <span class="string">"GET"</span>, <span class="string">"SET"</span>, <span class="string">"DEL"</span>]</span><br><span class="line">    }</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  <span class="attr">"verbosity"</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">"logfile"</span>: <span class="string">"/var/log/webdis.log"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>Docker-Compose 的配置文件</strong></p></blockquote><p>使用 Docker-Compose 管理容器，其中 docker-compose.yml 配置文件的完整内容如下（包括 Redis、Webdis）。具体的数据卷挂载目录，需要根据自己的实际情况进行修改。</p><figure class="highlight docker"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3.5"</span></span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:<span class="number">5.0</span>.<span class="number">4</span>-stretch</span><br><span class="line">    container_name: redis-<span class="number">5.0</span>.<span class="number">4</span></span><br><span class="line">    privileged: false</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="number">6379</span>:<span class="number">6379</span></span><br><span class="line">    networks:</span><br><span class="line">      redis-network:</span><br><span class="line">        ipv4_address: <span class="number">172.89</span>.<span class="number">0.2</span></span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">'/container/redis/data:/data'</span></span><br><span class="line">      - <span class="string">'/container/redis/redis.conf:/usr/local/etc/redis/redis.conf'</span></span><br><span class="line">    command: redis-server /usr/local/etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">  webdis:</span><br><span class="line">    image: clay/webdis:<span class="number">0.1</span>.<span class="number">4</span></span><br><span class="line">    container_name: webdis</span><br><span class="line">    privileged: false</span><br><span class="line">    depends_on:</span><br><span class="line">      - redis</span><br><span class="line">    networks:</span><br><span class="line">      redis-network:</span><br><span class="line">        ipv4_address: <span class="number">172.89</span>.<span class="number">0.3</span></span><br><span class="line">    ports:</span><br><span class="line">      - <span class="number">7379</span>:<span class="number">7379</span></span><br><span class="line">    volumes:</span><br><span class="line">      - <span class="string">'/container/wedis/webdis.log:/var/log/webdis.log'</span></span><br><span class="line">      - <span class="string">'/container/wedis/webdis.prod.json:/etc/webdis.prod.json'</span></span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  redis-network:</span><br><span class="line">    name: redis-network</span><br><span class="line">    driver: bridge</span><br><span class="line">    ipam:</span><br><span class="line">      config:</span><br><span class="line">        - subnet: <span class="number">172.89</span>.<span class="number">0.0</span>/<span class="number">24</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>创建并启动 Docker 容器</strong></p></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入docker-compose.yml配置文件所在的目录</span></span><br><span class="line"><span class="keyword"># cd</span> docker-compose-dir</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以后台方式启动Redis、Webdis容器</span></span><br><span class="line"><span class="keyword"># docker</span>-compose up<span class="params"> -d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看容器的启动情况</span></span><br><span class="line"><span class="keyword"># docker</span> ps<span class="params"> -a</span></span><br><span class="line">CONTAINER ID      IMAGE                   COMMAND                     CREATED             STATUS            PORTS                       NAMES</span><br><span class="line">ebd5cac7fee9      clay/webdis:0.1.4       <span class="string">"/bin/sh -c '/usr/lo…"</span>      14 minutes ago      Up 14 minutes     0.0.0.0:7379-&gt;7379/tcp      webdis</span><br><span class="line">9a1feb971d1c      redis:5.0.4-stretch     <span class="string">"docker-entrypoint.s…"</span>      14 minutes ago      Up 14 minutes     0.0.0.0:6379-&gt;6379/tcp      redis-5.0.4</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>CURL 命令测试 Webdis 与 Redis 是否正常工作</strong></p></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 写入key</span></span><br><span class="line"><span class="keyword"># curl</span> http://127.0.0.1:7379/SET/hello/world<span class="params"> -u</span> admin:123456</span><br><span class="line">{<span class="string">"SET"</span>:[<span class="literal">true</span>,<span class="string">"OK"</span>]}</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取key</span></span><br><span class="line"><span class="keyword"># curl</span> http://127.0.0.1:7379/GET/hello<span class="params"> -u</span> admin:123456</span><br><span class="line">{<span class="string">"GET"</span>:<span class="string">"world"</span>}</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除key</span></span><br><span class="line"><span class="keyword"># curl</span> http://127.0.0.1:7379/DEL/hello<span class="params"> -u</span> admin:123456</span><br><span class="line">{<span class="string">"DEL"</span>:1}</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>NodeJS 代码测试 Webdis 与 Redis 是否正常工作</strong></p></blockquote><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> request = <span class="built_in">require</span>(<span class="string">'request'</span>);</span><br><span class="line"><span class="keyword">var</span> username = <span class="string">"admin"</span>;</span><br><span class="line"><span class="keyword">var</span> password = <span class="string">"123456"</span>;</span><br><span class="line"><span class="keyword">var</span> url = <span class="string">'http://127.0.0.1:7379/GET/hello'</span>;</span><br><span class="line"><span class="keyword">var</span> auth = <span class="string">"Basic "</span> + <span class="keyword">new</span> Buffer(username + <span class="string">":"</span> + password).toString(<span class="string">"base64"</span>);</span><br><span class="line"></span><br><span class="line">request({</span><br><span class="line">    <span class="attr">url</span>: url,</span><br><span class="line">    <span class="attr">headers</span>: {</span><br><span class="line">      <span class="string">"Authorization"</span>: auth</span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">error, response, body</span>) </span>{</span><br><span class="line">    <span class="keyword">if</span> (error) {</span><br><span class="line">      <span class="built_in">console</span>.log(error);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (response.statusCode == <span class="number">200</span>) {</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"result: "</span> + body);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"code: "</span> + response.statusCode);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>WebSocket 与 Pub/Sub 的支持</strong></p></blockquote><p>Webdis 默认不启用 WebSocket 与 Pub/Sub 的支持，如需要相关功能，可以参考以下的步骤进行操作。官方声明 Websocket 与 Pub/Sub 功能是实验性的，生产环境慎用。<strong>经过反复测试，按照下面的步骤进行操作，JavaScript 代码依然无法连接 WebSocket、Pub/Sub 服务，后续再想办法解决。</strong></p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 连接上面创建的webdis容器</span></span><br><span class="line"><span class="keyword"># docker</span> run<span class="params"> -it</span> webdis /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入webdis的tests目录</span></span><br><span class="line"><span class="keyword"># cd</span> /usr/<span class="built_in">local</span>/webdis-0.1.4/tests</span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword"># tests</span>目录结构介绍</span><br><span class="line">|-- Makefile</span><br><span class="line">|-- README.tests</span><br><span class="line">|-- basic.py          <span class="comment"># 单元测试脚本</span></span><br><span class="line">|-- bench.sh          <span class="comment"># 压测脚本</span></span><br><span class="line">|-- limits.py</span><br><span class="line">|-- pubsub.c          <span class="comment"># pub/sub支持</span></span><br><span class="line">|-- websocket.c       <span class="comment"># websocket支持</span></span><br><span class="line">`-- websocket.html    <span class="comment"># websocket的html5测试页面</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译websocket、pub/sub的代码</span></span><br><span class="line"><span class="keyword"># make</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看websocket命令的使用方法</span></span><br><span class="line">$ ./websocket<span class="params"> -h</span></span><br><span class="line">Usage: ./websocket [options]</span><br><span class="line">Options are:<span class="params"></span></span><br><span class="line"><span class="params">	-h</span> host		(default = <span class="string">"127.0.0.1"</span>)<span class="params"></span></span><br><span class="line"><span class="params">	-p</span> port		(default = 7379)<span class="params"></span></span><br><span class="line"><span class="params">	-c</span> threads	(default = 4)<span class="params"></span></span><br><span class="line"><span class="params">	-n</span> count	(number of messages per thread, default = 100000)<span class="params"></span></span><br><span class="line"><span class="params">	-v</span>		(verbose)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动websocket服务，其中127.0.0.1是webdis服务的IP，7379是webdis服务的端口</span></span><br><span class="line">$ ./websocket<span class="params"> -h</span> 127.0.0.1<span class="params"> -p</span> 7379<span class="params"> -v</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看pubsub命令的使用方法</span></span><br><span class="line">$ ./pubsub<span class="params"> -h</span></span><br><span class="line">Usage: ./pubsub [options]</span><br><span class="line">Options are:<span class="params"></span></span><br><span class="line"><span class="params">	-h</span> host		(default = <span class="string">"127.0.0.1"</span>)<span class="params"></span></span><br><span class="line"><span class="params">	-p</span> port		(default = 7379)<span class="params"></span></span><br><span class="line"><span class="params">	-r</span> readers	(default = 450)<span class="params"></span></span><br><span class="line"><span class="params">	-w</span> writers	(default = 10)<span class="params"></span></span><br><span class="line"><span class="params">	-c</span> channels	(default = 1)<span class="params"></span></span><br><span class="line"><span class="params">	-n</span> messages	(number of messages to <span class="built_in">read</span> <span class="keyword">in</span> total, default = 100000)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动pub/sub服务，其中127.0.0.1是webdis服务的IP，7379是webdis服务的端口</span></span><br><span class="line"><span class="comment"># 经测试，pub/sub服务的启动会导致webdis服务意外停止，原因暂时未知</span></span><br><span class="line">$ ./pubsub<span class="params"> -h</span> 127.0.0.1<span class="params"> -p</span> 7379</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>JavaScript 代码测试 WebSocket 服务</strong></p></blockquote><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testJSON</span>(<span class="params"></span>) </span>{</span><br><span class="line">	<span class="keyword">var</span> jsonSocket = <span class="keyword">new</span> WebSocket(<span class="string">"ws://127.0.0.1:7379/.json"</span>);</span><br><span class="line">	jsonSocket.onopen = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line"></span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"JSON socket connected!"</span>);</span><br><span class="line">		jsonSocket.send(<span class="built_in">JSON</span>.stringify([<span class="string">"SET"</span>, <span class="string">"hello"</span>, <span class="string">"world"</span>]));</span><br><span class="line">		jsonSocket.send(<span class="built_in">JSON</span>.stringify([<span class="string">"GET"</span>, <span class="string">"hello"</span>]));</span><br><span class="line">	};</span><br><span class="line">	jsonSocket.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">messageEvent</span>) </span>{</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">"JSON received:"</span>, messageEvent.data);</span><br><span class="line">	};</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">testJSON();</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>JavaScript 代码测试 Pub/Sub 服务</strong></p></blockquote><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> previous_response_length = <span class="number">0</span></span><br><span class="line">xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">xhr.open(<span class="string">"GET"</span>, <span class="string">"http://127.0.0.1:7379/SUBSCRIBE/hello"</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.onreadystatechange = checkData;</span><br><span class="line">xhr.send(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkData</span>(<span class="params"></span>) </span>{</span><br><span class="line">	<span class="keyword">if</span>(xhr.readyState == <span class="number">3</span>)  {</span><br><span class="line">    	response = xhr.responseText;</span><br><span class="line">    	chunk = response.slice(previous_response_length);</span><br><span class="line">    	previous_response_length = response.length;</span><br><span class="line">    	<span class="built_in">console</span>.log(chunk);</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>Webdis 的 SSL 支持</strong></p></blockquote><p>Webdis 官方默认不支持 SSL，如果需要 SSL 的支持，可以使用 Nginx 作为反向代理服务器，即配置 Nginx 的代理与 SSL 证书，然后将请求转发给 Webdis，这样就可以提高 Webdis 连接的安全性。Nginx 的示例配置内容如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">server {</span><br><span class="line">    listen 18379;</span><br><span class="line">    # Webdis的IP与端口</span><br><span class="line">    server_name 172.89.0.3:7379;</span><br><span class="line"></span><br><span class="line">    # SSL证书</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate /usr/local/nginx/cert/example.cn.crt;</span><br><span class="line">    ssl_certificate_key /usr/local/nginx/cert/example.cn.key;</span><br><span class="line"></span><br><span class="line">    # SSL性能调优</span><br><span class="line">    ssl_session_timeout 10m;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line">    ssl_session_cache shared:SSL:10m;</span><br><span class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">    ssl_ciphers ECDHE-RSA-AES256-SHA384:AES256-SHA256:RC4:HIGH:!MD5:!aNULL:!eNULL:!NULL:!DH:!EDH:!AESGCM;</span><br><span class="line"></span><br><span class="line">    location / {</span><br><span class="line">        # 代理</span><br><span class="line">        proxy_pass  http://$server_name;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用CURL命令测试Nginx的代理与SSL配置是否正确，其中example.com是绑定了SSL证书的域名</span></span><br><span class="line"><span class="keyword"># curl</span> https://example.com:18379/GET/hello<span class="params"> -u</span> admin:123456</span><br></pre></td></tr></tbody></table></figure><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/c87853c9.html" title="Docker 安装 Webdis">https://www.techgrow.cn/posts/c87853c9.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%AE%B9%E5%99%A8%E5%8C%96/" rel="tag"><i class="fa fa-tag"></i> 容器化</a><a href="/tags/%E7%BC%93%E5%AD%98/" rel="tag"><i class="fa fa-tag"></i> 缓存</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/d06622f5.html" rel="prev" title="3D 打印备忘录"><i class="fa fa-angle-left"></i> 3D 打印备忘录</a></div><div class="post-nav-item"> <a href="/posts/d208d196.html" rel="next" title="Java 之 ScheduledThreadPoolExecutor 使用">Java 之 ScheduledThreadPoolExecutor 使用<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">1.7m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">25:23</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤 ICP 备 19024664 号</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035 号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/c87853c9.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>