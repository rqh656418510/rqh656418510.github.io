<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","width":300,"display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 Linux 如何实现 Windows 的 Event 事件机制，包括 CreateEvent、WaitEvent、SetEvent、ResetEvent 等函数的使用。"><meta property="og:type" content="article"><meta property="og:title" content="Linux 实现 Windows 的 Event 事件机制"><meta property="og:url" content="https://www.techgrow.cn/posts/c847598e.html"><meta property="og:site_name" content="Clay 的技术博客"><meta property="og:description" content="本文主要介绍 Linux 如何实现 Windows 的 Event 事件机制，包括 CreateEvent、WaitEvent、SetEvent、ResetEvent 等函数的使用。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2021-12-25T13:55:33.000Z"><meta property="article:modified_time" content="2021-12-25T13:55:33.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="C++"><meta property="article:tag" content="Linux系统编程"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.techgrow.cn/posts/c847598e.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/c847598e.html","path":"posts/c847598e.html","title":"Linux 实现 Windows 的 Event 事件机制"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Linux 实现 Windows 的 Event 事件机制 | Clay 的技术博客</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn:9360"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术博客" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax>!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/app/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt></div><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术博客</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-openplatform"><a href="https://open.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-toolbox fa-fw"></i>开放平台</a></li><li class="menu-item menu-item-readingnotes"><a href="https://docs.techgrow.cn/notes/" rel="external nofollow" target="_blank"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn:9360/ui/login?lng=zh-cn" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#pevents-%E4%BB%8B%E7%BB%8D"><span class="nav-text">pevents 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pevents-%E7%9A%84%E7%AE%80%E4%BB%8B"><span class="nav-text">pevents 的简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pevents-%E7%9A%84-API"><span class="nav-text">pevents 的 API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#API-%E5%87%BD%E6%95%B0"><span class="nav-text">API 函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E7%8A%B6%E6%80%81%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="nav-text">事件状态的类型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pevents-%E7%9A%84%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-text">pevents 的项目结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pevents-%E7%9A%84%E7%BC%96%E8%AF%91%E6%9E%84%E5%BB%BA"><span class="nav-text">pevents 的编译构建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pevents-%E7%9A%84%E7%BC%96%E8%AF%91%E5%8F%82%E6%95%B0"><span class="nav-text">pevents 的编译参数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Meson-%E6%8C%87%E5%AE%9A%E7%BC%96%E8%AF%91%E5%8F%82%E6%95%B0"><span class="nav-text">Meson 指定编译参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CMake-%E6%8C%87%E5%AE%9A%E7%BC%96%E8%AF%91%E5%8F%82%E6%95%B0"><span class="nav-text">CMake 指定编译参数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pevents-%E8%BF%90%E8%A1%8C%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-text">pevents 运行示例代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pevents-%E7%9A%84%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="nav-text">pevents 的实战案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E8%AF%B4%E6%98%8E"><span class="nav-text">编译说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%E4%B8%80"><span class="nav-text">实战案例一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%E4%BA%8C"><span class="nav-text">实战案例二</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B%E4%B8%89"><span class="nav-text">实战案例三</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">406</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">41</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → &#x2F;sitemap.xml"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="external nofollow" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/c847598e.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术博客"><meta itemprop="description" content="专注于 Java、前端、移动端、微服务、分布式系统、数据库、系统架构、人工智能、大数据、云计算、物联网、虚拟化学习的技术博客。"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Linux 实现 Windows 的 Event 事件机制 | Clay 的技术博客"><meta itemprop="description" content="本文主要介绍 Linux 如何实现 Windows 的 Event 事件机制，包括 CreateEvent、WaitEvent、SetEvent、ResetEvent 等函数的使用。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Linux 实现 Windows 的 Event 事件机制</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-12-25 21:55:33" itemprop="dateCreated datePublished" datetime="2021-12-25T21:55:33+08:00">2021-12-25</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/c847598e.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/c847598e.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>2.4k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><div id="readmore-container"><div class="admonition note"><p class="admonition-title">前言</p><p>Linux 中没有 Windows 系统中的 <code>CreateEvent()</code>、<code>WaitEvent()</code>、<code>SetEvent()</code>、<code>ResetEvent()</code> 等函数，本文将介绍如何使用 <a target="_blank" rel="external nofollow" href="https://github.com/neosmart/pevents">pevents</a> 替代 Linux 缺失的函数。</p></div><h2 id="pevents-介绍"><a href="#pevents-介绍" class="headerlink" title="pevents 介绍"></a>pevents 介绍</h2><span id="more"></span><h3 id="pevents-的简介"><a href="#pevents-的简介" class="headerlink" title="pevents 的简介"></a>pevents 的简介</h3><p><a target="_blank" rel="external nofollow" href="https://github.com/neosmart/pevents">pevents</a> 是一个跨平台的轻量级 C++ 库，旨在为 POSIX 系统提供 WIN32 事件的实现。<code>pevents</code> 提供了 Windows 平台手动和自动重置事件的大部分功能，最显著的是支持同时等待多个事件（<code>WaitForMultipleObjects</code>），而且支持 Windows、FreeBSD、Linux、macOS、iOS、Android 等平台。</p><h3 id="pevents-的-API"><a href="#pevents-的-API" class="headerlink" title="pevents 的 API"></a>pevents 的 API</h3><h4 id="API-函数"><a href="#API-函数" class="headerlink" title="API 函数"></a>API 函数</h4><p><code>pevents</code> 的 API 是根据 Windows 的 <code>CreateEvent（）</code>、<code>WaitEvent（）</code> 和 <code>WaitForMultipleObjects（）</code> 函数编写的，熟悉 WIN32 事件的开发人员应该可以将代码库切换到 <code>pevents</code> API。虚假唤醒是 Linux 下系统编程的正常部分，也是来自 Windows 世界的开发人员的常见陷阱，<code>pevents</code> 可以保证不存在虚假唤醒和等待返回的数据的正确性，其提供了如下的 API：</p><figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">SetEvent</span><span class="params">(<span class="keyword">neosmart_event_t</span> event)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ResetEvent</span><span class="params">(<span class="keyword">neosmart_event_t</span> event)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">PulseEvent</span><span class="params">(<span class="keyword">neosmart_event_t</span> event)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">DestroyEvent</span><span class="params">(<span class="keyword">neosmart_event_t</span> event)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">neosmart_event_t</span> <span class="title">CreateEvent</span><span class="params">(<span class="keyword">bool</span> manualReset, <span class="keyword">bool</span> initialState)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">WaitForEvent</span><span class="params">(<span class="keyword">neosmart_event_t</span> event, <span class="keyword">uint64_t</span> milliseconds)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">WaitForMultipleEvents</span><span class="params">(<span class="keyword">neosmart_event_t</span> *events, <span class="keyword">int</span> count, <span class="keyword">bool</span> waitAll, <span class="keyword">uint64_t</span> milliseconds)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">WaitForMultipleEvents</span><span class="params">(<span class="keyword">neosmart_event_t</span> *events, <span class="keyword">int</span> count, <span class="keyword">bool</span> waitAll, <span class="keyword">uint64_t</span> milliseconds, <span class="keyword">int</span> &amp;index)</span></span>;</span><br></pre></td></tr></tbody></table></figure><h4 id="事件状态的类型"><a href="#事件状态的类型" class="headerlink" title="事件状态的类型"></a>事件状态的类型</h4><ul><li><code>CreateEvent()</code> 函数</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">neosmart_event_t CreateEvent(</span><br><span class="line">    // true：表示手动，在 WaitEvent 后需要手动调用 ResetEvent 清除事件信号。false：表示自动，在 WaitEvent 后，系统会自动清除事件信号</span><br><span class="line">    bool manualReset, </span><br><span class="line"></span><br><span class="line">    // 初始状态，false 为无信号，true 为有信号</span><br><span class="line">    bool initialState</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><ul><li><code>WaitForEvent()</code> 函数</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">int WaitForEvent(</span><br><span class="line">    // 句柄对象</span><br><span class="line">    neosmart_event_t event,</span><br><span class="line">    // 等待的时间（毫秒）</span><br><span class="line">    uint64_t milliseconds</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><ul><li>事件状态的类型<ul><li><code>WAIT_TIMEOUT</code>：等待超时</li><li><code>WAIT_OBJECT_0</code>：句柄对象处于有信号状态</li><li><code>WAIT_FAILED</code>：出现错误，可通过 <code>GetLastError()</code> 函数得到错误码</li><li><code>WAIT_ABANDONED</code>：说明句柄代表的对象是个互斥对象，并且正在被其它线程占用</li></ul></li></ul><div class="admonition warning"><p class="admonition-title">注意</p><p>在 Linux 平台，<code>pevents</code> 的事件状态只支持使用 <code>WAIT_TIMEOUT</code>，且有信号的时候 <code>WaitEvent()</code> 函数的返回值是 <code>0</code>，而在 Windows 平台则支持上述四种事件状态</p></div><h3 id="pevents-的项目结构"><a href="#pevents-的项目结构" class="headerlink" title="pevents 的项目结构"></a>pevents 的项目结构</h3><ul><li>核心代码在 <code>src/</code> 目录</li><li>单元测试代码（通过 Meson 构建）在 <code>test/</code> 目录</li><li>在 <code>examples/</code> 目录中可以找到演示 <code>pevents</code> 用法的跨平台应用示例程序</li></ul><h3 id="pevents-的编译构建"><a href="#pevents-的编译构建" class="headerlink" title="pevents 的编译构建"></a>pevents 的编译构建</h3><p><code>pevents</code> 使用的构建工具是 Meson，目前这仅用于支持 <code>pevents</code> 核心代码及其单元测试的自动化构建 / 测试。值得一提的是，开发人员不需要担心构建工具的差异性，<code>pevents</code> 是特意基于 C/C++ 标准编写的，避免了复杂的配置或依赖于平台的构建指令的需要。</p><h3 id="pevents-的编译参数"><a href="#pevents-的编译参数" class="headerlink" title="pevents 的编译参数"></a>pevents 的编译参数</h3><p>通过编译参数 <code>-DWFMO</code> 与 <code>-DPULSE</code>，可以在编译时让 <code>pevents</code> 启用不同的功能：</p><ul><li><code>WFMO</code>：启用 WFMO 功能，如果需要使用 <code>WaitForMultipleEvents()</code> 函数，建议仅使用 WFMO 进行编译，因为它会为所有事件对象增加开销（较小）。</li><li><code>PULSE</code>：启用 PulseEvent 功能，<code>PulseEvent()</code> 在 Windows 平台从根本上被破坏了，一般不应该被使用，当你调用它时，它几乎永远不会做你认为你正在做的事情。<code>pevents</code> 包含这个函数只是为了让现有的（有缺陷的）代码从 WIN32 移植到 Unix/Linux 平台更容易，并且这个函数默认没有编译到 <code>pevents</code> 中。</li></ul><h4 id="Meson-指定编译参数"><a href="#Meson-指定编译参数" class="headerlink" title="Meson 指定编译参数"></a>Meson 指定编译参数</h4><p>在 Meson 中，可以通过 <code>meson_options.txt</code> 配置文件指定编译参数，让 <code>pevents</code> 启用不同的功能</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">option('wfmo', type: 'boolean', value: true,</span><br><span class="line">	description: 'Enable WFMO events')</span><br><span class="line">option('pulse', type: 'boolean', value: false,</span><br><span class="line">	description: 'Enable PulseEvent() function')</span><br></pre></td></tr></tbody></table></figure><h4 id="CMake-指定编译参数"><a href="#CMake-指定编译参数" class="headerlink" title="CMake 指定编译参数"></a>CMake 指定编译参数</h4><p>在 CMake 中，可以通过 <code>CMakeLists.txt</code> 配置文件指定编译参数，让 <code>pevents</code> 启用不同的功能</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set(CMAKE_CXX_FLAGS "-std=c++11 -lpthread -DWFMO")</span><br></pre></td></tr></tbody></table></figure><h2 id="pevents-运行示例代码"><a href="#pevents-运行示例代码" class="headerlink" title="pevents 运行示例代码"></a>pevents 运行示例代码</h2><div class="admonition note"><p class="admonition-title">提示</p><p>值得一提的是，<code>pevents</code> 的核心 C++ 源文件是 <code>pevents.h</code>、<code>pevents.cpp</code></p></div><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拉取代码</span></span><br><span class="line"><span class="keyword">$ git</span> <span class="built_in">clone</span> git@github.com:clay-world/pevents.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入源码目录</span></span><br><span class="line"><span class="keyword">$ cd</span> pevents</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成构建的输出目录</span></span><br><span class="line"><span class="keyword">$ meson</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入构建的输出目录</span></span><br><span class="line"><span class="keyword">$ cd</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译代码</span></span><br><span class="line"><span class="keyword">$ ninja</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行示例程序</span></span><br><span class="line">$ ./sample</span><br></pre></td></tr></tbody></table></figure><h2 id="pevents-的实战案例"><a href="#pevents-的实战案例" class="headerlink" title="pevents 的实战案例"></a>pevents 的实战案例</h2><h3 id="编译说明"><a href="#编译说明" class="headerlink" title="编译说明"></a>编译说明</h3><p>下面给出的案例使用了 <code>pthread</code>，由于 <code>pthread</code> 不是 Linux 系统默认的库，因此链接时需要使用静态库 <code>libpthread.a</code>。简而言之，在使用 <code>pthread_create()</code> 创建线程，以及调用 <code>pthread_atfork()</code> 函数建立 <code>fork</code> 处理程序时，需要通过 <code>-lpthread</code> 参数链接该库，同时还需要在 C++ 源文件里添加头文件 <code>pthread.h</code>。</p><div class="admonition note"><p class="admonition-title">提示</p><p>为了可以正常编译使用了 <code>pthread</code> 的项目代码，不同构建工具的使用说明如下：</p></div><p>若使用 G++ 编译 C++ 项目，则编译命令的示例如下：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译代码</span></span><br><span class="line"><span class="keyword">$ g</span>++ main.cpp<span class="params"> -o</span> main<span class="params"> -lpthread</span></span><br></pre></td></tr></tbody></table></figure><p>若使用 CMake 构建 C++ 项目，则 <code>CMakeLists.txt</code> 配置文件的示例内容如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set(CMAKE_CXX_FLAGS "-std=c++11 -lpthread -DWFMO")</span><br><span class="line"></span><br><span class="line">add_executable(main main.cpp)</span><br></pre></td></tr></tbody></table></figure><h3 id="实战案例一"><a href="#实战案例一" class="headerlink" title="实战案例一"></a>实战案例一</h3><p><code>CreateEvent(true, true)</code> - 手动清除事件信号，初始状态为有信号，<a href="/downloads/2021/12/pevents-cmake-demo-1.zip">点击下载</a> 基于 CMake 构建的完整案例代码</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pevents.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> neosmart;</span><br><span class="line"></span><br><span class="line"><span class="keyword">neosmart_event_t</span> g_hEvent = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printIds</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span> </span>{</span><br><span class="line">    <span class="keyword">pid_t</span> pid = <span class="built_in">getpid</span>();</span><br><span class="line">    <span class="keyword">pthread_t</span> tid = <span class="built_in">pthread_self</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s pid %u tid %u (0x%x)\n"</span>, s, (<span class="keyword">unsigned</span> <span class="keyword">int</span>) pid, (<span class="keyword">unsigned</span> <span class="keyword">int</span>) tid, (<span class="keyword">unsigned</span> <span class="keyword">int</span>) tid);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">procFunc1</span><span class="params">(<span class="keyword">void</span> *args)</span> </span>{</span><br><span class="line">    <span class="built_in">printIds</span>(<span class="string">"thread-1"</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">WaitForEvent</span>(g_hEvent, <span class="number">1</span>) == <span class="number">0</span>) {</span><br><span class="line">        cout &lt;&lt; <span class="string">"thread-1 is working..."</span> &lt;&lt; endl;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ((<span class="keyword">void</span> *) <span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">procFunc2</span><span class="params">(<span class="keyword">void</span> *args)</span> </span>{</span><br><span class="line">    <span class="built_in">printIds</span>(<span class="string">"thread-2"</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">WaitForEvent</span>(g_hEvent, <span class="number">1</span>) == <span class="number">0</span>) {</span><br><span class="line">        cout &lt;&lt; <span class="string">"thread-2 is working..."</span> &lt;&lt; endl;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ((<span class="keyword">void</span> *) <span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// 手动清除事件信号，初始状态为有信号</span></span><br><span class="line">    g_hEvent = <span class="built_in">CreateEvent</span>(<span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pthread_t</span> ntid1;</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;ntid1, <span class="literal">NULL</span>, procFunc1, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pthread_t</span> ntid2;</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;ntid2, <span class="literal">NULL</span>, procFunc2, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">5</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>程序运行的结果如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">thread-1 pid 62705 tid 2336241408 (0x8b403700)</span><br><span class="line">thread-1 is working...</span><br><span class="line">thread-2 pid 62705 tid 2327848704 (0x8ac02700)</span><br><span class="line">thread-2 is working...</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">提示</p><p>可以看到线程 1 和线程 2 都完整执行了，这是因为创建的事件是需手动 Reset 才会变为无信号的，所以执行完线程 1 后事件仍处于有信号的状态，所以线程 2 的逻辑才会被继续执行。</p></div><h3 id="实战案例二"><a href="#实战案例二" class="headerlink" title="实战案例二"></a>实战案例二</h3><p><code>CreateEvent(false, true)</code> - 自动清除事件信号，且初始状态为有信号，<a href="/downloads/2021/12/pevents-cmake-demo-2.zip">点击下载</a> 基于 CMake 构建的完整案例代码</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pevents.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> neosmart;</span><br><span class="line"></span><br><span class="line"><span class="keyword">neosmart_event_t</span> g_hEvent = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printIds</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span> </span>{</span><br><span class="line">    <span class="keyword">pid_t</span> pid = <span class="built_in">getpid</span>();</span><br><span class="line">    <span class="keyword">pthread_t</span> tid = <span class="built_in">pthread_self</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s pid %u tid %u (0x%x)\n"</span>, s, (<span class="keyword">unsigned</span> <span class="keyword">int</span>) pid, (<span class="keyword">unsigned</span> <span class="keyword">int</span>) tid, (<span class="keyword">unsigned</span> <span class="keyword">int</span>) tid);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">procFunc1</span><span class="params">(<span class="keyword">void</span> *args)</span> </span>{</span><br><span class="line">    <span class="built_in">printIds</span>(<span class="string">"thread-1"</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">WaitForEvent</span>(g_hEvent, <span class="number">1</span>) == <span class="number">0</span>) {</span><br><span class="line">        cout &lt;&lt; <span class="string">"thread-1 is working..."</span> &lt;&lt; endl;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ((<span class="keyword">void</span> *) <span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">procFunc2</span><span class="params">(<span class="keyword">void</span> *args)</span> </span>{</span><br><span class="line">    <span class="built_in">printIds</span>(<span class="string">"thread-2"</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">WaitForEvent</span>(g_hEvent, <span class="number">1</span>) == <span class="number">0</span>) {</span><br><span class="line">        cout &lt;&lt; <span class="string">"thread-2 is working..."</span> &lt;&lt; endl;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ((<span class="keyword">void</span> *) <span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// 自动清除事件信号，初始状态为有信号</span></span><br><span class="line">    g_hEvent = <span class="built_in">CreateEvent</span>(<span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pthread_t</span> ntid1;</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;ntid1, <span class="literal">NULL</span>, procFunc1, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pthread_t</span> ntid2;</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;ntid2, <span class="literal">NULL</span>, procFunc2, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">5</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>程序运行的结果如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">thread-1 pid 59685 tid 2245932800 (0x85de3700)</span><br><span class="line">thread-1 is working...</span><br><span class="line">thread-2 pid 59685 tid 2237540096 (0x855e2700)</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">提示</p><p>可以看到只有线程 1 完整执行了，这是由于事件在执行完线程 1 后被系统自动重置为无信号，所以线程 2 中的逻辑没有被执行。</p></div><h3 id="实战案例三"><a href="#实战案例三" class="headerlink" title="实战案例三"></a>实战案例三</h3><p><code>CreateEvent(true, false)</code> - 手动清除事件信号，初始状态为无信号，包括 <code>SetEvent（）</code> 与 <code>ResetEvent()</code> 的使用，<a href="/downloads/2021/12/pevents-cmake-demo-3.zip">点击下载</a> 基于 CMake 构建的完整案例代码</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pevents.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> neosmart;</span><br><span class="line"></span><br><span class="line"><span class="keyword">neosmart_event_t</span> g_hEvent = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printIds</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s)</span> </span>{</span><br><span class="line">    <span class="keyword">pid_t</span> pid = <span class="built_in">getpid</span>();</span><br><span class="line">    <span class="keyword">pthread_t</span> tid = <span class="built_in">pthread_self</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s pid %u tid %u (0x%x)\n"</span>, s, (<span class="keyword">unsigned</span> <span class="keyword">int</span>) pid, (<span class="keyword">unsigned</span> <span class="keyword">int</span>) tid, (<span class="keyword">unsigned</span> <span class="keyword">int</span>) tid);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">procFunc1</span><span class="params">(<span class="keyword">void</span> *args)</span> </span>{</span><br><span class="line">    <span class="built_in">printIds</span>(<span class="string">"thread-1"</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">WaitForEvent</span>(g_hEvent, <span class="number">1</span>) == <span class="number">0</span>) {</span><br><span class="line">        cout &lt;&lt; <span class="string">"thread-1 is working..."</span> &lt;&lt; endl;</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// 重置事件为无信号</span></span><br><span class="line">    <span class="built_in">ResetEvent</span>(g_hEvent);</span><br><span class="line">    <span class="keyword">return</span> ((<span class="keyword">void</span> *) <span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">procFunc2</span><span class="params">(<span class="keyword">void</span> *args)</span> </span>{</span><br><span class="line">    <span class="built_in">printIds</span>(<span class="string">"thread-2"</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">WaitForEvent</span>(g_hEvent, <span class="number">1</span>) == <span class="number">0</span>) {</span><br><span class="line">        cout &lt;&lt; <span class="string">"thread-2 is working..."</span> &lt;&lt; endl;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ((<span class="keyword">void</span> *) <span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func1</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// 手动清除事件信号，初始状态为有信号</span></span><br><span class="line">    g_hEvent = <span class="built_in">CreateEvent</span>(<span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pthread_t</span> ntid1;</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;ntid1, <span class="literal">NULL</span>, procFunc1, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pthread_t</span> ntid2;</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;ntid2, <span class="literal">NULL</span>, procFunc2, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">5</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// 手动清除事件信号，初始状态为无信号</span></span><br><span class="line">    g_hEvent = <span class="built_in">CreateEvent</span>(<span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置事件为有信号</span></span><br><span class="line">    <span class="built_in">SetEvent</span>(g_hEvent);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pthread_t</span> ntid1;</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;ntid1, <span class="literal">NULL</span>, procFunc1, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pthread_t</span> ntid2;</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;ntid2, <span class="literal">NULL</span>, procFunc2, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sleep</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>程序运行的结果如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">thread-1 pid 70368 tid 2745513728 (0xa3a53700)</span><br><span class="line">thread-1 is working...</span><br><span class="line">thread-2 pid 70368 tid 2737121024 (0xa3252700)</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">提示</p><p>可以看到只有线程 1 完整执行了，这是因为线程 1 在执行之前事件是有信号的，执行完成后事件被手动重置为无信号，所以线程 2 中的逻辑没有被执行。</p></div><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a target="_blank" rel="external nofollow" href="https://blog.csdn.net/sinat_31608641/article/details/105399249">C++ 的 CreateEvent ()</a></li><li><a target="_blank" rel="external nofollow" href="https://blog.csdn.net/u011507161/article/details/42462079">WaitForSingleObject 和 WaitForMultipleObject</a></li><li><a target="_blank" rel="external nofollow" href="https://blog.csdn.net/u011394598/article/details/82981399">事件 SetEvent、ResetEvent、WaitForSingleObject 与 CreateEvent 详解</a></li></ul></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script>var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if(!isMobile)try{var plugin=new ReadmorePlugin;plugin.init({id:"readmore-container",blogId:"96641-5333172926158-056",name:"全栈技术驿站",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",lockToc:"yes",type:"hexo",random:"0.9",interval:"30",expires:"365",height:"auto"})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/c847598e.html" title="Linux 实现 Windows 的 Event 事件机制">https://www.techgrow.cn/posts/c847598e.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎加入微信群</span><br> <img src="/img/wx-group-qr-technology.png"></div></div></div><div class="post-tags"><a href="/tags/C/" rel="tag"><i class="fa fa-tag"></i> C++</a><a href="/tags/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/" rel="tag"><i class="fa fa-tag"></i> Linux系统编程</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/15f45d12.html" rel="prev" title="Linux 移植 Windows 的 C++ 代码"><i class="fa fa-chevron-left"></i> Linux 移植 Windows 的 C++ 代码</a></div><div class="post-nav-item"> <a href="/posts/4ffdb5e1.html" rel="next" title="Centos7 升级 OpenSSL">Centos7 升级 OpenSSL<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright &copy; 2018 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">808k</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">12:15</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="beian"> <span><img src="/img/gonganbeian.png" alt></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备19024664号</a></span></div></div></footer><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-ZfzwelSToHk5YAcr9wbXAmWgyn9Jyq08fSLrLhZE89w="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://unpkg.com/qiniu-js@3.3.1/dist/qiniu.min.js"></script><script>
    var qiniu_domain = "https://qiniu.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/app/api/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn:9360","cssUrl":"https://unpkg.com/@waline/client@2.5.1/dist/waline.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://unpkg.com/@waline/client@2.5.1/dist/waline.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://qiniu.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/app/api/qiniu/token/upload","el":"#waline","comment":true,"path":"/posts/c847598e.html"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@2.5.1/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>