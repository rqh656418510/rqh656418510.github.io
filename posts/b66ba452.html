<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 Dubbo 的入门教程。"><meta property="og:type" content="article"><meta property="og:title" content="Dubbo 2 入门教程之四"><meta property="og:url" content="https://www.techgrow.cn/posts/b66ba452.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 Dubbo 的入门教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-thread-model.png"><meta property="article:published_time" content="2019-07-13T15:42:35.000Z"><meta property="article:modified_time" content="2025-07-13T15:42:35.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="微服务"><meta property="article:tag" content="分布式"><meta property="article:tag" content="RPC"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-thread-model.png"><link rel="canonical" href="https://www.techgrow.cn/posts/b66ba452.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/b66ba452.html","path":"posts/b66ba452.html","title":"Dubbo 2 入门教程之四"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Dubbo 2 入门教程之四 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90"><span class="nav-text">学习资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="nav-text">Dubbo 核心特性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B"><span class="nav-text">线程模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E6%80%A7%E8%AF%B4%E6%98%8E"><span class="nav-text">特性说明</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B-1"><span class="nav-text">线程模型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%B1%BB%E5%9E%8B"><span class="nav-text">线程池类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E6%B4%BE%E5%8F%91%E7%AD%96%E7%95%A5"><span class="nav-text">线程派发策略</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E"><span class="nav-text">配置说明</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="nav-text">配置参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">配置方式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-text">使用方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#YML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">YML 配置方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#XML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">XML 配置方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="nav-text">并发控制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E6%80%A7%E8%AF%B4%E6%98%8E-1"><span class="nav-text">特性说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0-1"><span class="nav-text">配置参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-text">注意事项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F-1"><span class="nav-text">使用方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">注解配置方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#XML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-1"><span class="nav-text">XML 配置方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%8E%A7%E5%88%B6"><span class="nav-text">连接控制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E6%80%A7%E8%AF%B4%E6%98%8E-2"><span class="nav-text">特性说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0-2"><span class="nav-text">配置参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-1"><span class="nav-text">注意事项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E4%BE%9B%E6%96%B9%E7%9A%84%E8%BF%9E%E6%8E%A5%E6%8E%A7%E5%88%B6"><span class="nav-text">提供方的连接控制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#YML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-1"><span class="nav-text">YML 配置方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#XML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-2"><span class="nav-text">XML 配置方式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B6%88%E8%B4%B9%E6%96%B9%E7%9A%84%E8%BF%9E%E6%8E%A5%E6%8E%A7%E5%88%B6"><span class="nav-text">消费方的连接控制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-1"><span class="nav-text">注解配置方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#XML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-3"><span class="nav-text">XML 配置方式</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">743</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/b66ba452.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Dubbo 2 入门教程之四 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 Dubbo 的入门教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Dubbo 2 入门教程之四</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-07-13 23:42:35" itemprop="dateCreated datePublished" datetime="2019-07-13T23:42:35+08:00">2019-07-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-13 23:42:35" itemprop="dateModified" datetime="2025-07-13T23:42:35+08:00">2025-07-13</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/b66ba452.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/b66ba452.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>10k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>9 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/d484ffa3.html">Dubbo 2 入门教程之一</a>、<a href="/posts/ad584707.html">Dubbo 2 入门教程之二</a>、<a href="/posts/fab9c84c.html">Dubbo 2 入门教程之三</a>、<a href="/posts/b66ba452.html">Dubbo 2 入门教程之四</a>、<a href="/posts/ab89c617.html">Dubbo 2 入门教程之五</a></li><li><a href="/posts/ef04d10a.html">Dubbo 2 巩固教程之一</a>、<a href="/posts/b6d5fbb8.html">Dubbo 2 巩固教程之二</a>、<a href="/posts/ea9ce835.html">Dubbo 2 巩固教程之三</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h3><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/incubator-dubbo/">Dubbo 官方项目</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/">Dubbo 官方文档</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-samples">Dubbo 官方案例</a></li></ul><span id="more"></span><h2 id="Dubbo-核心特性"><a href="#Dubbo-核心特性" class="headerlink" title="Dubbo 核心特性"></a>Dubbo 核心特性</h2><div class="admonition note"><p class="admonition-title">代码下载</p><p>本节完整的案例代码可以直接从 <a target="_blank" rel="external nofollow" href="https://github.com/rqh656418510/spring-cloud-share/tree/main/rpc-framework/dubbo-study/dubbo2.x-study">GitHub</a> 下载对应章节 <code>dubbo-lesson-12</code>。</p></div><h3 id="线程模型"><a href="#线程模型" class="headerlink" title="线程模型"></a>线程模型</h3><div class="admonition note"><p class="admonition-title">Dubbo 官方文档</p><ul><li><a target="_blank" rel="external nofollow" href="https://cn.dubbo.apache.org/zh-cn/docs/advanced/thread-model/">Dubbo 官方文档（2.x）- 线程模型</a></li><li><a target="_blank" rel="external nofollow" href="https://cn.dubbo.apache.org/zh-cn/docsv2.7/dev/source/service-invoking-process/#2321-%E7%BA%BF%E7%A8%8B%E6%B4%BE%E5%8F%91%E6%A8%A1%E5%9E%8B">Dubbo 官方文档（2.7）- 线程模型</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/threading-model/">Dubbo 官方文档（最新）- 线程模型</a></li></ul></div><h4 id="特性说明"><a href="#特性说明" class="headerlink" title="特性说明"></a>特性说明</h4><h5 id="线程模型-1"><a href="#线程模型-1" class="headerlink" title="线程模型"></a>线程模型</h5><p>通过网络对外提供服务的组件通常都包含两类线程：网络 I/O 线程和业务线程，Dubbo 框架也不例外。</p><ul><li><p>网络 I/O 线程</p><ul><li>负责处理网络请求的接收和传输，包括 <code>accept</code>、<code>connection</code>、<code>read</code>、<code>write</code> 等事件。</li><li>如果网络事件的处理逻辑较为简单且能迅速完成，直接在 I/O 线程中处理可以获得更高性能，因为省去了线程切换的开销。</li><li>但若处理逻辑较复杂或耗时较长，I/O 线程被阻塞将会导致无法及时响应新的网络请求，从而影响整体并发能力。</li></ul></li><li><p>业务线程</p><ul><li>专用于执行复杂的业务逻辑，例如通过 I/O 调用第三方服务、进行数据计算与处理等。</li><li>由于业务逻辑执行时间不确定，使用独立的业务线程可以有效避免阻塞 Dubbo 的网络 I/O 线程，从而保障系统的网络处理能力。</li></ul></li><li><p>使用场景</p><ul><li>如果事件处理的逻辑能迅速完成，并且不会发起新的网络 I/O 请求，比如只是在内存中记个标识，则直接在网络 I/O 线程上处理更快，因为减少了线程池调度。</li><li>如果事件处理的逻辑执行较慢，或者需要发起新的网络 I/O 请求，比如需要查询数据库，则必须派发到线程池处理，否则网络 I/O 线程阻塞，将导致不能接收其它新的请求。</li><li>如果用网络 I/O 线程处理事件，又在事件处理过程中发起新的网络 I/O 请求，比如在连接事件中发起登录请求，会抛出 “可能引发死锁” 异常，但不会真死锁。</li><li>因此，需要通过不同的线程派发策略和不同的线程池配置的组合来应对不同的场景<ul><li>举个例子，将所有的消息都派发给业务线程池，业务线程池固定 100 个线程，配置示例如下：</li><li>服务提供者的配置：<code>&lt;dubbo:protocol name="dubbo" dispatcher="all" threadpool="fixed" threads="100" /&gt;</code>。</li></ul></li></ul></li></ul><h5 id="线程池类型"><a href="#线程池类型" class="headerlink" title="线程池类型"></a>线程池类型</h5><p>Dubbo 提供了以下 4 种线程池类型：</p><ul><li><p><code>fixed</code>（固定大小线程池）</p><ul><li>特点：<ul><li>Dubbo 的默认线程池类型。</li><li>启动时创建固定数量线程，不会关闭线程，线程始终存在。</li><li>任务排队等待执行，如果线程都在忙，任务会进入队列。</li></ul></li><li>优点：<ul><li>线程数固定，可预测系统资源消耗，便于容量规划。</li><li>避免线程无限增长，降低系统过载风险。</li><li>稳定性高，适合长期运行的常规业务。</li></ul></li><li>缺点：<ul><li>并发峰值超过线程数时，任务会排队，可能导致响应延迟增加。</li></ul></li><li>适用场景：<ul><li>并发量稳定的常规业务场景。</li></ul></li></ul></li><li><p><code>cached</code>（缓存线程池）</p><ul><li>特点：<ul><li>空闲线程 1 分钟后自动销毁，需要时重新创建线程。</li><li>当任务数超过 <code>maximumPoolSize</code> 时，直接抛出 <code>RejectedExecutionException</code> 异常（拒绝任务），不会将任务放入队列排队。</li></ul></li><li>优点：<ul><li>根据负载动态调整线程数，节省系统资源。</li></ul></li><li>缺点：<ul><li>长耗时任务或高并发任务可能导致线程无限增加，引起系统过载。</li></ul></li><li>适用场景：<ul><li>短时高峰、任务执行快且任务量波动大的业务场景。</li></ul></li></ul></li><li><p><code>limited</code>（可伸缩线程池）</p><ul><li>特点：<ul><li>线程池大小可伸缩，但只增长不收缩，可以限制最大线程数。</li><li>当线程都被占用且队列满时，会直接拒绝新任务。</li><li>可以避免线程收缩后，流量突增导致性能下降。</li></ul></li><li>优点：<ul><li>以资源换稳定性，可以确保系统快速响应流量波动。</li></ul></li><li>缺点：<ul><li>空闲线程无法回收，长期运行可能占用较多资源。</li></ul></li><li>适用场景：<ul><li>流量波动明显，但希望系统在高峰期保持响应稳定的场景。</li></ul></li></ul></li><li><p><code>eager</code>（优先创建 Worker 线程池）</p><ul><li>工作机制：<ul><li>当任务数 &gt; <code>corePoolSize</code> 且 &lt; <code>maximumPoolSize</code> 时，优先创建 Worker 线程处理任务。</li><li>当任务数 &gt; <code>maximumPoolSize</code> 时，将任务放入阻塞队列。</li><li>阻塞队列已满时，抛出 <code>RejectedExecutionException</code> 异常。</li></ul></li><li>与 <code>cached</code> 线程池的区别：<ul><li><code>cached</code>：一旦超过最大线程数，会直接拒绝任务（抛出异常），不使用队列。</li><li><code>eager</code>：一旦超过最大线程数，会将任务放入队列，降低任务被拒绝执行的概率。</li></ul></li><li>优点：<ul><li>快速响应突发请求，高峰期任务能尽快创建线程处理。</li><li>减少任务被拒绝的概率（因为有阻塞队列作为缓冲）。</li><li>兼顾低延迟与高并发的处理能力。</li></ul></li><li>缺点：<ul><li>配置不当可能导致线程数激增，占用大量系统资源。</li></ul></li><li>适用场景：<ul><li>高并发、低延迟业务，既希望快速创建线程处理任务，又希望尽量减少任务被拒绝执行的概率。</li></ul></li></ul></li></ul><p>Dubbo 不同类型线程池的对比：</p><table><thead><tr><th>线程池类型</th><th>是否使用队列</th><th>队列是否有界</th><th>拒绝策略触发条件</th><th>特点与适用场景</th></tr></thead><tbody><tr><td><code>fixed</code></td><td>使用队列</td><td>无界队列（<code>LinkedBlockingQueue</code> 默认容量无限）</td><td>几乎不会触发</td><td>稳定但可能堆积大量请求，适合后台任务</td></tr><tr><td><code>cached</code></td><td>不使用队列</td><td></td><td></td><td>根据负载动态扩缩线程，适合短平快请求</td></tr><tr><td><code>limited</code></td><td>使用队列</td><td>有界队列</td><td>队列满 + 线程忙</td><td>可以防止堆积任务，控制并发与内存使用，适合网关或限流场景</td></tr><tr><td><code>eager</code></td><td>使用队列</td><td>有界</td><td>队列满 + 线程忙</td><td>更积极地扩容线程，适合高峰突发场景</td></tr></tbody></table><h5 id="线程派发策略"><a href="#线程派发策略" class="headerlink" title="线程派发策略"></a>线程派发策略</h5><p>Dubbo 提供了 5 种线程派发策略（Dispatcher），也叫消息派发策略，用于控制不同类型的消息在网络 I/O 线程和业务线程池之间的派发方式，从而实现高效且可控的并发处理。</p><ul><li><p>Dubbo 的消息类型</p><ul><li>请求消息（Request）：执行服务端业务逻辑，可能耗时较长，通常需要交给业务线程池处理，避免阻塞网络 I/O 线程。</li><li>响应消息（Response）：只需要将方法的执行结果返回给客户端，逻辑非常轻量，通常直接在网络 I/O 线程写出即可，无需切换到业务线程。</li><li>心跳消息（Heartbeat）：用于连接保活，逻辑轻量，通常在网络 I/O 线程处理。</li><li>连接消息（Connect）：表示客户端与服务端建立连接，轻量操作，通常在网络 I/O 线程处理。</li><li>断开消息（Disconnect）：表示客户端与服务端断开连接，轻量操作，通常在网络 I/O 线程处理。</li></ul></li><li><p>Dubbo 的线程派发策略</p><ul><li><code>all</code>：默认的线程派发策略，所有消息都派发到业务线程池处理，包括请求、响应、连接、断开、心跳等事件。</li><li><code>direct</code>：所有消息都不派发到业务线程池处理，全部都在网络 I/O 线程上直接执行。</li><li><code>message</code>：只有<strong>请求</strong>和<strong>响应</strong>消息派发到业务线程池处理，其它连接、断开、心跳消息，直接在网络 I/O 线程上执行。</li><li><code>execution</code>：只有<strong>请求</strong>消息派发到业务线程池处理，不包含响应消息；响应和其它连接、断开、心跳消息，直接在网络 I/O 线程上执行。</li><li><code>connection</code>：连接和断开事件在网络 I/O 线程上放入队列，按顺序逐个处理；其它请求、响应、心跳消息，则派发到业务线程池处理。</li></ul></li><li><p>Dubbo 的调用图</p><ul><li>如下图所示，红框中的 Dispatcher 就是线程派发器，Dubbo 支持 5 种不同的线程派发策略。</li><li>需要说明的是，Dispatcher 真实的职责创建具有线程派发能力的 <code>ChannelHandler</code>，比如 <code>AllChannelHandler</code>、<code>MessageOnlyChannelHandler</code> 和 <code>ExecutionChannelHandler</code> 等，其本身并不具备线程派发能力。</li><li>比如，在 <code>AllChannelHandler</code> 的代码实现中，Dubbo 的请求对象会被封装为 <code>ChannelEventRunnable</code>，而 <code>ChannelEventRunnable</code> 将会是服务调用过程的新起点。</li></ul></li></ul><p><img data-src="../../../asset/2025/09/dubbo-thread-model.png"></p><h4 id="配置说明"><a href="#配置说明" class="headerlink" title="配置说明"></a>配置说明</h4><h5 id="配置参数"><a href="#配置参数" class="headerlink" title="配置参数"></a>配置参数</h5><p>Dubbo 为线程模型提供了三个核心配置参数：<code>dispatcher</code>、<code>threadpool</code>、<code>threads</code>。</p><ul><li><code>dispatcher</code>（线程派发策略）</li></ul><table><thead><tr><th>参数值</th><th>含义说明</th><th>特点与适用场景</th></tr></thead><tbody><tr><td><code>all</code></td><td>默认值，所有消息均派发到业务线程池</td><td>最常见配置，网络 I/O 线程只负责读写，业务逻辑全部交由业务线程池处理。</td></tr><tr><td><code>direct</code></td><td>所有消息直接在网络 I/O 线程上执行</td><td>性能最高但风险大，可能会阻塞网络 I/O 线程，适合极轻量级、无阻塞逻辑的场景。</td></tr><tr><td><code>message</code></td><td>只派发请求、响应消息到业务线程池</td><td>连接、断开、心跳等消息仍在网络 I/O 线程中处理，适合请求耗时较长的场景。</td></tr><tr><td><code>execution</code></td><td>仅派发请求消息到业务线程池，不包含响应消息</td><td>响应和其它连接、断开、心跳消息，直接在网络 I/O 线程上执行，适合请求耗时较长的场景。</td></tr><tr><td><code>connection</code></td><td>每个连接独立分配线程池</td><td>为每个连接创建独立线程池，适合多连接、隔离性要求高的场景。</td></tr><tr><td>可扩展</td><td>自定义派发策略（SPI 扩展）</td><td>Dubbo 通过 SPI 机制支持扩展自定义 <code>Dispatcher</code> 实现，以满足特殊调度需求。</td></tr></tbody></table><ul><li><code>threadpool</code>（线程池类型）</li></ul><table><thead><tr><th>参数值</th><th>含义说明</th><th>特点与适用场景</th></tr></thead><tbody><tr><td><code>fixed</code></td><td>默认值，固定大小线程池</td><td>线程数固定（由 <code>threads</code> 参数决定），如果线程都在忙，任务会进入队列，适合稳定且可预估的并发场景。</td></tr><tr><td><code>cached</code></td><td>缓存线程池</td><td>无固定线程数，空闲线程可回收，不使用队列，适合流量波动较大的场景，但高并发下可能会创建大量线程。</td></tr><tr><td><code>limited</code></td><td>可伸缩线程池</td><td>线程池中的线程只会增加，不会收缩，但可以限制最大并发数；超出部分任务将排队等待，避免线程过多导致系统过载。</td></tr><tr><td><code>eager</code></td><td>优先创建线程的池（Dubbo 特有）</td><td>优先增加线程来处理请求，队列积压时再排队执行（与 JDK 的 <code>FixedThreadPool</code> 刚好相反），适合低延迟、高并发业务场景。</td></tr><tr><td>可扩展</td><td>自定义线程池</td><td> Dubbo SPI 机制允许开发者扩展自定义线程池实现。</td></tr></tbody></table><ul><li><code>threads</code>（线程数量）</li></ul><table><thead><tr><th>参数</th><th>默认值</th><th>含义说明</th><th>适用范围</th><th>调优建议</th></tr></thead><tbody><tr><td><code>threads</code></td><td><code>200</code></td><td>限制业务线程池中可并行执行的最大线程数。线程数过小会导致请求排队、响应延迟；过大则会增加线程上下文切换和内存开销。</td><td>Provider 端参数，仅影响服务提供者的业务线程池，不影响 Consumer 的请求线程数。</td><td>一般根据 CPU 核数与请求耗时进行调优：CPU 密集型业务推荐配置为核数的 2 ~ 4 倍；I/O 密集型业务可适当调高。</td></tr></tbody></table><h5 id="配置方式"><a href="#配置方式" class="headerlink" title="配置方式"></a>配置方式</h5><p>比如：将所有的消息都派发给业务线程池，业务线程池固定 100 个线程。</p><ul><li>Dubbo 配置示例：</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在服务提供者中的协议中，配置线程池类型与线程派发策略 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">port</span>=<span class="string">"20880"</span> <span class="attr">dispatcher</span>=<span class="string">"all"</span> <span class="attr">threadpool</span>=<span class="string">"fixed"</span> <span class="attr">threads</span>=<span class="string">"100"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>配置参数的说明：</li></ul><table><thead><tr><th>参数名</th><th>示例值</th><th>含义说明</th><th>作用</th></tr></thead><tbody><tr><td><code>name</code></td><td><code>dubbo</code></td><td>指定使用的通信协议名称，如 <code>dubbo</code>、<code>rmi</code>、<code>http</code> 等</td><td>决定服务暴露时所采用的通信协议类型</td></tr><tr><td><code>port</code></td><td><code>20880</code></td><td>服务监听的端口号</td><td>消费者通过该端口访问服务提供者</td></tr><tr><td><code>threadpool</code></td><td><code>fixed</code></td><td>业务线程池的类型，如 <code>fixed</code>、<code>cached</code>、<code>limited</code>、<code>eager</code> 等</td><td>控制业务线程池的创建与使用策略</td></tr><tr><td><code>dispatcher</code></td><td><code>all</code></td><td>线程派发策略，如 <code>all</code>、<code>direct</code>、<code>message</code>、<code>execution</code>、<code>connection</code> 等，控制网络 I/O 线程与业务线程的任务分配方式</td><td>决定请求在网络 I/O 线程与业务线程之间的调度方式</td></tr><tr><td><code>threads</code></td><td><code>100</code></td><td>业务线程池中的最大线程数</td><td>限制并发执行的业务线程数量，防止资源耗尽</td></tr></tbody></table><div class="admonition warning"><p class="admonition-title">特别注意</p><p><strong>Dubbo 线程模型的配置参数（如 <code>dispatcher</code>、<code>threadpool</code>、<code>threads</code>）通常是配置在服务提供者中，而服务消费者通常不需要配置。</strong></p></div><h4 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h4><h5 id="YML-配置方式"><a href="#YML-配置方式" class="headerlink" title="YML 配置方式"></a>YML 配置方式</h5><ul><li>服务提供者中配置</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">protocol:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">20880</span></span><br><span class="line">    <span class="attr">dispatcher:</span> <span class="string">all</span></span><br><span class="line">    <span class="attr">threadpool:</span> <span class="string">fixed</span></span><br><span class="line">    <span class="attr">threads:</span> <span class="number">100</span></span><br></pre></td></tr></tbody></table></figure><h5 id="XML-配置方式"><a href="#XML-配置方式" class="headerlink" title="XML 配置方式"></a>XML 配置方式</h5><ul><li>服务提供者中配置</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置服务协议，添加并发控制的配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">port</span>=<span class="string">"20880"</span> <span class="attr">dispatcher</span>=<span class="string">"all"</span> <span class="attr">threadpool</span>=<span class="string">"fixed"</span> <span class="attr">threads</span>=<span class="string">"100"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="并发控制"><a href="#并发控制" class="headerlink" title="并发控制"></a>并发控制</h3><h4 id="特性说明-1"><a href="#特性说明-1" class="headerlink" title="特性说明"></a>特性说明</h4><ul><li><p>功能说明</p><ul><li>Dubbo 提供了多种并发控制（限流）功能，可以帮助用户管理其应用程序和服务。</li></ul></li><li><p>使用场景</p><ul><li>限制从同一客户端到同一服务的并发请求数，防止恶意请求使服务器过载，确保服务的稳定性，并防止使用过多资源。</li><li>控制某些服务的最大并发请求数，确保其他服务的资源可用性。避免系统过载和确保系统稳定性。</li><li>允许在需求增加时更平滑地扩展服务，并且确保服务在高峰使用时间保持可靠和稳定。</li><li>这种并发控制方式要求用户准确的预先评估系统能处理的并发数，而准确的评估系统处理能力并不是一件容易的事情。<ul><li>因此 Dubbo 还提供了自适应限流模式，根据系统负载自动识别系统健康程度并进行限流保护，可以在此 <a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/rate-limit/adaptive-concurrency-control/"><strong>查看官方文档</strong></a>。</li></ul></li></ul></li></ul><h4 id="配置参数-1"><a href="#配置参数-1" class="headerlink" title="配置参数"></a>配置参数</h4><p>Dubbo 为并发控制提供了 <code>executes</code> 和 <code>actives</code> 配置参数，两者都支持接口级别和方法级别的配置，具体介绍如下表所示：</p><table><thead><tr><th>参数名称</th><th>作用层面</th><th>功能描述</th><th>常见适用场景</th><th>超限后的行为</th><th>注意事项</th></tr></thead><tbody><tr><td><code>executes</code></td><td>服务提供者中，对方法调用进行限流</td><td><strong>限制某个服务接口的最大并发调用数（即占用服务端线程池线程数）</strong></td><td>某个服务接口较重、CPU 密集型、需要限流保护时</td><td>超出并发数上限时直接拒绝请求，抛出 <code>RpcException</code> 异常</td><td>针对接口级别，常用于保护关键服务不被过载调用</td></tr><tr><td><code>actives</code></td><td>服务消费者中，对方法调用进行限流</td><td><strong>限制某个消费者对某个服务接口的最大并发请求数（即消费端发出的请求并发数）</strong></td><td>消费端调用高延迟服务时，防止请求堆积</td><td>超出请求数上限时阻塞等待响应（默认等待超时后抛出异常）</td><td>针对消费端的服务引用，适合控制客户端对下游的压力</td></tr></tbody></table><h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><p>在使用 Dubbo 的并发控制参数 <code>executes</code> 和 <code>actives</code> 时，必须注意以下细节：</p><ul><li>Dubbo 的 <code>actives</code> 参数控制的是「并发请求数（Active Requests）」，而不是 TCP 连接数，仅 Dubbo 协议等支持多路复用协议能体现出其并发控制的特性。</li><li>对于 Dubbo 协议而言，多个并发请求可以复用同一个 TCP 连接（支持多路复用），因此即使 <code>connections = 1</code>，一个 TCP 连接也可以同时处理多个请求；当 <code>actives = 10</code>，这就可以限制 Dubbo 协议最多支持 10 个并发请求。</li><li>对于其他协议（如 HTTP、RMI、Hessian），这些协议往往是「同步阻塞式」通信，一个 TCP 连接上一次只能发送一个请求，直到响应返回。因此即使设置 <code>actives = 10</code>，实际上也无法同时发出 10 个请求（受协议约束），所以此时 <code>actives</code> 不会生效。</li></ul><table><thead><tr><th>使用案例</th><th>配置</th><th>实际效果</th></tr></thead><tbody><tr><td> Dubbo 协议，<code>connections = 1</code>，<code>actives = 10</code></td><td>支持多路复用</td><td>可以在 1 个连接上同时处理最多 10 个并发请求</td></tr><tr><td> Dubbo 协议，<code>connections = 5</code>，<code>actives = 10</code></td><td>支持多路复用，多连接 + 多并发</td><td>最多有 10 个并行请求分布在 5 个连接上</td></tr><tr><td> Dubbo 协议，<code>connections = 1</code>，<code>actives = 1</code></td><td>请求严格串行</td><td>同一时间内只允许 1 个并发请求</td></tr><tr><td> RMI 或 HTTP 协议，<code>connections = 1</code>，<code>actives = 10</code></td><td>不支持多路复用，请求严格串行</td><td>实际只有 1 个并发请求，<code>actives</code> 不会生效</td></tr></tbody></table><h4 id="使用方式-1"><a href="#使用方式-1" class="headerlink" title="使用方式"></a>使用方式</h4><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>Dubbo 的并发控制参数 <code>executes</code> 必须配置在服务提供者中，不支持配置在服务消费者中。</li><li><strong>Dubbo 的并发控制参数 <code>actives</code> 可以配置在服务消费者或者服务提供者中，如果两者都配置了 <code>actives</code> 参数，那么服务消费者的配置更优先。</strong></li><li><strong>Dubbo 的并发控制参数 <code>actives</code> 是点对点（Consumer → Provider）级别的并发控制，而不是全局合计。也就是说限制的是 "单个服务消费者（Consumer）到单个服务提供者（Provider）之间" 的并发请求数。</strong></li></ul></div><h5 id="注解配置方式"><a href="#注解配置方式" class="headerlink" title="注解配置方式"></a>注解配置方式</h5><blockquote><p>executes 参数的配置</p></blockquote><ul><li>在服务提供者中，限制 <code>com.foo.BarService</code> 的每个方法，并发执行数（即占用服务端的线程池线程数）不能超过 10 个</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在服务提供者中配置</span></span><br><span class="line"><span class="meta">@DubboService(executes = 10)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BarServiceImpl</span> <span class="keyword">implements</span> <span class="title">BarService</span> </span>{ }</span><br></pre></td></tr></tbody></table></figure><ul><li>在服务提供者中，限制 <code>com.foo.BarService</code> 的 <code>sayHello()</code> 方法，并发执行数（即占用服务端的线程池线程数）不能超过 10 个</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在服务提供者的方法上配置</span></span><br><span class="line"><span class="meta">@DubboService(methods = {@Method(name = "sayHello", executes = 10)})</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BarServiceImpl</span> <span class="keyword">implements</span> <span class="title">BarService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">(String name)</span> </span>{ }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>actives 参数的配置</p></blockquote><ul><li>在服务消费者（或者服务提供者）中，限制 <code>com.foo.BarService</code> 的每个方法，每个客户端的并发请求数（即占用 TCP 连接的请求数，不一定是 TCP 连接数，比如 Dubbo 协议支持单连接多路复用）不能超过 10 个</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在服务消费者中配置</span></span><br><span class="line"><span class="meta">@DubboReference(actives = 10)</span></span><br><span class="line"><span class="keyword">private</span> BarService barService;</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 或者，在服务提供者中配置</span></span><br><span class="line"><span class="meta">@DubboService(actives = 10)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BarServiceImpl</span> <span class="keyword">implements</span> <span class="title">BarService</span> </span>{ }</span><br></pre></td></tr></tbody></table></figure><ul><li>在服务消费者（或者服务提供者）中，限制 <code>com.foo.BarService</code> 的 <code>sayHello()</code> 方法，每个客户端的并发请求数（即占用 TCP 连接的请求数，不一定是 TCP 连接数，比如 Dubbo 协议支持单连接多路复用）不能超过 10 个</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在服务消费者的方法上配置</span></span><br><span class="line"><span class="meta">@DubboReference(methods = {@Method(name = "sayHello", actives = 10)})</span></span><br><span class="line"><span class="keyword">private</span> BarService barService;</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 或者，在服务提供者的方法上配置</span></span><br><span class="line"><span class="meta">@DubboService(methods = {@Method(name = "sayHello", actives = 10)})</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BarServiceImpl</span> <span class="keyword">implements</span> <span class="title">BarService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">(String name)</span> </span>{ }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h5 id="XML-配置方式-1"><a href="#XML-配置方式-1" class="headerlink" title="XML 配置方式"></a>XML 配置方式</h5><blockquote><p>executes 参数的配置</p></blockquote><ul><li>在服务提供者中，限制 <code>com.foo.BarService</code> 的每个方法，并发执行数（即占用服务端的线程池线程数）不能超过 10 个</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 服务实现类 Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"barServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.foo.impl.BarServiceImpl"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 在服务提供者中配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">ref</span>=<span class="string">"barServiceImpl"</span> <span class="attr">executes</span>=<span class="string">"10"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>在服务提供者中，限制 <code>com.foo.BarService</code> 的 <code>sayHello()</code> 方法，并发执行数（即占用服务端的线程池线程数）不能超过 10 个</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 服务实现类 Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"barServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.foo.impl.BarServiceImpl"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 在服务提供者的方法上配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">ref</span>=<span class="string">"barServiceImpl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"sayHello"</span> <span class="attr">executes</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>actives 参数的配置</p></blockquote><ul><li>在服务消费者（或者服务提供者）中，限制 <code>com.foo.BarService</code> 的每个方法，每个客户端的并发请求数（即占用 TCP 连接的请求数，不一定是 TCP 连接数，比如 Dubbo 协议支持单连接多路复用）不能超过 10 个</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在服务消费者中配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"barService"</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">actives</span>=<span class="string">"10"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 服务实现类 Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"barServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.foo.impl.BarServiceImpl"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 或者，在服务提供者中配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">ref</span>=<span class="string">"barServiceImpl"</span> <span class="attr">actives</span>=<span class="string">"10"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>在服务消费者（或者服务提供者）中，限制 <code>com.foo.BarService</code> 的 <code>sayHello ()</code> 方法，每个客户端的并发请求数（即占用 TCP 连接的请求数，不一定是 TCP 连接数，比如 Dubbo 协议支持单连接多路复用）不能超过 10 个</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在服务消费者的方法上配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"barService"</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"sayHello"</span> <span class="attr">actives</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 服务实现类 Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"barServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.foo.impl.BarServiceImpl"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 或者，在服务提供者的方法上配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">ref</span>=<span class="string">"barServiceImpl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"sayHello"</span> <span class="attr">actives</span>=<span class="string">"10"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="连接控制"><a href="#连接控制" class="headerlink" title="连接控制"></a>连接控制</h3><h4 id="特性说明-2"><a href="#特性说明-2" class="headerlink" title="特性说明"></a>特性说明</h4><ul><li><p>功能说明</p><ul><li>Dubbo 的连接控制参数大致可以分为两类：<ul><li>服务提供方的连接控制：<code>accepts</code>、<code>lazy</code>；</li><li>服务消费方的连接控制：<code>connections</code>、<code>sticky</code>。</li></ul></li><li>Dubbo 的连接控制功能可以使用户能够控制和管理进出服务器连接数，限制连接数并设置超时，以确保 Dubbo 系统的稳定性和性能。</li><li>Dubbo 还允许用户根据 IP 地址、端口和协议配置不同级别的访问控制，保护系统免受恶意流量的影响，并降低服务中断的风险，此外提供了一种监视当前流量和连接状态的方法。</li></ul></li><li><p>使用场景</p><ul><li>服务器过载时减少连接数：当服务器负载过高时，可通过设置 Dubbo 的最大连接数限制，减少连接数，从而降低服务器压力，避免因过载导致的崩溃。</li><li>减少服务器受到攻击时的连接数：Dubbo 可限制服务器的最大连接数，防止恶意客户端建立过多连接，占满服务器资源，保障服务可用性。</li><li>限制特定服务的连接数：可针对不同服务设置连接数上限，防止单个服务被大量请求占用资源，确保系统整体响应能力。</li><li>限制来自单个 IP 地址的连接数：Dubbo 支持限制来自单个 IP 地址的连接数，有助于防止单个 IP 地址的恶意访问或异常流量攻击。</li></ul></li></ul><h4 id="配置参数-2"><a href="#配置参数-2" class="headerlink" title="配置参数"></a>配置参数</h4><p>Dubbo 为连接控制提供了 <code>accepts</code>、<code>connections</code>、<code>sticky</code>、<code>lazy</code> 配置参数，具体介绍如下表所示：</p><table><thead><tr><th>参数名</th><th>默认值</th><th>默认值的说明</th><th>作用</th><th>适用场景</th><th>注意事项</th></tr></thead><tbody><tr><td><code>accepts</code></td><td><code>0</code></td><td>表示默认不限制 Provider 端（JVM 进程级别）的连接数。</td><td>限制 Provider（JVM 进程级别）同时接受的最大连接数，超过该值的新连接将被拒绝。</td><td>- 服务端资源受限（CPU、FD 等）<br>- 防止恶意连接或瞬时高并发导致服务端过载</td><td> - 仅在 Provider 端生效；<br>- 限制的是 “连接数”，非并发请求数；<br>- 超限连接会被拒绝，客户端报连接失败。</td></tr><tr><td><code>connections</code></td><td><code>0</code></td><td>表示对于同一个 Provider JVM 实例，同一个服务接口的所有 Consumer 引用（如 <code>@DubboReference</code>）共享一个单一的长连接，不同服务接口之间的 Consumer 引用（如 <code>@DubboReference</code>）会各自独立创建一个单一的长连接。</td><td>控制 Consumer 与每个 Provider 之间的长连接数。</td><td>- 高并发调用、请求量大<br>- 希望通过多连接提高吞吐量</td><td> - 仅对长连接协议（如 Dubbo 协议）生效；<br>- 在每个 Consumer 与每个 Provider 之间生效；<br>- 设置过大会浪费连接资源，设置过小会影响吞吐量。</td></tr><tr><td><code>sticky</code></td><td><code>false</code></td><td>表示默认不启用粘滞连接。</td><td>开启粘滞连接，即同一个 Consumer 多次调用优先使用上次的 Provider 实例。</td><td>- 需要保持 “会话状态” 的业务（有状态服务）<br>- 如用户登录、缓存服务、分布式 Session</td><td>- 仅在有多个 Provider 实例，并启用了集群容错机制时才生效；<br>- 如果目标 Provider 不可用，会自动切换其他实例；<br>- 可以与负载均衡策略（如 <code>random</code>、<code>roundrobin</code>）组合使用。<br>- <strong>启用粘滞连接后，Dubbo 将会自动开启延迟连接，以减少长连接数。</strong></td></tr><tr><td><code>lazy</code></td><td><code>false</code></td><td>表示默认不启用延迟连接，即 Consumer 在启动时会立即与所有 Provider 建立长连接。</td><td>控制 Consumer 是否延迟创建与 Provider 的连接，直到第一次方法调用时才建立连接。</td><td>- 服务依赖关系复杂，启动时连接数过多<br>- 希望加快应用启动速度<br>- 部分服务调用频率较低</td><td> - <strong>仅对长连接协议（比如 Dubbo 协议）生效</strong>；<br>- 设置为 <code>true</code> 可减少应用启动时的连接数，加快启动速度；<br>- 启用延迟连接后，首次调用会有建立连接的延迟；<br>- <strong>启用粘滞连接后，Dubbo 将会自动开启延迟连接，以减少长连接数。</strong><br>- 对于高频调用的服务，建议保持 <code>false</code> 以避免首次调用时建立连接的开销。</td></tr></tbody></table><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>Dubbo 的连接控制参数 <code>sticky</code> 必须配置在服务消费者中，不支持配置在服务提供者中。</li><li>Dubbo 的连接控制参数 <code>accepts</code>、<code>lazy</code> 都必须配置在服务提供者中，不支持配置在服务消费者中。</li><li><strong>Dubbo 的连接控制参数 <code>connections</code> 可以配置在服务消费者或者服务提供者中，如果两者都配置了 <code>connections</code> 参数，那么服务消费者的配置更优先。</strong></li><li><strong><code>connections</code> 的默认值为 <code>0</code>，表示对于同一个 Provider JVM 实例，同一个服务接口的所有 Consumer 引用（如 <code>@DubboReference</code>）共享一个单一的长连接，不同服务接口之间的 Consumer 引用（如 <code>@DubboReference</code>）会各自独立创建一个单一的长连接。</strong></li></ul></div><h4 id="注意事项-1"><a href="#注意事项-1" class="headerlink" title="注意事项"></a>注意事项</h4><blockquote><p>使用 connections 配置参数的注意事项</p></blockquote><ul><li><p>连接池隔离机制</p><ul><li>Dubbo 的 TCP 连接池是按服务接口维度进行隔离的，其唯一标识是 <code>serviceKey</code>（组成公式：<code>serviceKey = interface + version + group + protocol</code>），而不是按 Provider JVM 实例来隔离。</li><li>对于每一个不同的 <code>serviceKey</code>，Consumer 端都会创建一个独立的客户端实例（如 NettyClient）来管理其连接，每个客户端实例会维护一个到对端服务提供者（Provider）的独立连接池。</li><li>即使两个服务接口由同一个 Provider 服务器提供，在 Consumer 端也会被视为两个不同的逻辑服务，并建立两套物理连接。</li><li>这样做的好处是不同接口可以独立配置连接数、超时等参数，避免接口间相互干扰，例如一个接口阻塞不会影响其他接口。</li></ul></li><li><p>连接池与物理连接的关系</p><ul><li>每个 <code>serviceKey</code> 对应的客户端实例（如 NettyClient）都会独立维护一个到对端 Provider 的连接池。</li><li>在默认配置 (<code>connections = 0</code>) 下，每个 <code>serviceKey</code> 的连接池内与同一个 Provider 地址之间会建立一条物理 TCP 长连接。</li></ul></li><li><p>配置的作用域与影响</p><ul><li><code>connections</code> 参数的作用范围是每个 <code>serviceKey</code> 到单个 Provider 地址。因此，即使是同一个 Provider 实例，其不同服务接口（不同 <code>serviceKey</code>）也不会共享 <code>connections</code> 配置所限定的连接。</li><li>举个例子：如果一个 Provider 暴露了 50 个接口，并且在 Consumer 引用（<code>@DubboReference</code>）中为每个服务接口都配置了 <code>connections = 1</code>，那么 Consumer 与这个 Provider 实例之间将建立 50 条物理 TCP 连接。</li></ul></li><li><p>潜在风险与配置建议</p><ul><li>这种设计带来了配置独立性和故障隔离的好处，但也意味着物理连接数会随着引用接口数量的增加而线性增长。</li><li>如果需要配置 <code>connections</code> 参数，建议配置 <code>connections = 2 ~ 4</code>，这样可以分散流量，避免单连接成为性能瓶颈。</li><li>如果为大量接口配置 <code>connections &gt; 1</code>，或者在高接口数的应用中，会快速消耗 Consumer 和 Provider 双方的系统资源（如文件描述符、内存、线程等），需要在高并发或大规模微服务架构中格外关注。</li></ul></li></ul><blockquote><p>使用 sticky 配置参数的注意事项</p></blockquote><ul><li>粘滞连接通常用于有状态服务（比如用户登录、缓存服务等），尽可能让 Consumer 总是向同一个 Provider 发起远程调用，除非该 Provider 宕机，再切换到另一个 Provider。</li><li>当启用粘滞连接时（<code>sticky = true</code>），Dubbo 将会自动开启延迟连接（<code>lazy = true</code>），以减少长连接数。</li></ul><blockquote><p>使用 lazy 配置参数的注意事项</p></blockquote><ul><li><code>lazy</code> 参数仅对长连接协议（比如 Dubbo 协议）生效；</li><li>启用延迟连接后，首次发起远程调用时会有建立连接的延迟；</li><li>因为连接在 Server 上，所以 <code>lazy</code> 参数配置在服务提供者（Provider）中；</li><li>当启用粘滞连接时（<code>sticky = true</code>），Dubbo 将会自动开启延迟连接（<code>lazy = true</code>），以减少长连接数。</li></ul><h4 id="提供方的连接控制"><a href="#提供方的连接控制" class="headerlink" title="提供方的连接控制"></a>提供方的连接控制</h4><h5 id="YML-配置方式-1"><a href="#YML-配置方式-1" class="headerlink" title="YML 配置方式"></a>YML 配置方式</h5><blockquote><p>accepts 的配置</p></blockquote><ul><li>在服务提供者中，限制服务提供者接受的连接不能超过 10 个</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Provider 端的全局配置</span></span><br><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">provider:</span></span><br><span class="line">    <span class="attr">accepts:</span> <span class="number">10</span>   <span class="comment"># 限制 Provider 端最多接受的连接数</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 或者在 Provider 的协议中配置</span></span><br><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">protocol:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">20880</span></span><br><span class="line">    <span class="attr">accepts:</span> <span class="number">10</span>   <span class="comment"># 限制使用该协议的 Provider 端最多接受的连接数</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>lazy（延迟连接）的配置</p></blockquote><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 Provider 的协议中配置</span></span><br><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">protocol:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">20880</span></span><br><span class="line">    <span class="attr">lazy:</span> <span class="literal">true</span>    <span class="comment"># 让使用该协议的 Provider 端启用延迟连接</span></span><br></pre></td></tr></tbody></table></figure><h5 id="XML-配置方式-2"><a href="#XML-配置方式-2" class="headerlink" title="XML 配置方式"></a>XML 配置方式</h5><blockquote><p>accepts 的配置</p></blockquote><ul><li>在服务提供者中，限制服务提供者接受的连接不能超过 10 个</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 限制 Provider 端最多接受的连接数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">protocol</span>=<span class="string">"dubbo"</span> <span class="attr">accepts</span>=<span class="string">"10"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 或者，在协议中配置，限制使用该协议的 Provider 端最多接受的连接数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">port</span>=<span class="string">"20880"</span> <span class="attr">accepts</span>=<span class="string">"10"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>lazy（延迟连接）的配置</p></blockquote><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在 Provider 的协议中配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">port</span>=<span class="string">"20880"</span> <span class="attr">lazy</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure><h4 id="消费方的连接控制"><a href="#消费方的连接控制" class="headerlink" title="消费方的连接控制"></a>消费方的连接控制</h4><h5 id="注解配置方式-1"><a href="#注解配置方式-1" class="headerlink" title="注解配置方式"></a>注解配置方式</h5><blockquote><p>connections 的配置</p></blockquote><ul><li>在服务消费者（或者服务提供者）中，限制服务消费者建立的连接不能超过 10 个</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在服务消费者中配置</span></span><br><span class="line"><span class="meta">@DubboReference(connections = 10)</span></span><br><span class="line"><span class="keyword">private</span> BarService barService;</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 或者，在服务提供者中配置</span></span><br><span class="line"><span class="meta">@DubboService(connections = 10)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BarServiceImpl</span> <span class="keyword">implements</span> <span class="title">BarService</span> </span>{ }</span><br></pre></td></tr></tbody></table></figure><blockquote><p>sticky（粘滞连接）的配置</p></blockquote><ul><li>在服务消费者中，开启粘滞连接</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在服务消费者配置</span></span><br><span class="line"><span class="meta">@DubboReference(sticky = true)</span></span><br><span class="line"><span class="keyword">private</span> BarService barService;</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 或者，在服务消费者的方法上配置</span></span><br><span class="line"><span class="meta">@DubboReference(methods = {@Method(name = "sayHello", sticky = true)})</span></span><br><span class="line"><span class="keyword">private</span> BarService barService;</span><br></pre></td></tr></tbody></table></figure><h5 id="XML-配置方式-3"><a href="#XML-配置方式-3" class="headerlink" title="XML 配置方式"></a>XML 配置方式</h5><blockquote><p>connections 的配置</p></blockquote><ul><li>在服务消费者（或者服务提供者）中，限制服务消费者建立的连接不能超过 10 个</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在服务消费者中配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"barService"</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">connections</span>=<span class="string">"10"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 服务实现类 Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"barServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.foo.impl.BarServiceImpl"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 或者，在服务提供者中配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">ref</span>=<span class="string">"barServiceImpl"</span> <span class="attr">connections</span>=<span class="string">"10"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>sticky（粘滞连接）的配置</p></blockquote><ul><li>在服务消费者中，开启粘滞连接</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在服务消费者中配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"barService"</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">sticky</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 或者，在服务消费者的方法上配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"barService"</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"sayHello"</span> <span class="attr">sticky</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/more/">Dubbo 官方文档 - 更多特性</a></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/b66ba452.html" title="Dubbo 2 入门教程之四">https://www.techgrow.cn/posts/b66ba452.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag"><i class="fa fa-tag"></i> 微服务</a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a><a href="/tags/RPC/" rel="tag"><i class="fa fa-tag"></i> RPC</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/42b280ec.html" rel="prev" title="HTML 开发随笔"><i class="fa fa-angle-left"></i> HTML 开发随笔</a></div><div class="post-nav-item"> <a href="/posts/c5f15a9c.html" rel="next" title="MyBatis-Plus 入门教程之五">MyBatis-Plus 入门教程之五<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2.1m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">31:29</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/b66ba452.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>