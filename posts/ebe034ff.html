<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍开源和商业的分布式数据库，原生支持数据分片、强一致分布式事务等特性。"><meta property="og:type" content="article"><meta property="og:title" content="分布式数据库技术选型介绍"><meta property="og:url" content="https://www.techgrow.cn/posts/ebe034ff.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍开源和商业的分布式数据库，原生支持数据分片、强一致分布式事务等特性。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2022-12-26T13:30:00.000Z"><meta property="article:modified_time" content="2025-09-28T13:30:00.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="微服务"><meta property="article:tag" content="数据库"><meta property="article:tag" content="分布式"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.techgrow.cn/posts/ebe034ff.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/ebe034ff.html","path":"posts/ebe034ff.html","title":"分布式数据库技术选型介绍"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>分布式数据库技术选型介绍 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script>
  (function () {

  // 防止 Pjax 重复绑定事件
  if (window.__moonMenuCodeExpandBound) {
    return;
  }
  window.__moonMenuCodeExpandBound = true;

  const STORAGE_KEY = 'moon_menu_code_fold';

  /* ===============================
   * 1. 设置 moon-menu 按钮的 title
   * =============================== */
  (function bindMoonMenuTitles() {
    const items = [
      { selector: '#moon-menu-item-code',        title: '展开 / 折叠代码块' },
      { selector: '#moon-menu-item-back2top',    title: '回到页面顶部' },
      { selector: '#moon-menu-item-back2bottom', title: '回到页面底部' }
    ];

    let allReady = true;

    items.forEach(item => {
      const el = document.querySelector(item.selector);
      if (!el) {
        allReady = false;
        return;
      }
      el.setAttribute('title', item.title);
    });

    if (!allReady) {
      setTimeout(bindMoonMenuTitles, 100);
    }
  })();

  /* =================================
   * 2. 页面首次加载：代码块恢复展开或折叠状态
   * ================================= */
  function applyStoredCodeState() {
    const containers = document.querySelectorAll('.code-container');
    if (!containers.length) {
      return;
    }

    const state = localStorage.getItem(STORAGE_KEY);
    if (!state) {
      return;
    }

    containers.forEach(container => {
      if (state === 'expanded') {
        // 展开代码块
        container.classList.remove('highlight-fold');
      } else if (state === 'folded') {
        // 折叠代码块
        container.classList.add('highlight-fold');
      }
    });
  }

  // 等代码块出现后，再恢复展开或折叠状态
  function waitAndApplyState() {
    const containers = document.querySelectorAll('.code-container');

    if (!containers.length) {
      setTimeout(waitAndApplyState, 100);
      return;
    }

    applyStoredCodeState();
  }

  // 页面首次加载时恢复状态
  waitAndApplyState();
  
  // Pjax 切换页面后，必须重新恢复状态
  document.addEventListener('pjax:complete', function () {
    waitAndApplyState();
  });

  /* ===============================
   * 3. 点击按钮：切换状态并保存
   * =============================== */
  document.addEventListener('click', function (e) {
    const codeMenu = e.target.closest('#moon-menu-item-code');
    if (!codeMenu) {
      return;
    }

    toggleAllCodeBlocks();
  });

  // 展开或折叠代码块
  function toggleAllCodeBlocks() {
    const containers = document.querySelectorAll('.code-container');
    if (!containers.length) {
      return;
    }

    // 只要存在折叠的代码块，就认为当前是折叠状态
    const hasFolded = Array.from(containers).some(c => {
      return c.classList.contains('highlight-fold');
    });

    containers.forEach(container => {
      if (hasFolded) {
        // 展开代码块
        container.classList.remove('highlight-fold');
      } else {
        // 折叠代码块
        container.classList.add('highlight-fold');
      }
    });

    // 记录展开或折叠状态
    localStorage.setItem(
      STORAGE_KEY,
      hasFolded ? 'expanded' : 'folded'
    );
  }

})();
</script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%B9%E6%98%93%E6%B7%B7%E6%B7%86%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E7%89%87%E6%A6%82%E5%BF%B5"><span class="nav-text">容易混淆的数据库分片概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OldSQL%E3%80%81NewSQL%E3%80%81NoSQL"><span class="nav-text">OldSQL、NewSQL、NoSQL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#OldSQL-%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-text">OldSQL 的概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NewSQL-%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-text">NewSQL 的概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NoSQL-%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-text">NoSQL 的概念</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E6%BA%90%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88OldSQL%EF%BC%89"><span class="nav-text">开源关系型数据库（OldSQL）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#OpenGauss"><span class="nav-text">OpenGauss</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E5%B1%95%E5%8E%86%E5%8F%B2"><span class="nav-text">发展历史</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BD%A2%E6%80%81%E5%88%92%E5%88%86"><span class="nav-text">形态划分</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5"><span class="nav-text">设计理念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="nav-text">核心特性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">适用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E6%BA%90%E7%94%9F%E6%80%81"><span class="nav-text">开源生态</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E6%BA%90%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88NewSQL%EF%BC%89"><span class="nav-text">开源分布式数据库（NewSQL）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TiDB"><span class="nav-text">TiDB</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E5%B1%95%E5%8E%86%E5%8F%B2-1"><span class="nav-text">发展历史</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5-1"><span class="nav-text">设计理念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-1"><span class="nav-text">核心特性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF-1"><span class="nav-text">适用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E6%BA%90%E7%94%9F%E6%80%81-1"><span class="nav-text">开源生态</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OceanBase"><span class="nav-text">OceanBase</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E5%B1%95%E5%8E%86%E5%8F%B2-2"><span class="nav-text">发展历史</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5-2"><span class="nav-text">设计理念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-2"><span class="nav-text">核心特性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF-2"><span class="nav-text">适用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E6%BA%90%E7%94%9F%E6%80%81-2"><span class="nav-text">开源生态</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CockroachDB"><span class="nav-text">CockroachDB</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E5%B1%95%E5%8E%86%E5%8F%B2-3"><span class="nav-text">发展历史</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5-3"><span class="nav-text">设计理念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7-3"><span class="nav-text">核心特性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%95%86%E4%B8%9A%E9%99%90%E5%88%B6"><span class="nav-text">商业限制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF-3"><span class="nav-text">适用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E6%BA%90%E7%94%9F%E6%80%81-3"><span class="nav-text">开源生态</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%95%86%E4%B8%9A%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88NewSQL%EF%BC%89"><span class="nav-text">商业分布式数据库（NewSQL）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Google-Spanner"><span class="nav-text">Google Spanner</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">792</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">55</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/ebe034ff.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="分布式数据库技术选型介绍 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍开源和商业的分布式数据库，原生支持数据分片、强一致分布式事务等特性。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 分布式数据库技术选型介绍</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-12-26 21:30:00" itemprop="dateCreated datePublished" datetime="2022-12-26T21:30:00+08:00">2022-12-26</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-09-28 21:30:00" itemprop="dateModified" datetime="2025-09-28T21:30:00+08:00">2025-09-28</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/ebe034ff.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/ebe034ff.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>8.2k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>7 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="容易混淆的数据库分片概念"><a href="#容易混淆的数据库分片概念" class="headerlink" title="容易混淆的数据库分片概念"></a>容易混淆的数据库分片概念</h3><ul><li>传统数据库的分片（分库分表）<ul><li>应用层或中间件负责，属于逻辑分片</li><li>典型代表：<ul><li>MyCat</li><li>ShardingSphere</li></ul></li><li> 特点：<ul><li>用户要自己定义路由规则</li><li> SQL 有限制</li><li>跨分片 Join / 事务复杂</li></ul></li></ul></li></ul><span id="more"></span><ul><li>原生分布式数据库的分片<ul><li>数据库内核自动完成分片，属于物理分片（透明分片）</li><li>对用户：<ul><li>看起来像一张普通表</li></ul></li><li>实际上：<ul><li>数据自动拆分</li><li>自动副本</li><li>自动迁移</li></ul></li></ul></li></ul><h3 id="OldSQL、NewSQL、NoSQL"><a href="#OldSQL、NewSQL、NoSQL" class="headerlink" title="OldSQL、NewSQL、NoSQL"></a>OldSQL、NewSQL、NoSQL</h3><ul><li><p>OldSQL：</p><ul><li>单机时代的关系数据库王者，强一致事务，但难以扩展</li><li>典型产品：MySQL、PostgreSQL、Oracle、OpenGauss</li></ul></li><li><p>NewSQL：</p><ul><li>在分布式时代，重新把 SQL 与 ACID 事务带回来</li><li>典型产品：TiDB、OceanBase、CockroachDB</li></ul></li><li><p>NoSQL：</p><ul><li>为扩展而生，牺牲关系模型与强一致事务，追求极致性能</li><li>典型产品：MongoDB、HBase、Cassandra、InfluxDB、Elasticsearch</li></ul></li></ul><table><thead><tr><th> 能力</th><th> OldSQL</th><th>NewSQL</th><th>NoSQL</th></tr></thead><tbody><tr><td> 关系模型支持</td><td>✅</td><td>✅</td><td>❌</td></tr><tr><td>SQL 完整支持</td><td>✅</td><td>✅</td><td>❌</td></tr><tr><td>ACID 事务支持</td><td>✅</td><td>✅</td><td>❌</td></tr><tr><td>水平扩展支持</td><td>❌</td><td>✅</td><td>✅</td></tr><tr><td>分布式支持</td><td>❌</td><td>✅</td><td>✅</td></tr></tbody></table><h4 id="OldSQL-的概念"><a href="#OldSQL-的概念" class="headerlink" title="OldSQL 的概念"></a>OldSQL 的概念</h4><p>OldSQL 通常指传统的单机或以主从为主的关系型数据库（比如 MySQL、PostgreSQL 等），是关系数据库理论最完整、最成熟的一类。简而言之，OldSQL 是指传统的关系型数据库。</p><ul><li><p>核心特征：</p><ul><li>单机性能强</li><li>采用严格的关系模型（表、行、列）</li><li>支持完整 SQL 语义</li><li>支持强 ACID 事务</li><li>拥有成熟的优化器与索引体系</li></ul></li><li><p>架构特点：</p><ul><li>以单机架构为核心</li><li>高可用实现方式：<ul><li>主从复制</li><li>读写分离</li></ul></li><li>扩展方式主要是：<ul><li>纵向扩展（Scale Up）</li><li>或业务层分库分表</li></ul></li></ul></li><li><p>代表产品：</p><ul><li>MySQL</li><li>PostgreSQL</li><li>Oracle</li><li>SQL Server</li></ul></li><li><p> 适用场景：</p><ul><li>中小规模业务系统</li><li>单机可承载的 OLTP 系统</li><li>对事务一致性要求极高、但数据规模可控的场景</li></ul></li><li><p>使用局限性：</p><ul><li>OldSQL 在单机能力上非常强，但天然不擅长水平扩展（横向扩展）</li><li>一旦数据与并发规模上来，往往需要引入复杂的分库分表方案</li></ul></li></ul><h4 id="NewSQL-的概念"><a href="#NewSQL-的概念" class="headerlink" title="NewSQL 的概念"></a>NewSQL 的概念</h4><p>NewSQL 是对 OldSQL 与 NoSQL 的一次 “融合式进化”，在不牺牲关系模型、SQL 完整、强一致事务的前提下，用分布式架构解决传统数据库的扩展性问题。简而言之，NewSQL 是原生分布式关系型数据库。</p><ul><li><p>核心特征：</p><ul><li>采用关系模型（表、行、列）</li><li>支持完整 SQL</li><li> 支持强一致事务</li><li>支持原生分布式架构</li><li>支持自动分片</li><li>支持在线扩缩容</li><li>支持高可用、多副本</li></ul></li><li><p>架构特点：</p><ul><li>计算与存储解耦（常见）</li><li>底层多为分布式 KV</li><li> 采用共识协议（Raft / Paxos）</li><li>支持全局事务协调（2PC + TSO）</li></ul></li><li><p>代表产品</p><ul><li>TiDB</li><li>OceanBase</li><li>CockroachDB</li><li>Google Spanner</li></ul></li><li><p> 适用场景</p><ul><li>大规模 OLTP 系统</li><li>金融、订单、交易系统</li><li>希望 “像用单机数据库一样使用分布式数据库” 的业务</li></ul></li></ul><h4 id="NoSQL-的概念"><a href="#NoSQL-的概念" class="headerlink" title="NoSQL 的概念"></a>NoSQL 的概念</h4><p>NoSQL 并不是 “不需要 SQL”，而是不再坚持关系模型与强一致事务，以换取极致的扩展性和性能。简而言之，NoSQL 是指非关系型数据库。</p><ul><li><p>核心特征：</p><ul><li>多采用最终一致性</li><li>通常不支持复杂 Join</li><li>Schema 弱或无 Schema</li><li> 采用非关系模型（NoSQL），存储类型包括：<ul><li>键值（Key-Value）<ul><li>Redis</li><li>Memcached</li></ul></li><li> 文档（Document）<ul><li>MongoDB</li><li>CouchDB</li></ul></li><li> 列族 / 宽列（Column-Family / Wide-Column）<ul><li>HBase</li><li>Cassandra</li></ul></li><li> 时序（Time-Series）<ul><li>InfluxDB</li><li>Prometheus TSDB</li></ul></li><li> 图（Graph）<ul><li>Neo4j</li><li>JanusGraph</li></ul></li><li> 对象（Object）<ul><li>Ceph</li></ul></li><li> 搜索 / 倒排索引（Search / Inverted Index）<ul><li>Elasticsearch</li><li>OpenSearch</li></ul></li></ul></li></ul></li><li><p> 架构特点：</p><ul><li>天生分布式</li><li>水平扩展简单</li><li>高吞吐、高并发</li><li>数据模型贴近存储</li></ul></li><li><p>适用场景：</p><ul><li>缓存系统</li><li>会话存储</li><li>日志、时序数据</li><li>海量数据写入、简单查询场景</li></ul></li><li><p>使用局限性：</p><ul><li>弱事务 / 最终一致性</li><li> SQL 支持不完整</li><li> Join 基本不可用</li></ul></li></ul><h2 id="开源关系型数据库（OldSQL）"><a href="#开源关系型数据库（OldSQL）" class="headerlink" title="开源关系型数据库（OldSQL）"></a>开源关系型数据库（OldSQL）</h2><h3 id="OpenGauss"><a href="#OpenGauss" class="headerlink" title="OpenGauss"></a>OpenGauss</h3><p>OpenGauss 是一款 以 PostgreSQL 为基础开发的传统关系型数据库（基于 C++ 开发），属于 OldSQL；由华为主导开源，主要定位于单机 / 主备高可用场景。特别注意的是：OpenGauss 本身并非原生分布式关系型数据库，其分布式能力依赖特定形态，必须加以区分。</p><h4 id="发展历史"><a href="#发展历史" class="headerlink" title="发展历史"></a>发展历史</h4><ul><li>2019 年<ul><li>华为在 PostgreSQL 基础上启动 OpenGauss 项目</li></ul></li><li> 2020 年<ul><li> OpenGauss 正式开源</li></ul></li><li> 2021 年<ul><li> OpenGauss 社区独立运作</li></ul></li><li> 2022 ~ 至今<ul><li>在政企、国产化数据库替代场景中广泛应用</li><li>重点发展方向仍以 “单机性能 + 高可用” 为主</li></ul></li></ul><h4 id="形态划分"><a href="#形态划分" class="headerlink" title="形态划分"></a>形态划分</h4><p>OpenGauss 必须区分两种形态，否则很容易产生误解。</p><ul><li>OpenGauss 单机 / 主备形态<ul><li>这是 OpenGauss 的主流、官方推荐使用形态</li><li>架构特征：<ul><li>单机数据库</li><li>支持主备复制</li><li>支持读写分离（有限支持）</li></ul></li><li>能力特点：<ul><li>标准关系模型</li><li>完整 SQL</li><li> 强 ACID 事务</li><li>不支持自动分片</li><li>不支持原生水平扩展</li></ul></li><li>本质上：OpenGauss（单机版）≈ PostgreSQL + 企业级增强</li></ul></li><li> OpenGauss 分布式组合形态<ul><li> OpenGauss 可以通过 “外部组件” 实现分布式能力</li><li>常见组合方式：<ul><li>OpenGauss + ShardingSphere</li><li>OpenGauss + DCF（分布式一致性框架）</li></ul></li><li>分片方式：<ul><li>逻辑分片</li><li>显式路由规则</li><li>由中间层或协调层完成</li></ul></li><li>特点总结：<ul><li>业务需要理解分片规则</li><li> SQL 能力受限于中间件</li><li>跨分片事务复杂</li></ul></li><li>本质上更接近：” 分库分表中间件 + SQL 引擎” 方案</li><li> OpenGauss 与 OceanBase / TiDB 的关键区别在于：分片不是数据库内核能力，而是外置实现</li></ul></li></ul><h4 id="设计理念"><a href="#设计理念" class="headerlink" title="设计理念"></a>设计理念</h4><ul><li><p>核心设计理念（单机 / 主备形态）：</p><ul><li>强调：<ul><li>单机性能</li><li>企业级稳定性</li><li>国产化替代</li></ul></li><li>数据模型：<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">order</span> <span class="keyword">WHERE</span> order_id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></tbody></table></figure><ul><li>查询的是一张物理表</li><li>不涉及自动分片或跨节点路由</li></ul></li></ul></li><li><p>核心设计理念（分布式组合形态）：</p><ul><li>分布式能力并非对业务透明</li><li>由外部组件实现分布式能力：<ul><li>ShardingSphere</li><li> 或其他中间件</li></ul></li><li>分片规则：<ul><li>显式分片</li><li>显式路由</li><li>显式架构设计</li></ul></li><li> OpenGauss 的分布式能力主要依赖外部组合方案，并非数据库内核原生实现，这与 OceanBase / TiDB 原生分布式关系型数据库有本质区别</li><li>从架构理念上看，OpenGauss 更接近 MySQL + ShardingSphere 这类 “分库分表中间件 + SQL 引擎” 模式，与 OceanBase / TiDB 的原生分布式 NewSQL 并不在同一技术层级</li></ul></li></ul><h4 id="核心特性"><a href="#核心特性" class="headerlink" title="核心特性"></a>核心特性</h4><ul><li><p>核心特性（以单机形态为主）：</p><ul><li>架构层面<ul><li>单机 / 主备架构</li><li>非原生分布式</li></ul></li><li>数据与事务<ul><li>强一致事务</li><li>行级锁 + MVCC</li></ul></li><li>SQL 与兼容性<ul><li> PostgreSQL 语法体系</li><li>丰富的企业级 SQL 特性</li></ul></li><li>运维能力<ul><li>主备切换</li><li>高可用部署</li><li>运维模型成熟</li></ul></li><li>分布式能力（组合式方案）：<ul><li>依赖外部组件</li><li>非数据库内核原生能力</li><li>复杂度与侵入性较高</li></ul></li></ul></li><li><p>事务能力</p><ul><li><p>单机 / 主备形态：</p><ul><li>标准 ACID 事务</li><li>本地事务</li><li>成熟稳定</li></ul></li><li><p>分布式组合形态：</p><ul><li><p>跨分片事务依赖中间件</p></li><li><p>一致性与性能受限于：</p><ul><li>路由策略</li><li>两阶段提交</li><li>中间件实现</li></ul></li></ul></li><li><p>对比说明：OpenGauss 的事务优势在单机强一致性，而非分布式事务能力</p></li></ul></li><li><p>对比「原生分布式数据库」</p><table><thead><tr><th>对比项</th><th> OpenGauss（单机 / 组合式）</th><th>OceanBase</th></tr></thead><tbody><tr><td> 分布式形态</td><td>外置 / 组合</td><td>原生内核实现</td></tr><tr><td>分片规则</td><td>显式定义</td><td>系统自动</td></tr><tr><td> SQL 能力</td><td>完整 SQL / 有限制（受中间件影响）</td><td>完整 SQL</td></tr><tr><td> 分布式事务</td><td>依赖中间件</td><td>原生支持</td></tr><tr><td>业务侵入</td><td>中 / 高</td><td>低</td></tr></tbody></table></li></ul><h4 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h4><ul><li><p>非常适合：</p><ul><li>国产化数据库替代</li><li>政企系统</li><li>单机或中等规模 OLTP 系统</li><li>对 PostgreSQL 生态依赖较强的系统</li></ul></li><li><p>不太适合：</p><ul><li>超大规模水平扩展系统</li><li>希望 “完全不感知分布式” 的业务</li><li>金融级分布式核心账务系统</li></ul></li></ul><h4 id="开源生态"><a href="#开源生态" class="headerlink" title="开源生态"></a>开源生态</h4><ul><li><p>GitHub 开源项目：</p><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/opengauss-mirror/openGauss-server">OpenGauss Server</a></li></ul></li><li><p> 开源社区生态：</p><ul><li>OpenGauss 社区版（免费）</li><li>政企国产化生态完善</li></ul></li></ul><h2 id="开源分布式数据库（NewSQL）"><a href="#开源分布式数据库（NewSQL）" class="headerlink" title="开源分布式数据库（NewSQL）"></a>开源分布式数据库（NewSQL）</h2><h3 id="TiDB"><a href="#TiDB" class="headerlink" title="TiDB"></a>TiDB</h3><p>TiDB 是一款分布式关系型数据库（基于 Go、Rust 开发），属于 NewSQL，兼容 MySQL 协议，支持水平扩展与强一致分布式事务。对外提供完整 SQL 和事务能力，对内采用分布式 KV 架构实现水平扩展。它对分片整体透明，但明确暴露 Region（分片）这一核心概念，是目前分片模型最清晰的分布式数据库之一。</p><h4 id="发展历史-1"><a href="#发展历史-1" class="headerlink" title="发展历史"></a>发展历史</h4><ul><li>2015 年<ul><li> PingCAP 团队启动 TiDB 项目</li></ul></li><li> 2016 年<ul><li> TiDB 正式开源</li></ul></li><li> 2018 年<ul><li>在国内互联网公司开始规模化落地</li></ul></li><li> 2020 年<ul><li>金融、运营商、政企开始使用 TiDB</li></ul></li><li>2022 ~ 至今<ul><li>成为国内最活跃的开源 NewSQL 数据库之一</li><li>社区活跃度与生态成熟度持续提升</li></ul></li></ul><h4 id="设计理念-1"><a href="#设计理念-1" class="headerlink" title="设计理念"></a>设计理念</h4><ul><li><p>核心设计理念：</p><ul><li>对业务层面基本透明，但分片概念清晰可感知</li><li>业务看到的是逻辑表：<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">order</span> <span class="keyword">WHERE</span> order_id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></tbody></table></figure></li><li>实际底层：<ul><li>表数据被拆分为多个 Region</li><li>Region 分布在不同 TiKV 节点</li><li>多副本存储</li><li>由调度系统自动均衡</li></ul></li></ul></li><li><p>核心数据模型：</p><ul><li>Region（分片）：<ul><li>TiDB 的最小数据分片单位</li><li> Region 的默认大小：<ul><li>约 96MB（可动态调整）</li></ul></li><li>Region 的职责：<ul><li>数据分布的基本单位</li><li>副本复制与调度的基本单位</li></ul></li><li> Region 自动管理机制：<ul><li>Region Split<ul><li> 数据增长后自动拆分</li></ul></li><li> Region Merge<ul><li> 数据减少后自动合并</li></ul></li><li>自动调度到不同节点（TiKV）</li></ul></li><li>用户可感知但不强制参与分片：<ul><li>用户默认可以完全不关心 Region</li><li> 也可以：<ul><li>通过 SQL Hint</li><li> 通过表结构设计</li><li>间接影响 Region 分布</li></ul></li></ul></li></ul></li></ul></li><li><p>核心架构组成</p><ul><li>TiDB Server<ul><li>SQL 解析与优化</li><li>无状态，可水平扩展</li></ul></li><li> TiKV<ul><li> 分布式 KV 存储</li><li>承载 Region 数据</li></ul></li><li> PD（Placement Driver）<ul><li>元数据管理</li><li> Region 调度</li><li>副本管理</li><li>负载均衡</li></ul></li><li> TiDB 是典型的计算与存储分离架构</li></ul></li></ul><h4 id="核心特性-1"><a href="#核心特性-1" class="headerlink" title="核心特性"></a>核心特性</h4><ul><li><p>核心特性：</p><ul><li>架构层面<ul><li>原生分布式</li><li>计算与存储分离</li><li> Shared-Nothing 架构</li><li>高可用、多副本</li></ul></li><li>数据与事务<ul><li>基于 Region 的自动分片</li><li>支持强一致分布式事务</li><li>支持 MVCC + 行级锁</li></ul></li><li> SQL 与兼容性<ul><li> MySQL 协议兼容</li><li>大部分 MySQL 语法与生态可用</li></ul></li><li>调度与运维<ul><li>自动 Region 调度</li><li>在线扩缩容</li><li>自动副本补齐与迁移</li></ul></li></ul></li><li><p>事务特性：</p><ul><li>支持分布式事务<ul><li>跨 Region 事务</li><li>跨 Region Join</li><li> 默认提供快照隔离（SI）</li><li>在特定配置下支持更强一致级别</li></ul></li><li>实现方式（简化理解）：<ul><li>Percolator 事务模型</li><li>两阶段提交（2PC）</li><li>PD 提供全局时间戳（TSO）</li><li>Raft 协议保证副本一致性</li></ul></li><li>对比说明：<ul><li>TiDB 的事务模型在一致性与性能之间做了工程化平衡，更适用于互联网高并发 OLTP 场景</li></ul></li></ul></li><li><p>对比「分库分表 + 中间件」</p><table><thead><tr><th>对比项</th><th> TiDB</th><th> 分库分表 + 中间件（如 MyCat、ShardingSphere）</th></tr></thead><tbody><tr><td>分片模型</td><td> Region（系统自动）</td><td>业务自定义分片规则</td></tr><tr><td>分片可见性</td><td>可感知但非强制</td><td>强制感知</td></tr><tr><td> SQL 能力</td><td>高（接近 MySQL）</td><td>有限制</td></tr><tr><td>事务</td><td>分布式事务</td><td>跨库事务复杂</td></tr><tr><td>扩缩容</td><td>在线</td><td>风险高</td></tr><tr><td>业务侵入</td><td>低</td><td>高</td></tr></tbody></table></li></ul><h4 id="适用场景-1"><a href="#适用场景-1" class="headerlink" title="适用场景"></a>适用场景</h4><ul><li><p>非常适合：</p><ul><li>互联网 OLTP 系统</li><li>订单 / 用户 / 业务系统</li><li>对 MySQL 生态依赖较重的系统</li><li>需要水平扩展、但可接受一定分布式语义的场景</li></ul></li><li><p>不一定适合：</p><ul><li>极端金融强一致核心业务</li><li>希望完全 “忘记分布式” 的业务</li><li>对单条事务延迟极其敏感的场景</li></ul></li></ul><h4 id="开源生态-1"><a href="#开源生态-1" class="headerlink" title="开源生态"></a>开源生态</h4><ul><li><p>GitHub 开源项目：</p><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/pingcap/tidb">TiDB</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/tikv/tikv">TiKV</a></li></ul></li><li><p> 开源生态组件：</p><ul><li>TiDB</li><li>TiKV</li><li>PD</li><li>TiCDC</li><li>TiFlash（HTAP）</li></ul></li></ul><h3 id="OceanBase"><a href="#OceanBase" class="headerlink" title="OceanBase"></a>OceanBase</h3><p>OceanBase 是一款原生分布式、强一致、高可用的关系型数据库（基于 C++ 开发），属于 NewSQL，兼容 MySQL 和 Oracle 协议。对用户隐藏分片细节，提供与单机数据库几乎一致的使用体验。</p><h4 id="发展历史-2"><a href="#发展历史-2" class="headerlink" title="发展历史"></a>发展历史</h4><ul><li>2010 年左右<ul><li>蚂蚁金服内部启动 OceanBase 项目</li></ul></li><li> 2014 年<ul><li>支撑支付宝核心交易系统</li></ul></li><li> 2019 年<ul><li>蚂蚁宣布 OceanBase 对外商业化</li></ul></li><li> 2021 年<ul><li>正式开源 OceanBase 社区版</li></ul></li><li> 2023 ~ 至今<ul><li>广泛应用于金融、政企、运营商、大型互联网</li><li>少有的：先在金融核心系统跑十几年，再开源的数据库</li></ul></li></ul><h4 id="设计理念-2"><a href="#设计理念-2" class="headerlink" title="设计理念"></a>设计理念</h4><ul><li><p>核心设计理念：</p><ul><li>对业务完全透明，业务看到的是一张逻辑表<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">order</span> <span class="keyword">WHERE</span> order_id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></tbody></table></figure></li><li>实际底层：<ul><li>数据已被自动拆分</li><li>分布在多个节点</li><li>有多个副本</li><li>自动迁移与负载均衡</li></ul></li><li>但这些对业务完全不可见，这与很多「分库分表 + 中间件」方案（如 MyCat、ShardingSphere）有本质区别</li></ul></li><li><p>核心数据模型：</p><ul><li>Tablet / Partition（自动分片）：<ul><li>OceanBase 会将表数据 自动拆分成多个 Tablet（分区）</li><li>Tablet 是：<ul><li>数据调度的最小单元</li><li>副本复制、迁移、均衡的基本单位</li></ul></li><li> Tablet 不是业务定义的分片规则，而是系统自动完成</li></ul></li><li>多副本 + Paxos：<ul><li>每个 Tablet 默认有 3 个副本</li><li>基于 Paxos / Multi-Paxos 协议：<ul><li>强一致性</li><li>线性一致读写</li><li>自动 Leader 选举、自动故障切换</li></ul></li></ul></li></ul></li></ul><h4 id="核心特性-2"><a href="#核心特性-2" class="headerlink" title="核心特性"></a>核心特性</h4><ul><li><p>核心特性：</p><ul><li>架构层面<ul><li>原生分布式（非单机改造）</li><li>Shared-Nothing 架构</li><li>多副本、高可用、自愈</li></ul></li><li>数据与事务<ul><li>自动分区（Tablet）</li><li>强一致分布式事务</li><li>行级锁 + MVCC</li></ul></li><li>SQL 与兼容性<ul><li>高度兼容 MySQL</li><li> 高度兼容 Oracle</li><li> 大量企业级 SQL 特性</li></ul></li><li>运维能力<ul><li>在线扩缩容（水平扩展）</li><li>自动负载均衡</li><li>自动副本修复</li><li>支持超大规模集群</li></ul></li></ul></li><li><p>事务能力：</p><ul><li>真正的强一致分布式事务，这是 OceanBase 最大的技术护城河之一。</li><li>事务特性：<ul><li>全局 ACID 事务</li><li>跨节点、跨分区事务</li><li>单 SQL、跨 SQL 都支持</li></ul></li><li>实现方式（简化理解）：<ul><li>全局时间戳服务（TSO）</li><li>两阶段提交（2PC）</li><li>Paxos 保证日志一致性</li></ul></li><li>对比很多 NewSQL / 分布式数据库：<ul><li>OceanBase 的事务能力更接近「分布式 Oracle」</li></ul></li></ul></li><li><p>对比 「分库分表 + 中间件」</p><table><thead><tr><th>对比项</th><th> OceanBase</th><th> 分库分表 + 中间件（如 MyCat、ShardingSphere）</th></tr></thead><tbody><tr><td>分片规则</td><td>系统自动</td><td>业务自己设计</td></tr><tr><td> SQL 能力</td><td>完整 SQL</td><td> 有限制</td></tr><tr><td>事务</td><td>强一致分布式事务</td><td>跨库事务实现复杂</td></tr><tr><td>运维复杂度</td><td>低</td><td>高</td></tr><tr><td>扩缩容</td><td>在线透明</td><td>高风险</td></tr><tr><td>业务侵入</td><td>无</td><td>很重</td></tr></tbody></table></li></ul><h4 id="适用场景-2"><a href="#适用场景-2" class="headerlink" title="适用场景"></a>适用场景</h4><ul><li><p>非常适合</p><ul><li>金融核心系统</li><li>订单 / 账务 / 交易系统</li><li>超大规模 OLTP</li><li> 需要强一致 + 高可用的系统</li></ul></li><li><p>不一定适合</p><ul><li>极端简单的小系统</li><li>只做 KV 存储</li><li>强依赖 NoSQL 特性的场景</li></ul></li></ul><h4 id="开源生态-2"><a href="#开源生态-2" class="headerlink" title="开源生态"></a>开源生态</h4><ul><li><p>GitHub 开源项目:</p><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/oceanbase/oceanbase">OceanBase</a></li></ul></li><li><p> 开源生态组件：</p><ul><li>OceanBase CE（社区版，免费）</li><li>OCP 运维平台（社区版，免费）</li><li>OBProxy（官方专用的代理服务器）</li><li>兼容 MySQL / Oracle 的工具链</li><li>更多组件详见 <a target="_blank" rel="external nofollow" href="https://github.com/oceanbase/tutorials-doc/blob/V4.2.1/zh-CN/100.dba-tutorial/10.overview-of-the-oceanbase-database/20.ecological-tools.md">官方文档 - OceanBase 生态工具介绍</a></li></ul></li></ul><h3 id="CockroachDB"><a href="#CockroachDB" class="headerlink" title="CockroachDB"></a>CockroachDB</h3><p>CockroachDB 是一款原生分布式、强一致、高可用的关系型数据库（基于 Go 开发），属于 NewSQL，兼容 PostgreSQL 协议。对用户隐藏分片与副本细节，提供接近单机 PostgreSQL 的使用体验，目标是 “实现像单机数据库一样使用的全球一致分布式数据库”。</p><div class="admonition note"><p class="admonition-title">提示</p><p>OceanBase 更像 "分布式的 MySQL / Oracle"，而 CockroachDB 更像 "开源版的 Spanner（Google） + PostgreSQL 体验"。</p></div><h4 id="发展历史-3"><a href="#发展历史-3" class="headerlink" title="发展历史"></a>发展历史</h4><ul><li>2014 年<ul><li>前 Google 工程师在美国创立 Cockroach Labs</li><li> 设计目标：借鉴 Spanner / Bigtable 思想，构建开源的全球一致数据库</li></ul></li><li> 2015 年<ul><li> CockroachDB 项目在 GitHub 开源</li></ul></li><li> 2017 ~ 2018 年<ul><li>分布式事务、Raft、多副本架构逐步成熟</li><li>社区与企业用户快速增长</li></ul></li><li> 2019 年<ul><li>许可证由 Apache 2.0 调整为 BSL（Business Source License）</li></ul></li><li>2021 ~ 至今<ul><li>广泛应用于金融科技、SaaS、多活系统</li><li>典型用户包括 Stripe、DoorDash、Bose 等</li></ul></li></ul><h4 id="设计理念-3"><a href="#设计理念-3" class="headerlink" title="设计理念"></a>设计理念</h4><ul><li><p>核心设计理念：</p><ul><li>对业务隐藏分布式复杂性，业务看到的是一张逻辑表<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> order_id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></tbody></table></figure></li><li>实际底层：<ul><li>数据自动切分</li><li>分布在多个节点</li><li>多副本强一致</li><li>自动迁移与负载均衡</li></ul></li><li>应用层无需关心分片规则、路由逻辑</li></ul></li><li><p>核心数据模型：</p><ul><li>Range（自动分片）：<ul><li>表数据会被自动切分成多个 Range</li><li>Range 是：<ul><li>数据复制的最小单位</li><li>调度、迁移、负载均衡的基本单位</li></ul></li><li> Range 由系统自动拆分 / 合并，非业务定义</li></ul></li><li>多副本 + Raft：<ul><li>每个 Range 默认 3 个副本（可配置）</li><li>基于 Raft 协议：<ul><li>强一致性</li><li>线性一致读写</li><li>自动 Leader 选举与故障切换</li></ul></li></ul></li></ul></li></ul><h4 id="核心特性-3"><a href="#核心特性-3" class="headerlink" title="核心特性"></a>核心特性</h4><ul><li><p>核心特性：</p><ul><li>架构层面<ul><li>原生分布式</li><li> Shared-Nothing 架构</li><li>多副本、高可用、自愈</li></ul></li><li>数据与事务<ul><li>自动分片（Range）</li><li>强一致分布式事务</li><li> MVCC + 行级锁</li></ul></li><li> SQL 与兼容性<ul><li> PostgreSQL 协议兼容</li><li>兼容大部分常用 PostgreSQL SQL 特性</li></ul></li><li>运维能力<ul><li>在线扩缩容</li><li>自动副本均衡</li><li>节点自动加入 / 移除</li><li>原生支持跨地域部署</li></ul></li></ul></li><li><p>事务能力：</p><ul><li>CockroachDB 以 “全球强一致分布式事务” 作为核心亮点</li><li>事务特性：<ul><li>全局 ACID 事务</li><li>跨节点、跨 Range 事务</li><li>单 SQL、跨 SQL 事务</li></ul></li><li>实现方式（简化理解）：<ul><li>HLC（Hybrid Logical Clock）</li><li>两阶段提交（2PC）</li><li>Raft 日志保证一致性</li></ul></li><li>特点：<ul><li>不依赖外部全局时钟（如 Google Spanner 的 TrueTime）</li><li>在普通云环境即可实现强一致分布式事务</li></ul></li></ul></li><li><p>对比 「分库分表 + 中间件」：</p><table><thead><tr><th>对比项</th><th> CockroachDB</th><th> 分库分表 + 中间件（如 MyCat、ShardingSphere）</th></tr></thead><tbody><tr><td>分片规则</td><td>系统自动</td><td>业务自己设计</td></tr><tr><td> SQL 能力</td><td>接近完整 SQL</td><td> 有限制</td></tr><tr><td>事务</td><td>强一致分布式事务</td><td>跨库事务复杂</td></tr><tr><td>运维复杂度</td><td>低</td><td>高</td></tr><tr><td>扩缩容</td><td>在线透明</td><td>高风险</td></tr><tr><td>业务侵入</td><td>无</td><td>很重</td></tr></tbody></table></li></ul><h4 id="商业限制"><a href="#商业限制" class="headerlink" title="商业限制"></a>商业限制</h4><ul><li>CockroachDB 属于代码开源 / 商业使用有限制的原生分布式数据库<ul><li> CockroachDB 采用 BSL（Business Source License）授权<ul><li> BSL 并不禁止商业使用，它主要禁止的是：将 CockroachDB 本身作为一个对外收费的数据库服务（DBaaS）提供给用户</li></ul></li><li> BSL 的授权特点：<ul><li>源码可见、可学习、可修改</li><li>生产环境商业使用有约束</li><li>若干年后转为 Apache 2.0 开源协议</li><li>这和 Apache / MIT 那种 “完全自由开源” 不一样</li></ul></li><li>商业使用举例：<ul><li>公司内部的项目使用 CockroachDB 开发一款收费的聊天 APP，一般不需要购买商业许可证</li><li>这是因为聊天 APP 属于业务应用（Application），而 CockroachDB 是内部基础设施组件，这是 BSL 明确允许的使用方式<ul><li>公司部署 CockroachDB 集群</li><li> CockroachDB 只是聊天 APP 的底层数据库</li><li>对外收费的是聊天 APP 本身，而不是 “数据库服务”</li><li> 不向第三方单独提供 “CockroachDB 托管数据库服务（DBaaS）”<table><thead><tr><th> 行为</th><th>是否需要购买商业许可证</th></tr></thead><tbody><tr><td>用 CockroachDB 开发聊天 APP 并收费</td><td>❌ 不需要</td></tr><tr><td> SaaS 产品内部使用 CockroachDB</td><td>❌ 不需要</td></tr><tr><td>企业内部系统使用 CockroachDB</td><td>❌ 不需要</td></tr><tr><td>将 CockroachDB 做成 “托管数据库服务” 对外销售</td><td>✅ 需要</td></tr><tr><td>类似 AWS RDS / 云数据库 CockroachDB</td><td>✅ 需要</td></tr></tbody></table></li></ul></li></ul></li></ul></li></ul><h4 id="适用场景-3"><a href="#适用场景-3" class="headerlink" title="适用场景"></a>适用场景</h4><ul><li><p>非常适合：</p><ul><li>金融级事务系统</li><li>多活 / 跨地域部署</li><li> SaaS 核心数据库</li><li>强一致 OLTP 场景</li><li>希望减少分库分表复杂度的系统</li></ul></li><li><p>不一定适合：</p><ul><li>单机即可满足的小规模系统</li><li>极端写放大、低延迟 KV 存储场景</li><li>对 PostgreSQL 特性高度依赖（如部分扩展）</li></ul></li></ul><h4 id="开源生态-3"><a href="#开源生态-3" class="headerlink" title="开源生态"></a>开源生态</h4><ul><li><p>GitHub 开源项目:</p><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/cockroachdb/cockroach?utm_source=chatgpt.com">CockroachDB</a></li></ul></li><li><p> 开源生态组件：</p><ul><li>CockroachDB Core<ul><li> 核心数据库源码（源码可见，BSL 许可，旧版本会转为 Apache 2.0）</li><li>支持分布式 SQL、强一致性（Raft）、自动分片与负载均衡</li></ul></li><li> CockroachDB Community / Free 功能集（免费）<ul><li>基础 SQL 能力、事务、自动容错</li><li>可用于自建集群与内部商业使用</li></ul></li><li> CockroachDB Enterprise Features（需商业许可证）<ul><li>备份 / 恢复（增量、加密）</li><li>多区域部署（Multi-Region）、Follower Reads</li><li> 行级 / 列级访问控制、审计日志等</li></ul></li><li> CockroachDB Cloud（官方托管服务）<ul><li>Cockroach Labs 提供的 DBaaS（闭源）</li></ul></li><li>生态与工具链<ul><li> SQL 客户端（<code>cockroach sql</code>）</li><li>监控与可观测性（Prometheus / Grafana 集成）</li><li>Kubernetes 部署（Helm Charts、Operator）</li><li>PostgreSQL 协议兼容（客户端与驱动）</li></ul></li></ul></li></ul><h2 id="商业分布式数据库（NewSQL）"><a href="#商业分布式数据库（NewSQL）" class="headerlink" title="商业分布式数据库（NewSQL）"></a>商业分布式数据库（NewSQL）</h2><h3 id="Google-Spanner"><a href="#Google-Spanner" class="headerlink" title="Google Spanner"></a>Google Spanner</h3><p>Google Spanner 是一款闭源的、云原生的分布式关系型数据库服务（属于 NewSQL），它是 NewSQL 架构思想的重要奠基者。</p><ul><li><p>Google Spanner 是：</p><ul><li>Google 内部数据库</li><li> GCP 托管服务</li></ul></li><li><p>用户只能：</p><ul><li>使用 Google Spanner 的云服务</li><li>不能部署、不能阅读 Google Spanner 的源码</li></ul></li></ul><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="/posts/3ccf5667.html">国产数据库产品汇总</a></li><li><a target="_blank" rel="external nofollow" href="https://cloud.tencent.com/developer/article/2146305">目前最火的五款国产数据库介绍</a></li><li><a href="/posts/8c661fac.html">分库分表可能真的要退出历史舞台</a></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/ebe034ff.html" title="分布式数据库技术选型介绍">https://www.techgrow.cn/posts/ebe034ff.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag"><i class="fa fa-tag"></i> 微服务</a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"><i class="fa fa-tag"></i> 数据库</a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/26ba10c4.html" rel="prev" title="ElasticSearch 开发随笔"><i class="fa fa-angle-left"></i> ElasticSearch 开发随笔</a></div><div class="post-nav-item"> <a href="/posts/496af1ce.html" rel="next" title="Docker 搭建 ZooKeeper 集群">Docker 搭建 ZooKeeper 集群<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2026</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2.3m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">35:12</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/ebe034ff.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div><div id="moon-menu-item-code" class="moon-menu-item"><i class="fa-solid fa-code"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>