<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 Dubbo 的入门教程。"><meta property="og:type" content="article"><meta property="og:title" content="Dubbo 2 入门教程之五"><meta property="og:url" content="https://www.techgrow.cn/posts/ab89c617.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 Dubbo 的入门教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-admin-route-rule.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-admin-condition-routing-rule-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-admin-condition-routing-rule-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo2-tag-routing-rule-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-admin-tag-routing-rule-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-routing-rule-store.png"><meta property="article:published_time" content="2019-07-16T15:42:35.000Z"><meta property="article:modified_time" content="2025-07-16T15:42:35.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="微服务"><meta property="article:tag" content="分布式"><meta property="article:tag" content="RPC"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-admin-route-rule.png"><link rel="canonical" href="https://www.techgrow.cn/posts/ab89c617.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/ab89c617.html","path":"posts/ab89c617.html","title":"Dubbo 2 入门教程之五"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Dubbo 2 入门教程之五 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90"><span class="nav-text">学习资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="nav-text">Dubbo 核心特性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99"><span class="nav-text">路由规则</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99%E4%BB%8B%E7%BB%8D"><span class="nav-text">路由规则介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99"><span class="nav-text">条件路由规则</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D"><span class="nav-text">简单介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B"><span class="nav-text">配置示例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%84%E5%88%99%E8%AF%A6%E8%A7%A3"><span class="nav-text">规则详解</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%90%84%E5%AD%97%E6%AE%B5%E7%9A%84%E5%90%AB%E4%B9%89"><span class="nav-text">各字段的含义</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Conditions-%E8%A7%84%E5%88%99%E4%BD%93"><span class="nav-text">Conditions 规则体</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%87%E7%AD%BE%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99"><span class="nav-text">标签路由规则</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D-1"><span class="nav-text">简单介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B-1"><span class="nav-text">配置示例</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Provider-%E7%AB%AF"><span class="nav-text">Provider 端</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Consumer-%E7%AB%AF"><span class="nav-text">Consumer 端</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%84%E5%88%99%E8%AF%A6%E8%A7%A3-1"><span class="nav-text">规则详解</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%90%84%E5%AD%97%E6%AE%B5%E7%9A%84%E5%90%AB%E4%B9%89-1"><span class="nav-text">各字段的含义</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%99%8D%E7%BA%A7%E7%BA%A6%E5%AE%9A%E8%AF%B4%E6%98%8E"><span class="nav-text">降级约定说明</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99"><span class="nav-text">脚本路由规则</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D-2"><span class="nav-text">简单介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%84%E5%88%99%E8%AF%A6%E8%A7%A3-2"><span class="nav-text">规则详解</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B"><span class="nav-text">脚本示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%99%E5%85%A5%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99"><span class="nav-text">写入路由规则</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99%E7%9A%84%E5%86%99%E5%85%A5"><span class="nav-text">路由规则的写入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99%E7%9A%84%E5%AD%98%E5%82%A8"><span class="nav-text">路由规则的存储</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E8%A7%84%E5%88%99%EF%BC%88%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE%EF%BC%89"><span class="nav-text">配置规则（动态配置）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">756</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">54</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/ab89c617.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Dubbo 2 入门教程之五 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 Dubbo 的入门教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Dubbo 2 入门教程之五</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-07-16 23:42:35" itemprop="dateCreated datePublished" datetime="2019-07-16T23:42:35+08:00">2019-07-16</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-16 23:42:35" itemprop="dateModified" datetime="2025-07-16T23:42:35+08:00">2025-07-16</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/ab89c617.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/ab89c617.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>6.7k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>6 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/d484ffa3.html">Dubbo 2 入门教程之一</a>、<a href="/posts/ad584707.html">Dubbo 2 入门教程之二</a>、<a href="/posts/fab9c84c.html">Dubbo 2 入门教程之三</a></li><li><a href="/posts/b66ba452.html">Dubbo 2 入门教程之四</a>、<a href="/posts/ab89c617.html">Dubbo 2 入门教程之五</a>、<a href="/posts/ad900e14.html">Dubbo 2 入门教程之六</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h3><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/incubator-dubbo/">Dubbo 官方项目（GitHub）</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-samples">Dubbo 官方案例（GitHub）</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docsv2.7/">Dubbo 官方文档（2.7 版本）</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docs/">Dubbo 官方文档（快照版本）</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/">Dubbo 官方文档（最新版本）</a></li></ul><span id="more"></span><h2 id="Dubbo-核心特性"><a href="#Dubbo-核心特性" class="headerlink" title="Dubbo 核心特性"></a>Dubbo 核心特性</h2><div class="admonition warning"><p class="admonition-title">Dubbo-Admin 说明</p><ul><li>本文使用的 Dubbo-Admin 服务治理控制台，其连接的注册中心、配置中心和元数据中心均为同一个 Zookeeper 实例。</li><li>因此，当文中介绍 Zookeeper 中的数据存储结构时，需要以此为前提，尤其是在涉及 Dubbo 路由规则的内容时。</li></ul></div><h3 id="路由规则"><a href="#路由规则" class="headerlink" title="路由规则"></a>路由规则</h3><div class="admonition note"><p class="admonition-title">Dubbo 官方文档</p><ul><li><a target="_blank" rel="external nofollow" href="https://cn.dubbo.apache.org/zh-cn/overview/what/core-features/traffic/">Dubbo 官方文档（最新版本）- 流量管理</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docs/examples/routing/">Dubbo 官方文档（快照版本）- 路由规则</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docsv2.7/user/examples/routing-rule/">Dubbo 官方文档（2.7 版本）- 路由规则</a>，<a href="../../../asset/2025/11/dubbo2-docs-routing-rule.png">附文档截图</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docsv2.7/user/examples/routing-rule-deprecated/">Dubbo 官方文档（2.7 版本）- 旧路由规则</a>，<a href="../../../asset/2025/11/dubbo2-docs-old-routing-rule.png">附文档截图</a></li></ul></div><h4 id="路由规则介绍"><a href="#路由规则介绍" class="headerlink" title="路由规则介绍"></a>路由规则介绍</h4><ul><li><p>路由规则在发起一次 RPC 调用前起到过滤目标服务器地址的作用，过滤后的地址列表将作为服务消费端最终发起 RPC 调用的备选地址。Dubbo 的路由规则分为以下几种：</p><ul><li><code>条件路由</code>：支持以服务或 Consumer 应用为粒度配置路由规则。</li><li><code>标签路由</code>: 支持以 Provider 应用为粒度配置路由规则。</li><li><code>脚本路由</code>：可以使用 JDK 支持的引擎（比如 JavaScript、JRuby、Groovy 等）解析路由脚本，默认使用 JavaScript 引擎。</li></ul></li><li><p>路由规则的 URL 内容：</p><ul><li>条件路由规则 URL 内容的示例：<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"route://0.0.0.0/com.foo.BarService?category=routers&amp;dynamic=false&amp;rule=" + URL.encode("host = 10.20.153.10 =&gt; host = 10.20.153.11")</span><br></pre></td></tr></tbody></table></figure></li><li>脚本路由规则 URL 内容的示例：<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"script://0.0.0.0/com.foo.BarService?category=routers&amp;dynamic=false&amp;rule=" + URL.encode("(function route(invokers) { ... } (invokers))")</span><br></pre></td></tr></tbody></table></figure></li></ul></li><li><p>动态配置路由规则</p><ul><li>对于脚本路由规则，不支持通过 <a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-admin">Dubbo-Admin</a> 服务治理控制台进行动态配置（动态调整），需要通过编程方式（Dubbo 原生 API）或者直接向注册中心写入路由规则来实现</li><li>对于条件路由规则和标签路由规则，支持通过 <a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-admin">Dubbo-Admin</a> 服务治理控制台进行动态配置（动态调整），如下图所示：</li></ul></li></ul><p><img data-src="../../../asset/2025/11/dubbo-admin-route-rule.png"></p><h4 id="条件路由规则"><a href="#条件路由规则" class="headerlink" title="条件路由规则"></a>条件路由规则</h4><h5 id="简单介绍"><a href="#简单介绍" class="headerlink" title="简单介绍"></a>简单介绍</h5><ul><li>条件路由规则用于将符合特定条件的请求定向到服务提供者的特定地址子集上。</li><li>条件路由规则首先会根据请求参数进行匹配，然后将匹配成功的请求转发到包含特定服务提供者实例地址的子集。</li><li>条件路由规则可以根据条件（如服务消费者的 IP、应用名称、服务名称、方法名称、参数等）来决定调用哪些服务提供者（Provider）或是否拒绝调用。</li><li><strong>条件路由规则影响的是服务消费者（Consumer）的 RPC 调用行为。</strong></li></ul><h5 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h5><p>Dubbo 支持在 <a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-admin">Dubbo-Admin</a> 服务治理控制台动态配置条件路由规则，且 Dubbo 项目无需引用额外的 Maven 依赖包即可支持。</p><ul><li>应用粒度的条件路由规则</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 应用名称为app1的服务消费者，只能消费所有端口为20880的服务提供者实例</span></span><br><span class="line"><span class="comment"># 应用名称为app2的服务消费者，只能消费所有端口为20881的服务提供者实例</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">scope:</span> <span class="string">application</span></span><br><span class="line"><span class="attr">force:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">runtime:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">key:</span> <span class="string">dubbo-consumer-application</span></span><br><span class="line"><span class="attr">conditions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">application=app1</span> <span class="string">=&gt;</span> <span class="string">address=*:20880</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">application=app2</span> <span class="string">=&gt;</span> <span class="string">address=*:20881</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></tbody></table></figure><p><img data-src="../../../asset/2025/11/dubbo-admin-condition-routing-rule-1.png"></p><hr><ul><li>服务粒度的条件路由规则</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DemoService的sayHello方法，只能消费所有端口为20880的服务提供者实例</span></span><br><span class="line"><span class="comment"># DemoService的sayHi方法，只能消费所有端口为20881的服务提供者实例</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">scope:</span> <span class="string">service</span></span><br><span class="line"><span class="attr">force:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">runtime:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">key:</span> <span class="string">com.clay.dubbo.service.DemoService</span></span><br><span class="line"><span class="attr">conditions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">method=sayHello</span> <span class="string">=&gt;</span> <span class="string">address=*:20880</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">method=sayHi</span> <span class="string">=&gt;</span> <span class="string">address=*:20881</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></tbody></table></figure><p><img data-src="../../../asset/2025/11/dubbo-admin-condition-routing-rule-2.png"></p><h5 id="规则详解"><a href="#规则详解" class="headerlink" title="规则详解"></a>规则详解</h5><h6 id="各字段的含义"><a href="#各字段的含义" class="headerlink" title="各字段的含义"></a>各字段的含义</h6><ul><li><code>scope</code> 表示路由规则的作用粒度，<code>scope</code> 的取值会决定 <code>key</code> 的取值。<strong>必填</strong>。<ul><li><code>service</code> 服务粒度</li><li><code>application</code> 应用粒度</li></ul></li><li><strong><code>key</code> 明确规则体作用在哪个应用或服务，必填</strong>。<ul><li><strong><code>scope=application</code> 时，<code>key</code> 取值为应用的名称</strong></li><li><strong><code>scope=service</code> 时，<code>key</code> 取值为 <code>[{group}:]{service}[:{version}]</code> 的组合</strong></li></ul></li><li><code>enabled=true</code> 当前路由规则是否生效，可不填，缺省生效。</li><li><code>force=false</code> 当路由结果为空时，是否强制执行；如果不强制执行，路由结果为空的路由规则将自动失效，可不填，缺省为 <code>false</code>。</li><li><code>runtime=false</code> 是否在每次调用时执行路由规则，否则只在服务提供者地址列表变更时预先执行并缓存结果，调用时直接从缓存中获取路由结果。如果用了参数路由，必须设为 <code>true</code>，需要注意设置会影响调用的性能，可不填，缺省为 <code>false</code>。</li><li><code>priority=1</code> 路由规则的优先级，用于排序，优先级越大越靠前执行，可不填，缺省为 <code>0</code>。</li><li><code>conditions</code> 定义具体的路由规则内容。<strong>必填</strong>。</li></ul><h6 id="Conditions-规则体"><a href="#Conditions-规则体" class="headerlink" title="Conditions 规则体"></a>Conditions 规则体</h6><p>字段 <code>conditions</code> 是路由规则的主体，由一条到任意多条规则组成，下面为每个路由规则的配置语法做详细说明：</p><blockquote><p>Conditions 的格式</p></blockquote><ul><li>基于条件表达式的路由规则，如：<code>host = 10.20.153.10 =&gt; host = 10.20.153.11</code></li><li><code>=&gt;</code> 之前的为服务消费者匹配条件，所有参数和服务消费者的 URL 进行对比，当服务消费者满足匹配条件时，对该服务消费者执行后面的过滤规则。</li><li><code>=&gt;</code> 之后为服务提供者地址列表的过滤条件，所有参数和服务提供者的 URL 进行对比，服务消费者最终只拿到过滤后的地址列表。</li><li>如果 <code>=&gt;</code> 之前的匹配条件为空，表示对所有服务消费者允许访问，如：<code>=&gt; host = 10.20.153.11</code>。</li><li>如果 <code>=&gt;</code> 之后的过滤条件为空，表示对所有服务消费者禁止访问，如：<code>host = 10.20.153.10 =&gt;</code>。</li></ul><blockquote><p>Conditions 的表达式</p></blockquote><ul><li><p>参数支持：</p><ul><li>服务调用信息，如：<code>method</code>、<code>argument</code> 等，暂不支持参数路由</li><li> URL 本身的字段，如：<code>protocol</code>、<code>host</code>、<code>port</code> 等</li><li>以及 URL 上的所有参数，如：<code>application</code>、<code>organization</code> 等</li></ul></li><li><p>条件支持：</p><ul><li>等号 <code>=</code> 表示 “匹配”，如：<code>host = 10.20.153.10</code></li><li>不等号 <code>!=</code> 表示 “不匹配”，如：<code>host != 10.20.153.10</code></li></ul></li><li><p>值支持：</p><ul><li>以逗号 <code>,</code> 分隔多个值，如：<code>host != 10.20.153.10,10.20.153.11</code></li><li>以星号 <code>*</code> 结尾，表示通配，如：<code>host != 10.20.*</code></li><li>以美元符 <code>$</code> 开头，表示引用服务消费者参数，如：<code>host = $host</code></li></ul></li></ul><blockquote><p>Condition 的配置示例</p></blockquote><ul><li>排除预发布机器：</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=&gt; host != 172.22.3.91</span><br></pre></td></tr></tbody></table></figure><ul><li>白名单：</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">register.ip != 10.20.153.10,10.20.153.11 =&gt;</span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">注意</p><p>一个服务只能有一条白名单规则，否则两条规则交叉，就都被筛选掉了。</p></div><ul><li>黑名单：</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">register.ip = 10.20.153.10,10.20.153.11 =&gt;</span><br></pre></td></tr></tbody></table></figure><ul><li>服务寄宿在应用上，只暴露一部分的机器，防止整个集群挂掉：</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=&gt; host = 172.22.3.1*,172.22.3.2*</span><br></pre></td></tr></tbody></table></figure><ul><li>为重要应用提供额外的机器：</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">application != kylin =&gt; host != 172.22.3.95,172.22.3.96</span><br></pre></td></tr></tbody></table></figure><ul><li>读写分离：</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">method = find*,list*,get*,is* =&gt; host = 172.22.3.94,172.22.3.95,172.22.3.96</span><br><span class="line">method != find*,list*,get*,is* =&gt; host = 172.22.3.97,172.22.3.98</span><br></pre></td></tr></tbody></table></figure><ul><li>前后台分离：</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">application = bops =&gt; host = 172.22.3.91,172.22.3.92,172.22.3.93</span><br><span class="line">application != bops =&gt; host = 172.22.3.94,172.22.3.95,172.22.3.96</span><br></pre></td></tr></tbody></table></figure><ul><li>隔离不同机房网段：</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host != 172.22.3.* =&gt; host != 172.22.3.*</span><br></pre></td></tr></tbody></table></figure><ul><li>服务提供者与服务消费者部署在同集群内，本机只访问本机的服务：</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=&gt; host = $host</span><br></pre></td></tr></tbody></table></figure><h4 id="标签路由规则"><a href="#标签路由规则" class="headerlink" title="标签路由规则"></a>标签路由规则</h4><h5 id="简单介绍-1"><a href="#简单介绍-1" class="headerlink" title="简单介绍"></a>简单介绍</h5><p>标签路由通过将一个或多个服务提供者（Provier）划分到同一个分组，约束流量只在指定分组中流转，从而实现流量隔离的目的，可以作为灰度发布、蓝绿发布等场景的能力基础。</p><p><img data-src="../../../asset/2025/11/dubbo2-tag-routing-rule-1.png"></p><p>从上图中可以看到有两个机房分别是机房 A、机房 B，其中机房 A 要求只能访问到 Service A 和 Service B ，而机房 B 要求只能访问到 Service C 和 Service D。要实现上面这种场景，就需要使用到 Dubbo 的标签路由。从机房 A 发起的 RPC 调用携带标签 <code>TAG_A</code> 访问到 Service A 和 Service B，而从机房 B 发起的 RPC 调用携带标签 <code>TAG_B</code> 访问到 Service C 和 Service D。</p><h5 id="配置示例-1"><a href="#配置示例-1" class="headerlink" title="配置示例"></a>配置示例</h5><h6 id="Provider-端"><a href="#Provider-端" class="headerlink" title="Provider 端"></a>Provider 端</h6><p>标签主要是指对 Provider 端（服务提供者）实例的分组，目前有两种方式可以完成实例分组，分别是 <code>动态规则打标</code> 和 <code>静态规则打标</code>，其中动态规则相较于静态规则优先级更高，而当两种规则同时存在且出现冲突时，将以动态规则为准。</p><ul><li><p>Provider 端的动态规则打标（支持在 <a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-admin">Dubbo-Admin</a> 服务治理控制台里面实现 Provider 端的动态规则打标，且 Dubbo 项目无需引用额外的 Maven 依赖包即可支持）</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dubbo-provider-application应用增加了两个标签分组tag1和tag2</span></span><br><span class="line"><span class="comment"># tag1包含一个实例 127.0.0.1:20880</span></span><br><span class="line"><span class="comment"># tag2包含一个实例 127.0.0.1:20881</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">force:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">runtime:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">key:</span> <span class="string">dubbo-provider-application</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tag1</span></span><br><span class="line">    <span class="attr">addresses:</span> [<span class="string">"127.0.0.1:20880"</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tag2</span></span><br><span class="line">    <span class="attr">addresses:</span> [<span class="string">"127.0.0.1:20881"</span>]</span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></tbody></table></figure><p><img data-src="../../../asset/2025/11/dubbo-admin-tag-routing-rule-1.png"></p></li><li><p>Provider 端的静态打标</p><ul><li>全局设置标签<ul><li> XML 设置方式<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">tag</span>=<span class="string">"tag1"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure></li><li>YML 设置方式<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">provider:</span></span><br><span class="line">    <span class="attr">tag:</span> <span class="string">tag1</span></span><br></pre></td></tr></tbody></table></figure></li><li>原生 API 设置方式<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ProviderConfig providerConfig = <span class="keyword">new</span> ProviderConfig();</span><br><span class="line">providerConfig.setTag(<span class="string">"tag1"</span>);</span><br></pre></td></tr></tbody></table></figure></li><li>JVM 启动参数设置方式<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java<span class="params"> -jar</span> xxx-provider.jar<span class="params"> -Ddubbo</span>.provider.tag={the tag you want, may come from OS ENV}</span><br></pre></td></tr></tbody></table></figure></li></ul></li><li>针对指定服务接口设置标签<ul><li> XML 设置方式<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.xxx.DemoService"</span> <span class="attr">ref</span>=<span class="string">"demoServiceImpl"</span> <span class="attr">tag</span>=<span class="string">"tag1"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure></li><li>注解设置方式<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DubboService(tag = "tag1")</span></span><br></pre></td></tr></tbody></table></figure></li></ul></li></ul></li></ul><h6 id="Consumer-端"><a href="#Consumer-端" class="headerlink" title="Consumer 端"></a>Consumer 端</h6><ul><li><p>Consumer 端设置携带的标签（<strong>不支持在 <a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-admin">Dubbo-Admin</a> 服务治理控制台里面动态设置 Consumer 端携带的标签</strong>）</p><ul><li>全局方式设置 Consumer 端携带的标签<ul><li> XML 设置方式<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:consumer</span> <span class="attr">tag</span>=<span class="string">"tag1"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure></li><li>YML 设置方式<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">consumer:</span></span><br><span class="line">    <span class="attr">tag:</span> <span class="string">tag1</span></span><br></pre></td></tr></tbody></table></figure></li></ul></li><li>针对指定服务接口设置 Consumer 端携带的标签<ul><li> XML 设置方式<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">interface</span>=<span class="string">"com.xxx.DemoService"</span> <span class="attr">tag</span>=<span class="string">"tag1"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure></li><li>注解设置方式<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DubboReference(tag = "tag1")</span></span><br></pre></td></tr></tbody></table></figure></li><li>原生 API 设置方式<ul><li>纯原生 API<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ApplicationConfig app = <span class="keyword">new</span> ApplicationConfig(<span class="string">"demo-consumer"</span>);</span><br><span class="line"></span><br><span class="line">RegistryConfig registry = <span class="keyword">new</span> RegistryConfig();</span><br><span class="line">registry.setProtocol(<span class="string">"zookeeper"</span>);</span><br><span class="line">registry.setAddress(<span class="string">"127.0.0.1:2181"</span>);</span><br><span class="line"></span><br><span class="line">ReferenceConfig&lt;DemoService&gt; reference = <span class="keyword">new</span> ReferenceConfig&lt;&gt;();</span><br><span class="line">reference.setApplication(app);</span><br><span class="line">reference.setRegistry(registry);</span><br><span class="line">reference.setInterface(DemoService.class);</span><br><span class="line"></span><br><span class="line">DemoService demoService = reference.get();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定 Consumer 端携带的标签，必须写在发起 RPC 调用之前</span></span><br><span class="line">RpcContext.getContext().setAttachment(CommonConstants.TAG_KEY, <span class="string">"tag1"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发起 RPC 调用</span></span><br><span class="line">String result = demoService.sayHi(<span class="string">"Dubbo"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"result = "</span> + result);</span><br></pre></td></tr></tbody></table></figure></li><li>或者原生 API + 注解<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DubboReference</span></span><br><span class="line">    <span class="keyword">private</span> DemoService demoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/sayHello")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// 指定 Consumer 端携带的标签，必须写在发起 RPC 调用之前</span></span><br><span class="line">        RpcContext.getContext().setAttachment(CommonConstants.TAG_KEY, <span class="string">"tag1"</span>);</span><br><span class="line">        <span class="comment">// 发起 RPC 调用</span></span><br><span class="line">        <span class="keyword">return</span> demoService.sayHello();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/sayHi")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHi</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// 指定 Consumer 端携带的标签，必须写在发起 RPC 调用之前</span></span><br><span class="line">        RpcContext.getContext().setAttachment(CommonConstants.TAG_KEY, <span class="string">"tag2"</span>);</span><br><span class="line">        <span class="comment">// 发起 RPC 调用</span></span><br><span class="line">        <span class="keyword">return</span> demoService.sayHi();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ul></li></ul></li></ul></li><li><p>请求标签的作用域为每一次 <code>invocation</code>，使用 <code>attachment</code> 来传递请求标签，注意保存在 <code>attachment</code> 中的值将会在一次完整的远程调用中持续传递，得益于这样的特性，开发者只需要在起始调用时，通过一行代码的设置，达到标签的持续传递。</p></li><li><p>目前仅仅支持硬编码的方式设置 Dubbo 标签。请注意 <code>RpcContext</code> 是线程绑定的，若希望优雅地使用标签路由的特性，建议通过 Servlet 过滤器（在 Web 环境下），或者定制的 SPI 过滤器中设置 Dubbo 标签。</p></li></ul><h5 id="规则详解-1"><a href="#规则详解-1" class="headerlink" title="规则详解"></a>规则详解</h5><h6 id="各字段的含义-1"><a href="#各字段的含义-1" class="headerlink" title="各字段的含义"></a>各字段的含义</h6><ul><li><code>key</code> 明确规则体作用到哪个应用。<strong>必填</strong>。</li><li><code>enabled=true</code> 当前路由规则是否生效，可不填，缺省生效。</li><li><code>force=false</code> 当路由结果为空时，是否强制执行，如果不强制执行，路由结果为空的路由规则将自动失效，可不填，缺省为 <code>false</code>。</li><li><code>runtime=false</code> 是否在每次调用时执行路由规则，否则只在服务提供者地址列表变更时预先执行并缓存结果，调用时直接从缓存中获取路由结果。如果用了参数路由，必须设为 <code>true</code>，需要注意设置会影响调用的性能，可不填，缺省为 <code>false</code>。</li><li><code>priority=1</code> 路由规则的优先级，用于排序，优先级越大越靠前执行，可不填，缺省为 <code>0</code>。</li><li><code>tags</code> 定义具体的标签分组内容，可定义任意 <code>n (n&gt;= 1)</code> 个标签并为每个标签指定实例列表。<strong>必填</strong>。</li><li><code>name</code>，标签名称</li><li><code>addresses</code>，当前标签包含的实例列表</li></ul><h6 id="降级约定说明"><a href="#降级约定说明" class="headerlink" title="降级约定说明"></a>降级约定说明</h6><ul><li>当配置 <code>dubbo.tag=tag1</code> 时<ul><li> Dubbo 优先选择标记了 <code>tag=tag1</code> 的 Provider；</li><li>若集群中不存在与请求标记对应的服务，默认将降级请求 <code>tag</code> 为空的 Provider；</li><li>如果要改变这种默认行为，即找不到匹配 <code>tag1</code> 的 Provider 时返回异常，需要配置 <code>dubbo.force.tag=true</code>。</li></ul></li><li>当 <code>dubbo.tag</code> 未配置时<ul><li> Dubbo 只会匹配 <code>tag</code> 为空的 Provider；</li><li>即使集群中存在可用的服务，若 <code>tag</code> 不匹配也就无法调用；这与上面的约定不同，<strong>携带标签的请求可以降级访问到无标签的服务，但不携带标签或者携带其他种类标签的请求永远无法调用到带其他标签的服务</strong>。</li></ul></li></ul><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>Dubbo <code>2.6.x</code> 版本以及更早的版本，请参考 <a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docsv2.7/user/examples/routing-rule-deprecated">Dubbo 官方文档（2.7 版本）- 老版本路由规则</a>，<a href="../../../asset/2025/11/dubbo2-docs-old-routing-rule.png">附文档截图</a>。</li><li>Dubbo 自定义路由可参考 <a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/spi/description/router/">Dubbo 官方文档（最新版本）- 路由扩展</a>，<a href="../../../asset/2025/11/dubbo-docs-routing-rule-spi.png">附文档截图</a>。</li></ul></div><h4 id="脚本路由规则"><a href="#脚本路由规则" class="headerlink" title="脚本路由规则"></a>脚本路由规则</h4><h5 id="简单介绍-2"><a href="#简单介绍-2" class="headerlink" title="简单介绍"></a>简单介绍</h5><ul><li>脚本路由规则为流量管理提供了最大的灵活性，所有流量在执行负载均衡选址之前，都会动态的执行一遍规则脚本，根据脚本执行的结果确定可用的地址子集。</li><li><strong>脚本路由规则只对服务消费者（Consumer）生效且只支持应用粒度管理，因此，<code>key</code> 字段必须设置为服务消费者（Consumer）的应用名称。</strong></li><li><strong>脚本路由规则不支持通过 <a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-admin">Dubbo-Admin</a> 服务治理控制台进行动态配置（动态调整），需要通过编程方式（Dubbo 原生 API）或者直接向注册中心写入路由规则来实现。</strong></li><li>脚本语法支持多种，以 Dubbo Java SDK 为例，脚本语法支持 Javascript、Groovy、Kotlin 等，具体可参见每个语言实现的限制，缺省脚本语法为 Javascript。</li><li>脚本路由规则 URL 内容的示例：<code>"script://0.0.0.0/com.foo.BarService?category=routers&amp;dynamic=false&amp;rule=" + URL.encode("(function route(invokers) { ... } (invokers))")</code></li></ul><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>在 Dubbo 的脚本路由规则中，脚本没有沙箱约束，可执行任意代码，存在后门安全风险。</li><li>换句话说，由于 Dubbo 的脚本路由规则可以动态加载远端代码并执行，因此存在潜在的安全隐患；在启用脚本路由规则前，一定要确保脚本规则在安全沙箱内运行。</li></ul></div><h5 id="规则详解-2"><a href="#规则详解-2" class="headerlink" title="规则详解"></a>规则详解</h5><p>脚本路由规则主体由以下字段构成，其负责定义脚本规则生效的目标服务消费者应用（Consumer）、流量过滤脚本以及一些特定场景下的行为。</p><table><thead><tr><th>字段</th><th>类型</th><th>描述</th><th>必填</th></tr></thead><tbody><tr><td><code>configVersion</code></td><td><code>string</code></td><td>脚本规则定义的版本，目前可用版本为 <code>v3.0</code></td><td>是</td></tr><tr><td><code>key</code></td><td><code>string</code></td><td>本规则所应用的目标应用标识符</td><td>是</td></tr><tr><td><code>type</code></td><td><code>string</code></td><td>用于编写 <code>script</code> 的脚本语言类型</td><td>是</td></tr><tr><td><code>enabled</code></td><td><code>bool</code></td><td>是否启用此规则，设置为 <code>false</code> 即禁用</td><td>是</td></tr><tr><td><code>script</code></td><td><code>string</code></td><td>用于过滤 Dubbo Provider 实例的脚本内容</td><td>是</td></tr><tr><td><code>force</code></td><td><code>bool</code></td><td>当路由后实例集合为空时如何处理：<code>true</code> 表示直接返回无可用 Provider 的异常，<code>false</code> 表示忽略此规则</td><td>否</td></tr></tbody></table><h5 id="脚本示例"><a href="#脚本示例" class="headerlink" title="脚本示例"></a>脚本示例</h5><p><code>script</code> 为脚本路由规则的主体，类型为一个具有符合结构的 <code>string</code> 字符串，具体取决于 <code>type</code> 指定的脚本语言。以下是 <code>type: javascript</code> 的一个脚本规则示例：</p><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> <span class="title">route</span>(<span class="params">invokers,invocation,context</span>) </span>{</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">new</span> java.util.ArrayList(invokers.size());</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; invokers.size(); i ++) {</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"10.20.3.3"</span>.equals(invokers.get(i).getUrl().getHost())) {</span><br><span class="line">            result.add(invokers.get(i));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">} (invokers, invocation, context)); <span class="comment">// 表示立即执行方法</span></span><br></pre></td></tr></tbody></table></figure><h4 id="写入路由规则"><a href="#写入路由规则" class="headerlink" title="写入路由规则"></a>写入路由规则</h4><h5 id="路由规则的写入"><a href="#路由规则的写入" class="headerlink" title="路由规则的写入"></a>路由规则的写入</h5><p>Dubbo 往注册中心（比如 Zookeeper）写入条件路由规则或标签路由规则的操作，通常由 <a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-admin">Dubbo-Admin</a> 服务治理中心的 UI 界面来完成，其底层的代码实现如下：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 Dubbo 原生 API，往注册中心写入条件路由规则、标签路由规则</span></span><br><span class="line">RegistryFactory registryFactory = ExtensionLoader.getExtensionLoader(RegistryFactory.class).getAdaptiveExtension();</span><br><span class="line">Registry registry = registryFactory.getRegistry(URL.valueOf(<span class="string">"zookeeper://10.20.153.10:2181"</span>));</span><br><span class="line">registry.register(URL.valueOf(<span class="string">"route://0.0.0.0/com.foo.BarService?category=routers&amp;dynamic=false&amp;rule="</span> + URL.encode(<span class="string">"host = 10.20.153.10 =&gt; host = 10.20.153.11"</span>)));</span><br></pre></td></tr></tbody></table></figure><p>各字段的含义：</p><ul><li><code>route://</code> 表示路由规则的类型，支持条件路由规则和脚本路由规则，可扩展，<strong>必填</strong>。</li><li><code>0.0.0.0</code> 表示对所有 IP 地址生效，如果只想对某个 IP 的生效，请填入具体 IP，<strong>必填</strong>。</li><li><code>com.foo.BarService</code> 表示只对指定服务生效，<strong>必填</strong>。</li><li><code>group=foo</code> 对指定服务的指定 <code>group</code> 生效，不填表示对未配置 <code>group</code> 的指定服务生效</li><li><code>version=1.0</code> 对指定服务的指定 <code>version</code> 生效，不填表示对未配置 <code>version</code> 的指定服务生效</li><li><code>category=routers</code> 表示该数据为动态配置类型，<strong>必填</strong>。</li><li><code>dynamic=false</code> 表示该数据为持久数据，当注册方退出时，数据依然保存在注册中心，<strong>必填</strong>。</li><li><code>enabled=true</code> 覆盖规则是否生效，可不填，缺省生效。</li><li><code>force=false</code> 当路由结果为空时，是否强制执行；如果不强制执行，路由结果为空的路由规则将自动失效，可不填，缺省为 <code>false</code>。</li><li><code>runtime=false</code> 是否在每次调用时执行路由规则，否则只在服务提供者地址列表变更时预先执行并缓存结果，调用时直接从缓存中获取路由结果。如果用了参数路由，必须设为 <code>true</code>，需要注意设置会影响调用的性能，可不填，缺省为 <code>false</code>。</li><li><code>priority=1</code> 路由规则的优先级，用于排序，优先级越大越靠前执行，可不填，缺省为 <code>0</code>。</li><li><code>rule=URL.encode("host = 10.20.153.10 =&gt; host = 10.20.153.11")</code> 表示路由规则的内容，<strong>必填</strong>。</li></ul><p>Dubbo 往注册中心（比如 Zookeeper）写入脚本路由规则的操作，不支持由 <a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-admin">Dubbo-Admin</a> 服务治理中心的 UI 界面来完成，需要通过编程方式（Dubbo 原生 API）或直接向注册中心写入路由规则来实现，比如：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 Dubbo 原生 API，往注册中心写入脚本路由规则</span></span><br><span class="line">RegistryFactory registryFactory = ExtensionLoader.getExtensionLoader(RegistryFactory.class).getAdaptiveExtension();</span><br><span class="line">Registry registry = registryFactory.getRegistry(URL.valueOf(<span class="string">"zookeeper://10.20.153.10:2181"</span>));</span><br><span class="line">registry.register(URL.valueOf(<span class="string">"script://0.0.0.0/com.foo.BarService?category=routers&amp;dynamic=false&amp;rule="</span> + URL.encode(<span class="string">"(function route(invokers) { ... } (invokers))"</span>)));</span><br></pre></td></tr></tbody></table></figure><h5 id="路由规则的存储"><a href="#路由规则的存储" class="headerlink" title="路由规则的存储"></a>路由规则的存储</h5><p>当 Dubbo-Admin 使用 Zookeeper 作为配置中心，并通过可视化控制台添加路由规则时，这些路由规则会存储在 Zookeeper 中的不同路径，主要分为以下几类：</p><ul><li>全局级路由规则<ul><li>路径：<code>/dubbo/config/dubbo/routers/</code></li><li>说明：<ul><li>存放所有服务全局生效的路由规则</li><li>适用于存储跨应用、跨服务的统一路由规则</li></ul></li></ul></li><li>应用级路由规则<ul><li>路径：<code>/dubbo/config/{application}/routers/</code><ul><li><code>{application}</code> 是具体应用的名称</li></ul></li><li>说明：<ul><li>存放在某个应用内生效的路由规则</li><li>影响该应用下的所有服务接口，但不跨应用</li></ul></li></ul></li><li>服务级路由规则<ul><li>路径：<code>/dubbo/{serviceInterface}/routers/</code><ul><li><code>{serviceInterface}</code> 是具体服务接口的全限定名</li></ul></li><li>说明：<ul><li>存放某个服务接口专属的路由规则</li><li>可覆盖全局级或应用级的路由规则</li></ul></li></ul></li></ul><p><img data-src="../../../asset/2025/11/dubbo-routing-rule-store.png"></p><h3 id="配置规则（动态配置）"><a href="#配置规则（动态配置）" class="headerlink" title="配置规则（动态配置）"></a>配置规则（动态配置）</h3><div class="admonition note"><p class="admonition-title">Dubbo 官方文档</p><ul><li><a target="_blank" rel="external nofollow" href="https://cn.dubbo.apache.org/zh-cn/overview/what/core-features/traffic/configuration-rule/">Dubbo 官方文档（最新版本）- 动态配置规则</a>，<a href="../../../asset/2025/11/dubbo-docs-configuration-rule.png">附文档截图</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docs/advanced/config-rule/">Dubbo 官方文档（快照版本）- 配置规则</a>，<a href="../../../asset/2025/11/dubbo2-docs-snap-config-rule.png">附文档截图</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docsv2.7/user/examples/config-rule/">Dubbo 官方文档（2.7 版本）- 配置规则</a>，<a href="../../../asset/2025/11/dubbo2-docs-config-rule.png">附文档截图</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docsv2.7/user/examples/config-rule-deprecated/">Dubbo 官方文档（2.7 版本）- 旧配置规则</a>，<a href="../../../asset/2025/11/dubbo2-docs-old-config-rule.png">附文档截图</a></li></ul></div><p>配置规则（也叫 “动态配置” 或者 “动态配置规则”）是 Dubbo 设计的在无需重启应用的情况下，动态调整 RPC 调用行为的一种能力。Dubbo 从 <code>2.7.0</code> 版本开始，支持从应用和服务两个粒度来调整动态配置。</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a target="_blank" rel="external nofollow" href="https://blog.csdn.net/m0_67402588/article/details/126327864">Dubbo 动态配置中心</a></li><li><a target="_blank" rel="external nofollow" href="https://blog.csdn.net/weixin_43931625/article/details/122900398">Dubbo 路由过滤功能介绍</a></li><li><a target="_blank" rel="external nofollow" href="https://blog.csdn.net/weixin_41947378/article/details/108549398">Dubbo 源码解析 - 服务路由</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docsv2.7/user/examples/">Dubbo 官方文档（2.7 版本）- 特性示例</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/more/">Dubbo 官方文档（最新版本）- 更多特性</a></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/ab89c617.html" title="Dubbo 2 入门教程之五">https://www.techgrow.cn/posts/ab89c617.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag"><i class="fa fa-tag"></i> 微服务</a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a><a href="/tags/RPC/" rel="tag"><i class="fa fa-tag"></i> RPC</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/fe4ed47c.html" rel="prev" title="Linux 安装 NodeJS"><i class="fa fa-angle-left"></i> Linux 安装 NodeJS</a></div><div class="post-nav-item"> <a href="/posts/3ffff1a5.html" rel="next" title="Linux 安装 ElasticSearch（单机）">Linux 安装 ElasticSearch（单机）<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2.2m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">33:14</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/ab89c617.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>