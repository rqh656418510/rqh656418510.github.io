<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍如何使用 Docker 部署 Kafka Eagle 的单机服务，实现对 Kafka 集群的监控。"><meta property="og:type" content="article"><meta property="og:title" content="Docker 部署 Kafka Eagle（EFAK）单机"><meta property="og:url" content="https://www.techgrow.cn/posts/73b15688.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍如何使用 Docker 部署 Kafka Eagle 的单机服务，实现对 Kafka 集群的监控。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/kafka-eagle-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/kafka-eagle-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/kafka-eagle-3.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/kafka-eagle-4.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/kafka-eagle-7.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/kafka-eagle-8.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/kafka-eagle-6.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/kafka-eagle-5.png"><meta property="article:published_time" content="2024-11-12T13:30:00.000Z"><meta property="article:modified_time" content="2024-12-05T13:30:00.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="容器化"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2024/12/kafka-eagle-1.png"><link rel="canonical" href="https://www.techgrow.cn/posts/73b15688.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/73b15688.html","path":"posts/73b15688.html","title":"Docker 部署 Kafka Eagle（EFAK）单机"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Docker 部署 Kafka Eagle（EFAK）单机 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%98%E6%96%B9%E8%B5%84%E6%BA%90"><span class="nav-text">官方资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%83%A8%E7%BD%B2%E8%A7%84%E5%88%92"><span class="nav-text">部署规划</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-text">准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL-%E9%83%A8%E7%BD%B2"><span class="nav-text">MySQL 部署</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kafka-%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2"><span class="nav-text">Kafka 集群部署</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E7%9A%84-YML-%E9%85%8D%E7%BD%AE"><span class="nav-text">完整的 YML 配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kafka-Eagle-%E5%8D%95%E6%9C%BA%E9%83%A8%E7%BD%B2"><span class="nav-text">Kafka Eagle 单机部署</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">初始化数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8"><span class="nav-text">创建容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E5%AE%B9%E5%99%A8"><span class="nav-text">验证容器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E7%8A%B6%E6%80%81"><span class="nav-text">查看容器状态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2"><span class="nav-text">访问管理页面</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kafka-Eagle-%E9%83%A8%E7%BD%B2%E9%97%AE%E9%A2%98"><span class="nav-text">Kafka Eagle 部署问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JMX-%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E5%86%B2%E7%AA%81"><span class="nav-text">JMX 端口占用冲突</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kafka-Eagle-%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2"><span class="nav-text">Kafka Eagle 集群部署</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%82%E8%BD%BD-Kafka-Eagle-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%97%A0%E6%95%88"><span class="nav-text">挂载 Kafka Eagle 配置文件无效</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E4%B8%8D%E8%B6%B3%E5%AF%BC%E8%87%B4%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5"><span class="nav-text">内存不足导致容器启动失败</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%91%E6%8E%A7%E5%A4%A7%E5%B1%8F%E6%97%A0%E6%B3%95%E5%AE%9E%E6%97%B6%E6%9B%B4%E6%96%B0%E6%98%BE%E7%A4%BA"><span class="nav-text">监控大屏无法实时更新显示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kafka-Eagle-%E6%97%A0%E6%B3%95%E7%9B%91%E6%8E%A7%E8%87%AA%E5%B7%B1"><span class="nav-text">Kafka Eagle 无法监控自己</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E6%B3%95%E7%9B%91%E6%8E%A7-ZooKeeper-%E9%9B%86%E7%BE%A4"><span class="nav-text">无法监控 ZooKeeper 集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A0%E6%B3%95%E7%9B%91%E6%8E%A7-Kafka-%E9%9B%86%E7%BE%A4"><span class="nav-text">无法监控 Kafka 集群</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%95%99%E7%A8%8B"><span class="nav-text">参考教程</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">712</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/73b15688.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Docker 部署 Kafka Eagle（EFAK）单机 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍如何使用 Docker 部署 Kafka Eagle 的单机服务，实现对 Kafka 集群的监控。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Docker 部署 Kafka Eagle（EFAK）单机</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2024-11-12 21:30:00" itemprop="dateCreated datePublished" datetime="2024-11-12T21:30:00+08:00">2024-11-12</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2024-12-05 21:30:00" itemprop="dateModified" datetime="2024-12-05T21:30:00+08:00">2024-12-05</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/73b15688.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/73b15688.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>6.1k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>6 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/d2fe844e.html">Linux 部署 Kafka Eagle（EFAK）单机</a></li><li><a href="/posts/73b15688.html">Docker 部署 Kafka Eagle（EFAK）单机</a></li><li><a href="/posts/70bdcb69.html">Linux 生产环境部署 Kafka Eagle（EFAK）集群</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文将介绍使用 Docker-Compose 部署 Kafka-Eagle（EFAK）的单机服务，实现对 Kafka 集群的管理和监控。</p><div class="admonition note"><p class="admonition-title">Kafka Eagle（EFAK）的介绍</p><p><a target="_blank" rel="external nofollow" href="https://github.com/smartloli/EFAK">Kafka Eagle</a>（现已改名为 EFAK，Eagle For Apache Kafka）是一款国产开源 Kafka 集群监控系统，可以用来监视 Kafka 集群的 Broker 状态、Topic 信息、IO、内存、Consumer 线程、偏移量等信息，并进行可视化图表展示。独特的 KQL 还可以通过 SQL 在线查询 Kafka 中的数据。Kafka Eagle 自身支持单机和集群两种方式进行部署，在企业的生产环境中使用得比较多，尤其是大规模 Kafka 集群环境。</p></div><span id="more"></span><h3 id="官方资源"><a href="#官方资源" class="headerlink" title="官方资源"></a>官方资源</h3><ul><li><p>官方项目资源</p><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/smartloli/EFAK">Kafka Eagle（EFAK）官方项目</a></li><li><a target="_blank" rel="external nofollow" href="https://docs.kafka-eagle.org/">Kafka Eagle（EFAK）官方文档</a></li></ul></li><li><p> Docker 资源</p><ul><li><a target="_blank" rel="external nofollow" href="https://hub.docker.com/r/nickzurich/efak">Kafka Eagle（EFAK）镜像地址</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/nick-zh/docker-kafka-eagle">Kafka Eagle（EFAK）Docker 项目</a></li></ul></li></ul><h3 id="部署规划"><a href="#部署规划" class="headerlink" title="部署规划"></a>部署规划</h3><table><thead><tr><th>组件</th><th>版本</th><th>部署方式</th><th>说明</th></tr></thead><tbody><tr><td> ZooKeeper</td><td><code>3.8.4</code></td><td>Docker-Compose</td><td> 集群（三节点）</td></tr><tr><td>Kafka</td><td><code>3.9.0</code></td><td>Docker-Compose</td><td> 集群（三节点）</td></tr><tr><td>MySQL</td><td><code>8.4.2</code></td><td>Docker-Compose</td><td> 单机</td></tr><tr><td> Kafka Eagle（EFAK）</td><td><code>3.0.1</code></td><td>Docker-Compose</td><td> 单机</td></tr></tbody></table><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>在部署 Kafka Eagle 之前，需要将 Kafka 集群和 MySQL 提前部署好。值得一提的是，如果项目中已有 Kafka 集群和 MySQL 服务正在运行，则可以忽略跳过二者的部署操作。</p><h3 id="MySQL-部署"><a href="#MySQL-部署" class="headerlink" title="MySQL 部署"></a>MySQL 部署</h3><ul><li><a href="/posts/2669f243.html">Docker 部署 MySQL 8</a></li></ul><div class="admonition note"><p class="admonition-title">提示</p><ul><li>Kafka Eagle（EFAK）需要一个数据库来存储其配置数据，如用户数据、Kafka 集群的监控指标数据等。</li><li>在默认情况下，Kafka Eagle（EFAK）使用的是 SQLite，而 SQLite 是存储在 EFAK 安装位置的嵌入式数据库。</li></ul></div><h3 id="Kafka-集群部署"><a href="#Kafka-集群部署" class="headerlink" title="Kafka 集群部署"></a>Kafka 集群部署</h3><ul><li><a href="/posts/d2c9b56d.html">Docker 搭建 Kafka 集群</a></li></ul><div class="admonition note"><p class="admonition-title">提示</p><ul><li>本文使用的 Kafka 集群是依赖于 Zookeeper 集群的，因此需要将 Zookeeper 集群提前搭建起来。</li><li>值得一提的是，从 Kafka <code>2.8.0</code> 版本开始，Kafka 自身实现了 <code>Raft</code> 分布式一致性机制，这意味着 Kafka 集群是可以脱离 ZooKeeper 独立运行的。</li></ul></div><h3 id="完整的-YML-配置"><a href="#完整的-YML-配置" class="headerlink" title="完整的 YML 配置"></a>完整的 YML 配置</h3><div class="admonition warning"><p class="admonition-title">特别注意</p><p>下述 <code>docker-compose.yml</code> 配置文件的内容可以直接复用，只需要简单更改数据卷（<code>volumes</code>）的配置，并将 <code>192.168.56.112</code> 更改为你自己宿主机的 IP 地址即可。</p></div><p>严格按照上述教程，通过 Docker-Compose 成功部署 Kafka 集群和 MySQL 后，<code>docker-compose.yml</code> 配置文件的完整内容如下所示：</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.5'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.4.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">"mysqld"</span>, <span class="string">"--mysql-native-password=ON"</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3306</span><span class="string">:3306</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/mysql:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">"CMD-SHELL"</span>, <span class="string">"mysqladmin ping -h localhost"</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">30s</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">distributed-network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">zookeeper01:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper:3.8.4</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zookeeper01</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">zookeeper01</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2181</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">ZOO_PORT:</span> <span class="number">2181</span></span><br><span class="line">      <span class="attr">ZOO_4LW_COMMANDS_WHITELIST:</span> <span class="string">ruok</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zookeeper01:2888:3888;2181</span> <span class="string">server.2=zookeeper02:2888:3888;2181</span> <span class="string">server.3=zookeeper03:2888:3888;2181</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">"CMD"</span>, <span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"echo ruok | nc localhost 2181 | grep imok"</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">20s</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/zookeeper/zookeeper01/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/zookeeper/zookeeper01/datalog:/datalog</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">distributed-network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">zookeeper02:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper:3.8.4</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zookeeper02</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">zookeeper02</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2182</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">2</span></span><br><span class="line">      <span class="attr">ZOO_PORT:</span> <span class="number">2181</span></span><br><span class="line">      <span class="attr">ZOO_4LW_COMMANDS_WHITELIST:</span> <span class="string">ruok</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zookeeper01:2888:3888;2181</span> <span class="string">server.2=zookeeper02:2888:3888;2181</span> <span class="string">server.3=zookeeper03:2888:3888;2181</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">"CMD"</span>, <span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"echo ruok | nc localhost 2181 | grep imok"</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">20s</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/zookeeper/zookeeper02/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/zookeeper/zookeeper02/datalog:/datalog</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">distributed-network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">zookeeper03:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper:3.8.4</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zookeeper03</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">zookeeper03</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2183</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">ZOO_PORT:</span> <span class="number">2181</span></span><br><span class="line">      <span class="attr">ZOO_4LW_COMMANDS_WHITELIST:</span> <span class="string">ruok</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zookeeper01:2888:3888;2181</span> <span class="string">server.2=zookeeper02:2888:3888;2181</span> <span class="string">server.3=zookeeper03:2888:3888;2181</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">"CMD"</span>, <span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"echo ruok | nc localhost 2181 | grep imok"</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">20s</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/zookeeper/zookeeper03/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/zookeeper/zookeeper03/datalog:/datalog</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">distributed-network</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">kafka01:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitnami/kafka:3.9.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kafka01</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">kafka01</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9093</span><span class="string">:9093</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_NODE_ID:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_LISTENERS:</span> <span class="string">PLAINTEXT://:9093</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_ADVERTISED_LISTENERS:</span> <span class="string">PLAINTEXT://192.168.56.112:9093</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_ZOOKEEPER_CONNECT:</span> <span class="string">zookeeper01:2181,zookeeper02:2181,zookeeper03:2181/kafka</span></span><br><span class="line">      <span class="attr">ALLOW_PLAINTEXT_LISTENER:</span> <span class="literal">yes</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">"CMD"</span>, <span class="string">"kafka-topics.sh"</span>, <span class="string">"--bootstrap-server"</span>, <span class="string">"kafka01:9093,kafka02:9094,kafka03:9095"</span>, <span class="string">"--list"</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">15s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">30s</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/kafka/kafka01:/bitnami/kafka</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="attr">zookeeper01:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">      <span class="attr">zookeeper02:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">      <span class="attr">zookeeper03:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">distributed-network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">kafka02:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitnami/kafka:3.9.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kafka02</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">kafka02</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9094</span><span class="string">:9094</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_NODE_ID:</span> <span class="number">2</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_LISTENERS:</span> <span class="string">PLAINTEXT://:9094</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_ADVERTISED_LISTENERS:</span> <span class="string">PLAINTEXT://192.168.56.112:9094</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_ZOOKEEPER_CONNECT:</span> <span class="string">zookeeper01:2181,zookeeper02:2181,zookeeper03:2181/kafka</span></span><br><span class="line">      <span class="attr">ALLOW_PLAINTEXT_LISTENER:</span> <span class="literal">yes</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">"CMD"</span>, <span class="string">"kafka-topics.sh"</span>, <span class="string">"--bootstrap-server"</span>, <span class="string">"kafka01:9093,kafka02:9094,kafka03:9095"</span>, <span class="string">"--list"</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">15s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">30s</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/kafka/kafka02:/bitnami/kafka</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="attr">zookeeper01:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">      <span class="attr">zookeeper02:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">      <span class="attr">zookeeper03:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">distributed-network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">kafka03:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitnami/kafka:3.9.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kafka03</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">kafka03</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9095</span><span class="string">:9095</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_NODE_ID:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_LISTENERS:</span> <span class="string">PLAINTEXT://:9095</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_ADVERTISED_LISTENERS:</span> <span class="string">PLAINTEXT://192.168.56.112:9095</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_ZOOKEEPER_CONNECT:</span> <span class="string">zookeeper01:2181,zookeeper02:2181,zookeeper03:2181/kafka</span></span><br><span class="line">      <span class="attr">ALLOW_PLAINTEXT_LISTENER:</span> <span class="literal">yes</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">"CMD"</span>, <span class="string">"kafka-topics.sh"</span>, <span class="string">"--bootstrap-server"</span>, <span class="string">"kafka01:9093,kafka02:9094,kafka03:9095"</span>, <span class="string">"--list"</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">15s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">30s</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/kafka/kafka03:/bitnami/kafka</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="attr">zookeeper01:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">      <span class="attr">zookeeper02:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">      <span class="attr">zookeeper03:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">distributed-network</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">distributed-network:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></tbody></table></figure><h2 id="Kafka-Eagle-单机部署"><a href="#Kafka-Eagle-单机部署" class="headerlink" title="Kafka Eagle 单机部署"></a>Kafka Eagle 单机部署</h2><h3 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h3><ul><li>创建数据库，用于 Kafka Eagle（EFAK）存储 Kafka 的监控指标数据</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 创建数据库</span><br><span class="line">CREATE DATABASE efak DEFAULT CHARACTER SET utf8mb4;</span><br></pre></td></tr></tbody></table></figure><ul><li>创建数据库用户并授权访问，用于 Kafka Eagle（EFAK）连接 MySQL</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 创建用户</span><br><span class="line">CREATE USER <span class="string">'efak'</span>@<span class="string">'%'</span> IDENTIFIED WITH mysql_native_password BY <span class="string">'123456'</span>;</span><br><span class="line"></span><br><span class="line">-- 用户授权</span><br><span class="line">GRANT ALL PRIVILEGES ON efak.* TO <span class="string">'efak'</span>@<span class="string">'%'</span>;</span><br><span class="line"></span><br><span class="line">-- 刷新权限</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">提示</p><ul><li>(1) 在初始化 MySQL 数据库时，只需要创建数据库，而不需要手动创建数据库表。这是因为 Kafka Eagle（EFAK）会在启动的时候自动创建所需的<a href="../../../asset/2024/12/kafka-eagle-db-tables.png">数据库表</a>，前提是 Kafka Eagle（EFAK）用于连接 MySQL 的用户有对应的数据库操作权限。</li><li>(2) 值得一提的是，当不使用 MySQL 来存储 Kafka 的监控指标数据时，Kafka Eagle（EFAK）默认会使用 SQlite 作为数据库。</li></ul></div><h3 id="创建容器"><a href="#创建容器" class="headerlink" title="创建容器"></a>创建容器</h3><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>下述配置内容是在上面用于部署 Kafka 集群和 MySQL 的 <code>docker-compose.yml</code> 配置文件的基础上更改而来的，其主要变化有以下几点：</li><li>(1) 新增 Kafka Eagle（EFAK）的配置</li><li> (2) Kafka 容器新增 JMX 服务的配置</li><li> (3) 去掉 Kafka 容器启动时的健康检测配置（<code>healthcheck</code>）</li><li>(4) 更改 ZooKeeper 容器的 "四字命令" 配置为 <code>mntr,conf,ruok,stat</code></li></ul></div><hr><div class="admonition note"><p class="admonition-title">为什么要去掉 Kafka 容器启动时的健康检测</p><ul><li>这是因为 Kafka Eagle（EFAK）需要依赖 Kafka 的 JMX 服务来对 Kafaka 实现监控，可是一旦启用 JMX，在 Kafka 容器内部不能再执行类似 <code>kafka-topics.sh --bootstrap-server xxx --list</code> 这样的命令，否则会抛出 JMX 端口占用冲突的异常。</li></ul></div><hr><div class="admonition note"><p class="admonition-title">为什么要更改 ZooKeeper 容器的四字命令配置</p><ul><li>这是因为 Kafka Eagle（EFAK）需要依赖 ZooKeeper 的 "四字命令" 来对 ZooKeeper 实现监控。在默认情况下，ZooKeeper 会禁用 "四字命令"，这样会导致 Kafka Eagle（EFAK）无法正常监控 ZooKeeper 的运行状态，所以需要启用下面这几个 "四字命令"。</li><li><code>ruok</code>：用于检查 Zookeeper 服务是否正常运行。</li><li><code>conf</code>：返回当前 Zookeeper 集群的配置，例如节点配置、数据目录等。</li><li><code>stat</code>：返回 Zookeeper 节点的状态，包括当前连接数、Zookeeper 节点的版本、日志文件信息等。</li><li><code>mntr</code>：返回 Zookeeper 的监控信息，包括各个节点的状态、同步信息等，通常用于健康检测和性能监控。</li></ul></div><ul><li>更改上面用于部署 Kafka 集群和 MySQL 的 <code>docker-compose.yml</code> 配置文件，并添加 Kafka Eagle（EFAK）的配置，完整的配置内容如下所示：</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.5'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.4.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">"mysqld"</span>, <span class="string">"--mysql-native-password=ON"</span>]</span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">3306</span><span class="string">:3306</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/mysql:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">"CMD-SHELL"</span>, <span class="string">"mysqladmin ping -h localhost"</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">5s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">30s</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">distributed-network</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">zookeeper01:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper:3.8.4</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zookeeper01</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">zookeeper01</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2181</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">ZOO_PORT:</span> <span class="number">2181</span></span><br><span class="line">      <span class="attr">ZOO_4LW_COMMANDS_WHITELIST:</span> <span class="string">mntr,conf,ruok,stat</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zookeeper01:2888:3888;2181</span> <span class="string">server.2=zookeeper02:2888:3888;2181</span> <span class="string">server.3=zookeeper03:2888:3888;2181</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">"CMD"</span>, <span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"echo ruok | nc localhost 2181 | grep imok"</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">20s</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/zookeeper/zookeeper01/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/zookeeper/zookeeper01/datalog:/datalog</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">distributed-network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">zookeeper02:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper:3.8.4</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zookeeper02</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">zookeeper02</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2182</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">2</span></span><br><span class="line">      <span class="attr">ZOO_PORT:</span> <span class="number">2181</span></span><br><span class="line">      <span class="attr">ZOO_4LW_COMMANDS_WHITELIST:</span> <span class="string">mntr,conf,ruok,stat</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zookeeper01:2888:3888;2181</span> <span class="string">server.2=zookeeper02:2888:3888;2181</span> <span class="string">server.3=zookeeper03:2888:3888;2181</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">"CMD"</span>, <span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"echo ruok | nc localhost 2181 | grep imok"</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">20s</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/zookeeper/zookeeper02/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/zookeeper/zookeeper02/datalog:/datalog</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">distributed-network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">zookeeper03:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">zookeeper:3.8.4</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">zookeeper03</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">zookeeper03</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">2183</span><span class="string">:2181</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">ZOO_MY_ID:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">ZOO_PORT:</span> <span class="number">2181</span></span><br><span class="line">      <span class="attr">ZOO_4LW_COMMANDS_WHITELIST:</span> <span class="string">mntr,conf,ruok,stat</span></span><br><span class="line">      <span class="attr">ZOO_SERVERS:</span> <span class="string">server.1=zookeeper01:2888:3888;2181</span> <span class="string">server.2=zookeeper02:2888:3888;2181</span> <span class="string">server.3=zookeeper03:2888:3888;2181</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">"CMD"</span>, <span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"echo ruok | nc localhost 2181 | grep imok"</span>]</span><br><span class="line">      <span class="attr">interval:</span> <span class="string">30s</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">10s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">start_period:</span> <span class="string">20s</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/zookeeper/zookeeper03/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/zookeeper/zookeeper03/datalog:/datalog</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">distributed-network</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">kafka01:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitnami/kafka:3.9.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kafka01</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">kafka01</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9093</span><span class="string">:9093</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">19999</span><span class="string">:19999</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_NODE_ID:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_LISTENERS:</span> <span class="string">PLAINTEXT://:9093</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_ADVERTISED_LISTENERS:</span> <span class="string">PLAINTEXT://192.168.56.112:9093</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_ZOOKEEPER_CONNECT:</span> <span class="string">zookeeper01:2181,zookeeper02:2181,zookeeper03:2181/kafka</span></span><br><span class="line">      <span class="attr">ALLOW_PLAINTEXT_LISTENER:</span> <span class="literal">yes</span></span><br><span class="line">      <span class="attr">KAFKA_JMX_PORT:</span> <span class="number">19999</span></span><br><span class="line">      <span class="attr">KAFKA_JMX_OPTS:</span> <span class="string">'-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=kafka01 -Dcom.sun.management.jmxremote.port=19999'</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/kafka/kafka01:/bitnami/kafka</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="attr">zookeeper01:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">      <span class="attr">zookeeper02:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">      <span class="attr">zookeeper03:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">distributed-network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">kafka02:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitnami/kafka:3.9.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kafka02</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">kafka02</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9094</span><span class="string">:9094</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">29999</span><span class="string">:29999</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_NODE_ID:</span> <span class="number">2</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_LISTENERS:</span> <span class="string">PLAINTEXT://:9094</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_ADVERTISED_LISTENERS:</span> <span class="string">PLAINTEXT://192.168.56.112:9094</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_ZOOKEEPER_CONNECT:</span> <span class="string">zookeeper01:2181,zookeeper02:2181,zookeeper03:2181/kafka</span></span><br><span class="line">      <span class="attr">ALLOW_PLAINTEXT_LISTENER:</span> <span class="literal">yes</span></span><br><span class="line">      <span class="attr">KAFKA_JMX_PORT:</span> <span class="number">29999</span></span><br><span class="line">      <span class="attr">KAFKA_JMX_OPTS:</span> <span class="string">'-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=kafka02 -Dcom.sun.management.jmxremote.port=29999'</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/kafka/kafka02:/bitnami/kafka</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="attr">zookeeper01:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">      <span class="attr">zookeeper02:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">      <span class="attr">zookeeper03:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">distributed-network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">kafka03:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitnami/kafka:3.9.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kafka03</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">kafka03</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9095</span><span class="string">:9095</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">39999</span><span class="string">:39999</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_NODE_ID:</span> <span class="number">3</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_LISTENERS:</span> <span class="string">PLAINTEXT://:9095</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_ADVERTISED_LISTENERS:</span> <span class="string">PLAINTEXT://192.168.56.112:9095</span></span><br><span class="line">      <span class="attr">KAFKA_CFG_ZOOKEEPER_CONNECT:</span> <span class="string">zookeeper01:2181,zookeeper02:2181,zookeeper03:2181/kafka</span></span><br><span class="line">      <span class="attr">ALLOW_PLAINTEXT_LISTENER:</span> <span class="literal">yes</span></span><br><span class="line">      <span class="attr">KAFKA_JMX_PORT:</span> <span class="number">39999</span></span><br><span class="line">      <span class="attr">KAFKA_JMX_OPTS:</span> <span class="string">'-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=kafka03 -Dcom.sun.management.jmxremote.port=39999'</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/kafka/kafka03:/bitnami/kafka</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="attr">zookeeper01:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">      <span class="attr">zookeeper02:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">      <span class="attr">zookeeper03:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">distributed-network</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">efak:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nickzurich/efak:3.0.1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">efak</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8048</span><span class="string">:8048</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">      <span class="attr">EFAK_CLUSTER_ZK_LIST:</span> <span class="string">zookeeper01:2181,zookeeper02:2181,zookeeper03:2181/kafka</span></span><br><span class="line">      <span class="attr">EFAK_CLUSTER_KAFKA_EAGLE_OFFSET_STORAGE:</span> <span class="string">kafka</span></span><br><span class="line">      <span class="attr">EFAK_DB_USERNAME:</span> <span class="string">efak</span></span><br><span class="line">      <span class="attr">EFAK_DB_PASSWORD:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">EFAK_DB_DRIVER:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">EFAK_DB_URL:</span> <span class="string">jdbc:mysql://mysql:3306/efak?useUnicode=true&amp;characterEncoding=UTF-8&amp;zeroDateTimeBehavior=convertToNull</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">kafka01</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">kafka02</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">kafka03</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">distributed-network</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">distributed-network:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">重要参数说明</p><ul><li><code>EFAK_CLUSTER_ZK_LIST</code>：指定 ZooKeeper 集群的节点列表。</li><li><code>EFAK_CLUSTER_KAFKA_EAGLE_OFFSET_STORAGE</code>：指定 Kafka 集群存储 Offset 的位置。</li><li><code>EFAK_DB_USERNAME</code>：指定 Kafka Eagle（EFAK）连接数据库的用户名。</li><li><code>EFAK_DB_PASSWORD</code>：指定 Kafka Eagle（EFAK）连接数据库的密码。</li><li><code>EFAK_DB_DRIVER</code>：指定 Kafka Eagle（EFAK）连接数据库的驱动。</li><li><code>EFAK_DB_URL</code>：指定 Kafka Eagle（EFAK）连接数据库的 URL。</li><li><code>KAFKA_JMX_PORT</code>：指定 Kafka 使用的 JMX 监听端口。</li><li><code>KAFKA_JMX_OPTS</code>：通过 Java 的系统属性配置 JMX 的详细选项，比如是否启用 JMX、RMI 主机名、RMI 端口、JMX 的身份认证、JMX 的 SSL 证书 等。</li><li><code>KAFKA_CFG_ADVERTISED_LISTENERS: PLAINTEXT://192.168.56.112:9095</code>：<strong>这里的 <code>192.168.56.112</code> 是宿主机的 IP 地址或者公网 IP 地址。如果配置错误，会导致外部 Kafka 客户端无法正常连接 Docker 容器内的 Kafka 服务器</strong>。</li></ul></div><ul><li>创建并启动 Kafka Eagle（EFAK） 容器（<strong>请必须保证操作系统有 2G 空闲内存，否则容器会启动失败</strong>）</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sudo docker-compose up -d</span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>当不使用 MySQL 来存储 Kafka 的监控指标数据时，Kafka Eagle（EFAK）默认会使用 SQlite 作为数据库；此时如果希望持久化容器内的 SQlite 数据文件，可以通过数据卷挂载 Kafka Eagle（EFAK）容器内的 <code>/hadoop/efak/db/ke.db</code> 文件到宿主机内。</li><li>在停止 Kafka 集群时，一定要等 Kafka 所有节点进程全部停止后，再停止 Zookeeper 集群。因为 Zookeeper 集群当中记录着 Kafka 集群的相关信息，Zookeeper 集群一旦先停止，Kafka 集群就没有办法再获取停止进程的信息，最后只能手动杀死 Kafka 进程了。</li></ul></div><h3 id="验证容器"><a href="#验证容器" class="headerlink" title="验证容器"></a>验证容器</h3><h4 id="查看容器状态"><a href="#查看容器状态" class="headerlink" title="查看容器状态"></a>查看容器状态</h4><ul><li>查看所有 Kafka Eagle（EFAK） 容器的运行状态</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker ps -a</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ebc5136d2afb   nickzurich/efak:3.0.1   "entrypoint.sh"          44 seconds ago   Up 42 seconds             0.0.0.0:8048-&gt;8048/tcp, :::8048-&gt;8048/tcp, 8080/tcp                       efak</span><br><span class="line">ed37bf8c8eac   bitnami/kafka:3.9.0     "/opt/bitnami/script…"   17 minutes ago   Up 16 minutes             9092/tcp, 0.0.0.0:9093-&gt;9093/tcp, :::9093-&gt;9093/tcp                       kafka01</span><br><span class="line">c09ca638d783   bitnami/kafka:3.9.0     "/opt/bitnami/script…"   17 minutes ago   Up 16 minutes             9092/tcp, 0.0.0.0:9095-&gt;9095/tcp, :::9095-&gt;9095/tcp                       kafka03</span><br><span class="line">9f2636e03ad3   bitnami/kafka:3.9.0     "/opt/bitnami/script…"   17 minutes ago   Up 16 minutes             9092/tcp, 0.0.0.0:9094-&gt;9094/tcp, :::9094-&gt;9094/tcp                       kafka02</span><br><span class="line">d82f6b11979c   zookeeper:3.8.4         "/docker-entrypoint.…"   17 minutes ago   Up 17 minutes (healthy)   2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2182-&gt;2181/tcp, :::2182-&gt;2181/tcp   zookeeper02</span><br><span class="line">639310a6bdd2   zookeeper:3.8.4         "/docker-entrypoint.…"   17 minutes ago   Up 17 minutes (healthy)   2888/tcp, 3888/tcp, 0.0.0.0:2181-&gt;2181/tcp, :::2181-&gt;2181/tcp, 8080/tcp   zookeeper01</span><br><span class="line">9d255997e30e   zookeeper:3.8.4         "/docker-entrypoint.…"   17 minutes ago   Up 17 minutes (healthy)   2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2183-&gt;2181/tcp, :::2183-&gt;2181/tcp   zookeeper03</span><br><span class="line">3361ac6e2d10   mysql:8.4.2             "docker-entrypoint.s…"   17 minutes ago   Up 17 minutes (healthy)   33060/tcp, 0.0.0.0:3309-&gt;3306/tcp, :::3309-&gt;3306/tcp                      mysql</span><br></pre></td></tr></tbody></table></figure><ul><li>若 Kafka Eagle（EFAK）容器启动失败，可以通过以下命令查看容器的启动日志来排查问题</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看启动日志</span></span><br><span class="line">sudo docker logs -f --tail 100 efak</span><br></pre></td></tr></tbody></table></figure><h4 id="访问管理页面"><a href="#访问管理页面" class="headerlink" title="访问管理页面"></a>访问管理页面</h4><ul><li>(1) 浏览器通过 <code>http://192.168.56.112:8048</code> 访问 Kafka Eagle（EFAK）的控制台管理页面（如下所示），默认的登录账号和密码是 <code>admin/123456</code>，请记得将 <code>192.168.56.112</code> 更改为你自己宿主机的 IP 地址。</li></ul><p><img data-src="../../../asset/2024/12/kafka-eagle-1.png"></p><ul><li>(2) 登录 Kafka Eagle（EFAK）的控制台后，浏览器通过 <code>http://192.168.56.112:8048/tv</code> 就可以访问监控数据大屏的页面（如下所示），请记得将 <code>192.168.56.112</code> 更改为你自己宿主机的 IP 地址。</li></ul><p><img data-src="../../../asset/2024/12/kafka-eagle-2.png"></p><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>在默认情况下，Kafka Eagle（EFAK）的监控数据大屏页面不会实时更新显示 Kafka 集群的监控指标图表，比如 CPU 与内存的使用率、生产速率、消费速率等。</li><li>如果需要在 Kafka Eagle（EFAK）的 UI 中实时显示 Kafka 集群的监控指标图表，可以通过给 Kafka Eagle（EFAK）容器添加环境变量 <code>EFAK_METRICS_CHARTS: true</code> 来开启该功能。</li><li>值得一提的是，Kafka 集群监控指标图表的渲染和数据获取会消耗一定的资源，如果 Kafka 的集群规模较大或者系统资源有限，建议通过禁用 <code>EFAK_METRICS_CHARTS</code> 选项（默认禁用）来减少系统负载。</li></ul></div><ul><li>(3) 当 Kafka 的 JMX 服务配置正确后，浏览器通过 <code>http://192.168.56.112:8048/cluster/kafka</code> 就可以访问 Kafka 的监控页面（如下所示），请记得将 <code>192.168.56.112</code> 更改为你自己宿主机的 IP 地址。</li></ul><p><img data-src="../../../asset/2024/12/kafka-eagle-3.png"></p><ul><li>(4) 当 ZooKeeper 的 “四字命令” 配置正确后，浏览器通过 <code>http://192.168.56.112:8048/cluster/zookeeper</code> 就可以访问 ZooKeeper 的监控页面（如下所示），请记得将 <code>192.168.56.112</code> 更改为你自己宿主机的 IP 地址。</li></ul><p><img data-src="../../../asset/2024/12/kafka-eagle-4.png"></p><h2 id="Kafka-Eagle-部署问题"><a href="#Kafka-Eagle-部署问题" class="headerlink" title="Kafka Eagle 部署问题"></a>Kafka Eagle 部署问题</h2><h3 id="JMX-端口占用冲突"><a href="#JMX-端口占用冲突" class="headerlink" title="JMX 端口占用冲突"></a>JMX 端口占用冲突</h3><p>当 Kafka 容器新增 JMX 服务的配置后，在 Kafka 容器内部执行类似 <code>kafka-console-producer.sh --broker-list xxx --topic test</code> 这样的命令，会抛出 JMX 端口占用冲突的异常（如下所示）。解决方法是只在 Kafka 容器外执行管理命令。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.rmi.server.ExportException: Port already in use: 19999; nested exception is: </span><br><span class="line">	java.net.BindException: Address already in use</span><br><span class="line">	at java.rmi/sun.rmi.transport.tcp.TCPTransport.listen(TCPTransport.java:346)</span><br><span class="line">	at java.rmi/sun.rmi.transport.tcp.TCPTransport.exportObject(TCPTransport.java:243)</span><br><span class="line">	at java.rmi/sun.rmi.transport.tcp.TCPEndpoint.exportObject(TCPEndpoint.java:415)</span><br><span class="line">	at java.rmi/sun.rmi.transport.LiveRef.exportObject(LiveRef.java:147)</span><br><span class="line">	at java.rmi/sun.rmi.server.UnicastServerRef.exportObject(UnicastServerRef.java:235)</span><br><span class="line">	at java.rmi/sun.rmi.registry.RegistryImpl.setup(RegistryImpl.java:223)</span><br><span class="line">	at java.rmi/sun.rmi.registry.RegistryImpl.&lt;init&gt;(RegistryImpl.java:182)</span><br><span class="line">	at jdk.management.agent/sun.management.jmxremote.SingleEntryRegistry.&lt;init&gt;(SingleEntryRegistry.java:49)</span><br><span class="line">	at jdk.management.agent/sun.management.jmxremote.ConnectorBootstrap.exportMBeanServer(ConnectorBootstrap.java:859)</span><br><span class="line">	at jdk.management.agent/sun.management.jmxremote.ConnectorBootstrap.startRemoteConnectorServer(ConnectorBootstrap.java:480)</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">相关 Issues 案例</p><ul><li> <a target="_blank" rel="external nofollow" href="https://github.com/bitnami/charts/issues/12917">Kafka JMX Exporter, Port already in use: 5555</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/wurstmeister/kafka-docker/issues/171">when KAFKA_JMX_PORT specified, cannot use kafka-console-producer</a></li></ul></div><h3 id="Kafka-Eagle-集群部署"><a href="#Kafka-Eagle-集群部署" class="headerlink" title="Kafka Eagle 集群部署"></a>Kafka Eagle 集群部署</h3><p>在生产环境中，往往都需要部署多个 Kafka Eagle（EFAK） 实例，以此实现高可用。Kafka Eagle（EFAK）是天生支持集群（分布式）部署的，但由于 Kafka Eagle（EFAK）官方目前构建的 Docker 镜像并不支持集群部署功能。因此，如果需要部署 Kafka Eagle（EFAK）集群，只能是手动进行部署或者自行构建 Docker 镜像来实现，其中手动部署的教程请参考 <a target="_blank" rel="external nofollow" href="https://docs.kafka-eagle.org/2.installation/2.installonlinuxmac#id-2.2.7-start-the-efak-server-distributed">官方文档</a> 或者 <a href="/posts/70bdcb69.html">本站教程</a>。</p><h3 id="挂载-Kafka-Eagle-配置文件无效"><a href="#挂载-Kafka-Eagle-配置文件无效" class="headerlink" title="挂载 Kafka Eagle 配置文件无效"></a>挂载 Kafka Eagle 配置文件无效</h3><p>当使用的 Kafka Eagle（EFAK）镜像是 <code>3.0.1</code> 版本时，不能再通过数据卷挂载配置文件到容器内的方式（如下所示）来指定 <code>system-config.properties</code> 配置文件。因为 Kafka Eagle（EFAK）容器在每次启动时，都会拷贝默认的 <code>system-config.properties</code> 配置文件进行覆盖，导致外部挂载的配置文件也被 “重置”，详见<a target="_blank" rel="external nofollow" href="https://github.com/nick-zh/docker-kafka-eagle/blob/main/entrypoint.sh">这里</a>的脚本代码。解决办法是，在 Docker-Compose 中通过环境变量来指定 Kafka Eagle（EFAK）的配置参数。值得一提的是，Kafka Eagle（EFAK）镜像支持的所有环境变量可以从 <a target="_blank" rel="external nofollow" href="https://github.com/nick-zh/docker-kafka-eagle/blob/main/Dockerfile">这里</a> 获取得到。</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.5'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">efak:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nickzurich/efak:3.0.1</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">efak</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8048</span><span class="string">:8048</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">TZ:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/usr/local/efak/system-config.properties:/opt/efak/conf/system-config.properties</span>    <span class="comment"># 挂载的配置文件不会生效，且会被覆盖修改</span></span><br></pre></td></tr></tbody></table></figure><h3 id="内存不足导致容器启动失败"><a href="#内存不足导致容器启动失败" class="headerlink" title="内存不足导致容器启动失败"></a>内存不足导致容器启动失败</h3><p>在 Kafka Eagle（EFAK）的项目源码中，有一个 <code>ke.sh</code> <a target="_blank" rel="external nofollow" href="https://github.com/smartloli/EFAK/blob/main/efak-web/src/main/resources/bin/ke.sh">启动脚本</a>，该脚本里面有以下一行代码：</p><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> KE_JAVA_OPTS=<span class="string">"-server -Xmx2g -Xms2g -XX:MaxGCPauseMillis=20 -XX:+UseG1GC -XX:MetaspaceSize=128m -XX:InitiatingHeapOccupancyPercent=35 -XX:G1HeapRegionSize=16M -XX:MinMetaspaceFreeRatio=50 -XX:MaxMetaspaceFreeRatio=80"</span></span><br></pre></td></tr></tbody></table></figure><p>其中 JVM 参数 <code>-Xms2g</code> 指定了初始堆内存为 <code>2G</code>，因此当操作系统的空闲内存不足 <code>2G</code> 时，会导致 Kafka Eagle（EFAK）容器启动失败。解决办法是，更改 Shell 脚本代码并重新构建 Kafka Eagle（EFAK）镜像，或者增加机器的物理内存（强烈推荐）。</p><h3 id="监控大屏无法实时更新显示"><a href="#监控大屏无法实时更新显示" class="headerlink" title="监控大屏无法实时更新显示"></a>监控大屏无法实时更新显示</h3><p>在 Kafka Eagle（EFAK）的控制台中访问监控大屏页面时，发现即使有生产者正在发送消息和消费者正在消费消息，Kafka 集群的监控指标图表也无法实时更新显示或者没有任何监控数据显示（如下图所示）。这是因为 Kafka Eagle（EFAK）默认禁用了 Kafka 集群的监控指标图表实时更新。</p><p><img data-src="../../../asset/2024/12/kafka-eagle-7.png"></p><p>解决办法是，通过给 Kafka Eagle（EFAK）容器添加环境变量 <code>EFAK_METRICS_CHARTS: true</code> 来开启 Kafka 集群的监控指标图表实时更新。</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.5'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">efak:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nickzurich/efak:3.0.1</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">EFAK_METRICS_CHARTS:</span> <span class="literal">true</span></span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">特别注意</p><p>在 Kafka Eagle（EFAK）的控制台中，Kafka 集群监控指标图表的渲染和数据获取会消耗一定的资源。如果 Kafka 的集群规模较大或者系统资源有限，建议通过禁用 <code>EFAK_METRICS_CHARTS</code> 选项（默认禁用）来减少系统负载。</p></div><h3 id="Kafka-Eagle-无法监控自己"><a href="#Kafka-Eagle-无法监控自己" class="headerlink" title="Kafka Eagle 无法监控自己"></a>Kafka Eagle 无法监控自己</h3><p>在 Kafka Eagle（EFAK）的控制台中访问 EfakServer 的监控页面时，发现无法正常显示 EfakServer 的运行状态，监控页面一直显示提示信息 <code>Processing</code> 或者节点状态显示为 <code>Offline</code>，如下图所示：</p><p><img data-src="../../../asset/2024/12/kafka-eagle-8.png"></p><p>这个问题可以忽略不解决，猜测（待验证）只有当 Kafka Eagle（EFAK）以集群（分布式）模式部署时，EfakServer 的监控页面才会正常显示相关监控信息，详细说明请看 <a href="/posts/70bdcb69.html#Kafka-Eagle-%E6%97%A0%E6%B3%95%E7%9B%91%E6%8E%A7%E8%87%AA%E5%B7%B1">这里</a>。</p><h3 id="无法监控-ZooKeeper-集群"><a href="#无法监控-ZooKeeper-集群" class="headerlink" title="无法监控 ZooKeeper 集群"></a>无法监控 ZooKeeper 集群</h3><p>在 Kafka Eagle（EFAK）的控制台中访问 ZooKeeper 的监控页面时，发现无法正常显示 ZooKeeper 的运行状态，如下图所示：</p><p><img data-src="../../../asset/2024/12/kafka-eagle-6.png"></p><p>这通常是由于 ZooKeeper 容器没有配置 “四字命令” 或者 “四字命令” 配置不正确导致的，因为 Kafka Eagle（EFAK）是基于 ZooKeeper 的 “四字命令” 来实现 ZooKeeper 运行状态的监控。解决办法是，为 ZooKeeper 容器添加对应的 “四字命令” 配置，如下所示：</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">zookeeper:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">zookeeper:3.8.4</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">2181</span><span class="string">:2181</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="attr">ZOO_4LW_COMMANDS_WHITELIST:</span> <span class="string">mntr,conf,ruok,stat</span></span><br></pre></td></tr></tbody></table></figure><h3 id="无法监控-Kafka-集群"><a href="#无法监控-Kafka-集群" class="headerlink" title="无法监控 Kafka 集群"></a>无法监控 Kafka 集群</h3><p>在 Kafka Eagle（EFAK）的控制台中访问 Kafka 的监控页面时，发现无法正常显示 Kafka 的运行状态，如下图所示：</p><p><img data-src="../../../asset/2024/12/kafka-eagle-5.png"></p><p>这通常是由于 Kafka 容器没有配置 JMX 服务或者 JMX 服务配置不正确导致的，因为 Kafka Eagle（EFAK）是基于 JMX 服务来实现 Kafka 运行状态的监控。解决办法是，为 Kafka 容器添加对应的 JMX 配置，如下所示：</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3.5'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">bitnami/kafka:3.9.0</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9092</span><span class="string">:9092</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">19999</span><span class="string">:19999</span>   <span class="comment"># 映射 JMX 端口</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">KAFKA_JMX_PORT:</span> <span class="number">19999</span>   <span class="comment"># 指定 JMX 端口</span></span><br><span class="line">      <span class="attr">KAFKA_JMX_OPTS:</span> <span class="string">'-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=kafka -Dcom.sun.management.jmxremote.port=19999'</span></span><br></pre></td></tr></tbody></table></figure><h2 id="参考教程"><a href="#参考教程" class="headerlink" title="参考教程"></a>参考教程</h2><ul><li><a target="_blank" rel="external nofollow" href="https://cloud.tencent.com/developer/article/1965683">构建 Kafka Eagle 的 Docker 镜像</a></li><li><a target="_blank" rel="external nofollow" href="https://juejin.cn/post/7310569308915220492">通过 Docker-Compose 快速部署 EFAK</a></li><li><a target="_blank" rel="external nofollow" href="https://www.cnblogs.com/scfssq/p/17390955.html">Docker-Compose 部署 Kafka 和 Kafka Eagle</a></li><li><a href="/posts/70bdcb69.html">Linux 生产环境部署 Kafka-Eagle（EFAK）集群</a></li><li><a href="/posts/d2fe844e.html">Linux 部署 Kafka-Eagle（EFAK）单机</a></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/73b15688.html" title="Docker 部署 Kafka Eagle（EFAK）单机">https://www.techgrow.cn/posts/73b15688.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%AE%B9%E5%99%A8%E5%8C%96/" rel="tag"><i class="fa fa-tag"></i> 容器化</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/7d8de9f4.html" rel="prev" title="Dubbo 3 基于 SpringBoot 支持 REST 协议"><i class="fa fa-angle-left"></i> Dubbo 3 基于 SpringBoot 支持 REST 协议</a></div><div class="post-nav-item"> <a href="/posts/d2fe844e.html" rel="next" title="Linux 部署 Kafka-Eagle（EFAK）单机">Linux 部署 Kafka-Eagle（EFAK）单机<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">1.9m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">29:09</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/73b15688.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>