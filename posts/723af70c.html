<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 Kubernetes 的入门使用教程。"><meta property="og:type" content="article"><meta property="og:title" content="Kubernetes 入门教程之八"><meta property="og:url" content="https://www.techgrow.cn/posts/723af70c.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 Kubernetes 的入门使用教程。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2025-10-08T13:12:19.000Z"><meta property="article:modified_time" content="2025-10-08T13:12:19.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="容器化"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.techgrow.cn/posts/723af70c.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/723af70c.html","path":"posts/723af70c.html","title":"Kubernetes 入门教程之八"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Kubernetes 入门教程之八 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kubernetes-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF"><span class="nav-text">Kubernetes 核心技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8"><span class="nav-text">持久化存储</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6"><span class="nav-text">集群安全机制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RBAC-%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-text">RBAC 的基本概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RBAC-%E7%9A%84-API-%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1"><span class="nav-text">RBAC 的 API 资源对象</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Role%EF%BC%88%E8%A7%92%E8%89%B2%EF%BC%89"><span class="nav-text">Role（角色）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ClusterRole%EF%BC%88%E9%9B%86%E7%BE%A4%E8%A7%92%E8%89%B2%EF%BC%89"><span class="nav-text">ClusterRole（集群角色）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RoleBinding%EF%BC%88%E8%A7%92%E8%89%B2%E7%BB%91%E5%AE%9A%EF%BC%89"><span class="nav-text">RoleBinding（角色绑定）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ClusterRoleBinding%EF%BC%88%E9%9B%86%E7%BE%A4%E8%A7%92%E8%89%B2%E7%BB%91%E5%AE%9A%EF%BC%89"><span class="nav-text">ClusterRoleBinding（集群角色绑定）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RBAC-%E5%AF%B9%E8%B5%84%E6%BA%90%E7%9A%84%E5%BC%95%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-text">RBAC 对资源的引用方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RBAC-%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E8%A7%92%E8%89%B2%E5%AE%9A%E4%B9%89%E7%A4%BA%E4%BE%8B"><span class="nav-text">RBAC 中常见的角色定义示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RBAC-%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E8%A7%92%E8%89%B2%E7%BB%91%E5%AE%9A%E7%A4%BA%E4%BE%8B"><span class="nav-text">RBAC 中常用的角色绑定示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RBAC-%E4%B8%AD%E9%BB%98%E8%AE%A4%E7%9A%84%E8%A7%92%E8%89%B2%E5%92%8C%E8%A7%92%E8%89%B2%E7%BB%91%E5%AE%9A"><span class="nav-text">RBAC 中默认的角色和角色绑定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RBAC-%E4%B8%AD%E9%A2%84%E9%98%B2%E6%8F%90%E6%9D%83%E5%92%8C%E6%8E%88%E6%9D%83%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-text">RBAC 中预防提权和授权初始化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RBAC-%E7%9A%84%E5%AE%8C%E6%95%B4%E4%BD%BF%E7%94%A8%E6%BC%94%E7%A4%BA%E6%A1%88%E4%BE%8B"><span class="nav-text">RBAC 的完整使用演示案例</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">743</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/723af70c.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Kubernetes 入门教程之八 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 Kubernetes 的入门使用教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Kubernetes 入门教程之八</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-10-08 21:12:19" itemprop="dateCreated datePublished" datetime="2025-10-08T21:12:19+08:00">2025-10-08</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/723af70c.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/723af70c.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>8.4k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>8 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/99bf51b3.html">Kubernetes 入门教程之一</a>、<a href="/posts/c57e8370.html">Kubernetes 入门教程之二</a>、<a href="/posts/2722157d.html">Kubernetes 入门教程之三</a></li><li><a href="/posts/37a21b7b.html">Kubernetes 入门教程之四</a>、<a href="/posts/6bf07963.html">Kubernetes 入门教程之五</a>、<a href="/posts/76121b26.html">Kubernetes 入门教程之六</a></li><li><a href="/posts/2ca57d7f.html">Kubernetes 入门教程之七</a>、<a href="/posts/723af70c.html">Kubernetes 入门教程之八</a>、<a href="/posts/cfb1715d.html">Kubernetes 入门教程之九</a></li></ul><h2 id="Kubernetes-核心技术"><a href="#Kubernetes-核心技术" class="headerlink" title="Kubernetes 核心技术"></a>Kubernetes 核心技术</h2><h3 id="持久化存储"><a href="#持久化存储" class="headerlink" title="持久化存储"></a>持久化存储</h3><h3 id="集群安全机制"><a href="#集群安全机制" class="headerlink" title="集群安全机制"></a>集群安全机制</h3><h4 id="RBAC-的基本概念"><a href="#RBAC-的基本概念" class="headerlink" title="RBAC 的基本概念"></a>RBAC 的基本概念</h4><p>RBAC（Role Based Access Control，基于角色的访问控制）在 Kubernetes <code>v1.5</code> 中首次引入，并在 <code>v1.6</code> 版本升级为 Beta，成为 Kubeadm 安装方式下的默认授权模式。RBAC 的核心思想是：通过角色定义权限，通过角色绑定将权限授予给特定的主体（比如 User、Group、ServiceAccount），从而实现精细化的访问控制。<strong>Kubernetes 集群要启用 RBAC 授权模式，需要在 API Server 的启动参数中添加 <code>--authorization-mode=RBAC</code>。</strong></p><hr><ul><li><p>在 RBAC（基于角色的访问控制）中，主要包含以下四个核心概念：</p><ul><li>角色（Role / ClusterRole）：<ul><li>定义一组可执行的权限规则，即允许对哪些资源执行哪些操作。</li></ul></li><li>角色绑定（RoleBinding / ClusterRoleBinding）：<ul><li>将角色与主体进行关联，从而使主体获得该角色定义的权限。</li></ul></li><li>主体（Subject）：<ul><li>表示可以被授予权限的实体，包括用户（User）、用户组（Group）和服务账户（ServiceAccount）。</li></ul></li><li>权限规则（Policy Rules）：<ul><li>具体描述允许执行的操作，包括对哪些资源（<code>resources</code>）、在哪些命名空间（<code>namespace</code>）、执行哪些动作（<code>verbs</code>）等。</li></ul></li></ul></li><li><p>相比其他访问控制方式，RBAC（基于角色的访问控制）具有以下优势：</p><ul><li>权限覆盖全面：<ul><li>对集群中的资源和非资源类型的访问权限均提供完整支持。</li></ul></li><li>动态调整：<ul><li>可在集群运行时更改权限配置，无需重启 API Server。</li></ul></li><li>API 原生支持：<ul><li>RBAC 由若干 API 对象构成，可像其他 Kubernetes 资源一样通过 <code>kubectl</code> 或 API 进行管理。</li></ul></li></ul></li></ul><hr><ul><li>在访问 Kubernetes 集群的时候，需要经过以下三个步骤：<ul><li>第一步：认证<ul><li>核心目标：<ul><li>用于确认访问者的身份。</li></ul></li><li>访问端口：<ul><li>对外不暴露 <code>8080</code> 端口（仅供集群内部组件访问）；</li><li>对外提供的访问端口为 <code>6443</code>（HTTPS 端口）。</li></ul></li><li>认证方式：<ul><li>HTTPS 证书认证：基于 CA 证书验证客户端身份；</li><li>HTTP Token 认证：通过 Token 标识用户身份；</li><li>HTTP Basic 认证：基于用户名和密码进行身份校验。</li></ul></li></ul></li><li>第二步：鉴权（授权）<ul><li>在确认用户身份后，判断其是否具备执行该操作的权限；</li><li>Kubernetes 主要基于 RBAC（基于角色的访问控制）机制进行鉴权；</li><li>权限通过角色（Role / ClusterRole）与角色绑定（RoleBinding / ClusterRoleBinding）来定义和分配。</li></ul></li><li>第三步：准入控制<ul><li>用于在请求通过认证和鉴权后，对请求内容进行进一步的策略检查；</li><li>本质上是一个由多个准入控制器（Admission Controllers）组成的列表；</li><li>如果请求被这些准入控制器中的规则允许，则放行请求；否则，请求会被拒绝。</li></ul></li></ul></li></ul><div class="admonition note"><p class="admonition-title">提示</p><p>在访问 Kubernetes 的过程中，都需要经过 API Server，由 API Server 做统一协调。比如，访问过程中需要 CA 证书、Token、或者用户名和密码；如果访问 Pod，则需要 Service Account。</p></div><h4 id="RBAC-的-API-资源对象"><a href="#RBAC-的-API-资源对象" class="headerlink" title="RBAC 的 API 资源对象"></a>RBAC 的 API 资源对象</h4><p>在 Kubernetes 中，RBAC 引入了 4 个新的顶级资源对象：Role、ClusterRole、RoleBinding、ClusterRoleBinding。同其他 API 资源对象一样，用户可以使用 <code>kubectl</code> 命令或者 API 调用等方式操作这些资源对象。</p><h5 id="Role（角色）"><a href="#Role（角色）" class="headerlink" title="Role（角色）"></a>Role（角色）</h5><blockquote><p>概念介绍</p></blockquote><ul><li>Role（角色）只能对命名空间内的资源进行授权。</li><li>一个 Role（角色）就是一组权限的集合，这里的权限都是许可形式的，不存在拒绝的规则。</li><li>在一个命名空间中，可以用 Role（角色）来定义一个角色。如果是集群级别的，就需要使用 ClusterRole（集群角色）了。</li></ul><blockquote><p>使用案例</p></blockquote><ul><li>在下面的例子中，定义的 Role（角色）具备读取 Pod 的权限：</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-reader</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">""</span>]    <span class="comment"># 空字符串表示核心 API 组（/api/v1）</span></span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">"pods"</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">"get"</span>, <span class="string">"watch"</span>, <span class="string">"list"</span>]</span><br></pre></td></tr></tbody></table></figure><table><thead><tr><th>参数名称</th><th>说明</th><th>配置示例</th></tr></thead><tbody><tr><td><code>apiGroups</code></td><td>支持的 API 组列表，用于指定资源所属的 API 组。核心组使用空字符串 <code>""</code> 表示。</td><td><code>"", "apps", "batch", "extensions"</code>（对应 <code>apiVersion: v1</code>、<code>apps/v1</code>、<code>batch/v1</code> 等）</td></tr><tr><td><code>resources</code></td><td>支持的资源对象列表，指定该角色可操作的 Kubernetes 资源类型。</td><td><code>pods</code>、<code>deployments</code>、<code>jobs</code>、<code>services</code> 等</td></tr><tr><td><code>verbs</code></td><td>对资源对象的操作方法列表，定义允许的具体操作。</td><td><code>get</code>、<code>watch</code>、<code>list</code>、<code>create</code>、<code>update</code>、<code>delete</code>、<code>patch</code>、<code>replace</code> 等</td></tr></tbody></table><h5 id="ClusterRole（集群角色）"><a href="#ClusterRole（集群角色）" class="headerlink" title="ClusterRole（集群角色）"></a>ClusterRole（集群角色）</h5><blockquote><p>概念介绍</p></blockquote><p>ClusterRole（集群角色）除了具备与 Role（角色）在单一命名空间内相同的资源管理能力外，由于其作用域为集群级别，还可用于授权以下几类对象：</p><ul><li>集群范围的资源，例如 <code>Node</code>（节点）；</li><li>非资源型路径，例如 <code>/healthz</code>；</li><li>跨全部命名空间的资源，例如在所有命名空间中的 <code>pods</code>。</li></ul><blockquote><p>使用案例</p></blockquote><ul><li>在下面的例子中，定义的 ClusterRole（集群角色）可以让用户有权访问任意一个或所有命名空间的 Secrets：</li></ul><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">secret-reader</span></span><br><span class="line">  <span class="comment"># ClusterRole 不受限于命名空间，因此不需要定义 namespace</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">""</span>]     <span class="comment"># 空字符串表示核心 API 组（/api/v1）</span></span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">"secrets"</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">"get"</span>, <span class="string">"watch"</span>, <span class="string">"list"</span>]</span><br></pre></td></tr></tbody></table></figure><table><thead><tr><th>参数名称</th><th>说明</th><th>配置示例</th></tr></thead><tbody><tr><td><code>apiGroups</code></td><td>支持的 API 组列表，用于指定资源所属的 API 组。核心组使用空字符串 <code>""</code> 表示。</td><td><code>"", "apps", "batch", "extensions"</code>（对应 <code>apiVersion: v1</code>、<code>apps/v1</code>、<code>batch/v1</code> 等）</td></tr><tr><td><code>resources</code></td><td>支持的资源对象列表，指定该角色可操作的 Kubernetes 资源类型。</td><td><code>pods</code>、<code>deployments</code>、<code>jobs</code>、<code>services</code> 等</td></tr><tr><td><code>verbs</code></td><td>对资源对象的操作方法列表，定义允许的具体操作。</td><td><code>get</code>、<code>watch</code>、<code>list</code>、<code>create</code>、<code>update</code>、<code>delete</code>、<code>patch</code>、<code>replace</code> 等</td></tr></tbody></table><h5 id="RoleBinding（角色绑定）"><a href="#RoleBinding（角色绑定）" class="headerlink" title="RoleBinding（角色绑定）"></a>RoleBinding（角色绑定）</h5><blockquote><p>核心概念</p></blockquote><ul><li>RoleBinding（角色绑定）用于将一个 Role（角色）绑定到一个指定的主体上，绑定的主体可以是 User（用户）、Group（用户组）或 ServiceAccount（服务账户）。</li><li>RoleBinding（角色绑定）的授权范围限定在某个命名空间内，它可以引用同一命名空间中的 Role，为该命名空间内的资源授予相应的访问权限。</li></ul><blockquote><p>使用案例</p></blockquote><ul><li>在下面的例子中，RoleBinding（角色绑定）将在 <code>default</code> 命名空间中将 <code>pod-reader</code> 角色授予用户 <code>jane</code>，可以让 <code>jane</code> 用户读取 <code>default</code> 命名空间里的 Pod：</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">read-pods</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">jane</span></span><br><span class="line">    <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-reader</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></tbody></table></figure><table><thead><tr><th>参数名称</th><th>说明</th><th>配置示例</th></tr></thead><tbody><tr><td><code>subjects</code></td><td>指定要绑定的访问主体，可以是用户（User）、用户组（Group）或服务账户（ServiceAccount）。此处绑定的主体是名为 <code>jane</code> 的用户。</td><td><code>jane</code></td></tr><tr><td><code>roleRef</code></td><td>指定要绑定的角色，用于定义该主体可执行的权限操作。此处引用的是命名空间内的 <code>pod-reader</code> 角色。</td><td><code>pod-reader</code></td></tr><tr><td><code>namespace</code></td><td>指定 RoleBinding 所属的命名空间，授权范围仅限于该命名空间内。此处为 <code>default</code> 命名空间。</td><td><code>default</code></td></tr></tbody></table><div class="admonition warning"><p class="admonition-title">特别注意</p><p>RoleBinding 除了可以引用 Role，还可以引用 ClusterRole，对属于同一命名空间内 ClusterRole 定义的资源主体进行授权。一种常见的做法是 Kubernetes 集群管理员为集群范围预先定义好一组角色（ClusterRole），然后在多个命名空间中重复使用这些 ClusterRole。</p></div><ul><li>在下面的例子中，使用 RoleBinding 绑定 ClusterRole（集群角色）<code>secret-reader</code>，使用户 <code>dave</code> 只能读取 <code>development</code> 命名空间中的 Secret：</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">read-secrets</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">development</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dave</span></span><br><span class="line">    <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">secret-reader</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></tbody></table></figure><ul><li>配置说明：<ul><li>RoleBinding 将集群角色 <code>secret-reader</code> 授权给命名空间 <code>development</code> 中的用户 <code>dave</code>。</li><li>虽然绑定的是 集群角色（ClusterRole），但作用仍限定在 <code>development</code> 命名空间。</li><li><code>subjects</code> 指定了被授权的主体，<code>roleRef</code> 指定了要绑定的集群角色（ClusterRole）。</li></ul></li></ul><h5 id="ClusterRoleBinding（集群角色绑定）"><a href="#ClusterRoleBinding（集群角色绑定）" class="headerlink" title="ClusterRoleBinding（集群角色绑定）"></a>ClusterRoleBinding（集群角色绑定）</h5><blockquote><p>核心概念</p></blockquote><ul><li>ClusterRoleBinding（集群角色绑定）用于将一个 ClusterRole（集群角色）绑定到一个指定的主体上，绑定的主体可以是 User（用户）、Group（用户组）或 ServiceAccount（服务账户）。</li><li>ClusterRoleBinding（集群角色绑定）的授权范围为整个集群，它可以引用任意命名空间中的 ServiceAccount，并为所有命名空间或集群级资源授予相应的访问权限。</li><li>ClusterRoleBinding（集群角色绑定）中的角色只能是 ClusterRole（集群角色），不能是 Role（角色），用于执行集群级别或者对所有命名空间都生效的授权操作。</li></ul><blockquote><p>使用案例</p></blockquote><ul><li>在下面的例子中，使用 ClusterRoleBinding 绑定 ClusterRole（集群角色）<code>secret-reader</code>，允许 <code>manager</code> 组的用户读取所有命名空间中的 Secret：</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">read-secrets-global</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">Group</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">manager</span></span><br><span class="line">    <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">secret-reader</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></tbody></table></figure><ul><li>配置说明：<ul><li>ClusterRoleBinding 将集群角色 <code>secret-reader</code> 授权给整个集群中的用户组 <code>manager</code>。</li><li>授权作用范围为整个集群，不仅限于某个命名空间。</li><li><code>subjects</code> 指定了被授权的主体，<code>roleRef</code> 指定了要绑定的集群角色（ClusterRole）。</li></ul></li></ul><h4 id="RBAC-对资源的引用方式"><a href="#RBAC-对资源的引用方式" class="headerlink" title="RBAC 对资源的引用方式"></a>RBAC 对资源的引用方式</h4><ul><li>多数 Kubernetes 资源可以通过其名称字符串表示，即在 Endpoint 的 URL 相对路径中体现，例如 <code>pods</code>。</li><li>某些 Kubernetes API 包含下级资源，例如 Pod 的日志 (<code>logs</code>)。<ul><li>例如，Pod 日志的访问路径为： <code>GET /api/v1/namespaces/{namespaces}/pods/{name}/log</code>。</li><li>在这个例子中，Pod 是命名空间内的主资源，而 <code>log</code> 是 Pod 的下级资源。</li></ul></li><li>如果要在 RBAC 角色（Role 或 ClusterRole）中体现这种层级关系，需要用斜杠 <code>/</code> 来分隔主资源和下级资源。<ul><li>例如，如果希望某个主体同时拥有读取 Pod 以及读取 Pod 日志的权限，则可以配置 <code>resources</code> 为一个数组：<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-and-pod-logs-reader</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">""</span>]                  <span class="comment"># 空字符串表示核心 API 组（/api/v1）</span></span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">"pods"</span>, <span class="string">"pods/log"</span>]  <span class="comment"># 同时包含了主资源 pods 和下级资源 pods/log</span></span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">"get"</span>, <span class="string">"list"</span>]           <span class="comment"># 指定该角色允许执行的操作</span></span><br></pre></td></tr></tbody></table></figure></li></ul></li><li>Kubernetes 资源还可以通过名称（ResourceName）进行引用。<ul><li>在指定 ResourceName 后，使用 <code>get</code>、<code>delete</code>、<code>update</code>、<code>patch</code> 动词的请求，就会被限制在这个资源实例范围内。</li><li>例如，下面的声明可以授权一个主体只能对一个叫 <code>my-configmap</code> 的 ConfigMap 执行 <code>get</code> 和 <code>update</code> 操作：<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">configmap-updater</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">""</span>]                   <span class="comment"># 空字符串表示核心 API 组（/api/v1）</span></span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">"configmaps"</span>]         <span class="comment"># resources 应为复数形式，比如 configmaps</span></span><br><span class="line">    <span class="attr">resourceNames:</span> [<span class="string">"my-configmap"</span>]   <span class="comment"># 指定作用对象</span></span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">"update"</span>, <span class="string">"get"</span>]          <span class="comment"># 指定该角色允许执行的操作</span></span><br></pre></td></tr></tbody></table></figure></li></ul></li></ul><h4 id="RBAC-中常见的角色定义示例"><a href="#RBAC-中常见的角色定义示例" class="headerlink" title="RBAC 中常见的角色定义示例"></a>RBAC 中常见的角色定义示例</h4><ul><li>(1) 允许读取核心 API 组中 Pod 的资源</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">""</span>]   <span class="comment"># 空字符串表示核心 API 组（/api/v1）</span></span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">"pods"</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>]</span><br></pre></td></tr></tbody></table></figure><ul><li>(2) 允许读写 <code>extensions</code> 和 <code>apps</code> 两个 API 组中的 <code>deployment</code> 资源</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">"extensions"</span>, <span class="string">"apps"</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">"deployments"</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>, <span class="string">"create"</span>, <span class="string">"update"</span>, <span class="string">"patch"</span>, <span class="string">"delete"</span>]</span><br></pre></td></tr></tbody></table></figure><ul><li>(3) 允许读写 <code>pods</code> 及读写 <code>jobs</code></li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">""</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">"pods"</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">"batch"</span>, <span class="string">"extensions"</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">"jobs"</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>, <span class="string">"create"</span>, <span class="string">"update"</span>, <span class="string">"patch"</span>, <span class="string">"delete"</span>]</span><br></pre></td></tr></tbody></table></figure><ul><li>(4) 允许读取一个名为 <code>my-config</code> 的 ConfigMap（必须绑定到一个 RoleBinding 来限制到一个命名空间下的 ConfigMap）：</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">""</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">"configmaps"</span>]</span><br><span class="line">    <span class="attr">resourceNames:</span> [<span class="string">"my-config"</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">"get"</span>]</span><br></pre></td></tr></tbody></table></figure><ul><li>(5) 允许读取核心 API 组的 Node 资源（Node 属于集群级别的资源，必须放在 ClusterRole 中，并使用 ClusterRoleBinding 进行绑定）：</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">""</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">"nodes"</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>]</span><br></pre></td></tr></tbody></table></figure><ul><li>(6) 允许对非资源端点 <code>/healthz</code> 及其所有子路径进行 GET / POST 操作（必须使用 ClusterRole 和 ClusterRoleBinding）</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">nonResourceURLs:</span> [<span class="string">"/healthz"</span>, <span class="string">"/healthz/*"</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">"get"</span>, <span class="string">"post"</span>]</span><br></pre></td></tr></tbody></table></figure><h4 id="RBAC-中常用的角色绑定示例"><a href="#RBAC-中常用的角色绑定示例" class="headerlink" title="RBAC 中常用的角色绑定示例"></a>RBAC 中常用的角色绑定示例</h4><ul><li>绑定用户名 <code>Alice@example.com</code></li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">"Alice@example.com"</span></span><br><span class="line">    <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></tbody></table></figure><ul><li>绑定组名 <code>frontend-admins</code></li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">Group</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">"frontend-admins"</span></span><br><span class="line">    <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></tbody></table></figure><ul><li>绑定 <code>kube-system</code> 命名空间中的默认 Service Account</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">Group</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">system:authentication</span></span><br><span class="line">    <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">Group</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">system:unauthentication</span></span><br><span class="line">    <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></tbody></table></figure><h4 id="RBAC-中默认的角色和角色绑定"><a href="#RBAC-中默认的角色和角色绑定" class="headerlink" title="RBAC 中默认的角色和角色绑定"></a>RBAC 中默认的角色和角色绑定</h4><p>API Server 会创建一套默认的 ClusterRole 和 ClusterRoleBinding 资源对象，其中很多是以 <code>system:</code> 为前缀的，以表明这些资源属于基础架构，对这些对象的改动可能会造成集群故障。所有默认的 ClusterRole 和 RoleBinding 资源对象都会用标签 <code>kubernetes.io/bootstrapping=rbac-defaults</code> 进行标记。</p><blockquote><p>常见的系统角色</p></blockquote><table><thead><tr><th>默认的 ClusterRole</th><th> 默认的 ClusterRoleBinding</th><th> 描述</th></tr></thead><tbody><tr><td><code>system:basic-user</code></td><td><code>system:authenticated</code> 和 <code>system:unauthorized</code> 组</td><td>让用户能够读取自身的信息</td></tr><tr><td><code>system:discovery</code></td><td><code>system:authenticated</code> 和 <code>system:unauthorized</code> 组</td><td>对 API 发现 Endpoint 的只读访问，用于 API 级别的发现和协商</td></tr></tbody></table><blockquote><p>常见的用户角色</p></blockquote><p>有些默认角色不是以 <code>system:</code> 为前缀的，这部分角色是针对用户的，其中包含超级用户角色 <code>cluster-admin</code>，有的用于集群一级的角色 <code>cluster-status</code>，还有针对命名空间的角色 <code>admin</code>、<code>edit</code>、<code>view</code>。</p><table><thead><tr><th>默认的 ClusterRole</th><th> 默认的 ClusterRoleBinding</th><th> 描述</th></tr></thead><tbody><tr><td><code>cluster-admin</code></td><td><code>system:masters</code> 组</td><td>让超级用户可以对任何资源执行任何操作。如果在 ClusterRoleBinding 中使用，则影响的是整个集群的所有 NameSpace 中的任何资源；如果使用的是 RoleBinding，则能控制这一绑定的 NameSpace 中的资源，还包括 NameSpace 本身</td></tr><tr><td><code>cluster-status</code></td><td>None</td><td> 可以对基础集群状态信息进行只读访问</td></tr><tr><td><code>admin</code></td><td>None</td><td> 允许 <code>admin</code> 访问，可以限制在一个 NameSpace 中使用 RoleBinding。如果在 RoleBinding 中使用，则允许对 NameSpace 中的大多数资源进行读写访问，其中包含创建角色和角色绑定的能力。这一角色不允许操作 NameSpace 本身，也不能写入资源限制</td></tr><tr><td><code>edit</code></td><td>None</td><td> 允许对 NameSpace 内的大多数资源进行读写操作，不允许查看或更改角色，以及角色绑定</td></tr><tr><td><code>view</code></td><td>None</td><td> 允许对多数资源对象进行只读操作，但是对角色、角色绑定及 Secret 是不可访问的</td></tr></tbody></table><blockquote><p>核心 Master 组件角色</p></blockquote><table><thead><tr><th>默认的 ClusterRole</th><th> 默认的 ClusterRoleBinding</th><th> 描述</th></tr></thead><tbody><tr><td><code>system:kube-scheduler</code></td><td><code>system:kube-scheduler</code> 用户</td><td>能够访问 kube-scheduler 组件所需的资源</td></tr><tr><td><code>system:kube-controller-manager</code></td><td><code>system:kube-controller-manager</code> 用户</td><td>能够访问 kube-controller-manager 组件所需的资源</td></tr><tr><td><code>system:node</code></td><td><code>system:nodes</code> 组</td><td><br>- 允许访问 kubelet 所需的资源，包括对 Secret 的读取，以及对 Pod 的写入<br>- 未来会把上面的两个权限限制在分配到本 Node 的对象上<br>- 今后的鉴权过程，kubelet 必须以 <code>system:node</code> 及一个 <code>system:node</code> 形式的用户名进行。参看 <code>https://pr.k8s.io/40476</code></td></tr><tr><td><code>system:node-proxier</code></td><td><code>system:kube-proxy</code> 用户</td><td>允许访问 kube-proxy 所需的资源</td></tr><tr><td><code>system:kube-scheduler</code></td><td><code>system:kube-scheduler</code> 用户</td><td>能够访问 kube-scheduler 组件所需的资源</td></tr></tbody></table><h4 id="RBAC-中预防提权和授权初始化"><a href="#RBAC-中预防提权和授权初始化" class="headerlink" title="RBAC 中预防提权和授权初始化"></a>RBAC 中预防提权和授权初始化</h4><ul><li>RBAC API 会拒绝用户通过编辑角色或角色绑定的方式进行提权。这一限制是在 API 层面实现的，因此即使 RBAC 未启用，该限制仍然有效。</li><li>用户只能在拥有某个角色的所有权限，且与该角色的生效范围一致的前提下，才能对角色进行创建和更改。例如，用户 <code>user-1</code> 没有列出集群中所有 Secret 的权限，就无法创建具有该权限的 <code>ClusterRole</code>。</li><li>要让一个用户能够创建或者更改角色，需要满足以下条件：<ul><li>授予用户一个允许创建 / 更改 <code>Role</code> 或 <code>ClusterRole</code> 资源对象的角色；</li><li>为用户授予角色时，要覆盖该用户所能控制的所有权限范围。</li></ul></li><li>如果用户尝试创建超出自身权限的 Role 或 ClusterRole，该 API 调用会被拒绝。</li><li>如果一个用户的权限包含了某个角色的所有权限，则可以为其创建和更改该角色的绑定；或者，如果用户被授予了针对某个角色的绑定授权，也可以完成此操作。<ul><li>例如，用户 <code>user-1</code> 没有列出集群中所有 Secret 的权限，因此无法为一个具有此权限的角色创建 ClusterRoleBinding。要使用户能够创建或更改该角色绑定，需要：<ul><li>授予用户一个允许创建和更改 <code>RoleBinding</code> 或 <code>ClusterRoleBinding</code> 的角色；</li><li>授予用户绑定某一角色的权限，可以通过两种方式：<ul><li>隐式：让用户拥有该角色的所有权限；</li><li>显式：授予用户针对该角色或 ClusterRoleBinding 的操作权限。</li></ul></li></ul></li></ul></li><li>在进行第一个角色和角色绑定时，必须让初始用户具备其尚未被授予的权限，要进行初始的角色和角色绑定设置，有以下两种方法:<ul><li> 使用属于 <code>system:masters</code> 组的身份，这一群组默认具有 <code>cluster-admin</code> 这一超级用户角色的绑定；</li><li>如果 API Server 以 <code>--insecure-port</code> 参数启动，则客户端通过这个非安全端口进行接口调用，这一端口没有认证鉴权的限制。</li></ul></li></ul><blockquote><p>举个例子，允许用户 <code>user-1</code> 在 <code>user-1-namespace</code> 命名空间中，可以对其他用户授予 <code>admin</code>、<code>edit</code> 及 <code>view</code> 角色</p></blockquote><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">role-grantor</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">"rbac.authorization.k8s.io"</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">"rolebindings"</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">"create"</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">"rbac.authorization.k8s.io"</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">"clusterroles"</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">"bind"</span>]</span><br><span class="line">    <span class="attr">resourceNames:</span> [<span class="string">"admin"</span>, <span class="string">"edit"</span>, <span class="string">"view"</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">role-grantor-binding</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">user-1-namespace</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">user-1</span></span><br><span class="line">    <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">role-grantor</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></tbody></table></figure><h4 id="RBAC-的完整使用演示案例"><a href="#RBAC-的完整使用演示案例" class="headerlink" title="RBAC 的完整使用演示案例"></a>RBAC 的完整使用演示案例</h4><div class="admonition note"><p class="admonition-title">提示</p><ul><li>本节将演示如何在 Kubernetes 集群中使用 RBAC，并通过 CA 证书进行认证（识别身份）。</li><li><strong>Kubernetes 集群要启用 RBAC 授权模式，需要在 API Server 的启动参数中添加 <code>--authorization-mode=RBAC</code>。</strong></li></ul></div><blockquote><p><strong>(1) 创建命名空间</strong></p></blockquote><ul><li>创建命名空间</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create ns roledemo</span><br></pre></td></tr></tbody></table></figure><ul><li>查看所有命名空间</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get ns</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NAME              STATUS   AGE</span><br><span class="line">default           Active   83d</span><br><span class="line">kube-flannel      Active   81d</span><br><span class="line">kube-node-lease   Active   83d</span><br><span class="line">kube-public       Active   83d</span><br><span class="line">kube-system       Active   83d</span><br><span class="line">roledemo          Active   111m</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>(2) 创建 Deployment</strong></p></blockquote><ul><li>通过 YAML 文件（比如 <code>nginx-deploy.yaml</code>）创建 Deployment（用于创建和管理 Pod）</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deploy</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">roledemo</span>     <span class="comment"># 指定命名空间</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx:1.15</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建或更新 YAML 文件中定义的 Deployment 对象</span></span><br><span class="line">kubectl apply<span class="params"> -f</span> nginx-deploy.yaml</span><br></pre></td></tr></tbody></table></figure><ul><li>查看特定命名空间内的所有 Pod</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods<span class="params"> -n</span> roledemo</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-deploy-85b7dd6b6d-29gs6   1/1     Running   0          16s</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>(3) 创建 Role（角色）</strong></p></blockquote><ul><li>通过 YAML 文件（比如 <code>role-demo.yaml</code>）创建 Role（角色）</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">roledemo</span>     <span class="comment"># 指定命名空间</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-reader</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">""</span>]                     <span class="comment"># 空字符串表示核心 API 组（/api/v1）</span></span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">"pods"</span>]                 <span class="comment"># resources 应为复数形式，比如 pods</span></span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">"get"</span>, <span class="string">"watch"</span>, <span class="string">"list"</span>]     <span class="comment"># 指定该角色允许执行的操作</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建或更新 YAML 文件中定义的 Role 对象</span></span><br><span class="line">kubectl apply<span class="params"> -f</span> role-demo.yaml</span><br></pre></td></tr></tbody></table></figure><ul><li>查看特定命名空间内的所有 Role（角色）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get roles<span class="params"> -n</span> roledemo</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME         CREATED AT</span><br><span class="line">pod-reader   2025-10-08T11:47:10Z</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>(4) 创建 RoleBinding（角色绑定）</strong></p></blockquote><ul><li>通过 YAML 文件（比如 <code>rolebinding-demo.yaml</code>）创建 RoleBinding（角色绑定）</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">read-pods</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">roledemo</span>     <span class="comment"># 指定命名空间</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mary</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-reader</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建或更新 YAML 文件中定义的 RoleBinding（角色绑定）</span></span><br><span class="line">kubectl apply<span class="params"> -f</span> rolebinding-demo.yaml</span><br></pre></td></tr></tbody></table></figure><ul><li>查看特定命名空间内的所有 RoleBinding（角色绑定）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get rolebindings<span class="params"> -n</span> roledemo</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME        ROLE              AGE</span><br><span class="line">read-pods   Role/pod-reader   2m43s</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>(5) 基于 CFSSL 生成 CA 证书</strong></p></blockquote><ul><li>创建 <code>ca-config.json</code> 文件</li></ul><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"signing"</span>: {</span><br><span class="line">      <span class="attr">"default"</span>: {</span><br><span class="line">          <span class="attr">"expiry"</span>: <span class="string">"87600h"</span></span><br><span class="line">      },</span><br><span class="line">      <span class="attr">"profiles"</span>: {</span><br><span class="line">          <span class="attr">"kubernetes"</span>: {</span><br><span class="line">              <span class="attr">"expiry"</span>: <span class="string">"87600h"</span>,</span><br><span class="line">              <span class="attr">"usages"</span>: [</span><br><span class="line">                  <span class="string">"signing"</span>,</span><br><span class="line">                  <span class="string">"key encipherment"</span>,</span><br><span class="line">                  <span class="string">"server auth"</span>,</span><br><span class="line">                  <span class="string">"client auth"</span></span><br><span class="line">              ]</span><br><span class="line">          }</span><br><span class="line">      }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>创建 <code>ca-csr.json</code> 文件</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="attr">"CN":</span> <span class="string">"kubernetes"</span>,</span><br><span class="line">    <span class="attr">"key":</span> {</span><br><span class="line">        <span class="attr">"algo":</span> <span class="string">"rsa"</span>,</span><br><span class="line">        <span class="attr">"size":</span> <span class="number">2048</span></span><br><span class="line">    },</span><br><span class="line">    <span class="attr">"names":</span> [</span><br><span class="line">        {</span><br><span class="line">            <span class="attr">"C":</span> <span class="string">"CN"</span>,</span><br><span class="line">            <span class="attr">"L":</span> <span class="string">"Beijing"</span>,</span><br><span class="line">            <span class="attr">"ST":</span> <span class="string">"Beijing"</span>,</span><br><span class="line">            <span class="attr">"O":</span> <span class="string">"k8s"</span>,</span><br><span class="line">            <span class="attr">"OU":</span> <span class="string">"System"</span></span><br><span class="line">        }</span><br><span class="line">    ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>创建 <code>mary-csr.json</code> 文件</li></ul><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="attr">"CN"</span>: <span class="string">"mary"</span>,</span><br><span class="line">  <span class="attr">"hosts"</span>: [],</span><br><span class="line">  <span class="attr">"key"</span>: {</span><br><span class="line">    <span class="attr">"algo"</span>: <span class="string">"rsa"</span>,</span><br><span class="line">    <span class="attr">"size"</span>: <span class="number">2048</span></span><br><span class="line">  },</span><br><span class="line">  <span class="attr">"names"</span>: [</span><br><span class="line">    {</span><br><span class="line">      <span class="attr">"C"</span>: <span class="string">"CN"</span>,</span><br><span class="line">      <span class="attr">"L"</span>: <span class="string">"BeiJing"</span>,</span><br><span class="line">      <span class="attr">"ST"</span>: <span class="string">"BeiJing"</span></span><br><span class="line">    }</span><br><span class="line">  ]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>拷贝 Kubernetes 集群搭建时所创建的 CA 证书（包括 <code>ca.pem</code> 和 <code>ca-key.pem</code>），<strong>请自行更改 CA 证书的路径</strong></li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /opt/kubernetes/ssl/ca* .</span><br></pre></td></tr></tbody></table></figure><ul><li>查看当前目录下的文件列表（最重要的是 <code>ca-key.pem</code>、<code>ca.pem</code> 文件）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls .</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ca-config.json  ca-csr.json  ca-key.pem  ca.pem  mary-csr.json  nginx-deploy.yaml  rolebinding-demo.yaml  role-demo.yaml</span><br></pre></td></tr></tbody></table></figure><ul><li>通过 CFSSL 工具生成 CA 证书</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert<span class="params"> -ca</span>=ca.pem<span class="params"> -ca</span>-key=ca-key.pem<span class="params"> -config</span>=ca-config.json<span class="params"> -profile</span>=kubernetes mary-csr.json | cfssljson<span class="params"> -bare</span> mary</span><br></pre></td></tr></tbody></table></figure><ul><li>查看当前目录下的文件列表（最重要的是新生成的 <code>mary.csr</code>、<code>mary-key.pem</code>、<code>mary.pem</code> 文件）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls .</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ca-config.json  ca-csr.json  ca-key.pem  ca.pem  mary.csr  mary-csr.json  mary-key.pem  mary.pem  nginx-deploy.yaml  rolebinding-demo.yaml  role-demo.yaml</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>(6) 为用户创建一个独立的 kubeconfig 配置文件</strong></p></blockquote><ul><li>定义集群连接信息（API Server 地址 + CA 证书），<strong>请自行将 <code>192.168.2.191</code> 更改为 API Server 的 IP 地址</strong></li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl config <span class="built_in">set</span>-cluster kubernetes \<span class="params"></span></span><br><span class="line"><span class="params">  --certificate</span>-authority=ca.pem \<span class="params"></span></span><br><span class="line"><span class="params">  --embed</span>-certs=<span class="literal">true</span> \<span class="params"></span></span><br><span class="line"><span class="params">  --server</span>=https://192.168.2.191:6443 \<span class="params"></span></span><br><span class="line"><span class="params">  --kubeconfig</span>=mary-kubeconfig</span><br></pre></td></tr></tbody></table></figure><ul><li>配置用户身份（客户端证书和私钥）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl config <span class="built_in">set</span>-credentials mary \<span class="params"></span></span><br><span class="line"><span class="params">  --client</span>-key=mary-key.pem \<span class="params"></span></span><br><span class="line"><span class="params">  --client</span>-certificate=mary.pem \<span class="params"></span></span><br><span class="line"><span class="params">  --embed</span>-certs=<span class="literal">true</span> \<span class="params"></span></span><br><span class="line"><span class="params">  --kubeconfig</span>=mary-kubeconfig</span><br></pre></td></tr></tbody></table></figure><ul><li>将集群与用户 <code>mary</code> 绑定成一个上下文</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl config <span class="built_in">set</span>-context default \<span class="params"></span></span><br><span class="line"><span class="params">  --cluster</span>=kubernetes \<span class="params"></span></span><br><span class="line"><span class="params">  --user</span>=mary \<span class="params"></span></span><br><span class="line"><span class="params">  --kubeconfig</span>=mary-kubeconfig</span><br></pre></td></tr></tbody></table></figure><ul><li>切换到 <code>default</code> 上下文，使后续 <code>kubectl</code> 命令能够以用户 <code>mary</code> 的身份访问集群</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context default<span class="params"> --kubeconfig</span>=mary-kubeconfig</span><br></pre></td></tr></tbody></table></figure><ul><li>查看当前目录下的文件列表（最重要的是新生成的 <code>mary-kubeconfig</code> 文件）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls .</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ca-config.json  ca-csr.json  ca-key.pem  ca.pem  mary.csr  mary-csr.json  mary-key.pem  mary-kubeconfig  mary.pem  nginx-deploy.yaml  rolebinding-demo.yaml  role-demo.yaml</span><br></pre></td></tr></tbody></table></figure><ul><li>查看凭证（用户）信息</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl<span class="params"> --kubeconfig</span>=mary-kubeconfig config view<span class="params"> --minify</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">clusters:</span><br><span class="line">- cluster:</span><br><span class="line">    certificate-authority-data: DATA+OMITTED</span><br><span class="line">    server: https://192.168.2.191:6443</span><br><span class="line">  name: kubernetes</span><br><span class="line">contexts:</span><br><span class="line">- context:</span><br><span class="line">    cluster: kubernetes</span><br><span class="line">    user: mary</span><br><span class="line">  name: default</span><br><span class="line">current-context: default</span><br><span class="line">kind: Config</span><br><span class="line">preferences: {}</span><br><span class="line">users:</span><br><span class="line">- name: mary</span><br><span class="line">  user:</span><br><span class="line">    client-certificate-data: REDACTED</span><br><span class="line">    client-key-data: REDACTED</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>(7) 验证 RBAC 控制是否生效</strong></p></blockquote><ul><li>验证用户是否可以访问已被允许的资源，正常情况下用户 <code>mary</code> 可以在命名空间 <code>roledemo</code> 下列出或者查看 Pod</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods<span class="params"> -n</span> roledemo<span class="params"> --kubeconfig</span>=mary-kubeconfig</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-deploy-85b7dd6b6d-29gs6   1/1     Running   1          18h</span><br></pre></td></tr></tbody></table></figure><ul><li>验证用户是否可以越权访问其他命名空间的资源，正常情况下用户 <code>mary</code> 不可以在其他命名空间（比如 <code>default</code>）下列出或者查看 Pod</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods<span class="params"> -n</span> default<span class="params"> --kubeconfig</span>=mary-kubeconfig</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error from server (Forbidden): pods is forbidden: User "mary" cannot list resource "pods" in API group "" in the namespace "default"</span><br></pre></td></tr></tbody></table></figure><ul><li>验证用户是否可以执行未被允许的操作（例如，删除 Pod），正常情况下用户 <code>mary</code> 不能执行删除 Pod 的操作</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod nginx-deploy-85b7dd6b6d-29gs6<span class="params"> -n</span> roledemo<span class="params"> --kubeconfig</span>=mary-kubeconfig</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error from server (Forbidden): pods "nginx-deploy-85b7dd6b6d-29gs6" is forbidden: User "mary" cannot delete resource "pods" in API group "" in the namespace "roledemo"</span><br></pre></td></tr></tbody></table></figure><ul><li>通过 API Server + CA 证书直接验证用户身份，如果身份验证失败，可以添加 <code>-v</code> 参数让 <code>curl</code> 命令输出详细的日志信息来排查问题</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl<span class="params"> --cert</span> ./mary.pem<span class="params"> --key</span> ./mary-key.pem<span class="params"> --cacert</span> ./ca.pem https://192.168.2.191:6443/api/v1/namespaces/roledemo/pods</span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 或者，curl 命令加上 -v 参数，输出详细的日志信息</span></span><br><span class="line">curl<span class="params"> -v</span><span class="params"> --cert</span> ./mary.pem<span class="params"> --key</span> ./mary-key.pem<span class="params"> --cacert</span> ./ca.pem https://192.168.2.191:6443/api/v1/namespaces/roledemo/pods</span><br></pre></td></tr></tbody></table></figure><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/723af70c.html" title="Kubernetes 入门教程之八">https://www.techgrow.cn/posts/723af70c.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%AE%B9%E5%99%A8%E5%8C%96/" rel="tag"><i class="fa fa-tag"></i> 容器化</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/cfb1715d.html" rel="prev" title="Kubernetes 入门教程之九"><i class="fa fa-angle-left"></i> Kubernetes 入门教程之九</a></div><div class="post-nav-item"> <a href="/posts/ef54a41c.html" rel="next" title="Java 与 Dubbo 的 SPI 机制介绍">Java 与 Dubbo 的 SPI 机制介绍<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2.1m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">31:35</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/723af70c.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>