<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 C 语言的面向接口编程和多态使用，包括数组类型、数组指针类型、函数类型、函数指针类型、函数类型和函数指针作为函数参数、DLL 动态链接库的创建与调用等。"><meta property="og:type" content="article"><meta property="og:title" content="C 语言面向接口编程和多态使用"><meta property="og:url" content="https://www.techgrow.cn/posts/1844a1fe.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 C 语言的面向接口编程和多态使用，包括数组类型、数组指针类型、函数类型、函数指针类型、函数类型和函数指针作为函数参数、DLL 动态链接库的创建与调用等。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2021/11/cplusplus-create-dll-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2021/11/cplusplus-create-dll-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2021/11/cplusplus-create-dll-3.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2021/11/cplusplus-create-dll-4.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2021/11/cplusplus-load-dll-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2021/11/cplusplus-load-dll-1.png"><meta property="article:published_time" content="2021-06-03T13:13:21.000Z"><meta property="article:modified_time" content="2021-06-06T13:13:21.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="C语言"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2021/11/cplusplus-create-dll-1.png"><link rel="canonical" href="https://www.techgrow.cn/posts/1844a1fe.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/1844a1fe.html","path":"posts/1844a1fe.html","title":"C 语言面向接口编程和多态使用"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>C 语言面向接口编程和多态使用 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/app/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E6%8C%87%E9%92%88"><span class="nav-text">数组指针</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%AF%AD%E6%B3%95"><span class="nav-text">数组类型的语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E6%8C%87%E9%92%88%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%AF%AD%E6%B3%95"><span class="nav-text">数组指针类型的语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B%E4%B8%8E%E6%95%B0%E7%BB%84%E6%8C%87%E9%92%88%E7%B1%BB%E5%9E%8B%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">数组类型与数组指针类型的使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88"><span class="nav-text">函数指针</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%AF%AD%E6%B3%95"><span class="nav-text">函数类型的语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%AF%AD%E6%B3%95"><span class="nav-text">函数指针类型的语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%E7%B1%BB%E5%9E%8B%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">函数类型与函数指针类型的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%E4%BD%9C%E4%B8%BA%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0"><span class="nav-text">函数类型与函数指针作为函数参数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B%E4%BD%9C%E4%B8%BA%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0"><span class="nav-text">函数类型作为函数参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%E4%BD%9C%E4%B8%BA%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0"><span class="nav-text">函数指针作为函数参数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DLL-%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">DLL 动态链接库的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E8%AF%B4%E6%98%8E"><span class="nav-text">运行环境说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DLL-%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-text">DLL 项目的创建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA-DLL-%E9%A1%B9%E7%9B%AE"><span class="nav-text">新建 DLL 项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99-DLL-%E4%BB%A3%E7%A0%81"><span class="nav-text">编写 DLL 代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%9F%E6%88%90-DLL-%E6%96%87%E4%BB%B6"><span class="nav-text">生成 DLL 文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E4%BB%A3%E7%A0%81%E4%B8%8B%E8%BD%BD"><span class="nav-text">案例代码下载</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DLL-%E7%9A%84%E4%B8%A4%E7%A7%8D%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-text">DLL 的两种调用方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#DLL-%E5%8A%A8%E6%80%81%E8%B0%83%E7%94%A8"><span class="nav-text">DLL 动态调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DLL-%E9%9D%99%E6%80%81%E8%B0%83%E7%94%A8"><span class="nav-text">DLL 静态调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E4%BB%A3%E7%A0%81%E4%B8%8B%E8%BD%BD-1"><span class="nav-text">案例代码下载</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E5%8D%9A%E5%AE%A2"><span class="nav-text">参考博客</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">596</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">52</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/1844a1fe.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="C 语言面向接口编程和多态使用 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 C 语言的面向接口编程和多态使用，包括数组类型、数组指针类型、函数类型、函数指针类型、函数类型和函数指针作为函数参数、DLL 动态链接库的创建与调用等。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> C 语言面向接口编程和多态使用</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-06-03 21:13:21" itemprop="dateCreated datePublished" datetime="2021-06-03T21:13:21+08:00">2021-06-03</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-06-06 21:13:21" itemprop="dateModified" datetime="2021-06-06T21:13:21+08:00">2021-06-06</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/1844a1fe.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/1844a1fe.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>2.5k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>2 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="数组指针"><a href="#数组指针" class="headerlink" title="数组指针"></a>数组指针</h2><h3 id="数组类型的语法"><a href="#数组类型的语法" class="headerlink" title="数组类型的语法"></a>数组类型的语法</h3><p>C 语言中的数组有自己特定的类型，可以通过 <code>typedef</code> 关键字定义数组类型，语法格式为：<code>typedef type(name)[length];</code>，例如：</p><ul><li><code>typedef int(MyIntArray)[3];</code></li><li><code>typedef char(MyCharArray)[3];</code></li></ul><h3 id="数组指针类型的语法"><a href="#数组指针类型的语法" class="headerlink" title="数组指针类型的语法"></a>数组指针类型的语法</h3><ul><li>数组指针类型用于指向一个数组</li><li>可以直接定义数组指针类型：<code>typedef type(*name)[length];</code></li></ul><span id="more"></span><h3 id="数组类型与数组指针类型的使用"><a href="#数组类型与数组指针类型的使用" class="headerlink" title="数组类型与数组指针类型的使用"></a>数组类型与数组指针类型的使用</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="comment">// 1. 定义数组类型（会分配内存空间）</span></span><br><span class="line">	<span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(MyArray)</span>[3]</span>;</span><br><span class="line"></span><br><span class="line">	MyArray <span class="built_in">array</span>;</span><br><span class="line">	<span class="built_in">array</span>[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">array</span>[<span class="number">1</span>] = <span class="number">2</span>;</span><br><span class="line">	<span class="built_in">array</span>[<span class="number">2</span>] = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) {</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"array[%d] = %d\n"</span>, i, <span class="built_in">array</span>[i]);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. 定义数组指针类型（不会分配内存空间）</span></span><br><span class="line">	<span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(*MyPointArray)</span>[3]</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> a[<span class="number">3</span>];</span><br><span class="line">	MyPointArray pointArray;</span><br><span class="line">	pointArray = &amp;a;	<span class="comment">// 将数组指针类型指向一个数组</span></span><br><span class="line">	(*pointArray)[<span class="number">0</span>] = <span class="number">11</span>;</span><br><span class="line">	(*pointArray)[<span class="number">1</span>] = <span class="number">22</span>;</span><br><span class="line">	(*pointArray)[<span class="number">2</span>] = <span class="number">33</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) {</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"a[%d] = %d, "</span>, j, a[j]);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"(*pointArray)[%d] = %d\n"</span>, j, (*pointArray)[j]);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. 定义一个数组指针变量（不会分配内存空间）</span></span><br><span class="line">	<span class="keyword">int</span>(*pointArrayVar)[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> b[<span class="number">3</span>];</span><br><span class="line">	pointArrayVar = &amp;b;		<span class="comment">// 将数组指针变量指向一个数组</span></span><br><span class="line">	(*pointArrayVar)[<span class="number">0</span>] = <span class="number">111</span>;</span><br><span class="line">	(*pointArrayVar)[<span class="number">1</span>] = <span class="number">222</span>;</span><br><span class="line">	(*pointArrayVar)[<span class="number">2</span>] = <span class="number">333</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">0</span>; n &lt; <span class="number">3</span>; n++) {</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"b[%d] = %d, "</span>, n, b[n]);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"(*pointArrayVar)[%d] = %d\n"</span>, n, (*pointArrayVar)[n]);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>程序运行的输出结果如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">array[0] = 1</span><br><span class="line">array[1] = 2</span><br><span class="line">array[2] = 3</span><br><span class="line"></span><br><span class="line">a[0] = 11, (*pointArray)[0] = 11</span><br><span class="line">a[1] = 22, (*pointArray)[1] = 22</span><br><span class="line">a[2] = 33, (*pointArray)[2] = 33</span><br><span class="line"></span><br><span class="line">b[0] = 111, (*pointArrayVar)[0] = 111</span><br><span class="line">b[1] = 222, (*pointArrayVar)[1] = 222</span><br><span class="line">b[2] = 333, (*pointArrayVar)[2] = 333</span><br></pre></td></tr></tbody></table></figure><h2 id="函数指针"><a href="#函数指针" class="headerlink" title="函数指针"></a>函数指针</h2><h3 id="函数类型的语法"><a href="#函数类型的语法" class="headerlink" title="函数类型的语法"></a>函数类型的语法</h3><p>C 语言中的函数有自己特定的类型，可以通过 <code>typedef</code> 关键字定义函数类型，语法格式为：<code>typedef type (name)(parameter list);</code>，例如：</p><ul><li><code>typedef int (f)(int, int);</code></li><li><code>typedef void (p)(int);</code></li></ul><h3 id="函数指针类型的语法"><a href="#函数指针类型的语法" class="headerlink" title="函数指针类型的语法"></a>函数指针类型的语法</h3><ul><li>函数指针类型用于指向一个函数</li><li>函数有三大要素：名称、参数、返回值，函数名是函数体的入口地址</li><li>可以通过函数类型定义函数指针类型: <code>FuncType* pointer;</code></li><li>也可以直接定义函数指针类型：<code>typedef type (*pointer)(parameter list);</code><ul><li><code>pointer</code>：函数指针变量名</li><li><code>type</code>：指向函数的返回值类型</li><li><code>parameter list</code>：指向函数的参数类型列表</li></ul></li></ul><h3 id="函数类型与函数指针类型的使用"><a href="#函数类型与函数指针类型的使用" class="headerlink" title="函数类型与函数指针类型的使用"></a>函数类型与函数指针类型的使用</h3><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">	<span class="keyword">return</span> a + b;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 1. 定义函数类型</span></span><br><span class="line">	<span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(MyFuncType)</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 通过函数类型定义函数指针类型</span></span><br><span class="line">	MyFuncType* myFuncType = add;	</span><br><span class="line">	<span class="keyword">int</span> result = myFuncType(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d + %d = %d\n"</span>, <span class="number">1</span>, <span class="number">3</span>, result);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. 定义一个函数指针类型（不会分配内存空间）</span></span><br><span class="line">	<span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*MyFuncPointType)</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 加不加上"&amp;"符号都是可以的，如果加上了"&amp;"符号，可以解决C语言版本的兼容问题</span></span><br><span class="line">	<span class="comment">// MyFuncPointType myFuncPointType = &amp;add;</span></span><br><span class="line"></span><br><span class="line">	MyFuncPointType myFuncPointType = add;</span><br><span class="line">	<span class="keyword">int</span> result2 = myFuncPointType(<span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d + %d = %d\n"</span>, <span class="number">4</span>, <span class="number">5</span>, result2);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 3. 定义函数指针变量（会分配内存空间）</span></span><br><span class="line">	<span class="keyword">int</span> (*MyFuncPointVar)(<span class="keyword">int</span> a, <span class="keyword">int</span> b);</span><br><span class="line">	MyFuncPointVar = add;</span><br><span class="line">	<span class="keyword">int</span> result3 = MyFuncPointVar(<span class="number">7</span>, <span class="number">9</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d + %d = %d\n"</span>, <span class="number">7</span>, <span class="number">9</span>, result3);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>程序运行的输出结果如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1 + 3 = 4</span><br><span class="line">4 + 5 = 9</span><br><span class="line">7 + 9 = 16</span><br></pre></td></tr></tbody></table></figure><h3 id="函数类型与函数指针作为函数参数"><a href="#函数类型与函数指针作为函数参数" class="headerlink" title="函数类型与函数指针作为函数参数"></a>函数类型与函数指针作为函数参数</h3><h4 id="函数类型作为函数参数"><a href="#函数类型作为函数参数" class="headerlink" title="函数类型作为函数参数"></a>函数类型作为函数参数</h4><p>当函数类型做为函数的参数传递给一个被调用函数，被调用函数就可以通过这个函数类型调用外部的函数，这就形成了<code>回调函数</code>。C 语言回调函数的本质是，提前做了一个协议的约定（把函数的参数、函数的返回值类型提前约定）。</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义函数类型</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(MyFuncType)</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">	<span class="keyword">return</span> a + b;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mult</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">	<span class="keyword">return</span> a * b;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数类型作为函数参数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">callbackFunc</span><span class="params">(MyFuncType func)</span> </span>{</span><br><span class="line">	<span class="keyword">return</span> func(<span class="number">3</span>, <span class="number">6</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="comment">// 通过函数类型定义函数指针类型</span></span><br><span class="line">	MyFuncType* myFuncType = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	myFuncType = add;</span><br><span class="line">	<span class="keyword">int</span> result = callbackFunc(*myFuncType);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"result = %d\n"</span>, result);</span><br><span class="line"></span><br><span class="line">	myFuncType = mult;</span><br><span class="line">	<span class="keyword">int</span> result2 = callbackFunc(*myFuncType);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"result = %d\n"</span>, result2);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>程序运行的输出结果如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result = 9</span><br><span class="line">result = 18</span><br></pre></td></tr></tbody></table></figure><h4 id="函数指针作为函数参数"><a href="#函数指针作为函数参数" class="headerlink" title="函数指针作为函数参数"></a>函数指针作为函数参数</h4><p>当函数指针做为函数的参数传递给一个被调用函数，被调用函数就可以通过这个指针调用外部的函数，这就形成了<code>回调函数</code>。C 语言回调函数的本质是，提前做了一个协议的约定（把函数的参数、函数的返回值类型提前约定）。</p><ul><li>a) 将 “函数的调用” 和 “函数的实现” 解耦</li><li> b) 可以模拟 C++ 的多态机制（提前布局 VPTR 指针和虚函数表，找虚函数入口地址来实现函数调用）</li></ul><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">	<span class="keyword">return</span> a + b;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mult</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>{</span><br><span class="line">	<span class="keyword">return</span> a * b;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数指针做函数参数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">callbackFunc</span><span class="params">(<span class="keyword">int</span> (*MyFunc)(<span class="keyword">int</span> a, <span class="keyword">int</span> b))</span> </span>{</span><br><span class="line">	<span class="keyword">return</span> MyFunc(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="comment">// 定义函数指针变量</span></span><br><span class="line">	<span class="keyword">int</span> (*myFuncVar)(<span class="keyword">int</span> a, <span class="keyword">int</span> b);</span><br><span class="line"></span><br><span class="line">	myFuncVar = add;</span><br><span class="line">	<span class="keyword">int</span> result = callbackFunc(myFuncVar);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"result = %d\n"</span>, result);</span><br><span class="line"></span><br><span class="line">	myFuncVar = mult;</span><br><span class="line">	<span class="keyword">int</span> result2 = callbackFunc(myFuncVar);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"result = %d\n"</span>, result2);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>程序运行的输出结果如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result = 7</span><br><span class="line">result = 12</span><br></pre></td></tr></tbody></table></figure><p>上述的 <code>add</code>、<code>mult</code> 函数都是写在同一个源文件当中，假如 <code>add</code> 函数是一个库中的函数，此时就只有使用回调了，通过函数指针参数将外部函数地址传入来实现调用。日后如果库里面的 <code>add</code> 函数的代码作了修改，也不必改动函数调用方的代码，就可以正常实现调用，便于程序的维护和升级。</p><h2 id="DLL-动态链接库的使用"><a href="#DLL-动态链接库的使用" class="headerlink" title="DLL 动态链接库的使用"></a>DLL 动态链接库的使用</h2><p>下面将介绍 C/C++ 如何开发和调用一款 Socket 客户端的 DLL 动态链接库，该 DLL 主要实现了 Socket 客户端的初始化、报文发送、报文接收、资源释放等功能，第三方可以直接调用该 DLL 实现 Socket 通信。值得一提的是，本案例并没有真正完整地实现 Socket 客户端的底层代码，更多的是使用伪代码来模拟 Socket 客户端的通信。</p><h3 id="运行环境说明"><a href="#运行环境说明" class="headerlink" title="运行环境说明"></a>运行环境说明</h3><p>这里给出的案例代码和操作步骤，只适用于 Windows 系统的 C/C++ 开发，且依赖 Visual Studio 开发工具，不适用于 Linux 系统的 C/C++ 开发。</p><h3 id="DLL-项目的创建"><a href="#DLL-项目的创建" class="headerlink" title="DLL 项目的创建"></a>DLL 项目的创建</h3><h4 id="新建-DLL-项目"><a href="#新建-DLL-项目" class="headerlink" title="新建 DLL 项目"></a>新建 DLL 项目</h4><p><img data-src="../../../asset/2021/11/cplusplus-create-dll-1.png" alt="cplusplus-create-dll-1"></p><p><img data-src="../../../asset/2021/11/cplusplus-create-dll-2.png" alt="cplusplus-create-dll-2"></p><p><img data-src="../../../asset/2021/11/cplusplus-create-dll-3.png" alt="cplusplus-create-dll-3"></p><p>值得一提的是，通过 Visual Studio 创建 DLL（动态链接库）项目，源文件默认的后缀是 <code>.cpp</code>，如果项目使用的是 C 语言，则需要将自动生成的 <code>dllmain.cpp</code>、<code>pch.cpp</code> 的文件名改为 <code>dllmain.c</code>、<code>pch.c</code>。</p><h4 id="编写-DLL-代码"><a href="#编写-DLL-代码" class="headerlink" title="编写 DLL 代码"></a>编写 DLL 代码</h4><ul><li>创建 <code>socketclient.c</code> 源文件</li></ul><p><img data-src="../../../asset/2021/11/cplusplus-create-dll-4.png" alt="cplusplus-create-dll-4"></p><ul><li><code>socketclient.c</code> 源文件的代码如下，其中 <code>__declspec(dllexport)</code> 的作用是将函数导出给 DLL 的调用方</li></ul><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pch.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义函数指针类型，用于数据加密</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*EncodeData)</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* in, <span class="keyword">int</span> inlen, <span class="keyword">unsigned</span> <span class="keyword">char</span>* out, <span class="keyword">int</span>* outlen)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义结构体</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">Sck_Handle</span> {</span></span><br><span class="line">    <span class="keyword">char</span> version[<span class="number">16</span>];</span><br><span class="line">    <span class="keyword">char</span> ip[<span class="number">16</span>];</span><br><span class="line">    <span class="keyword">int</span> port;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span>* p;</span><br><span class="line">    <span class="keyword">int</span> len;</span><br><span class="line">    <span class="keyword">char</span>* p2;</span><br><span class="line">    EncodeData encodeCallback;</span><br><span class="line">} Sck_Handle;</span><br><span class="line"></span><br><span class="line"><span class="comment">//客户端初始化</span></span><br><span class="line">__declspec(dllexport)</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">socketclient_init</span><span class="params">(<span class="keyword">void</span>** handle)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    Sck_Handle* tmpHandle = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (handle == <span class="literal">NULL</span>) {</span><br><span class="line">        ret = <span class="number">-1</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"function socketclient_init() err :%d  check params == NULL err \n"</span>, ret);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    tmpHandle = (Sck_Handle*)<span class="built_in">malloc</span>(<span class="built_in"><span class="keyword">sizeof</span></span>(Sck_Handle));</span><br><span class="line">    <span class="keyword">if</span> (tmpHandle == <span class="literal">NULL</span>) {</span><br><span class="line">        ret = <span class="number">-2</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"function socketclient_init() err :%d  malloc err \n"</span>, ret);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memset</span>(tmpHandle, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(Sck_Handle));</span><br><span class="line">    <span class="built_in">strcpy</span>(tmpHandle-&gt;version, <span class="string">"1.0.0.1"</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(tmpHandle-&gt;ip, <span class="string">"192.168.12.12"</span>);</span><br><span class="line">    tmpHandle-&gt;port = <span class="number">8081</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//间接赋值</span></span><br><span class="line">    *handle = tmpHandle;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//客户端报文发送</span></span><br><span class="line">__declspec(dllexport)</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">socketclient_send</span><span class="params">(<span class="keyword">void</span>* handle, <span class="keyword">unsigned</span> <span class="keyword">char</span>* buf, <span class="keyword">int</span> buflen)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    Sck_Handle* tmpHandle = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (handle == <span class="literal">NULL</span> || buf == <span class="literal">NULL</span> || buflen &lt;= <span class="number">0</span>) {</span><br><span class="line">        ret = <span class="number">-2</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"function socketclient_send() err :%d  (handle == NULL ||  buf == NULL || buflen &lt;= 0 ) \n"</span>, ret);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    }</span><br><span class="line">    tmpHandle = (Sck_Handle*)handle;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (tmpHandle-&gt;encodeCallback == <span class="literal">NULL</span>) {</span><br><span class="line">        <span class="comment">//明文发送</span></span><br><span class="line">        tmpHandle-&gt;len = buflen;</span><br><span class="line">        tmpHandle-&gt;p = (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)<span class="built_in">malloc</span>(buflen);</span><br><span class="line">        <span class="keyword">if</span> (tmpHandle-&gt;p == <span class="literal">NULL</span>) {</span><br><span class="line">            ret = <span class="number">-2</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"function socketclient_send() err :%d  malloc len:%d \n"</span>, ret, buflen);</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">memcpy</span>(tmpHandle-&gt;p, buf, buflen);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">//加密发送</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">char</span> crypdata[<span class="number">4096</span>];</span><br><span class="line">        <span class="keyword">int</span> cryptdatalen = <span class="number">4096</span>;</span><br><span class="line">        ret = tmpHandle-&gt;<span class="built_in">encodeCallback</span>(buf, buflen, crypdata, &amp;cryptdatalen);</span><br><span class="line">        <span class="keyword">if</span> (ret != <span class="number">0</span>) {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"function encodeCallback() err :%d  \n"</span>, ret);</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        tmpHandle-&gt;len = cryptdatalen;</span><br><span class="line">        tmpHandle-&gt;p = (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)<span class="built_in">malloc</span>(cryptdatalen);</span><br><span class="line">        <span class="keyword">if</span> (tmpHandle-&gt;p == <span class="literal">NULL</span>) {</span><br><span class="line">            ret = <span class="number">-1</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"function socketclient_send() err :%d  malloc len:%d \n"</span>, ret, cryptdatalen);</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">memcpy</span>(tmpHandle-&gt;p, crypdata, cryptdatalen);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//客户端报文加密发送</span></span><br><span class="line">__declspec(dllexport)</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">socketclient_send_encode</span><span class="params">(<span class="keyword">void</span>* handle, <span class="keyword">unsigned</span> <span class="keyword">char</span>* buf, <span class="keyword">int</span> buflen, EncodeData encodeCallback)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> cryptbuf[<span class="number">4096</span>];</span><br><span class="line">    <span class="keyword">int</span> cryptbuflen = <span class="number">4096</span>;</span><br><span class="line">    Sck_Handle* tmpHandle = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (handle == <span class="literal">NULL</span> || buf == <span class="literal">NULL</span> || encodeCallback == <span class="literal">NULL</span>) {</span><br><span class="line">        ret = <span class="number">-1</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"function socketclient_send_encode() err :%d  (handle == NULL ||  buf == NULL || encodeCallback == NULL) \n"</span>,</span><br><span class="line">            ret);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过函数指针，执行数据的加密操作</span></span><br><span class="line">    ret = <span class="built_in">encodeCallback</span>(buf, buflen, cryptbuf, &amp;cryptbuflen);</span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>) {</span><br><span class="line">        ret = <span class="number">-2</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"function socketclient_send_encode() err :%d  check encode_result == 0 err \n"</span>, ret);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    tmpHandle = (Sck_Handle*)handle;</span><br><span class="line">    tmpHandle-&gt;len = cryptbuflen;</span><br><span class="line">    tmpHandle-&gt;p = (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)<span class="built_in">malloc</span>(cryptbuflen);</span><br><span class="line">    <span class="keyword">if</span> (tmpHandle-&gt;p == <span class="literal">NULL</span>) {</span><br><span class="line">        ret = <span class="number">-3</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"function socketclient_send_encode() err :%d  malloc len:%d \n"</span>, ret, cryptbuflen);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把加密的明文缓存到内存中</span></span><br><span class="line">    <span class="built_in">memcpy</span>(tmpHandle-&gt;p, cryptbuf, cryptbuflen);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//客户端报文接收</span></span><br><span class="line">__declspec(dllexport)</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">socketclient_recv</span><span class="params">(<span class="keyword">void</span>* handle, <span class="keyword">unsigned</span> <span class="keyword">char</span>* buf, <span class="keyword">int</span>* buflen)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    Sck_Handle* tmpHandle = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (handle == <span class="literal">NULL</span> || buf == <span class="literal">NULL</span> || buflen == <span class="literal">NULL</span>) {</span><br><span class="line">        ret = <span class="number">-2</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"function socketclient_recv() err :%d  (handle == NULL ||  buf == NULL || buflen == NULL ) \n"</span>, ret);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    }</span><br><span class="line">    tmpHandle = (Sck_Handle*)handle;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memcpy</span>(buf, tmpHandle-&gt;p, tmpHandle-&gt;len);</span><br><span class="line">    *buflen = tmpHandle-&gt;len;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//客户端资源释放</span></span><br><span class="line">__declspec(dllexport)</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">socketclient_destory</span><span class="params">(<span class="keyword">void</span>* handle)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    Sck_Handle* tmpHandle = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (handle == <span class="literal">NULL</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    tmpHandle = (Sck_Handle*)handle;</span><br><span class="line">    <span class="keyword">if</span> (tmpHandle-&gt;p != <span class="literal">NULL</span>) {</span><br><span class="line">        <span class="built_in">free</span>(tmpHandle-&gt;p); <span class="comment">//释放结构体成员域的指针所指向的内存空间</span></span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">free</span>(tmpHandle); <span class="comment">//释放结构体内存</span></span><br><span class="line"></span><br><span class="line">    handle = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置加密回调函数</span></span><br><span class="line">__declspec(dllexport)</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">socketclient_set_encode_callback</span><span class="params">(<span class="keyword">void</span>* handle, EncodeData encodeCallback)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    Sck_Handle* tmpHandle = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (handle == <span class="literal">NULL</span> || encodeCallback == <span class="literal">NULL</span>) {</span><br><span class="line">        ret = <span class="number">-1</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"function socketclient_set_encode_callback() err :%d  check (handle == NULL || encodeCallback == NULL) err \n"</span>, ret);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    }</span><br><span class="line">    tmpHandle = (Sck_Handle*)handle;</span><br><span class="line">    tmpHandle-&gt;encodeCallback = encodeCallback;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="生成-DLL-文件"><a href="#生成-DLL-文件" class="headerlink" title="生成 DLL 文件"></a>生成 DLL 文件</h4><p>DLL 项目执行编译后，会自动在项目所在的文件夹内生成 <code>.dll</code> 与 <code>.lib</code> 文件，例如 <code>socket-client.dll</code> 与 <code>socket-client.lib</code>。在 VS Studio 的 <code>Developer Command Prompt</code> 命令窗口中，使用 <code>dumpbin /exports socket-client.dll</code> 命令，查看得到 <code>socket-client.dll</code> 动态链接库的详细信息如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Microsoft (R) COFF/PE Dumper Version 14.29.30136.0</span><br><span class="line">Copyright (C) Microsoft Corporation.  All rights reserved.</span><br><span class="line"></span><br><span class="line">Dump of file socket-client.dll</span><br><span class="line"></span><br><span class="line">File Type: DLL</span><br><span class="line"></span><br><span class="line">  Section contains the following exports for socket-client.dll</span><br><span class="line"></span><br><span class="line">    00000000 characteristics</span><br><span class="line">    FFFFFFFF time date stamp</span><br><span class="line">        0.00 version</span><br><span class="line">           1 ordinal base</span><br><span class="line">           6 number of functions</span><br><span class="line">           6 number of names</span><br><span class="line"></span><br><span class="line">    ordinal hint RVA      name</span><br><span class="line"></span><br><span class="line">          1    0 00011005 socketclient_destory = @ILT+0(socketclient_destory)</span><br><span class="line">          2    1 0001135C socketclient_init = @ILT+855(socketclient_init)</span><br><span class="line">          3    2 00011055 socketclient_recv = @ILT+80(socketclient_recv)</span><br><span class="line">          4    3 00011195 socketclient_send = @ILT+400(socketclient_send)</span><br><span class="line">          5    4 000112E4 socketclient_send_encode = @ILT+735(socketclient_send_encode)</span><br><span class="line">          6    5 00011244 socketclient_set_encode_callback = @ILT+575(socketclient_set_encode_callback)</span><br><span class="line"></span><br><span class="line">  Summary</span><br><span class="line"></span><br><span class="line">        1000 .00cfg</span><br><span class="line">        1000 .data</span><br><span class="line">        1000 .idata</span><br><span class="line">        1000 .msvcjmc</span><br><span class="line">        3000 .pdata</span><br><span class="line">        4000 .rdata</span><br><span class="line">        1000 .reloc</span><br><span class="line">        1000 .rsrc</span><br><span class="line">        9000 .text</span><br><span class="line">       10000 .textbss</span><br></pre></td></tr></tbody></table></figure><h4 id="案例代码下载"><a href="#案例代码下载" class="headerlink" title="案例代码下载"></a>案例代码下载</h4><ul><li><a href="/downloads/2021/11/socket-client.zip">点击</a>下载完整的案例代码</li></ul><h3 id="DLL-的两种调用方式"><a href="#DLL-的两种调用方式" class="headerlink" title="DLL 的两种调用方式"></a>DLL 的两种调用方式</h3><h4 id="DLL-动态调用"><a href="#DLL-动态调用" class="headerlink" title="DLL 动态调用"></a>DLL 动态调用</h4><p>在本案例中，实现了通过函数指针类型，动态调用 DLL 里的函数，<a href="/downloads/2021/11/socket-client.dll">点击下载</a> 使用到的 <code>socket-client.dll</code> 。值得一提的是，日后如果 DLL 里面的函数体代码作了修改，也不必改动函数调用方的代码（如下代码），就可以正常实现函数的调用，这样非常便于程序的维护和升级。特别注意，动态调用 DLL 里的函数时（动态加载 DLL），不需要 <code>.h</code> 和 <code>.lib</code> 文件，只需要 <code>.dll</code> 文件，同时要知道所要调用的函数的参数类型以及返回值类型（用于定义函数指针类型）。</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义函数指针类型</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*SocketInit)</span><span class="params">(<span class="keyword">void</span>** handle)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*SocketSend)</span><span class="params">(<span class="keyword">void</span>* handle, <span class="keyword">unsigned</span> <span class="keyword">char</span>* buf, <span class="keyword">int</span> buflen)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*SocketRev)</span><span class="params">(<span class="keyword">void</span>* handle, <span class="keyword">unsigned</span> <span class="keyword">char</span>* buf, <span class="keyword">int</span>* buflen)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*SocketDestory)</span><span class="params">(<span class="keyword">void</span>* handle)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">	HINSTANCE hInstance;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 加载DLL动态链接库</span></span><br><span class="line">	hInstance = LoadLibrary(<span class="string">"./socket-client.dll"</span>);</span><br><span class="line">	<span class="keyword">if</span> (hInstance == <span class="literal">NULL</span>)</span><br><span class="line">	{</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"LoadLibrary() 调用失败, ErrorCode: %d"</span>, GetLastError());</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 调用DLL动态链接库</span></span><br><span class="line">	SocketInit socketInit = (SocketInit)GetProcAddress(hInstance, <span class="string">"socketclient_init"</span>);</span><br><span class="line">	SocketSend socketSend = (SocketSend)GetProcAddress(hInstance, <span class="string">"socketclient_send"</span>);</span><br><span class="line">	SocketRev socketRev = (SocketRev)GetProcAddress(hInstance, <span class="string">"socketclient_recv"</span>);</span><br><span class="line">	SocketDestory socketDestory = (SocketDestory)GetProcAddress(hInstance, <span class="string">"socketclient_destory"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (socketInit == <span class="literal">NULL</span>)</span><br><span class="line">	{</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> inbuf[<span class="number">128</span>];</span><br><span class="line">	<span class="keyword">int</span> inbuflen = <span class="number">128</span>;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> outbuf[<span class="number">4096</span>];</span><br><span class="line">	<span class="keyword">int</span> outbuflen = <span class="number">4096</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span>* handle = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">int</span> initResult = socketInit(&amp;handle);</span><br><span class="line">	<span class="keyword">int</span> sendResult = socketSend(handle, inbuf, inbuflen);</span><br><span class="line">	<span class="keyword">int</span> revResult = socketRev(handle, outbuf, &amp;outbuflen);</span><br><span class="line">	<span class="keyword">int</span> destoryResult = socketDestory(handle);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"initResult = %d\n"</span>, initResult);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"sendResult = %d\n"</span>, sendResult);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"revResult = %d\n"</span>, revResult);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"destoryResult = %d\n"</span>, destoryResult);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 释放DLL动态链接库</span></span><br><span class="line">	<span class="keyword">if</span> (hInstance != <span class="literal">NULL</span>) {</span><br><span class="line">		FreeLibrary(hInstance);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>程序运行的输出结果如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">initResult = 0</span><br><span class="line">sendResult = 0</span><br><span class="line">revResult = 0</span><br><span class="line">destoryResult = 0</span><br></pre></td></tr></tbody></table></figure><h4 id="DLL-静态调用"><a href="#DLL-静态调用" class="headerlink" title="DLL 静态调用"></a>DLL 静态调用</h4><p>静态调用 DLL 里的函数（静态加载 DLL），需要同时使用 <code>.h</code>、<code>.lib</code> 以及 <code>.dll</code> 文件，具体的操作步骤如下：</p><ul><li>a) 将 <code>.h</code>、<code>.lib</code> 以及 <code>.dll</code> 文件分别拷贝到项目所在的文件夹内，必须与 <code>.c</code> 源文件处于同一个文件夹</li><li> b) 在需要调用 DLL 的 <code>.c</code> 源文件中，通过 <code>#pragma comment(lib "xxx.lib")</code> 指令引入 <code>.lib</code> 文件</li><li> c) 在需要调用 DLL 的 <code>.c</code> 源文件中，通过 <code>#include "xxx.h</code>，引入 <code>.h</code> 头文件</li><li> d) 正常编写代码，并调用 DLL 里的函数</li></ul><p><img data-src="../../../asset/2021/11/cplusplus-load-dll-2.png" alt="cplusplus-load-dll-2"></p><p>若使用的开发工具是 Visual Studio，则可以不通过 <code>#pragma comment(lib "xxx.lib")</code> 指令引入 <code>.lib</code> 文件。右键项目，选择 <code>属性</code>，导航到 <code>配置属性</code> -&gt; <code>链接器</code> -&gt; <code>输入</code> -&gt; <code>附加依赖项</code>，添加对应的 <code>.lib</code> 文件名即可，如下图所示：</p><p><img data-src="../../../asset/2021/11/cplusplus-load-dll-1.png" alt="cplusplus-load-dll-1"></p><hr><p><code>.h</code> 头文件里一般定义了 DLL 动态链接库里的函数原型，例如 <code>socket-client.h</code> 头文件的代码如下：</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _INC_MYSOCKETCLIENT_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _INC_MYSOCKETCLIENT_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span>  __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> {</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*EncodeData)</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* in, <span class="keyword">int</span> inlen, <span class="keyword">unsigned</span> <span class="keyword">char</span>* out, <span class="keyword">int</span>* outlen)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">socketclient_init</span><span class="params">(<span class="keyword">void</span>** handle)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">socketclient_send</span><span class="params">(<span class="keyword">void</span>* handle, <span class="keyword">unsigned</span> <span class="keyword">char</span>* buf, <span class="keyword">int</span> buflen)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">socketclient_recv</span><span class="params">(<span class="keyword">void</span>* handle, <span class="keyword">unsigned</span> <span class="keyword">char</span>* buf, <span class="keyword">int</span>* buflen)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">socketclient_destory</span><span class="params">(<span class="keyword">void</span>* handle)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">socketclient_set_encode_callback</span><span class="params">(<span class="keyword">void</span>* handle, EncodeData encodeCallback)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">socketclient_send_encode</span><span class="params">(<span class="keyword">void</span>* handle, <span class="keyword">unsigned</span> <span class="keyword">char</span>* buf, <span class="keyword">int</span> buflen, EncodeData encodeCallback)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span>  __cplusplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span>  <span class="comment">/* _INC_MYSOCKETCLIENT_H__ */</span></span></span><br></pre></td></tr></tbody></table></figure><hr><p>静态调用 DLL 里的函数（<code>main.c</code>）的代码如下：</p><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"socket-client.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Hw_Encode</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* in, <span class="keyword">int</span> inlen, <span class="keyword">unsigned</span> <span class="keyword">char</span>* out, <span class="keyword">int</span>* outlen)</span> </span>{</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"function Hw_Encode() begin ....\n"</span>);</span><br><span class="line">	<span class="built_in">strcpy</span>((<span class="keyword">char</span>*)out, <span class="string">"123456789"</span>);</span><br><span class="line">	*outlen = <span class="number">9</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"function Hw_Encode() end ....\n"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Cisco_Encode</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span>* in, <span class="keyword">int</span> inlen, <span class="keyword">unsigned</span> <span class="keyword">char</span>* out, <span class="keyword">int</span>* outlen)</span> </span>{</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"function Cisco_Encode() begin ....\n"</span>);</span><br><span class="line">	<span class="built_in">strcpy</span>((<span class="keyword">char</span>*)out, <span class="string">"123456789"</span>);</span><br><span class="line">	*outlen = <span class="number">9</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"function Cisco_Encode() end ....\n"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> in[<span class="number">1024</span>];</span><br><span class="line">	<span class="keyword">int</span> inlen;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> out[<span class="number">1024</span>];</span><br><span class="line">	<span class="keyword">int</span> outlen;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span>* handle = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">strcpy</span>((<span class="keyword">char</span>*)in, <span class="string">"aaaaaaaa"</span>);</span><br><span class="line">	inlen = <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//客户端初始化</span></span><br><span class="line">	ret = <span class="built_in">socketclient_init</span>(&amp;handle);</span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>)</span><br><span class="line">	{</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"function socketclient_init() err:%d \n"</span>, ret);</span><br><span class="line">		<span class="keyword">goto</span> End;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"the result of socketclient_init() is %d \n"</span>, ret);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置加密回调函数</span></span><br><span class="line">	ret = <span class="built_in">socketclient_set_encode_callback</span>(handle, Cisco_Encode);</span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>) {</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"function socketclient_set_encode_callback() err:%d \n"</span>, ret);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"the result of socketclient_set_encode_callback() is %d \n"</span>, ret);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//客户端发送报文</span></span><br><span class="line">	ret = <span class="built_in">socketclient_send</span>(handle, in, inlen);</span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>)</span><br><span class="line">	{</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"function socketclient_send() err:%d \n"</span>, ret);</span><br><span class="line">		<span class="keyword">goto</span> End;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"the result of socketclient_send() is %d \n"</span>, ret);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//客户端报文加密发送</span></span><br><span class="line">	ret = <span class="built_in">socketclient_send_encode</span>(handle, in, inlen, Hw_Encode);</span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>)</span><br><span class="line">	{</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"function socketclient_send_encode() err:%d \n"</span>, ret);</span><br><span class="line">		<span class="keyword">goto</span> End;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"the result of socketclient_send_encode() is %d \n"</span>, ret);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//客户端接收报文</span></span><br><span class="line">	ret = <span class="built_in">socketclient_recv</span>(handle, out, &amp;outlen);</span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>)</span><br><span class="line">	{</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"function socketclient_recv() err:%d \n"</span>, ret);</span><br><span class="line">		<span class="keyword">goto</span> End;</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"the result of socketclient_recv() is %d \n"</span>, ret);</span><br><span class="line"></span><br><span class="line">End:</span><br><span class="line">	<span class="comment">//客户端释放资源</span></span><br><span class="line">	ret = <span class="built_in">socketclient_destory</span>(handle);</span><br><span class="line">	<span class="keyword">if</span> (ret != <span class="number">0</span>)</span><br><span class="line">	{</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"function socketclient_destory() err:%d \n"</span>, ret);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"the result of socketclient_destory() is %d \n"</span>, ret);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>程序运行的输出结果如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">the result of socketclient_init() is 0</span><br><span class="line">the result of socketclient_set_encode_callback() is 0</span><br><span class="line">function Cisco_Encode() begin ....</span><br><span class="line">function Cisco_Encode() end ....</span><br><span class="line">the result of socketclient_send() is 0</span><br><span class="line">function Hw_Encode() begin ....</span><br><span class="line">function Hw_Encode() end ....</span><br><span class="line">the result of socketclient_send_encode() is 0</span><br><span class="line">the result of socketclient_recv() is 0</span><br><span class="line">the result of socketclient_destory() is 0</span><br></pre></td></tr></tbody></table></figure><h4 id="案例代码下载-1"><a href="#案例代码下载-1" class="headerlink" title="案例代码下载"></a>案例代码下载</h4><ul><li><a href="/downloads/2021/11/static-load-socket-client-dll.zip">点击</a>下载完整的案例代码（DLL 静态调用）</li></ul><h2 id="参考博客"><a href="#参考博客" class="headerlink" title="参考博客"></a>参考博客</h2><ul><li><a target="_blank" rel="external nofollow" href="https://blog.csdn.net/wu_lian_nan/article/details/89028047">C++ 动态加载 DLL 和静态加载 DLL，以及 DLL 的编写</a></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/1844a1fe.html" title="C 语言面向接口编程和多态使用">https://www.techgrow.cn/posts/1844a1fe.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/C%E8%AF%AD%E8%A8%80/" rel="tag"><i class="fa fa-tag"></i> C语言</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/a6f0aaf9.html" rel="prev" title="Spring Cloud Gateway 开发随笔"><i class="fa fa-angle-left"></i> Spring Cloud Gateway 开发随笔</a></div><div class="post-nav-item"> <a href="/posts/f7ed6378.html" rel="next" title="Debian 更换软件源">Debian 更换软件源<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">1.4m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">20:50</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤 ICP 备 19024664 号</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035 号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/app/api/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/app/api/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/1844a1fe.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>