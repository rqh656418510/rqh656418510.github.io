<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 RabbitMQ 的使用教程。"><meta property="og:type" content="article"><meta property="og:title" content="RabbitMQ 入门教程之十"><meta property="og:url" content="https://www.techgrow.cn/posts/3168935.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 RabbitMQ 的使用教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/04/rabbitmq-58.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/04/rabbitmq-cluster-docker-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/04/rabbitmq-59.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/04/rabbitmq-60.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/04/rabbitmq-61.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/04/rabbitmq-62.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/04/rabbitmq-63.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/04/rabbitmq-64.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/04/rabbitmq-65.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/04/rabbitmq-66.png"><meta property="article:published_time" content="2021-06-27T14:13:45.000Z"><meta property="article:modified_time" content="2021-06-27T14:13:45.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="微服务"><meta property="article:tag" content="消息队列"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2025/04/rabbitmq-58.png"><link rel="canonical" href="https://www.techgrow.cn/posts/3168935.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/3168935.html","path":"posts/3168935.html","title":"RabbitMQ 入门教程之十"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>RabbitMQ 入门教程之十 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90"><span class="nav-text">学习资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RabbitMQ-%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="nav-text">RabbitMQ 集群搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D"><span class="nav-text">背景介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9"><span class="nav-text">集群节点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F"><span class="nav-text">集群模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84"><span class="nav-text">集群架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA"><span class="nav-text">集群搭建</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RabbitMQ-%E9%95%9C%E5%83%8F%E9%98%9F%E5%88%97"><span class="nav-text">RabbitMQ 镜像队列</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%83%8C%E6%99%AF%E4%BB%8B%E7%BB%8D-1"><span class="nav-text">背景介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E5%BF%B5%E4%BB%8B%E7%BB%8D"><span class="nav-text">概念介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%AD%A5%E9%AA%A4"><span class="nav-text">配置步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E9%85%8D%E7%BD%AE"><span class="nav-text">验证配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-text">注意事项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RabbitMQ-%E4%BB%B2%E8%A3%81%E9%98%9F%E5%88%97"><span class="nav-text">RabbitMQ 仲裁队列</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">686</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/3168935.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="RabbitMQ 入门教程之十 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 RabbitMQ 的使用教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> RabbitMQ 入门教程之十</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-06-27 22:13:45" itemprop="dateCreated datePublished" datetime="2021-06-27T22:13:45+08:00">2021-06-27</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/3168935.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/3168935.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>7.6k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>7 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/ec623f8b.html">RabbitMQ 入门教程之一</a>、<a href="/posts/39a63bd3.html">RabbitMQ 入门教程之二</a>、<a href="/posts/ae3ea986.html">RabbitMQ 入门教程之三</a></li><li><a href="/posts/b2ecc598.html">RabbitMQ 入门教程之四</a>、<a href="/posts/ff0ea7dd.html">RabbitMQ 入门教程之五</a>、<a href="/posts/f9176fde.html">RabbitMQ 入门教程之六</a></li><li><a href="/posts/4eeb4098.html">RabbitMQ 入门教程之七</a>、<a href="/posts/1074caeb.html">RabbitMQ 入门教程之八</a>、<a href="/posts/adff4cba.html">RabbitMQ 入门教程之九</a></li><li><a href="/posts/3168935.html">RabbitMQ 入门教程之十</a>、<a href="/posts/ac3bb7d5.html">RabbitMQ 入门教程之十一</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h3><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/rabbitmq/rabbitmq-server">RabbitMQ GitHub 开源项目</a></li><li><a target="_blank" rel="external nofollow" href="https://www.rabbitmq.com/docs">RabbitMQ 官方文档（英文）</a></li><li><a target="_blank" rel="external nofollow" href="https://rabbitmq.cn/docs">RabbitMQ 官方文档（中文）</a></li></ul><span id="more"></span><h2 id="RabbitMQ-集群搭建"><a href="#RabbitMQ-集群搭建" class="headerlink" title="RabbitMQ 集群搭建"></a>RabbitMQ 集群搭建</h2><h3 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h3><p>最开始我们使用的 RabbitMQ 只是单机版本，随着业务的发展，已经无法满足实际应用中的高可用性和高并发处理需求。试想一下：如果 RabbitMQ 所在的服务器出现内存溢出、机器掉电、主板损坏等硬件故障，整个消息服务就会中断，系统将面临严重的可用性问题。此外，虽然一台 RabbitMQ 服务器在良好的配置下可以支持大约每秒 1000 条消息的吞吐量，但如果业务系统需要处理每秒 10 万条甚至更高数量级的消息，仅靠一台服务器远远不够。此时，一味依赖升级硬件来提升单机性能不仅成本高昂、扩展性差，而且无法从根本上解决问题。因此，搭建 RabbitMQ 集群才是应对实际业务压力、提升系统稳定性和可用性的关键解决方案。</p><h3 id="集群节点"><a href="#集群节点" class="headerlink" title="集群节点"></a>集群节点</h3><p>RabbitMQ 的集群节点分为磁盘节点、内存节点。RabbitMQ 支持消息的持久化，也就是数据写在磁盘上。在 RabbitMQ 集群中，必须至少有一个磁盘节点，否则队列元数据无法写入到集群中。当磁盘节点宕掉时，集群将无法写入新的队列元数据信息。如果 RabbitMQ 集群全部宕机，必须先启动磁盘节点，然后再启动内存节点。最合适的方案就是既有磁盘节点，又有内存节点；建议至少 2 个磁盘节点，其他节点可以作为内存节点来提高性能，比如采用 2 个 磁盘节点 + 1 个内存节点的集群搭建方式。</p><table><thead><tr><th>节点类型</th><th>节点特点</th></tr></thead><tbody><tr><td><code>disc</code>（磁盘节点）</td><td>元数据持久化到磁盘，<strong>集群元数据（如队列、交换机、绑定、用户、权限的定义等）会复制到这些节点上</strong>。至少需要一个 <code>disc</code> 节点才能组成完整的 RabbitMQ 集群。</td></tr><tr><td><code>ram</code>（内存节点）</td><td>大部分集群元数据仅保存在内存中，性能更高。启动时会从磁盘节点同步元数据，但自身不会持久化元数据。一旦内存节点宕机或重启，它的元数据就会丢失（除非从磁盘节点重新同步）。<strong>掉电就丢失元数据，不适合长期存储，只适合当辅助节点使用</strong>。</td></tr></tbody></table><div class="admonition note"><p class="admonition-title">磁盘节点补充说明</p><ul><li>RabbitMQ 默认的集群节点类型是 <code>disc</code>（磁盘节点），至少需要一个 <code>disc</code> 节点才能组成完整的 RabbitMQ 集群。</li></ul></div><div class="admonition note"><p class="admonition-title">内存节点补充说明</p><ul><li><code>ram</code>（内存节点）决定的是 RabbitMQ 的集群元数据保存在内存中，元数据包括队列、交换机、绑定、用户、权限的定义等，而不是决定队列和消息都存储在内存里面，也就是消息的存储还是由队列持久化、消息持久化决定的。</li><li>假设在 RabbitMQ 的一个内存节点上创建了队列，如果这个节点宕机，它的元数据就没了，重启后队列的定义也不存在。但是，如果将队列设置为持久化（<code>durable=true</code>），消息也设置为持久化（<code>delivery_mode=2</code>），即使内存节点宕机了，只要还有磁盘节点存在，就可以恢复内存节点的队列和消息数据。</li></ul></div><h3 id="集群模式"><a href="#集群模式" class="headerlink" title="集群模式"></a>集群模式</h3><p>RabbitMQ 集群模式分为两种，包括普通模式和镜像模式；可以说镜像模式是普通模式的升级版，其中 RabbitMQ 默认使用的是普通模式。</p><ul><li><p><strong>普通模式</strong></p><ul><li>这里以两个节点（节点 A、节点 B）为例来进行说明。</li><li>对于 Queue 来说，消息实体只存在于其中一个节点，A、B 两个节点仅有相同的元数据，即队列结构。</li><li>当消息进入 A 节点的队列中后，消费者从 B 节点拉取时，RabbitMQ 会临时在 A、B 间进行消息传输，把 A 中的消息实体取出并经过 B 发送给消费者。</li><li>所以，消费者应尽量连接每一个节点，从中取消息。即对于同一个逻辑队列，要在多个节点建立物理队列，否则，无论消费者连 A 或者连 B，出口总在 A，会产生瓶颈。</li><li>该模式还存在一个问题就是当 A 节点宕机后，B 节点无法取到 A 节点中还未消费的消息实体。</li><li>如果做了消息持久化，那么得等 A 节点恢复，才可被消费；如果没有持久化的话，消息会丢失。</li></ul></li><li><p><strong>镜像模式</strong></p><ul><li>在普通模式的基础上，通过镜像队列策略（HA Policy）将需要的队列配置成镜像队列，让队列存储在多个节点上，消息实体会主动在镜像节点之间同步，而不是在客户端取数据时临时拉取，也就是说有多少个镜像节点消息就会备份多少份。</li><li>该模式带来的副作用也很明显，除了降低系统性能外，如果镜像队列数量过多，加之大量的消息进入，集群内部的网络带宽将会被这种同步通讯大大消耗掉，适用于对业务可靠性要求较高的场景。</li><li>由于镜像队列之间消息自动同步，且内部有选举 Master 机制，即使 Master 节点宕机也不会影响整个集群的使用，达到去中心化的目的，从而有效的防止消息丢失及服务不可用等问题。</li></ul></li></ul><h3 id="集群架构"><a href="#集群架构" class="headerlink" title="集群架构"></a>集群架构</h3><p>RabbitMQ 集群的典型架构（高可用负载均衡集群）如下图所示，展示了如何通过多个节点实现高可用和负载均衡。这种架构可以有效地提高 RabbitMQ 的吞吐量和容错能力，适用于对消息可靠性和系统可用性要求较高的生产环境。架构说明如下：</p><ul><li>客户端连接：​客户端通过虚拟 IP（VIP）连接到集群，VIP 由 Keepalived 管理，实现高可用性。</li><li>负载均衡：​HAProxy 作为负载均衡器，将客户端请求分发到后端的 RabbitMQ 节点。在 HAProxy 的配置中启用健康检查后，HAProxy 可以感知到 RabbitMQ 节点的宕机，并自动将其从负载均衡列表中剔除。</li><li>RabbitMQ 节点：​多个 RabbitMQ 节点组成集群，节点之间通过镜像队列（Mirroring）机制同步消息，确保消息的高可用性。</li></ul><p><img data-src="../../../asset/2025/04/rabbitmq-58.png"></p><div class="admonition warning"><p class="admonition-title">重要提示</p><p>无论 RabbitMQ 集群是运行在普通模式，还是启用了镜像模式（使用镜像队列），客户端（包括生产者和消费者）都可以直接连接到集群中的任意节点进行消息的发送与接收（类似于无状态设计）。RabbitMQ 集群节点之间通过内部通信机制来保持数据同步和状态一致，从而对客户端屏蔽了具体的队列位置，使得客户端无需关心消息实际存储在哪个节点上，连接任一节点即可正常使用。这就是为什么可以使用 Keepalived + HAProxy 来实现 RabbitMQ 高可用负载均衡集群的原因。若希望进一步提高可用性，推荐使用 RabbitMQ 的 Quorum Queue + Keepalived + HAProxy + Prometheus + AlertManager 的组合，可以构建一个企业级高可用消息中间件系统。</p></div><h3 id="集群搭建"><a href="#集群搭建" class="headerlink" title="集群搭建"></a>集群搭建</h3><ul><li><a href="/posts/736e972f.html">Docker 搭建 RabbitMQ 集群</a></li><li><a href="/posts/486aeff3.html">Centos 7 生产环境搭建 RabbitMQ 集群</a></li><li><a href="/posts/b2050656.html">Debian 11 生产环境搭建 RabbitMQ 集群</a></li></ul><h2 id="RabbitMQ-镜像队列"><a href="#RabbitMQ-镜像队列" class="headerlink" title="RabbitMQ 镜像队列"></a>RabbitMQ 镜像队列</h2><h3 id="背景介绍-1"><a href="#背景介绍-1" class="headerlink" title="背景介绍"></a>背景介绍</h3><p>在 RabbitMQ 集群中，如果只有一个 Broker 节点，一旦该节点发生故障，不仅会导致服务的临时性不可用，还可能造成消息的丢失。<strong>虽然可以通过将所有消息设置为持久化（<code>delivery_mode = 2</code>），并将队列设置为持久化（<code>durable = true</code>）来降低数据丢失的风险，但这仍然无法完全避免由于缓存机制带来的数据丢失问题。因为从消息发送到真正写入磁盘并完成刷盘（Flush）之间存在一个短暂的时间窗口，在此期间如果节点宕机，消息依然可能丢失</strong>。为此，可以启用 RabbitMQ 的发布确认机制（Publisher Confirm），让客户端明确知道哪些消息已经被 RabbitMQ 持久化到磁盘，从而提升消息投递的可靠性。尽管如此，从高可用性的角度考虑，仍然不希望因单点故障而导致服务中断。此时，<strong>可以通过引入镜像队列（Mirrored Queue）的方式，将队列数据复制（镜像）到集群中的其他 Broker 节点上。当某个节点发生故障时，RabbitMQ 可以自动将队列切换到其镜像副本上，确保服务的持续可用，避免单点故障带来的影响。</strong></p><h3 id="概念介绍"><a href="#概念介绍" class="headerlink" title="概念介绍"></a>概念介绍</h3><p>RabbitMQ 的镜像队列（Mirrored Queue）是一种用于实现高可用（High Availability， HA）的机制，它可以将一个队列的内容实时同步复制到多个节点（也称为镜像节点）上。这样，即使主节点发生宕机，系统也可以自动将主队列提升到其他镜像节点上，从而继续提供服务，确保消息不丢失、业务不中断。<strong>特别注意的是，镜像队列依赖于 RabbitMQ 的集群架构，因此在使用镜像队列之前，必须先搭建好一个基于普通模式（即非分布式分片或联邦模式）的 RabbitMQ 集群环境。镜像队列是在该集群的基础上，通过策略（Policy）配置来实现队列在多个节点之间的同步复制和主备切换的。</strong></p><ul><li><p><strong>镜像队列的工作机制</strong></p><ul><li>队列创建时，主副本（Master） 会存在某个节点上；</li><li>该队列的镜像会被复制到指定的其他节点上，称为副本（Slaves）；</li><li>所有生产者和消费者仍然连接主副本，但副本会同步接收数据；</li><li>如果主副本节点故障，系统会自动从副本列表中提升一个新的主副本。</li></ul></li><li><p><strong>镜像队列的优缺点</strong></p><ul><li>优点：<ul><li>高可用性：主副本故障时，副本可以快速接管；</li><li>数据冗余：减少消息丢失风险；</li><li>适合关键业务：金融、电商等要求消息高可靠性的场景。</li></ul></li><li>缺点：<ul><li>性能开销大：每条消息都需要同步到多个副本，影响吞吐量；</li><li>资源消耗高：每个镜像副本都占用内存和磁盘；</li><li>不推荐大规模使用：尤其是在高并发系统中，性能瓶颈比较明显。</li></ul></li></ul></li><li><p><strong>镜像队列的使用场景</strong></p><ul><li>适合使用的场景：<ul><li>少量关键队列，需要高可用保障；</li><li>节点数量不多，资源压力不大；</li><li>需要快速故障转移、消息不容丢失。</li></ul></li><li>不适合使用的场景：<ul><li>高并发写入、高吞吐场景（容易成为性能瓶颈）；</li><li>队列数量多，副本同步占用大量资源。</li></ul></li></ul></li></ul><h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><div class="admonition note"><p class="admonition-title">配置镜像队列的步骤</p><ul><li>配置 RabbitMQ 的镜像队列，只需要执行以下两个步骤即可：</li><li>(1) 基于普通模式，将 RabbitMQ 集群搭建完成。</li><li>(2) 通过控制台可视化界面或者命令行，添加镜像队列策略（HA Policy）。</li></ul></div><blockquote><p>通过可视化界面添加镜像队列策略（HA Policy）</p></blockquote><ul><li>(1) 基于普通模式，将 RabbitMQ 集群搭建完成。</li></ul><p><img data-src="../../../asset/2025/04/rabbitmq-cluster-docker-1.png"></p><ul><li>(2) 在 RabbitMQ 的 Web 控制台中，添加镜像队列策略（HA Policy）。</li></ul><p><img data-src="../../../asset/2025/04/rabbitmq-59.png"></p><ul><li>(3) 镜像队列策略（HA Policy）创建完成后的样子。</li></ul><p><img data-src="../../../asset/2025/04/rabbitmq-60.png"></p><blockquote><p>镜像策略配置参数说明</p></blockquote><ul><li><p>Name：</p><ul><li>策略的名称</li></ul></li><li><p> Pattern：</p><ul><li>匹配的规则，会按照设置的规则进行镜像设置。</li><li>比如：<code>^mirror</code> 表示匹配 <code>mirror</code> 开头的队列（即会为开头是 <code>mirror</code> 的队列进行镜像备份），如果是匹配所有的队列，那就是 <code>^.</code></li></ul></li><li><p>Apply to:</p><ul><li>作用：定义策略的作用范围</li><li>可选值：<ul><li><code>Exchanges and queues</code>：策略会同时应用到队列（Queue）和交换机（Exchange）。不常用于镜像队列配置，因为镜像策略主要是给队列用的。</li><li><code>Exchanges</code>：策略只作用于交换机（Exchange），比如设置 TTL、自动删除、名称匹配等。</li><li><code>queues</code>：策略只作用于队列，包括经典队列（Classic Queues）和仲裁队列（Quorum Queues）。</li></ul></li></ul></li><li><p>Definition：</p><ul><li><code>ha-mode</code>：<ul><li>作用：定义镜像队列复制的策略（即在哪些节点上创建副本）。</li><li>可选值：<ul><li><code>all</code>：在所有节点上都创建副本。</li><li><code>exactly</code>：在指定数量的节点上创建副本，数量由 <code>ha-params</code> 指定。</li><li><code>nodes</code>：只在指定的节点上创建副本，节点名称由 <code>ha-params</code> 指定。</li></ul></li></ul></li><li><code>ha-params</code>：<ul><li>作用：根据 <code>ha-mode</code> 的不同，用于指定副本的数量或副本所在的节点。</li><li>具体含义：<ul><li>如果 <code>ha-mode</code> 是 <code>all</code>，则 <code>ha-params</code> 可以省略不配置。</li><li>如果 <code>ha-mode</code> 是 <code>exactly</code>，则 <code>ha-params</code> 是一个整数，且必须配置，表示副本数量。</li><li>如果 <code>ha-mode</code> 是 <code>nodes</code>，则 <code>ha-params</code> 是一个节点名称组成的数组（如 <code>["rabbit@rabbitmq-node1", "rabbitmq-node2"]</code>），且必须配置。</li></ul></li></ul></li><li><code>ha-sync-mode</code>：<ul><li>作用：控制镜像队列同步的方式（即新加入的副本如何与主副本进行同步）。</li><li>可选值：<ul><li><code>automatic</code>：新加入的镜像副本会自动从主队列同步数据。</li><li><code>manual</code>：默认值，必须手动触发同步，即通过可视化界面或者执行 <code>rabbitmqctl sync_queue &lt;queue_name&gt;</code> 命令进行数据同步。</li></ul></li></ul></li><li><code>ha-promote-on-shutdown</code>：<ul><li>作用：控制当主节点优雅关闭（Shutdown）时，是否自动提升一个镜像为新的主队列。</li><li>可选值：<ul><li><code>always</code>：默认值，主节点关闭时始终提升副本。</li><li><code>when-synced</code>：推荐值，仅当副本已完全同步时才会被提升为主。</li></ul></li></ul></li><li><code>ha-promote-on-failure</code>：<ul><li>作用：控制主节点在故障（意外宕机）时，是否自动提升一个镜像为新的主队列。</li><li>可选值：<ul><li><code>true</code>：默认值，在主队列宕机时，自动选举一个镜像为主。</li><li><code>false</code>：不自动提升，需要人工干预。</li></ul></li></ul></li></ul></li></ul><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li><code>ha-mode</code> 配置参数没有默认值，因为它是定义 RabbitMQ 镜像队列策略（HA Policy）的核心参数之一，属于必填项。</li><li><code>ha-sync-mode</code>、<code>ha-promote-on-shutdown</code>、<code>ha-promote-on-failure</code> 配置参数都有默认值，属于非必填项。</li></ul></div><blockquote><p>通过命令行添加镜像队列策略（HA Policy）</p></blockquote><p>除了可以在 RabbitMQ 的控制台上，通过可视化界面添加镜像队列策略（HA Policy），还可以使用命令行进行添加（前提是 RabbitMQ 集群已搭建完成），如下所示：</p><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ha-mode: all</span></span><br><span class="line">rabbitmqctl set_policy ha-all <span class="string">"^ha\."</span> <span class="string">'{"ha-mode":"all","ha-sync-mode":"automatic"}'</span> --apply-to queues</span><br><span class="line"></span><br><span class="line"><span class="comment"># ha-mode: exactly</span></span><br><span class="line">rabbitmqctl set_policy ha-2-nodes <span class="string">"^ha\."</span> <span class="string">'{"ha-mode":"exactly","ha-params":2,"ha-sync-mode":"automatic"}'</span> --apply-to queues</span><br><span class="line"></span><br><span class="line"><span class="comment"># ha-mode: nodes</span></span><br><span class="line">rabbitmqctl set_policy ha-specified <span class="string">"^ha\."</span> <span class="string">'{"ha-mode":"nodes","ha-params":["rabbit@rabbitmq-node1","rabbit@rabbitmq-node2"],"ha-sync-mode":"automatic"}'</span> --apply-to queues</span><br></pre></td></tr></tbody></table></figure><h3 id="验证配置"><a href="#验证配置" class="headerlink" title="验证配置"></a>验证配置</h3><blockquote><p>(1) 在任意一个集群节点上（如 <code>rabbitmq-node1</code>）创建一个队列（名称为 <code>mirror.test.queue</code>），该队列会被自动应用镜像队列策略（HA Policy），然后手动发送一条消息到该队列中</p></blockquote><p><img data-src="../../../asset/2025/04/rabbitmq-61.png"></p><hr><p><img data-src="../../../asset/2025/04/rabbitmq-62.png"></p><blockquote><p>(2) 通过 <code>rabbitmqctl stop_app</code> 命令停掉节点二（<code>rabbitmq-node2</code>）的 RabbitMQ 服务</p></blockquote><p><img data-src="../../../asset/2025/04/rabbitmq-63.png"></p><hr><p><img data-src="../../../asset/2025/04/rabbitmq-64.png"></p><blockquote><p>(3) 当节点二（<code>rabbitmq-node2</code>）的 RabbitMQ 服务停掉后，发现新的镜像队列会存储在节点三（<code>rabbitmq-node3</code>）上面，并且新的镜像队列会自动完成数据同步</p></blockquote><p><img data-src="../../../asset/2025/04/rabbitmq-65.png"></p><hr><p><img data-src="../../../asset/2025/04/rabbitmq-66.png"></p><div class="admonition note"><p class="admonition-title">总结</p><p>这就意味着，在启用了镜像队列策略之后，即使集群中某个节点（即原本承载某个队列的主节点）发生宕机，消费者仍然可以继续正常消费该队列中的消息。因为该队列的内容已经通过镜像机制被实时同步到了其他节点上，也就是说，队列在多个节点上拥有完整的副本。当主节点不可用时，RabbitMQ 会自动从这些副本中选举一个新的主节点，从而保障服务的连续性与消息的高可用性。</p></div><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p><strong>​在 RabbitMQ 的镜像队列（Mirrored Queue）中，存在主副本（Master）和副本（Slave）的概念。消费者永远只能从主副本（Master）读取和写入数据，副本（Slave）不对外提供读取和写入服务，它们的唯一职责是从主副本（Master）同步数据，以保持数据的一致性。</strong>这种设计的主要原因是为了确保数据的一致性和简化系统的复杂性。​如果允许副本（Slave）提供读服务，可能会导致消费者读取到尚未同步完成的数据，造成数据不一致的问题。当主副本（Master）发生故障时，RabbitMQ 会从副本（Slave）列表中选举一个新的主副本（Master）。​一旦新的主副本（Master）选举完成，消费者将自动从新的主副本（Master）继续读取或写入数据，确保服务的连续性。</p><blockquote><p>生产者是往哪个副本写入消息？</p></blockquote><p>在 RabbitMQ 的镜像队列中，写入操作永远是由主副本（Master）来处理的。也就是说：</p><ul><li>生产者发送消息时，可以将消息发送到 RabbitMQ 集群中的任意一个节点；</li><li>该节点会将请求路由到该队列的主副本（Master）所在节点上执行；</li><li>主副本（Master）接收到消息后，会将消息同步复制到所有的镜像副本（Slave）；</li><li>如果设置了强同步策略，当所有副本都确认收到消息后，才会认为消息写入成功。</li></ul><blockquote><p>副本（Slave）的作用是什么？</p></blockquote><ul><li>高可用性保障<ul><li>当 Master 节点宕机时，自动从剩余的 Slave 节点中选出一个新的 Master，确保队列持续可用。</li></ul></li><li>数据冗余与备份<ul><li> Slave 会实时同步 Master 队列中的所有消息和状态，实现数据冗余，防止数据丢失。</li></ul></li><li>故障切换支持<ul><li>发生故障时，能够快速切换角色，无需人工干预，提升系统的容错能力。</li></ul></li><li>读写一致性保障<ul><li> Slave 跟随 Master 接收写操作，确保在 Master 崩溃前的数据都能保存在至少一个副本中。</li></ul></li><li>保障消费者不受影响<ul><li>故障切换后消费者可以继续从新的 Master 消费，不需要重新声明或绑定队列。</li></ul></li><li>支撑分布式架构<ul><li>多节点协同工作，适应 RabbitMQ 集群化部署需求，提高系统整体稳定性。</li></ul></li><li>管理和维护友好<ul><li>提高系统可维护性，在节点维护、升级或扩容时不会中断服务。</li></ul></li></ul><blockquote><p>副本（Slave）中的消息能不能被消费者消费？</p></blockquote><p>在 RabbitMQ 的镜像队列中，消费者不能消费副本（Slave）中的消息，只能消费主副本（Master）中的消息。也就是说：</p><ul><li>即使副本（Slave）上有完整的数据，但它们在 RabbitMQ 中是只读的，并且不对外提供读服务；</li><li>所有消费者都必须连接到主副本（Master）所在的节点，由主副本（Master）派发消息；</li><li>如果连接的是其他副本节点（Slave），那么该节点会自动将请求路由到主副本节点（Master）；</li><li>这也是为什么 RabbitMQ 推荐使用 HAProxy 或客户端连接逻辑来避免客户端只连接某个节点。</li></ul><blockquote><p>主副本（Master）和副本（Slave）之间的数据同步能否保持强一致性？</p></blockquote><p>在 RabbitMQ 的镜像队列中，主副本（Master）和副本（Slave）之间的数据同步是否可以保持强一致性取决于具体的策略配置。RabbitMQ 提供了两种同步策略：</p><table><thead><tr><th>同步策略</th><th>是否强一致性</th><th>是否为默认策略</th><th>描述</th></tr></thead><tbody><tr><td><code>automatic</code>（自动同步）</td><td>❌ 弱一致性</td><td>✅ 是</td><td>主副本（Master）发送数据给副本（Slave）后，不等待确认就返回成功，副本（Slave）有可能会一时落后</td></tr><tr><td><code>always</code>（强同步）</td><td>✅ 强一致性</td><td>❌ 否</td><td>主副本（Master）在写入消息时，必须等待所有副本（Slave）都确认收到后才返回成功</td></tr></tbody></table><ul><li>当镜像队列策略配置了 <code>ha-sync-mode = automatic</code>，即没有启用强同步机制，那么数据是最终一致性，在极端情况下可能丢失一小部分数据，比如主副本（Master）崩溃，但副本（Slave）尚未同步完成。</li><li>当镜像队列策略配置了 <code>ha-sync-mode = manual</code>，即启用了强同步机制，则数据可以保持强一致性，但这会牺牲一定的性能和吞吐量。</li></ul><h2 id="RabbitMQ-仲裁队列"><a href="#RabbitMQ-仲裁队列" class="headerlink" title="RabbitMQ 仲裁队列"></a>RabbitMQ 仲裁队列</h2><p>Quorum Queue（仲裁队列）是 RabbitMQ 官方推荐的新一代高可用队列，支持自动 Leader、日志复制、更可靠。Quorum 队列会在多个节点中选举一个 Leader，其他节点同步消息。Consumer 可以连接任意节点，性能、容错性都比 RabbitMQ 集群的普通模式好很多。</p><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/3168935.html" title="RabbitMQ 入门教程之十">https://www.techgrow.cn/posts/3168935.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag"><i class="fa fa-tag"></i> 微服务</a><a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" rel="tag"><i class="fa fa-tag"></i> 消息队列</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/adff4cba.html" rel="prev" title="RabbitMQ 入门教程之九"><i class="fa fa-angle-left"></i> RabbitMQ 入门教程之九</a></div><div class="post-nav-item"> <a href="/posts/18340f27.html" rel="next" title="ZooKeeper 入门教程之二">ZooKeeper 入门教程之二<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">1.8m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">26:44</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/3168935.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>