<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 ZooKeeper 的使用教程。"><meta property="og:type" content="article"><meta property="og:title" content="ZooKeeper 入门教程之二"><meta property="og:url" content="https://www.techgrow.cn/posts/18340f27.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 ZooKeeper 的使用教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/zookeeper-17.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/zookeeper-18.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/zookeeper-19.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/zookeeper-20.png"><meta property="article:published_time" content="2021-06-27T14:13:45.000Z"><meta property="article:modified_time" content="2021-06-27T14:13:45.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="分布式"><meta property="article:tag" content="大数据"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2024/12/zookeeper-17.png"><link rel="canonical" href="https://www.techgrow.cn/posts/18340f27.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/18340f27.html","path":"posts/18340f27.html","title":"ZooKeeper 入门教程之二"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>ZooKeeper 入门教程之二 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90"><span class="nav-text">学习资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ZooKeeper-%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="nav-text">ZooKeeper 客户端的命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%AF%AD%E6%B3%95"><span class="nav-text">客户端命令行语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ZNode-%E8%8A%82%E7%82%B9%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="nav-text">ZNode 节点的类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9B%E7%A7%8D%E5%B8%B8%E8%A7%81%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B"><span class="nav-text">四种常见节点类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%89%E7%A7%8D%E6%96%B0%E7%9A%84%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B"><span class="nav-text">三种新的节点类型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ZNode-%E8%8A%82%E7%82%B9%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-text">ZNode 节点的创建</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%81%E4%B9%85%E8%8A%82%E7%82%B9%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-text">持久节点的创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%B4%E6%97%B6%E8%8A%82%E7%82%B9%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-text">临时节点的创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%81%E4%B9%85%E9%A1%BA%E5%BA%8F%E8%8A%82%E7%82%B9%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-text">持久顺序节点的创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%B4%E6%97%B6%E9%A1%BA%E5%BA%8F%E8%8A%82%E7%82%B9%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-text">临时顺序节点的创建</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ZNode-%E8%8A%82%E7%82%B9%E7%9A%84%E5%88%A0%E9%99%A4"><span class="nav-text">ZNode 节点的删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9-ZNode-%E8%8A%82%E7%82%B9%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-text">修改 ZNode 节点的数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96-ZNode-%E8%8A%82%E7%82%B9%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-text">获取 ZNode 节点的数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96-ZNode-%E8%8A%82%E7%82%B9%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="nav-text">获取 ZNode 节点的信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B-ZNode-%E8%8A%82%E7%82%B9%E7%9A%84%E7%8A%B6%E6%80%81"><span class="nav-text">查看 ZNode 节点的状态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%91%E5%90%AC-ZNode-%E8%8A%82%E7%82%B9%E7%9A%84%E5%8F%98%E5%8C%96"><span class="nav-text">监听 ZNode 节点的变化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%91%E5%90%AC%E5%99%A8%E7%9A%84%E5%8E%9F%E7%90%86"><span class="nav-text">监听器的原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%91%E5%90%AC%E5%91%BD%E4%BB%A4%E7%9A%84%E8%AF%AD%E6%B3%95"><span class="nav-text">监听命令的语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%91%E5%90%AC%E8%8A%82%E7%82%B9%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8F%98%E5%8C%96"><span class="nav-text">监听节点的数据变化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%91%E5%90%AC%E8%8A%82%E7%82%B9%E7%9A%84%E5%AD%90%E8%8A%82%E7%82%B9%E5%8F%98%E5%8C%96"><span class="nav-text">监听节点的子节点变化</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ZooKeeper-%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84-API"><span class="nav-text">ZooKeeper 客户端的 API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ZooKeeper-%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E5%86%99%E5%85%A5%E5%8E%9F%E7%90%86"><span class="nav-text">ZooKeeper 客户端的写入原理</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">719</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/18340f27.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="ZooKeeper 入门教程之二 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 ZooKeeper 的使用教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> ZooKeeper 入门教程之二</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-06-27 22:13:45" itemprop="dateCreated datePublished" datetime="2021-06-27T22:13:45+08:00">2021-06-27</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/18340f27.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/18340f27.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>5k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>5 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/23b4218e.html">ZooKeeper 入门教程之一</a></li><li><a href="/posts/18340f27.html">ZooKeeper 入门教程之二</a></li><li><a href="/posts/5a68992a.html">ZooKeeper 入门教程之三</a></li><li><a href="/posts/16baf534.html">ZooKeeper 入门教程之四</a></li><li><a href="/posts/b589771.html">ZooKeeper 入门教程之五</a></li><li><a href="/posts/d415f72.html">ZooKeeper 入门教程之六</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h3><ul><li><a href="/posts/ecc33bf4.html">ZooKeeper 学习路线</a></li><li><a target="_blank" rel="external nofollow" href="https://zookeeper.apache.org/documentation.html">ZooKeeper 官方英文文档</a></li><li><a target="_blank" rel="external nofollow" href="https://zookeeper.net.cn/doc/r3.9.2/index.html">ZooKeeper 官方中文文档</a></li></ul><span id="more"></span><h2 id="ZooKeeper-客户端的命令"><a href="#ZooKeeper-客户端的命令" class="headerlink" title="ZooKeeper 客户端的命令"></a>ZooKeeper 客户端的命令</h2><h3 id="客户端命令行语法"><a href="#客户端命令行语法" class="headerlink" title="客户端命令行语法"></a>客户端命令行语法</h3><p><img data-src="../../../asset/2024/12/zookeeper-17.png"></p><ul><li>启动 ZooKeeper 客户端</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 ZooKeeper 的命令帮助手册</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 0] <span class="built_in">help</span></span><br></pre></td></tr></tbody></table></figure><h3 id="ZNode-节点的类型"><a href="#ZNode-节点的类型" class="headerlink" title="ZNode 节点的类型"></a>ZNode 节点的类型</h3><h4 id="四种常见节点类型"><a href="#四种常见节点类型" class="headerlink" title="四种常见节点类型"></a>四种常见节点类型</h4><p>ZooKeeper 的节点（ZNode）是其数据存储的基本单元，每个节点有自己的路径、数据和元信息。根据用途和特性，ZooKeeper 的节点分为以下四种类型：</p><ul><li><p><strong>持久节点（Persistent ZNode）</strong></p><ul><li>定义：<ul><li>创建持久节点后，除非是显示删除，否则该节点将一直存在于 ZooKeeper 中。</li><li>即使创建节点的客户端断开连接，节点也不会被删除。</li></ul></li><li>特点：<ul><li>不受客户端会话状态的影响，即使客户端断开连接，节点仍然存在。</li><li>适用于存储长期存在的数据，如配置信息、元信息等。</li></ul></li><li>适用场景：<ul><li><code>配置信息存储</code>：在分布式系统中，可以使用持久节点来存储各种配置信息，例如数据库连接信息、系统参数等。这些配置信息不会因为客户端的连接状态而改变，因此适合使用持久节点存储。</li></ul></li></ul></li><li><p><strong>临时节点（Ephemeral ZNode）</strong></p><ul><li>定义：<ul><li>临时节点的生命周期与创建它的客户端会话绑定。如果创建临时节点的客户端会话结束（例如客户端与 ZooKeeper 服务器的连接断开），那么这个节点就会被自动删除。</li><li>临时节点非常适合用于表示临时状态或临时任务。</li></ul></li><li>特点：<ul><li>当客户端断开会话（例如关闭连接或会话超时），节点会自动删除。</li><li>无法创建临时节点的子节点（子节点必须是持久节点）。</li></ul></li><li>适用场景：<ul><li><code>服务注册中心</code>：每个服务在启动时，连接到 ZooKeeper 并创建一个唯一的临时节点，节点名称通常包括服务的标识（如 IP、端口等）。客户端查询指定服务的父节点，即可获取所有在线服务的列表。ZooKeeper 的 Watcher 机制可用于实时监听服务的上下线变化。当服务实例正常关闭或因故宕机导致会话断开时，ZooKeeper 会自动删除对应的临时节点，确保注册中心能够反映实时的服务状态。</li></ul></li></ul></li><li><p><strong>持久顺序节点（Persistent Sequential ZNode）</strong></p><ul><li>定义：<ul><li>持久顺序节点与持久节点类似，但是它会在节点名称后面自动添加一个单调递增的序号。这个序号是一个由 ZooKeeper 自动生成的数字，用于保持节点的顺序。</li><li>持久顺序节点在创建后也不会被自动删除，除非是显式删除。</li></ul></li><li>特点：<ul><li>节点在创建后会一直存在，直到被明确删除。</li><li>节点名称带有自动生成的顺序后缀，用于有序标识。</li></ul></li><li>适用场景：<ul><li><code>分布式任务调度</code>：在分布式任务调度系统中，多个任务需要按顺序执行且长期存储，适合使用持久化顺序节点来实现。任务提交时，在 ZooKeeper 的 <code>/tasks</code> 路径下创建持久顺序节点，如 <code>/tasks/task000000001</code>，自动带有递增顺序号，确保任务能够按顺序处理。工作节点按顺序获取任务并处理，完成后删除对应节点。即使系统崩溃，节点数据仍存在，确保任务不会丢失。</li></ul></li></ul></li><li><p><strong>临时顺序节点（Ephemeral Sequential ZNode）</strong></p><ul><li>定义：<ul><li>临时顺序节点结合了临时节点和顺序节点的特点。它会在节点名称后面自动添加一个单调递增的序号，并且在创建它的客户端会话结束后自动删除。</li><li>临时顺序节点常用于实现分布式锁或者分布式队列。</li></ul></li><li>特点：<ul><li>节点的生命周期与客户端会话绑定，会话结束时自动删除。</li><li>节点名称带有自动生成的顺序后缀，用于有序标识。</li></ul></li><li>适用场景：<ul><li><code>分布式锁</code>：在分布式系统中，可以使用临时顺序节点来实现分布式锁。每个客户端尝试获取锁时，都创建一个临时顺序节点，然后检查自己创建的是否是最小的节点。如果是最小的节点，则表示获取了锁；否则，客户端需要监听前一个节点的删除事件，等待锁的释放。</li></ul></li></ul></li></ul><div class="admonition note"><p class="admonition-title">提示</p><ul><li>创建 ZNode 时设置顺序标识，ZNode 的名称后面会附加一个顺序号，这顺序号是一个单调递增的计数器，由父节点维护。</li><li>特别注意：在分布式系统中，顺序号可以被用于为所有的事件进行全局排序，这样客户端可以通过顺序号推断事件的顺序。</li></ul></div><h4 id="三种新的节点类型"><a href="#三种新的节点类型" class="headerlink" title="三种新的节点类型"></a>三种新的节点类型</h4><p>在 ZooKeeper <code>3.5.5</code> 或更高版本中，新增了以下三种节点类型：</p><ul><li><p><strong>容器节点（Container ZNode）</strong></p><ul><li>定义：<ul><li>容器节点是一个标记节点类型，它的用途是将节点创建为一个 “容器”。</li></ul></li><li>特点：<ul><li>容器节点本身不会存储数据，而是作为一个逻辑上的分隔符或者容器来组织其它节点。</li><li>容器节点没有真正的数据内容，但它可以有子节点。</li><li>容器节点本质上是持久节点，但会在以下条件下被自动删除：<ul><li>容器节点的子节点全部被删除。</li><li>在一段时间内（默认由 ZooKeeper 内部机制决定），容器节点没有新的子节点被创建。</li></ul></li></ul></li><li>创建命令：<ul><li>节点创建：<code>create -c /book "python"</code></li></ul></li><li>适用场景：<ul><li>当需要在 ZooKeeper 中组织节点，或者以分层方式管理节点时，可以使用容器节点。</li><li>适用于组织节点的逻辑结构，尤其是在需要短期存储子节点但不希望长期保留父节点的场景，比如分布式锁或分布式队列的根节点。</li><li>容器节点可以用作命名空间的划分或分组的基础结构。例如，可以使用容器节点来管理多个服务或配置，便于层级化管理。</li></ul></li><li>注意事项：<ul><li>容器节点的删除是由 ZooKeeper 后台任务完成，可能存在一定延迟。</li><li>容器节点仅在子节点被清空后，ZooKeeper 后台任务才会尝试删除掉它。</li></ul></li></ul></li><li><p><strong>带生存时间的持久节点（Persistent With TTL ZNode）</strong></p><ul><li>定义：<ul><li>一种持久节点类型，但带有 “TTL（生存时间）” 特性。</li><li>TTL 表示该节点将会在指定的时间过期后自动删除。过期时间由客户端在创建节点时设置，这种节点的生命周期是有限的。</li></ul></li><li>特点：<ul><li>自动删除：节点会在指定的 TTL 到期后自动被 ZooKeeper 删除。</li><li>持久性：节点会在 ZooKeeper 重启后继续存在，直到 TTL 到期。</li><li>可以用于存储临时的数据，但与普通的临时节点不同，它允许节点具有一个持久性的特征，只是在一定时间后会被清理。</li></ul></li><li>创建命令：<ul><li>节点创建：<code>create -t 60000 /book "python"</code></li></ul></li><li>适用场景：<ul><li>当需要存储一些临时性的、具有时效性的数据，并希望它们在过期后自动删除时。</li><li>比如，可以用来存储某些配置项或缓存数据，允许系统在数据过期时自动清理，而不需要人工干预。</li></ul></li></ul></li><li><p><strong>带生存时间的持久顺序节点（Persistent Sequential With TTL ZNode）</strong></p><ul><li>定义：<ul><li>一种结合了持久性、顺序性和 TTL 的节点类型。</li><li>节点会被赋予一个唯一的顺序标识符（通常是数字后缀），并且也具有 “TTL（生存时间）” 特性。</li></ul></li><li>特点：<ul><li>持久性：节点会在 ZooKeeper 重启后继续存在，直到 TTL 到期。</li><li>顺序性：ZooKeeper 会为该节点分配一个自增的序列号，这个序列号会在节点名称后附加。</li><li>自动删除：节点会在 TTL 到期后被自动删除。</li></ul></li><li>创建命令：<ul><li>节点创建：<code>create -s -t 60000 /book "python"</code></li></ul></li><li>适用场景：<ul><li>适用于限时的分布式锁、分布式队列等，保证在特定时间后节点过期并清理。</li><li>适用于需要生成顺序节点，并且这些节点具有时效性的业务场景。例如，在分布式任务调度中，可以为每个任务分配一个顺序编号，并且在任务完成后自动删除这些顺序编号的节点。</li></ul></li></ul></li></ul><h3 id="ZNode-节点的创建"><a href="#ZNode-节点的创建" class="headerlink" title="ZNode 节点的创建"></a>ZNode 节点的创建</h3><h4 id="持久节点的创建"><a href="#持久节点的创建" class="headerlink" title="持久节点的创建"></a>持久节点的创建</h4><ul><li>创建持久节点</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 0] create /backend <span class="string">"backend"</span></span><br><span class="line">Created /backend</span><br></pre></td></tr></tbody></table></figure><ul><li>获取节点的数据</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 1] get /backend</span><br><span class="line">backend</span><br><span class="line"></span><br><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 2] get -s /backend</span><br><span class="line">backend</span><br><span class="line">cZxid = 0x300000020</span><br><span class="line">ctime = Sun Dec 29 17:11:26 CST 2021</span><br><span class="line">mZxid = 0x300000020</span><br><span class="line">mtime = Sun Dec 29 17:11:26 CST 2021</span><br><span class="line">pZxid = 0x300000021</span><br><span class="line">cversion = 1</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 7</span><br><span class="line">numChildren = 1</span><br></pre></td></tr></tbody></table></figure><h4 id="临时节点的创建"><a href="#临时节点的创建" class="headerlink" title="临时节点的创建"></a>临时节点的创建</h4><ul><li>创建临时节点</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 0] create -e /backend <span class="string">"backend"</span></span><br><span class="line">Created /backend</span><br></pre></td></tr></tbody></table></figure><ul><li>查看根目录下的节点列表</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 1] ls /</span><br><span class="line">[backend, zookeeper]</span><br></pre></td></tr></tbody></table></figure><ul><li>退出客户端</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 2] quit</span><br></pre></td></tr></tbody></table></figure><ul><li>客户端重新连接后，查看临时节点是否被删除</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 3] ls /</span><br><span class="line">[zookeeper]</span><br></pre></td></tr></tbody></table></figure><h4 id="持久顺序节点的创建"><a href="#持久顺序节点的创建" class="headerlink" title="持久顺序节点的创建"></a>持久顺序节点的创建</h4><ul><li>首先创建一个普通的根节点（持久节点）</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 0] create /backend <span class="string">"backend"</span></span><br><span class="line">Created /backend</span><br></pre></td></tr></tbody></table></figure><ul><li>创建持久顺序节点</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 1] create -s /backend/python <span class="string">"python"</span></span><br><span class="line">Created /backend/python0000000000</span><br><span class="line"></span><br><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 2] create -s /backend/python <span class="string">"python"</span></span><br><span class="line">Created /backend/python0000000001</span><br><span class="line"></span><br><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 3] create -s /backend/python <span class="string">"python"</span></span><br><span class="line">Created /backend/python0000000002</span><br></pre></td></tr></tbody></table></figure><ul><li>查看子节点列表</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 4] ls /backend</span><br><span class="line">[python0000000000, python0000000001, python0000000002]</span><br></pre></td></tr></tbody></table></figure><h4 id="临时顺序节点的创建"><a href="#临时顺序节点的创建" class="headerlink" title="临时顺序节点的创建"></a>临时顺序节点的创建</h4><ul><li>首先创建一个普通的根节点（持久节点）</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 0] create /backend <span class="string">"backend"</span></span><br><span class="line">Created /backend</span><br></pre></td></tr></tbody></table></figure><ul><li>创建临时顺序节点</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 1] create -e -s /backend/python <span class="string">"python"</span></span><br><span class="line">Created /backend/python0000000000</span><br><span class="line"></span><br><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 2] create -e -s /backend/python <span class="string">"python"</span></span><br><span class="line">Created /backend/python0000000001</span><br><span class="line"></span><br><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 3] create -e -s /backend/python <span class="string">"python"</span></span><br><span class="line">Created /backend/python0000000002</span><br></pre></td></tr></tbody></table></figure><ul><li>查看子节点列表</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 4] ls /backend</span><br><span class="line">[python0000000000, python0000000001, python0000000002]</span><br></pre></td></tr></tbody></table></figure><ul><li>退出客户端</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 5] quit</span><br></pre></td></tr></tbody></table></figure><ul><li>客户端重新连接后，查看临时节点是否被删除</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 6] ls /backend</span><br><span class="line">[]</span><br></pre></td></tr></tbody></table></figure><h3 id="ZNode-节点的删除"><a href="#ZNode-节点的删除" class="headerlink" title="ZNode 节点的删除"></a>ZNode 节点的删除</h3><ul><li>删除节点</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 0] delete /backend</span><br></pre></td></tr></tbody></table></figure><ul><li>递归删除节点</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 1] delete /backend/python</span><br></pre></td></tr></tbody></table></figure><h3 id="修改-ZNode-节点的数据"><a href="#修改-ZNode-节点的数据" class="headerlink" title="修改 ZNode 节点的数据"></a>修改 ZNode 节点的数据</h3><ul><li>首先创建一个节点</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 0] create /backend <span class="string">"backend"</span></span><br></pre></td></tr></tbody></table></figure><ul><li>获取节点的数据</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 1] get -s /backend</span><br><span class="line">backend</span><br><span class="line">cZxid = 0x300000055</span><br><span class="line">ctime = Sun Dec 29 17:59:20 CST 2021</span><br><span class="line">mZxid = 0x300000055</span><br><span class="line">mtime = Sun Dec 29 17:59:20 CST 2021</span><br><span class="line">pZxid = 0x300000055</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 7</span><br><span class="line">numChildren = 0</span><br></pre></td></tr></tbody></table></figure><ul><li>修改节点的数据</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 2] <span class="built_in">set</span> /backend <span class="string">"backend_update"</span></span><br></pre></td></tr></tbody></table></figure><ul><li>再次获取节点的数据</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 3] get -s /backend</span><br><span class="line">backend_update</span><br><span class="line">cZxid = 0x300000055</span><br><span class="line">ctime = Sun Dec 29 17:59:20 CST 2021</span><br><span class="line">mZxid = 0x300000056</span><br><span class="line">mtime = Sun Dec 29 18:01:13 CST 2021</span><br><span class="line">pZxid = 0x300000055</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 1</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 14</span><br><span class="line">numChildren = 0</span><br></pre></td></tr></tbody></table></figure><h3 id="获取-ZNode-节点的数据"><a href="#获取-ZNode-节点的数据" class="headerlink" title="获取 ZNode 节点的数据"></a>获取 ZNode 节点的数据</h3><ul><li>首先创建一个节点</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 0] create /backend <span class="string">"backend"</span></span><br></pre></td></tr></tbody></table></figure><ul><li>获取节点的数据</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 1] get /backend</span><br><span class="line">backend</span><br></pre></td></tr></tbody></table></figure><ul><li>获取节点的数据（附带详细信息）</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 2] get -s /backend</span><br><span class="line">backend</span><br><span class="line">cZxid = 0x300000055</span><br><span class="line">ctime = Sun Dec 29 17:59:20 CST 2021</span><br><span class="line">mZxid = 0x300000055</span><br><span class="line">mtime = Sun Dec 29 17:59:20 CST 2021</span><br><span class="line">pZxid = 0x300000055</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 7</span><br><span class="line">numChildren = 0</span><br></pre></td></tr></tbody></table></figure><h3 id="获取-ZNode-节点的信息"><a href="#获取-ZNode-节点的信息" class="headerlink" title="获取 ZNode 节点的信息"></a>获取 ZNode 节点的信息</h3><ul><li>查看节点中所包含的子节点</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 0] ls /</span><br><span class="line">[zookeeper]</span><br></pre></td></tr></tbody></table></figure><ul><li>查看节点的详细信息</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 1] ls -s /</span><br><span class="line">[zookeeper]cZxid = 0x0</span><br><span class="line">ctime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">mZxid = 0x0</span><br><span class="line">mtime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">pZxid = 0x30000001d</span><br><span class="line">cversion = 3</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 0</span><br><span class="line">numChildren = 1</span><br></pre></td></tr></tbody></table></figure><h3 id="查看-ZNode-节点的状态"><a href="#查看-ZNode-节点的状态" class="headerlink" title="查看 ZNode 节点的状态"></a>查看 ZNode 节点的状态</h3><ul><li>首先创建一个节点</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 0] create /backend <span class="string">"backend"</span></span><br></pre></td></tr></tbody></table></figure><ul><li>查看节点的状态</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 0] <span class="built_in">stat</span> /backend</span><br><span class="line">cZxid = 0x0</span><br><span class="line">ctime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">mZxid = 0x0</span><br><span class="line">mtime = Thu Jan 01 08:00:00 CST 1970</span><br><span class="line">pZxid = 0x30000005d</span><br><span class="line">cversion = 32</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0x0</span><br><span class="line">dataLength = 0</span><br><span class="line">numChildren = 2</span><br></pre></td></tr></tbody></table></figure><ul><li>字段信息说明</li></ul><table><thead><tr><th>字段</th><th>含义</th></tr></thead><tbody><tr><td> czxid</td><td> 节点创建时的事务 ID（ZXID 是事务的唯一标识）</td></tr><tr><td>ctime</td><td> 节点创建的时间戳（以毫秒为单位，从 1970 年开始）</td></tr><tr><td>mzxid</td><td> 节点最后一次更新时的事务 ID（ZXID）</td></tr><tr><td>mtime</td><td> 节点最后一次更新的时间戳（以毫秒为单位，从 1970 年开始）</td></tr><tr><td>pzxid</td><td> 最后一次修改子节点列表的事务 ID（ZXID）</td></tr><tr><td>cversion</td><td> 节点子节点的版本号（即子节点修改的次数）</td></tr><tr><td>dataVersion</td><td> 节点数据的版本号</td></tr><tr><td> aclVersion</td><td> 节点访问控制列表（ACL）的版本号</td></tr><tr><td> ephemeralOwner</td><td> 如果是临时节点，表示创建该节点的会话 ID（Session ID）；如果不是临时节点，则是 0</td></tr><tr><td>dataLength</td><td> 节点存储的数据大小（以字节为单位）</td></tr><tr><td>numChildren</td><td> 节点的直接子节点数量</td></tr></tbody></table><h3 id="监听-ZNode-节点的变化"><a href="#监听-ZNode-节点的变化" class="headerlink" title="监听 ZNode 节点的变化"></a>监听 ZNode 节点的变化</h3><p>客户端注册监听它关心的目录节点，当目录节点发生变化（数据改变、节点删除、子目录节点增加 / 删除）时，ZooKeeper 服务器会通知客户端。监听机制可以保证 ZooKeeper 保存的任何数据的任何改变，都能快速地反应给监听了该节点的应用程序。</p><h4 id="监听器的原理"><a href="#监听器的原理" class="headerlink" title="监听器的原理"></a>监听器的原理</h4><ul><li>监听器的工作原理<ul><li> (1) 首先要有一个 <code>main</code> 线程。</li><li>(2) 在 <code>main</code> 线程中创建 Zookeeper 客户端，这时就会创建两个线程，一个负责网络连接通信（Connect），一个负责监听（Listener）。</li><li>(3) 通过 Connect 线程将注册的监听事件发送给 Zookeeper 服务器。</li><li>(4) 在 Zookeeper 服务器中，将客户端注册的监听事件添加到监听器列表。</li><li>(5) 当 Zookeeper 服务器监听到有数据或子节点发生变化，就会将这个消息发送给客户端的 Listener 线程。</li><li>(6) 在客户端的 Listener 线程内，调用 <code>process()</code> 方法进行消息处理。</li></ul></li></ul><p><img data-src="../../../asset/2024/12/zookeeper-18.png"></p><h4 id="监听命令的语法"><a href="#监听命令的语法" class="headerlink" title="监听命令的语法"></a>监听命令的语法</h4><ul><li><p>监听节点数据的变化</p><ul><li><code>get -w path</code></li></ul></li><li><p>监听子节点增减的变化</p><ul><li><code>ls -w path</code></li></ul></li></ul><h4 id="监听节点的数据变化"><a href="#监听节点的数据变化" class="headerlink" title="监听节点的数据变化"></a>监听节点的数据变化</h4><ul><li>首先创建一个节点</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 0] create /backend <span class="string">"backend"</span></span><br><span class="line">Created /backend</span><br></pre></td></tr></tbody></table></figure><ul><li>在集群节点一上注册监听 <code>/backend</code> 节点的数据变化</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 1] get -w /backend</span><br></pre></td></tr></tbody></table></figure><ul><li>在集群节点二上修改 <code>/backend</code> 节点的数据</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 2] <span class="built_in">set</span> /backend <span class="string">"backend_changed"</span></span><br></pre></td></tr></tbody></table></figure><ul><li>观察集群节点一上接收到数据变化的监听</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WATCHER::</span><br><span class="line"></span><br><span class="line">WatchedEvent state:SyncConnected type:NodeDataChanged path:/backend</span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">特别注意</p><p>ZooKeeper 的监听器注册一次，只能监听一次。如果想再次监听，则需要再次注册。</p></div><h4 id="监听节点的子节点变化"><a href="#监听节点的子节点变化" class="headerlink" title="监听节点的子节点变化"></a>监听节点的子节点变化</h4><ul><li>首先创建一个节点</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 0] create /backend <span class="string">"backend"</span></span><br><span class="line">Created /backend</span><br></pre></td></tr></tbody></table></figure><ul><li>在集群节点一上注册监听 <code>/backend</code> 节点的子节点变化</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 1] ls -w /backend</span><br><span class="line">[]</span><br></pre></td></tr></tbody></table></figure><ul><li>在集群节点二上为 <code>/backend</code> 节点创建子节点</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: 127.0.0.1:2181(CONNECTED) 2] create /backend/java</span><br><span class="line">Created /backend/java</span><br></pre></td></tr></tbody></table></figure><ul><li>观察集群节点一上接收到子节点变化的监听</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WATCHER::</span><br><span class="line"></span><br><span class="line">WatchedEvent state:SyncConnected <span class="built_in">type</span>:NodeChildrenChanged path:/backend</span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">特别注意</p><p>ZooKeeper 的监听器注册一次，只能监听一次。如果想再次监听，则需要再次注册。</p></div><h2 id="ZooKeeper-客户端的-API"><a href="#ZooKeeper-客户端的-API" class="headerlink" title="ZooKeeper 客户端的 API"></a>ZooKeeper 客户端的 API</h2><p>本节将演示如何使用 ZooKeeper 原生客户端（并不是 Curator 客户端）的 API，比如创建节点、监听子节点变化、判断节点是否存在，完整的案例代码可以直接从 <a target="_blank" rel="external nofollow" href="https://github.com/rqh656418510/spring-cloud-share/tree/main/big-data/zookeeper-study">GitHub</a> 下载对应章节 <code>zookeeper-lesson-01</code>。</p><ul><li>引入 Maven 依赖</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.17.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>日志文件（<code>log4j.properties</code>）</li></ul><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">INFO, stdout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d %p [%c] - %m%n</span></span><br><span class="line"><span class="meta">log4j.appender.logfile</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="meta">log4j.appender.logfile.File</span>=<span class="string">target/spring.log</span></span><br><span class="line"><span class="meta">log4j.appender.logfile.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.logfile.layout.ConversionPattern</span>=<span class="string">%d %p [%c] - %m%n</span></span><br></pre></td></tr></tbody></table></figure><ul><li>Java 案例代码</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZKClientTest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ZooKeeper 连接地址（多个集群节点使用逗号分割）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ADDRESS = <span class="string">"192.168.2.235:2181,192.168.2.235:2182,192.168.2.235:2183"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ZooKeeper 会话超时时间</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_TIMEOUT = <span class="number">2000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ZooKeeper 客户端</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ZooKeeper client;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化 ZK 客户端</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@BeforeAll</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">// 创建 ZK 客户端，并设置全局监听器</span></span><br><span class="line">        client = <span class="keyword">new</span> ZooKeeper(ADDRESS, SESSION_TIMEOUT, <span class="keyword">new</span> Watcher() {</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 接收到监听事件后的回调函数（用户的业务逻辑）</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(WatchedEvent event)</span> </span>{</span><br><span class="line">                <span class="comment">// 获取监听事件的信息</span></span><br><span class="line">                System.out.println(<span class="string">"===&gt; Watcher: "</span> + event.getType() + <span class="string">" -- "</span> + event.getPath());</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 监听器是一次性的，当接收到监听事件后，需要重新设置监听器</span></span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    List&lt;String&gt; children = client.getChildren(<span class="string">"/"</span>, <span class="keyword">true</span>);</span><br><span class="line">                    <span class="keyword">for</span> (String path : children) {</span><br><span class="line">                        System.out.println(<span class="string">"===&gt; "</span> + path);</span><br><span class="line">                    }</span><br><span class="line">                } <span class="keyword">catch</span> (Exception e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createNode</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        String path = client.create(<span class="string">"/java"</span>, <span class="string">"Hello World"</span>.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</span><br><span class="line">        System.out.println(<span class="string">"===&gt; "</span> + path);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取子节点，并监听子节点的变化</span></span><br><span class="line"><span class="comment">     * &lt;p&gt; 监听器是一次性的，当接收到监听事件后，需要重新设置监听器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getChildren</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        List&lt;String&gt; children = client.getChildren(<span class="string">"/"</span>, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">for</span> (String path : children) {</span><br><span class="line">            System.out.println(<span class="string">"===&gt; "</span> + path);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// 延时阻塞</span></span><br><span class="line">        System.in.read();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断节点是否存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exist</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        Stat stat = client.exists(<span class="string">"/java"</span>, <span class="keyword">false</span>);</span><br><span class="line">        System.out.println(stat == <span class="keyword">null</span> ? <span class="string">"not exist"</span> : <span class="string">"exist"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>ZooKeeper 的监听器是一次性的，当客户端接收到监听事件后，需要让客户端重新设置监听器。</li><li>上述案例代码中，ZooKeeper 客户端的版本是 <code>3.6.3</code>，而 ZooKeeper 服务器的版本是 <code>3.5.7</code>。</li></ul></div><h2 id="ZooKeeper-客户端的写入原理"><a href="#ZooKeeper-客户端的写入原理" class="headerlink" title="ZooKeeper 客户端的写入原理"></a>ZooKeeper 客户端的写入原理</h2><blockquote><p>当 ZooKeeper 客户端将写请求直接发送给 Leader 节点时，ZooKeeper 服务器的处理流程如下图所示</p></blockquote><p><img data-src="../../../asset/2025/01/zookeeper-19.png"></p><ul><li>(1) Leader 节点让 Follwer 节点写入数据。</li><li>(2) 只要满足一半以上节点写入成功（半数写入），Leader 节点就会立刻返回 ACK（确认消息）给客户端。</li><li>(3) 最后 Leader 节点继续让其他 Follower 节点写入数据。</li></ul><blockquote><p>当 ZooKeeper 客户端将写请求发送给 Follower 节点，ZooKeeper 服务器的处理流程如下图所示</p></blockquote><p><img data-src="../../../asset/2025/01/zookeeper-20.png"></p><ul><li>(1) Follower 节点会将写请求交给 Leader 节点。</li><li>(2) Leader 节点让 Follwer 节点写入数据。</li><li>(3) 只要满足一半以上节点写入成功（半数写入），Leader 节点就会立刻返回 ACK（确认消息）给 Follower 节点，然后 Follower 节点再返回 ACK（确认消息）给客户端。</li><li>(4) 最后 Leader 节点继续让其他 Follower 节点写入数据。</li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/18340f27.html" title="ZooKeeper 入门教程之二">https://www.techgrow.cn/posts/18340f27.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag"><i class="fa fa-tag"></i> 大数据</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/3168935.html" rel="prev" title="RabbitMQ 入门教程之十"><i class="fa fa-angle-left"></i> RabbitMQ 入门教程之十</a></div><div class="post-nav-item"> <a href="/posts/5a68992a.html" rel="next" title="ZooKeeper 入门教程之三">ZooKeeper 入门教程之三<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">1.9m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">29:30</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/18340f27.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>