<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍微服务单点登录的多种实现方案。"><meta property="og:type" content="article"><meta property="og:title" content="微服务单点登录的实现方案"><meta property="og:url" content="https://www.techgrow.cn/posts/5e91a2fd.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍微服务单点登录的多种实现方案。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/12/sso-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/12/sso-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/12/sso-3.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/12/sso-4.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/12/sso-5.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/12/sso-6.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/12/sso-7.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/12/sso-8.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/12/sso-9.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/12/sso-10.png"><meta property="article:published_time" content="2019-07-15T15:12:42.000Z"><meta property="article:modified_time" content="2025-10-13T13:30:00.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="分布式"><meta property="article:tag" content="微服务"><meta property="article:tag" content="架构设计"><meta property="article:tag" content="OAuth"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2025/12/sso-1.png"><link rel="canonical" href="https://www.techgrow.cn/posts/5e91a2fd.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/5e91a2fd.html","path":"posts/5e91a2fd.html","title":"微服务单点登录的实现方案"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>微服务单点登录的实现方案 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script>
  (function () {

  // 防止 Pjax 重复绑定事件
  if (window.__moonMenuCodeExpandBound) {
    return;
  }
  window.__moonMenuCodeExpandBound = true;

  const STORAGE_KEY = 'moon_menu_code_fold';

  /* ===============================
   * 1. 设置 moon-menu 按钮的 title
   * =============================== */
  (function bindMoonMenuTitles() {
    const items = [
      { selector: '#moon-menu-item-code',        title: '展开 / 折叠代码块' },
      { selector: '#moon-menu-item-back2top',    title: '回到页面顶部' },
      { selector: '#moon-menu-item-back2bottom', title: '回到页面底部' }
    ];

    let allReady = true;

    items.forEach(item => {
      const el = document.querySelector(item.selector);
      if (!el) {
        allReady = false;
        return;
      }
      el.setAttribute('title', item.title);
    });

    if (!allReady) {
      setTimeout(bindMoonMenuTitles, 100);
    }
  })();

  /* =================================
   * 2. 页面首次加载：代码块恢复展开或折叠状态
   * ================================= */
  function applyStoredCodeState() {
    const containers = document.querySelectorAll('.code-container');
    if (!containers.length) {
      return;
    }

    const state = localStorage.getItem(STORAGE_KEY);
    if (!state) {
      return;
    }

    containers.forEach(container => {
      if (state === 'expanded') {
        // 展开代码块
        container.classList.remove('highlight-fold');
      } else if (state === 'folded') {
        // 折叠代码块
        container.classList.add('highlight-fold');
      }
    });
  }

  // 等代码块出现后，再恢复展开或折叠状态
  function waitAndApplyState() {
    const containers = document.querySelectorAll('.code-container');

    if (!containers.length) {
      setTimeout(waitAndApplyState, 100);
      return;
    }

    applyStoredCodeState();
  }

  // 页面首次加载时恢复状态
  waitAndApplyState();
  
  // Pjax 切换页面后，必须重新恢复状态
  document.addEventListener('pjax:complete', function () {
    waitAndApplyState();
  });

  /* ===============================
   * 3. 点击按钮：切换状态并保存
   * =============================== */
  document.addEventListener('click', function (e) {
    const codeMenu = e.target.closest('#moon-menu-item-code');
    if (!codeMenu) {
      return;
    }

    toggleAllCodeBlocks();
  });

  // 展开或折叠代码块
  function toggleAllCodeBlocks() {
    const containers = document.querySelectorAll('.code-container');
    if (!containers.length) {
      return;
    }

    // 只要存在折叠的代码块，就认为当前是折叠状态
    const hasFolded = Array.from(containers).some(c => {
      return c.classList.contains('highlight-fold');
    });

    containers.forEach(container => {
      if (hasFolded) {
        // 展开代码块
        container.classList.remove('highlight-fold');
      } else {
        // 折叠代码块
        container.classList.add('highlight-fold');
      }
    });

    // 记录展开或折叠状态
    localStorage.setItem(
      STORAGE_KEY,
      hasFolded ? 'expanded' : 'folded'
    );
  }

})();
</script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%9A%E8%AF%9D%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text">会话的基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-%E6%97%A0%E7%8A%B6%E6%80%81%E5%8D%8F%E8%AE%AE"><span class="nav-text">HTTP 无状态协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%9A%E8%AF%9D%E6%9C%BA%E5%88%B6%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="nav-text">会话机制的概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="nav-text">登录状态的概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%B3%BB%E7%BB%9F%E7%99%BB%E5%BD%95%E7%9A%84%E5%A4%8D%E6%9D%82%E6%80%A7"><span class="nav-text">多系统登录的复杂性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E7%9A%84%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text">单点登录的基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="nav-text">单点登录的概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-text">单点登录的工作原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E7%82%B9%E6%B3%A8%E9%94%80%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-text">单点注销的工作原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E7%9A%84%E9%83%A8%E7%BD%B2%E6%9E%B6%E6%9E%84"><span class="nav-text">单点登录的部署架构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88"><span class="nav-text">单点登录的实现方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E-Session-%E7%BB%9F%E4%B8%80%E8%AE%A4%E8%AF%81%E4%B8%AD%E5%BF%83"><span class="nav-text">基于 Session + 统一认证中心</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E-JWT%EF%BC%88%E4%B8%BB%E6%B5%81%E6%96%B9%E6%A1%88%EF%BC%89"><span class="nav-text">基于 JWT（主流方案）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E-Gateway-%E7%BB%9F%E4%B8%80%E8%AE%A4%E8%AF%81"><span class="nav-text">基于 Gateway 统一认证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E-OAuth2-OpenID-Connect%EF%BC%88%E4%BC%81%E4%B8%9A%E7%BA%A7%E6%A0%87%E5%87%86%EF%BC%89"><span class="nav-text">基于 OAuth2 / OpenID Connect（企业级标准）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E-CAS-LDAP%EF%BC%88%E4%BC%A0%E7%BB%9F%E4%BC%81%E4%B8%9A%E6%96%B9%E6%A1%88%EF%BC%89"><span class="nav-text">基于 CAS / LDAP（传统企业方案）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Token-%E7%9A%84%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F"><span class="nav-text">Token 的存储方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Access-Token"><span class="nav-text">Access Token</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Refresh-Token"><span class="nav-text">Refresh Token</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">794</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">56</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/5e91a2fd.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="微服务单点登录的实现方案 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍微服务单点登录的多种实现方案。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 微服务单点登录的实现方案</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-07-15 23:12:42" itemprop="dateCreated datePublished" datetime="2019-07-15T23:12:42+08:00">2019-07-15</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-10-13 21:30:00" itemprop="dateModified" datetime="2025-10-13T21:30:00+08:00">2025-10-13</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/5e91a2fd.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/5e91a2fd.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>6.7k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>6 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="会话的基础概念"><a href="#会话的基础概念" class="headerlink" title="会话的基础概念"></a>会话的基础概念</h2><h3 id="HTTP-无状态协议"><a href="#HTTP-无状态协议" class="headerlink" title="HTTP 无状态协议"></a>HTTP 无状态协议</h3><p>Web 应用采用 Browser/Server 架构，HTTP 作为通信协议。HTTP 是无状态协议，浏览器的每一次请求，服务器会独立处理，不与之前或之后的请求产生关联，这个过程用下图说明，三次请求 / 响应对之间没有任何联系。</p><span id="more"></span><p><img data-src="../../../asset/2025/12/sso-1.png"></p><p>但这也同时意味着，任何用户都能通过浏览器访问服务器资源。如果想保护服务器的某些资源，必须限制浏览器请求；要限制浏览器请求，必须鉴别浏览器请求，响应合法请求，忽略非法请求；要鉴别浏览器请求，必须清楚浏览器请求状态。既然 HTTP 协议无状态，那就让服务器和浏览器共同维护一个状态吧！这就是会话机制。</p><h3 id="会话机制的概述"><a href="#会话机制的概述" class="headerlink" title="会话机制的概述"></a>会话机制的概述</h3><p>浏览器第一次请求服务器时，服务器会创建一个会话（Session），并将会话的 ID 作为响应的一部分发送给浏览器。浏览器接收到会话 ID 后，将其存储起来（通常存储在 Cookie 中），并在后续的第二次、第三次等请求中自动带上这个会话 ID。服务器从请求中取得会话 ID，就能识别出这些请求是否来自同一个用户。这样一来，尽管 HTTP 本身是无状态的，但通过会话 ID，服务器就能将后续请求与第一次请求关联起来，从而实现对用户状态的跟踪。</p><p><img data-src="../../../asset/2025/12/sso-2.png"></p><p>服务器在内存中保存会话的两种方式：</p><ul><li>请求参数</li><li> Cookie</li></ul><p>将会话 ID 作为每一个请求的参数，服务器接收请求自然能解析参数获得会话 ID ，并借此判断是否来自同一会话，很明显，这种方式不靠谱。那就浏览器自己来维护这个会话 ID 吧 ，每次发送 HTTP 请求时浏览器自动发送会话 ID ，Cookie 机制正好用来做这件事。Cookie 是浏览器用来存储少量数据的一种机制，数据以 key /value 形式存储，浏览器发送 HTTP 请求时自动携带 Cookie 信息。Tomcat 会话机制当然也实现了 Cookie，访问 Tomcat 服务器时，浏览器中可以看到一个名为 <code>JSESSIONID</code> 的 Cookie，这就是 Tomcat 会话机制维护的会话 ID ，Cookie 的请求响应过程如下图。</p><p><img data-src="../../../asset/2025/12/sso-3.png"></p><h3 id="登录状态的概述"><a href="#登录状态的概述" class="headerlink" title="登录状态的概述"></a>登录状态的概述</h3><p>有了会话机制，登录状态就好明白了，我们假设浏览器第一次请求服务器需要输入用户名与密码验证身份，服务器拿到用户名密码去数据库比对，正确的话说明当前持有这个会话的用户是合法用户，应该将这个会话标记为 “已授权” 或者 “已登录” 等等之类的状态，既然是会话的状态，自然要保存在会话对象中，Tomcat 在会话对象中设置登录状态如下：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HttpSession session = request.getSession();</span><br><span class="line">session.setAttribute(<span class="string">"isLogin"</span>, <span class="keyword">true</span>);</span><br></pre></td></tr></tbody></table></figure><p>用户再次访问时，Tomcat 在会话对象中查看登录状态</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HttpSession session = request.getSession();</span><br><span class="line">session.getAttribute(<span class="string">"isLogin"</span>);</span><br></pre></td></tr></tbody></table></figure><p>实现了登录状态的浏览器请求服务器模型如下图所示：</p><p><img data-src="../../../asset/2025/12/sso-4.png"></p><p>每次请求受保护资源时，服务器都会检查会话对象中的登录状态，只有 <code>isLogin=true</code> 的会话才能访问，登录机制因此而实现。</p><h3 id="多系统登录的复杂性"><a href="#多系统登录的复杂性" class="headerlink" title="多系统登录的复杂性"></a>多系统登录的复杂性</h3><p>系统早已从久远的单系统发展成为如今由多系统组成的应用群，面对如此众多的系统，用户难道要一个一个登录、然后一个一个注销吗？就像下图描述的这样：</p><p><img data-src="../../../asset/2025/12/sso-5.png"></p><p>Web 系统由单系统发展成多系统组成的应用群，复杂性应该由系统内部承担，而不是用户。无论 Web 系统内部多么复杂，对用户而言，都是一个统一的整体；也就是说，用户访问 Web 系统的整个应用群与访问单个系统一样，登录 / 注销只要一次就够了。</p><p><img data-src="../../../asset/2025/12/sso-6.png"></p><p>虽然单系统的登录解决方案很完美，但对于多系统应用群已经不再适用了，为什么呢？回顾一下 Cookie，通常 Cookie 用来在浏览器与服务器之间维护会话状态。但 Cookie 是有限制的，这个限制就是 Cookie 的域（通常对应网站的域名），浏览器发送 HTTP 请求时会自动携带与该域名匹配的 Cookie ，而不是自动携带所有 Cookie。</p><p><img data-src="../../../asset/2025/12/sso-7.png"></p><p>既然这样，为什么不将 Web 应用群中所有子系统的域名统一在一个顶级域名下，例如 <code>baidu.com</code>，然后将它们的 Cookie 域（Domain）设置为 <code>*.baidu.com</code>，这种做法理论上是可以的，甚至早期很多多系统登录就采用这种同域名共享 Cookie 方式。然而，可行不代表好，基于 Cookie 的登录态共享方案存在众多局限，比如：</p><ul><li><p>（1）应用群的域名需要统一</p><ul><li>核心原因：浏览器的 Cookie 受 Domain / Path 等属性限制，天然存在跨域问题。</li><li>解决方案：<ul><li>通过统一主域名（如 <code>*.baidu.com</code>）来共享 Cookie；</li><li>或在入口层使用 Nginx / API 网关 做统一接入，避免前端直接跨域访问。</li></ul></li></ul></li><li><p>（2）应用群各系统的会话机制需要统一</p><ul><li>问题说明：<ul><li>不同 Web 技术栈默认使用的 Session Cookie 名称和机制不同（例如：Tomcat 使用 <code>JSESSIONID</code>）；</li><li>因此，直接共享 Web 容器 Session Cookie 的方式无法支持跨语言、跨平台系统（如 Java、PHP、Python）之间的登录态共享。</li></ul></li><li>解决方案：<ul><li>不再依赖 Web 容器自身的 Session 机制；</li><li>统一使用自定义的 Cookie Key（如 UUID）；</li><li>将 <code>UUID → Token / 用户登录态信息</code> 存储到 Redis 等集中式存储中；</li><li>应用群内各系统通过该 UUID 从 Redis 中获取真实的认证信息，从而实现统一登录态。</li></ul></li></ul></li><li><p>（3）Cookie 本身存在安全风险</p><ul><li>问题说明：<ul><li>Cookie 会被浏览器自动携带，容易受到 CSRF（跨站请求伪造）攻击。</li></ul></li><li>解决方案：<ul><li>Cookie 中只存储无敏感意义的标识信息（如 UUID）；</li><li>真实的认证信息和权限数据仅保存在服务端（如 Redis）；</li><li>配合 <code>HttpOnly</code>、<code>Secure</code>、<code>SameSite</code> 等属性提升整体安全性。</li></ul></li></ul></li></ul><p>因此，我们需要一种全新的登录方式来实现多系统应用群的登录，这就是单点登录（SSO）。</p><div class="admonition note"><p class="admonition-title">总结</p><p>基于 Cookie 的登录态共享方案，需要统一域名、统一会话标识机制，并避免在 Cookie 中存储敏感信息，通常通过「Cookie + Redis」的方式实现跨语言系统的单点登录。</p></div><h2 id="单点登录的基础概念"><a href="#单点登录的基础概念" class="headerlink" title="单点登录的基础概念"></a>单点登录的基础概念</h2><h3 id="单点登录的概述"><a href="#单点登录的概述" class="headerlink" title="单点登录的概述"></a>单点登录的概述</h3><p>单点登录（Single Sign-On，SSO）是一种身份认证机制，指用户只需登录一次，就可以在多个相互关联的系统或应用中无需重复登录即可访问受保护资源，包括单点登录和单点注销两部分。简而言之：<strong>单点登录就是通过统一认证中心，让用户在多个系统之间实现 “一次登录，全站通行”。</strong></p><ul><li><p>单点登录的核心思想</p><ul><li>SSO 的核心在于统一身份认证：<ul><li>用户的账号和密码只在统一认证中心校验一次</li><li>登录成功后，由认证中心颁发登录凭证（如 Token / Cookie）</li></ul></li><li>其他系统通过校验该凭证来确认用户身份，而不再要求用户再次登录</li></ul></li><li><p>单点登录的优点</p><ul><li>提升用户体验，避免频繁输入账号密码</li><li>减少密码暴露次数，提高安全性</li><li>统一账号管理，降低系统维护成本</li></ul></li><li><p>单点登录的典型应用场景</p><ul><li>企业内部系统（OA、CRM、ERP 共用一套账号）</li><li>互联网平台（登录一次即可访问多个子系统）</li><li>微服务架构中的多业务系统</li></ul></li></ul><h3 id="单点登录的工作原理"><a href="#单点登录的工作原理" class="headerlink" title="单点登录的工作原理"></a>单点登录的工作原理</h3><p>相比于单系统登录，单点登录（SSO）需要一个独立的认证中心，只有认证中心能接受用户的用户名密码等安全信息，其他系统不提供登录入口，只接受认证中心的间接授权。间接授权通过令牌实现，认证中心验证用户的用户名密码没问题后，会创建授权令牌，在接下来的请求跳转过程中，授权令牌作为参数携带给各个子系统，子系统拿到授权令牌，即得到了授权，可以借此创建局部会话，局部会话的登录方式与单系统的登录方式相同，即基于 Web 容器（比如 Tomcat）的 Session 来存储用户的登录信息或者 Token。这个过程，也就是单点登录的工作原理，用下图说明：</p><p><img data-src="../../../asset/2025/12/sso-8.png"></p><p>下面对上图简要描述：</p><ul><li>用户访问系统 1 的受保护资源，系统发现用户未登录，跳转至 SSO 中心，并将自己的地址作为参数</li><li> SSO 认证中心发现用户未登录，将用户引导至登录页面</li><li>用户输入用户名密码提交登录申请</li><li> SSO 认证中心校验用户信息，创建用户与 SSO 认证中心之间的会话，称为全局会话，同时创建授权令牌</li><li> SSO 认证中心带着令牌跳转回最初的请求地址（系统 1）</li><li>系统 1 拿到令牌后，去 SSO 认证中心校验令牌是否有效</li><li> SSO 认证中心校验令牌，返回令牌有效，注册系统 1</li><li> 系统 1 使用该令牌创建与用户的会话，称为局部会话，返回受保护资源</li><li>用户访问系统 2 的受保护资源</li><li>系统 2 发现用户未登录，跳转至 SSO 认证中心，并将自己的地址作为参数</li><li> SSO 认证中心发现用户已登录，跳转到系统 2 的地址，并附上令牌</li><li>系统 2 拿到令牌后，去 SSO 认证中心校验令牌是否有效</li><li> SSO 认证中心校验令牌，返回有效，注册系统 2</li><li> 系统 2 使用该令牌创建与用户的局部会话，返回受保护资源</li></ul><p>用户登录成功之后，会与 SSO 认证中心及各个子系统建立会话，用户与 SSO 认证中心建立的会话称为全局会话，用户与各个子系统建立的会话称为局部会话。局部会话建立之后，用户访问子系统受保护资源将不再通过 SSO 认证中心，全局会话与局部会话有如下约束关系：</p><ul><li>局部会话存在，全局会话一定存在</li><li>全局会话存在，局部会话不一定存在</li><li>全局会话销毁，局部会话必须销毁</li></ul><div class="admonition warning"><p class="admonition-title">全局会话与局部会话的说明</p><ul><li>全局会话通常使用 Redis 集中式缓存来存储用户的登录信息或者 Token。</li><li>局部会话通常使用 Web 容器（比如 Tomcat）的 Session 来存储用户的登录信息或者 Token。</li></ul></div><h3 id="单点注销的工作原理"><a href="#单点注销的工作原理" class="headerlink" title="单点注销的工作原理"></a>单点注销的工作原理</h3><p>单点注销是指在一个子系统中注销，所有子系统的会话都将被注销，用下面的图来说明。</p><p><img data-src="../../../asset/2025/12/sso-9.png"></p><p>SSO 认证中心一直监听全局会话的状态，一旦全局会话销毁，监听器将通知所有注册系统执行注销操作</p><ul><li>用户向系统 1 发起注销请求</li><li>系统根据用户与系统 1 建立的会话 ID 拿到令牌，向 SSO 认证中心发起注销请求</li><li> SSO 认证中心校验令牌有效，销毁全局会话，同时取出所有用此令牌注册的系统地址</li><li> SSO 认证中心向所有注册系统发起注销请求</li><li>各注册系统接收 SSO 认证中心的注销请求，销毁局部会话</li><li> SSO 认证中心引导用户至登录页面</li></ul><h3 id="单点登录的部署架构"><a href="#单点登录的部署架构" class="headerlink" title="单点登录的部署架构"></a>单点登录的部署架构</h3><p>单点登录涉及 SSO 认证中心与多个子系统，子系统与 SSO 认证中心需要通信以交换令牌、校验令牌及发起注销请求，因而子系统必须集成 SSO 的客户端；SSO 认证中心则是 SSO 服务端，整个单点登录过程实质是 SSO 客户端与 SSO 服务端通信的过程，用下图描述：</p><p><img data-src="../../../asset/2025/12/sso-10.png"></p><ul><li><p>SSO Client（客户端）</p><ul><li>拦截子系统未登录用户请求，跳转至 SSO 认证中心</li><li>接收并存储 SSO 认证中心发送的令牌</li><li>与 SSO Server 通信，校验令牌的有效性</li><li>建立用户与子系统的局部会话</li><li>拦截用户注销请求，向 SSO 认证中心发送注销请求</li><li>接收 SSO 认证中心发出的注销请求，销毁局部会话</li></ul></li><li><p> SSO Server（服务端）</p><ul><li>验证用户的登录信息</li><li>创建全局会话</li><li>创建授权令牌</li><li>与 SSO Client 通信发送令牌</li><li>校验 SSO Client 令牌有效性</li><li>子系统注册</li><li>接收 SSO Client 注销请求，注销所有会话</li></ul></li></ul><p>SSO 服务端与 SSO 客户端通信方式有多种，包括 HttpClient、WebService、RPC、RESTful API 等。</p><h2 id="单点登录的实现方案"><a href="#单点登录的实现方案" class="headerlink" title="单点登录的实现方案"></a>单点登录的实现方案</h2><p>在 Spring Cloud 微服务架构中，实现单点登录（SSO）常见有以下几种方案。</p><h3 id="基于-Session-统一认证中心"><a href="#基于-Session-统一认证中心" class="headerlink" title="基于 Session + 统一认证中心"></a>基于 Session + 统一认证中心</h3><ul><li><p>思路：</p><ul><li>独立一个认证中心（Auth Server）</li><li>用户登录后，Session 信息存储在 Redis 等集中式缓存</li><li>各微服务共享 Session 信息</li></ul></li><li><p>优点：</p><ul><li>实现简单，适合传统项目</li><li>改造成本低</li></ul></li><li><p>缺点：</p><ul><li>强依赖 Session，不够 “微服务化”</li><li> 扩展性和跨端能力较弱</li></ul></li><li><p>适用场景：</p><ul><li>内部系统、流量不大、历史系统改造</li></ul></li></ul><h3 id="基于-JWT（主流方案）"><a href="#基于-JWT（主流方案）" class="headerlink" title="基于 JWT（主流方案）"></a>基于 JWT（主流方案）</h3><ul><li><p>思路：</p><ul><li>登录成功后由认证服务（Auth Server）签发 JWT</li><li> 客户端将 JWT 存储在本地持久化存储中（如浏览器的 LocalStorage 或者 IndexedDB）</li><li>客户端每次请求在 HTTP Header 中携带 JWT</li><li> 网关或微服务对 JWT 进行校验</li></ul></li><li><p>优点：</p><ul><li>无状态，天然支持分布式</li><li>性能好，扩展性强</li><li>适合前后端分离、移动端</li></ul></li><li><p>缺点：</p><ul><li>Token 失效控制较复杂（需要使用短期 Access Token + Refresh Token，或在 Redis 中维护 Token 黑名单）</li></ul></li><li><p>适用场景：</p><ul><li>Spring Cloud + Gateway 的主流方案</li></ul></li></ul><h3 id="基于-Gateway-统一认证"><a href="#基于-Gateway-统一认证" class="headerlink" title="基于 Gateway 统一认证"></a>基于 Gateway 统一认证</h3><ul><li><p>思路：</p><ul><li>使用 Auth Server 作为统一认证中心</li><li>登录成功后签发 JWT / OAuth2 Token</li><li> 所有请求先经过 Gateway</li><li> 在网关层完成 Token 校验和权限控制</li><li>微服务只处理业务逻辑</li></ul></li><li><p>优点：</p><ul><li>认证和授权逻辑集中，职责清晰</li><li>微服务完全解耦，无状态</li><li>易扩展，支持第三方登录</li></ul></li><li><p>缺点：</p><ul><li>网关成为流量入口，压力较大</li><li>需要配合限流、熔断、缓存等机制</li></ul></li><li><p>适用场景：</p><ul><li>微服务数量多</li><li>前后端分离</li><li>对安全性和扩展性要求较高的系统</li></ul></li></ul><h3 id="基于-OAuth2-OpenID-Connect（企业级标准）"><a href="#基于-OAuth2-OpenID-Connect（企业级标准）" class="headerlink" title="基于 OAuth2 / OpenID Connect（企业级标准）"></a>基于 OAuth2 / OpenID Connect（企业级标准）</h3><ul><li><p>思路：</p><ul><li>使用 OAuth2 作为授权框架</li><li> OpenID Connect 提供身份认证</li><li>可结合 Spring Authorization Server / Keycloak</li></ul></li><li><p> 优点：</p><ul><li>标准化、扩展性强</li><li>支持第三方登录（微信、钉钉、GitHub）</li><li>安全性高</li></ul></li><li><p>缺点：</p><ul><li>实现复杂，学习成本高</li></ul></li><li><p>适用场景：</p><ul><li>中大型系统</li><li>需要对接第三方身份体系</li></ul></li></ul><h3 id="基于-CAS-LDAP（传统企业方案）"><a href="#基于-CAS-LDAP（传统企业方案）" class="headerlink" title="基于 CAS / LDAP（传统企业方案）"></a>基于 CAS / LDAP（传统企业方案）</h3><ul><li><p>思路：</p><ul><li>使用 CAS 或 LDAP 统一身份认证</li><li> Spring Cloud 作为业务系统接入</li></ul></li><li><p>优点：</p><ul><li>成熟稳定</li><li>适合企业内部账号体系</li></ul></li><li><p>缺点：</p><ul><li>与微服务结合较重</li><li>灵活性一般</li></ul></li><li><p>适用场景：</p><ul><li>政企、银行、事业单位</li></ul></li></ul><h2 id="Token-的存储方式"><a href="#Token-的存储方式" class="headerlink" title="Token 的存储方式"></a>Token 的存储方式</h2><p>在单点登录（SSO）体系中，通常会使用两类 Token，包括 Access Token 和 Refresh Token，两者在用途、生命周期和安全级别上存在本质区别。</p><table><thead><tr><th>对比项</th><th> Access Token</th><th>Refresh Token</th></tr></thead><tbody><tr><td> 有效期</td><td>短（分钟级）</td><td>长（天 / 周）</td></tr><tr><td>使用频率</td><td>高频</td><td>低频</td></tr><tr><td>安全级别</td><td>较低</td><td>极高</td></tr><tr><td>一旦泄露</td><td>影响有限</td><td>风险极大</td></tr><tr><td>使用场景</td><td>访问受保护资源</td><td>换取新的 Access Token</td></tr></tbody></table><div class="admonition note"><p class="admonition-title">总结</p><ul><li>Access Token：用于访问受保护的资源，生命周期较短，随每次请求携带，一旦泄露影响相对可控。</li><li>Refresh Token：用于在 Access Token 过期后换取新的 Access Token，生命周期较长，不直接访问业务资源，安全级别要求更高。</li></ul></div><h3 id="Access-Token"><a href="#Access-Token" class="headerlink" title="Access Token"></a>Access Token</h3><p>Access Token 建议存储在浏览器的 LocalStorage 和 IndexedDB。</p><ul><li><p>(1) 存储在浏览器的 LocalStorage</p><ul><li>特点：<ul><li>API 使用简单</li><li>浏览器关闭、重启都不会丢</li><li>前后端分离项目中使用最广泛</li></ul></li><li>优点：<ul><li>实现简单</li><li>性能较好</li><li>支持所有主流浏览器</li></ul></li><li>缺点：<ul><li>容易被 XSS（跨站脚本攻击）读取</li></ul></li><li>适用场景：<ul><li>企业内部系统</li><li>风险可控的 B 端项目</li></ul></li></ul></li><li><p> (2) 存储在浏览器的 IndexedDB</p><ul><li>特点：<ul><li>浏览器原生数据库</li><li>浏览器关闭、重启都不会丢</li><li>不容易被简单 XSS（跨站脚本攻击）直接读取</li></ul></li><li>优点：<ul><li>安全性高</li><li>适合存敏感数据</li></ul></li><li>缺点：<ul><li>API 复杂</li><li>使用成本高</li></ul></li><li>适用场景：<ul><li>金融、政企</li><li>对安全要求极高的系统</li></ul></li></ul></li></ul><div class="admonition note"><p class="admonition-title">提示</p><ul><li>用户登录成功后由认证服务签发 JWT，客户端将 JWT 存储在本地（如浏览器的 LocalStorage 或 IndexedDB），后续请求通过 HTTP Header 携带 JWT，网关或微服务对 Token 进行校验。</li><li>由于 JWT 存储在浏览器的 LocalStorage 是不安全的，因此实际项目中通常使用短期 Access Token + Refresh Token，并结合 CSP、防 XSS（跨站脚本攻击）手段。</li></ul></div><h3 id="Refresh-Token"><a href="#Refresh-Token" class="headerlink" title="Refresh Token"></a>Refresh Token</h3><p>Refresh Token 建议存储在浏览器的 Cookie（HttpOnly）。</p><ul><li>存储在 Cookie（HttpOnly）<ul><li>关键点：<ul><li>Cookie 必须设置 <code>Expires</code> 或 <code>Max-Age</code> 属性</li><li>否则默认是会话 Cookie，浏览器关闭即失效</li></ul></li><li>优点：<ul><li>天然支持持久化</li><li>可设置 <code>HttpOnly</code> 属性防止 JavaScript 读取</li></ul></li><li>缺点：<ul><li>跨域配置复杂</li><li>存在 CSRF（跨站请求伪造）攻击风险</li><li>不符合微服务 Header 标准用法</li></ul></li><li>适用场景：<ul><li>传统 Web 系统</li><li> Refresh Token 存储（常见）</li></ul></li></ul></li></ul><div class="admonition note"><p class="admonition-title">Cookie（HttpOnly）会不会由浏览器自动携带给服务端？</p><ul><li>Cookie（HttpOnly）在客户端发送请求时会由浏览器自动携带给服务端。</li><li>Cookie 的 HttpOnly 属性只是禁止 JavaScript 访问 Cookie，不影响浏览器在满足 Domain、Path、SameSite 等条件下自动携带给服务端。</li></ul></div><div class="admonition note"><p class="admonition-title">为什么 Refresh Token 更适合存储在 Cookie（HttpOnly）？</p><ul><li>Refresh Token 的有效期较长，一旦泄露风险极高，因此不适合存放在浏览器的 LocalStorage 和 IndexedDB 等可被 JavaScript 读取的位置。</li><li>使用 Cookie（HttpOnly ）可以防止 XSS（跨站脚本攻击）窃取 Refresh Token，同时浏览器又能自动携带 Refresh Token，用于刷新 Access Token，是安全性和可用性的最佳平衡。</li></ul></div><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="/posts/2cb9090c.html">Gateway + Security + OAuth 2.0 + JWT 实现统一的认证授权</a></li><li><a target="_blank" rel="external nofollow" href="https://developer.aliyun.com/article/1645954">使用 Spring Cloud Gateway 集成 Sa-Token 实现微服务单点登录</a></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/5e91a2fd.html" title="微服务单点登录的实现方案">https://www.techgrow.cn/posts/5e91a2fd.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag"><i class="fa fa-tag"></i> 微服务</a><a href="/tags/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/" rel="tag"><i class="fa fa-tag"></i> 架构设计</a><a href="/tags/OAuth/" rel="tag"><i class="fa fa-tag"></i> OAuth</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/e3b4a6cc.html" rel="prev" title="Quartz 开发随笔"><i class="fa fa-angle-left"></i> Quartz 开发随笔</a></div><div class="post-nav-item"> <a href="/posts/fe4ed47c.html" rel="next" title="Linux 安装 NodeJS">Linux 安装 NodeJS<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2026</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2.3m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">35:24</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/5e91a2fd.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div><div id="moon-menu-item-code" class="moon-menu-item"><i class="fa-solid fa-code"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>