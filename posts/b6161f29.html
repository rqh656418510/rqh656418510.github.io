<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 CMake 的基础使用教程，包括第一个 CMake 项目和常见的编译选项介绍。"><meta property="og:type" content="article"><meta property="og:title" content="CMake 入门教程之一"><meta property="og:url" content="https://www.techgrow.cn/posts/b6161f29.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 CMake 的基础使用教程，包括第一个 CMake 项目和常见的编译选项介绍。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/10/cmake-1.png"><meta property="article:published_time" content="2023-11-09T14:25:49.000Z"><meta property="article:modified_time" content="2023-11-09T14:25:49.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="Linux系统编程"><meta property="article:tag" content="C语言"><meta property="article:tag" content="C++"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2024/10/cmake-1.png"><link rel="canonical" href="https://www.techgrow.cn/posts/b6161f29.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/b6161f29.html","path":"posts/b6161f29.html","title":"CMake 入门教程之一"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>CMake 入门教程之一 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E6%B5%81%E7%9A%84%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7"><span class="nav-text">主流的构建工具</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CMake-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-text">CMake 基本概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-CMake"><span class="nav-text">什么是 CMake</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%AD%A6%E4%B9%A0-CMake"><span class="nav-text">为什么要学习 CMake</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E9%80%89%E7%94%A8-CMake"><span class="nav-text">为什么要选用 CMake</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CMake-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-text">CMake 的工作原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E7%AC%AC%E4%B8%80%E4%B8%AA-CMake-%E9%A1%B9%E7%9B%AE"><span class="nav-text">编译第一个 CMake 项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E7%9A%84-C-C-%E7%BC%96%E8%AF%91%E5%99%A8"><span class="nav-text">使用指定的 C/C++ 编译器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E4%B8%80"><span class="nav-text">解决方案一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E4%BA%8C"><span class="nav-text">解决方案二</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-NMake-%E6%9E%84%E5%BB%BA%E5%B9%B6%E7%BC%96%E8%AF%91"><span class="nav-text">使用 NMake 构建并编译</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%B8%B8%E8%A7%81%E7%9A%84%E7%BC%96%E8%AF%91%E9%80%89%E9%A1%B9"><span class="nav-text">使用常见的编译选项</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">720</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/b6161f29.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="CMake 入门教程之一 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 CMake 的基础使用教程，包括第一个 CMake 项目和常见的编译选项介绍。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> CMake 入门教程之一</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-11-09 22:25:49" itemprop="dateCreated datePublished" datetime="2023-11-09T22:25:49+08:00">2023-11-09</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/b6161f29.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/b6161f29.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>3.2k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>3 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/b6161f29.html">CMake 入门教程之一</a></li><li><a href="/posts/c3cap78f.html">CMake 入门教程之二</a></li><li><a href="/posts/881a3bba.html">CMake 入门教程之三</a></li><li><a href="/posts/cfcab78c.html">CMake 入门教程之四</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文将介绍 CMake 是什么，并使用 CMake 编译第一个 C/C++ 项目。</p><h3 id="主流的构建工具"><a href="#主流的构建工具" class="headerlink" title="主流的构建工具"></a>主流的构建工具</h3><table><thead><tr><th>构建工具</th><th>主要用途</th><th>适用平台</th><th>特点</th><th>常见使用场景</th></tr></thead><tbody><tr><td> Make</td><td> 经典构建系统</td><td> Unix/Linux/macOS，Windows（MinGW / Cygwin）</td><td>GNU 工具链标配，依赖 <code>Makefile</code></td><td>Linux 系统编译、跨平台项目</td></tr><tr><td> CMake</td><td> 跨平台构建配置生成器</td><td>跨平台</td><td>不直接编译，生成 Makefile / Ninja / VS 工程</td><td>跨平台 C/C++ 项目管理</td></tr><tr><td> Ninja</td><td> 高性能并行构建</td><td>跨平台</td><td>构建速度快，文件依赖解析简单</td><td> CMake、Chromium、LLVM 等大型项目</td></tr><tr><td> NMake</td><td> 命令行 Make 工具（微软版）</td><td>Windows</td><td> 随 MSVC 提供，适合命令行构建简单项目</td><td> MSVC 环境下的轻量构建</td></tr><tr><td> MSBuild</td><td> 编译和管理 Visual Studio 项目（<code>.sln</code>/<code>.vcxproj</code>）</td><td>Windows</td><td> 与 VS 深度集成，支持 MSVC 编译器</td><td> Visual Studio 传统项目构建</td></tr><tr><td> Meson</td><td> 现代化构建系统</td><td>跨平台</td><td>默认用 Ninja 构建，语法简单</td><td> GNOME、GStreamer 等项目</td></tr><tr><td> Bazel</td><td>Google 出品构建系统</td><td>跨平台</td><td>支持大型代码库、分布式构建</td><td> TensorFlow、Google 内部项目</td></tr><tr><td> SCons</td><td> 基于 Python 实现的构建系统</td><td>跨平台</td><td>配置用 Python 脚本编写，依赖少</td><td>嵌入式或定制化构建流程</td></tr></tbody></table><h2 id="CMake-基本概念"><a href="#CMake-基本概念" class="headerlink" title="CMake 基本概念"></a>CMake 基本概念</h2><h3 id="什么是-CMake"><a href="#什么是-CMake" class="headerlink" title="什么是 CMake"></a>什么是 CMake</h3><p>CMake 是用于构建、测试和软件打包的开源跨平台工具。</p><h3 id="为什么要学习-CMake"><a href="#为什么要学习-CMake" class="headerlink" title="为什么要学习 CMake"></a>为什么要学习 CMake</h3><ul><li>企业项目：不管是构建 Linux 程序还是自动化构建 VS 程序，业内大量公司都在使用 CMake。</li><li>开源项目：QT、OpenCV、GoogleTest、KDE、OGRE、Android NDK、鸿蒙 ETS NDK 等知名开源项目都使用了 CMake。</li><li>职业发展：CMake 适用于跨平台自动化构建和部署、持续集成、测试驱动开发、自动化单元测试等场景。</li></ul><span id="more"></span><h3 id="为什么要选用-CMake"><a href="#为什么要选用-CMake" class="headerlink" title="为什么要选用 CMake"></a>为什么要选用 CMake</h3><ul><li><p>为什么需要一个好的构建系统</p><ul><li>想避免硬编码路径</li><li>需要在多台计算机上构建一个包</li><li>想使用 CI（持续集成）</li><li>需要支持不同的操作系统</li><li>想支持多个编译器</li><li>想使用 IDE，但不是所有情况</li><li>想描述程序的逻辑结构，而不是标志和命令</li><li>想使用库</li><li>想使用其他工具来帮助编写代码，比如 <code>ProtoBuf</code></li><li>想使用单元测试</li></ul></li><li><p>为什么需要持续集成</p><ul><li>每次集成都通过自动化的制造（包括提交、发布、自动化测试）来验证，准确地发现集成错误</li><li>快速错误，每完成一点更新，就集成到主干，可以快速发现错误，定位错误也比较容易</li><li>各种不同的更新主干，如果不经常集成，会导致集成的成本变大</li><li>让产品可以快速地通过，同时保持关键测试合格</li><li>自动化测试，只要有一个测试用例不通过就不能集成</li><li>集成并不能删除发现的错误，但可以让它们很容易被发现和改正</li></ul></li><li><p>为什么是 CMake</p><ul><li>CMake 的特性<ul><li>自动搜索可能需要的程序、库和头文件的能力</li><li>独立的构建目录，可以安全清理</li><li>支持创建复杂的自定义命令，例如 <code>qt moc uic</code></li><li>配置时选择可选组件的能力</li><li>从简单的文本文件（CMakeLists.txt）自动生成工作区和项目的能力</li><li>在静态和共享构建之间轻松切换的能力</li><li>在大多数平台上自动生成文件依赖项，并支持并行构建</li></ul></li><li>每个 IDE 都支持 CMake（ CMake 支持几乎所有 IDE）</li><li>使用 CMake 的软件包比任何其他系统都多</li></ul></li></ul><h3 id="CMake-的工作原理"><a href="#CMake-的工作原理" class="headerlink" title="CMake 的工作原理"></a>CMake 的工作原理</h3><p><img data-src="../../../asset/2024/10/cmake-1.png"></p><h2 id="编译第一个-CMake-项目"><a href="#编译第一个-CMake-项目" class="headerlink" title="编译第一个 CMake 项目"></a>编译第一个 CMake 项目</h2><ul><li>项目的目录结构</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">first_cmake</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">└── first_cmake.cpp</span><br></pre></td></tr></tbody></table></figure><ul><li><code>first_cmake.cpp</code> 源文件</li></ul><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv [])</span> </span>{</span><br><span class="line">    cout &lt;&lt; <span class="string">"First CMake Test"</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li><code>CMakeLists.txt</code> 配置文件</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 指定 CMake 版本</span><br><span class="line">cmake_minimum_required (VERSION 3.15)</span><br><span class="line"></span><br><span class="line"># 指定项目名称</span><br><span class="line">project (first_cmake)</span><br><span class="line"></span><br><span class="line"># 指定要编译的源文件</span><br><span class="line">add_executable (first_cmake first_cmake.cpp)</span><br></pre></td></tr></tbody></table></figure><ul><li>执行 CMake 编译</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置项目，生成构建文件（例如 Makefile 或 Ninja 文件）</span></span><br><span class="line">cmake -S . -B build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译项目，生成可执行文件</span></span><br><span class="line">cmake --build build</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 参数说明</span><br><span class="line">    - `-S`：指定从哪里获取 `CMakeLists.txt` 配置文件，`.` 表示当前目录</span><br><span class="line">    - `-B`：指定生成的构建文件应该存放的目录（通常指定为 `build` 目录），默认会存放在当前目录下</span><br><span class="line">    - `--build`：指定从哪里获取构建文件进行编译，或者说是指定编译后的输出目录</span><br></pre></td></tr></tbody></table></figure><ul><li>上述两个 CMake 命令的功能可以分为几部分：<ul><li>调用生成的构建系统：<ul><li>如果之前生成的是 Makefile，它将调用 <code>make</code>。</li><li>如果生成的是 Ninja 构建系统，它将调用 <code>ninja</code>。</li></ul></li><li>编译项目：<ul><li>它将编译项目中的源代码，并生成可执行文件、库等目标。</li></ul></li><li>自动检测编译工具：<ul><li><code>cmake --build</code> 会根据生成的构建系统（Makefile、Ninja 等）来自动使用正确的工具进行构建，而不需要手动调用 <code>make</code> 或 <code>ninja</code>。</li></ul></li></ul></li></ul><div class="admonition note"><p class="admonition-title">提示</p><p>通过 <code>cmake --build build</code>，可以避免使用特定的生成器工具（例如 <code>make</code> 或 <code>ninja</code>），并保持跨平台的一致性。</p></div><h2 id="使用指定的-C-C-编译器"><a href="#使用指定的-C-C-编译器" class="headerlink" title="使用指定的 C/C++ 编译器"></a>使用指定的 C/C++ 编译器</h2><p>在使用 CMake 编译 C/C++ 项目时，CMake 会自动根据不同的操作系统类型来调用对应的 C/C++ 编译器，比如：</p><ul><li><code>Linux 操作系统</code>：使用 <code>gcc</code>、<code>g++</code>、<code>clang</code> 编译器。</li><li><code>Windows 操作系统</code>：使用 Microsoft Visual C++ 编译器（简称 MSVC），提供了 <code>cl.exe</code> 编译和 <code>link.exe</code> 链接等命令行工具。</li></ul><p>在 Windows 操作系统上，如果不是在 <code>Developer Command Prompt for Visual Studio</code> 开发者命令提示符窗口内执行生成构建文件的 CMake 命令，而是在 Git Bash 内执行命令，那么就会出现以下的错误信息：</p><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置项目，生成构建文件（例如 Makefile 或 Ninja 文件）</span></span><br><span class="line">cmake -S . -B build</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-- Building for: NMake Makefiles</span><br><span class="line">CMake Error at CMakeLists.txt:5 (project):</span><br><span class="line">  Running</span><br><span class="line"></span><br><span class="line">   'nmake' '-?'</span><br><span class="line"></span><br><span class="line">  failed with:</span><br><span class="line"></span><br><span class="line">   no such file or directory</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CMake Error: CMAKE_C_COMPILER not set, after EnableLanguage</span><br><span class="line">CMake Error: CMAKE_CXX_COMPILER not set, after EnableLanguage</span><br><span class="line">-- Configuring incomplete, errors occurred!</span><br></pre></td></tr></tbody></table></figure><p>这通常是因为在 Git Bash 内运行 CMake 时，CMake 找不到 <code>nmake</code> 工具，比如 <code>nmake</code> 工具不可用或没有正确安装。解决该问题的方法是，在 Git Bash 中让 CMake 使用特定的 C/C++ 编译器。</p><div class="admonition note"><p class="admonition-title">什么是 nmake</p><p><code>nmake</code> 是 Microsoft 的一个构建工具，其作用类似 <code>make</code>，它通常与 Visual Studio 一起安装，尤其在使用 Microsoft Visual C++ 编译器（简称 MSVC）时，CMake 可能需要它来生成配置文件。</p></div><h3 id="解决方案一"><a href="#解决方案一" class="headerlink" title="解决方案一"></a>解决方案一</h3><p>在 Windows 系统上 <a href="/posts/60b40ee7.html">安装 MinGW</a>，然后在 Git Bash 中让 CMake 使用 MinGW 自带的 <code>gcc</code> 和 <code>g++</code> 编译器。</p><ul><li>首先删除之前生成的 <code>build</code> 目录</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除构建目录</span></span><br><span class="line">rm -rf build</span><br></pre></td></tr></tbody></table></figure><ul><li>在 Git Bash 中，要让 CMake 使用 MinGW 提供的 <code>gcc</code> 和 <code>g++</code> 编译器，可以通过指定使用 MinGW Makefiles 配置生成器来完成</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置项目，生成构建文件（例如 Makefile 或 Ninja 文件）</span></span><br><span class="line">cmake -S . -B build -G <span class="string">"MinGW Makefiles"</span></span><br></pre></td></tr></tbody></table></figure><ul><li>一旦配置完成，就可以使用以下命令编译 C/C++ 项目，相当于执行了 <code>mingw32-make -C build</code> 命令</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译项目，生成可执行文件</span></span><br><span class="line">cmake --build build</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 参数说明</span><br><span class="line">    - `-S`：指定从哪里获取 `CMakeLists.txt` 配置文件，`.` 表示当前目录</span><br><span class="line">    - `-B`：指定生成的构建文件应该存放的目录（通常指定为 `build` 目录），默认会存放在当前目录下。</span><br><span class="line">    - `-G`：指定 CMake 使用哪个配置生成器，比如使用 MinGW Makefiles。</span><br></pre></td></tr></tbody></table></figure><h3 id="解决方案二"><a href="#解决方案二" class="headerlink" title="解决方案二"></a>解决方案二</h3><p>在 Windows 系统上 <a href="/posts/60b40ee7.html">安装 MinGW</a>，然后在 Git Bash 中让 CMake 使用 MinGW 自带的 <code>gcc</code> 和 <code>g++</code> 编译器。</p><ul><li>首先删除之前生成的 <code>build</code> 目录</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除构建目录</span></span><br><span class="line">rm -rf build</span><br></pre></td></tr></tbody></table></figure><ul><li>在 Git Bash 中，要让 CMake 使用 MinGW 提供的编译器，还可以在 <code>CMakeLists.txt</code> 配置文件中，显式指定 C/C++ 编译器</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置 MinGW 提供的 GCC 作为 C 编译器</span></span><br><span class="line"><span class="built_in">set</span> (CMAKE_C_COMPILER <span class="string">"C:/MinGW/bin/gcc.exe"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 MinGW 提供的 G++ 作为 C++ 编译器</span></span><br><span class="line"><span class="built_in">set</span> (CMAKE_CXX_COMPILER <span class="string">"C:/MinGW/bin/g++.exe"</span>)</span><br></pre></td></tr></tbody></table></figure><p>然后编译项目代码，必须确保上面设置的编译器路径和 MinGW 的安装路径一致</p><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置项目，生成构建文件（例如 Makefile 或 Ninja 文件）</span></span><br><span class="line">cmake -S . -B build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译项目，生成可执行文件</span></span><br><span class="line">cmake --build build</span><br></pre></td></tr></tbody></table></figure><p>成功编译代码后，最后会显示 <code>gcc</code> 和 <code>g++</code> 编译器都来自 MinGW，而不是 Visual Studio 的 <code>cl.exe</code>。</p><div class="admonition warning"><p class="admonition-title">特别注意</p><p>笔者使用该方案来让 CMake 使用特定的编译器，但最终没有成功，原因暂时未知。</p></div><h2 id="使用-NMake-构建并编译"><a href="#使用-NMake-构建并编译" class="headerlink" title="使用 NMake 构建并编译"></a>使用 NMake 构建并编译</h2><p>NMake 是 MSVC 自带的轻量命令行构建工具，在 Windows 环境下，若希望让 CMake 使用 NMake 构建并编译项目，可以在 <code>Developer Command Prompt for Visual Studio</code> 开发者命令提示符窗口内执行以下命令：</p><ul><li>让 CMake 使用 NMake Makefiles 配置生成器来生成构建文件</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置项目，生成构建文件（例如 Makefile 或 Ninja 文件）</span></span><br><span class="line">cmake<span class="params"> -S</span> .<span class="params"> -B</span> build<span class="params"> -G</span> <span class="string">"NMake Makefiles"</span></span><br></pre></td></tr></tbody></table></figure><ul><li>一旦配置完成，就可以使用以下命令编译 C/C++ 项目，相当于在 <code>build</code> 目录下执行 <code>nmake</code> 命令</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译项目，生成可执行文件</span></span><br><span class="line">cmake<span class="params"> --build</span> build</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 参数说明</span><br><span class="line">    - `-S`：指定从哪里获取 `CMakeLists.txt` 配置文件，`.` 表示当前目录。</span><br><span class="line">    - `-B`：指定生成的构建文件应该存放的目录（通常指定为 `build` 目录），默认会存放在当前目录下。</span><br><span class="line">    - `-G`：指定 CMake 使用哪个配置生成器，比如使用 NMake Makefiles。</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">提示</p><ul><li>若想知道当前版本的 CMake 支持哪些生成器（Generators），可以使用帮助命令 <code>cmake --help</code> 来查看详细的帮助手册。</li><li>CMake 常用的生成器有：NMake Makefiles、MinGW Makefiles、MSYS Makefiles、Ninja 等。</li></ul></div><h2 id="使用常见的编译选项"><a href="#使用常见的编译选项" class="headerlink" title="使用常见的编译选项"></a>使用常见的编译选项</h2><ul><li><strong><code>--target &lt;target&gt;</code></strong>: 指定要构建的特定目标（例如，生成特定的可执行文件或库）。如果不指定，它会构建所有默认目标。</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake<span class="params"> --build</span> build<span class="params"> --target</span> my_target</span><br></pre></td></tr></tbody></table></figure><ul><li><strong><code>--config &lt;configuration&gt;</code></strong>: 用于多配置生成器（例如 Visual Studio 或 Xcode），可以指定构建的配置类型，如 <code>Debug</code> 或 <code>Release</code>。</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake<span class="params"> --build</span> build<span class="params"> --config</span> Release</span><br></pre></td></tr></tbody></table></figure><ul><li><strong><code>--clean-first</code></strong>: 先清理项目再编译，相当于 <code>make clean &amp;&amp; make</code>。</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake<span class="params"> --build</span> build<span class="params"> --clean</span>-first</span><br></pre></td></tr></tbody></table></figure><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/b6161f29.html" title="CMake 入门教程之一">https://www.techgrow.cn/posts/b6161f29.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/" rel="tag"><i class="fa fa-tag"></i> Linux系统编程</a><a href="/tags/C%E8%AF%AD%E8%A8%80/" rel="tag"><i class="fa fa-tag"></i> C语言</a><a href="/tags/C/" rel="tag"><i class="fa fa-tag"></i> C++</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/a29573a6.html" rel="prev" title="Debian 12 更改最大文件描述符数"><i class="fa fa-angle-left"></i> Debian 12 更改最大文件描述符数</a></div><div class="post-nav-item"> <a href="/posts/6a0cde5a.html" rel="next" title="Debian 12 设置时区与同步时间">Debian 12 设置时区与同步时间<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">29:37</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/b6161f29.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>