<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要记录 SpringBoot 3 的基础教程，包括 MVC 自动配置、静态资源、错误处理、嵌入式容器、源码分析等内容。"><meta property="og:type" content="article"><meta property="og:title" content="SpringBoot3 基础教程之三 Web 开发"><meta property="og:url" content="https://www.techgrow.cn/posts/12fb0f17.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要记录 SpringBoot 3 的基础教程，包括 MVC 自动配置、静态资源、错误处理、嵌入式容器、源码分析等内容。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2023/06/spring-boot3-study-17.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2023/06/spring-boot3-study-18.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2023/06/spring-boot3-study-7.png"><meta property="article:published_time" content="2023-06-16T15:12:42.000Z"><meta property="article:modified_time" content="2023-07-22T15:12:42.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="微服务"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2023/06/spring-boot3-study-17.png"><link rel="canonical" href="https://www.techgrow.cn/posts/12fb0f17.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/12fb0f17.html","path":"posts/12fb0f17.html","title":"SpringBoot3 基础教程之三 Web 开发"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>SpringBoot3 基础教程之三 Web 开发 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">自动配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%9A%84%E5%8E%9F%E7%90%86"><span class="nav-text">自动配置的原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%9A%84%E9%BB%98%E8%AE%A4%E6%95%88%E6%9E%9C"><span class="nav-text">自动配置的默认效果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="nav-text">静态资源</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%A7%84%E5%88%99"><span class="nav-text">默认静态资源规则</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%98%A0%E5%B0%84"><span class="nav-text">静态资源映射</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E7%BC%93%E5%AD%98"><span class="nav-text">静态资源缓存</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Favicon-%E5%9B%BE%E6%A0%87"><span class="nav-text">Favicon 图标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AC%A2%E8%BF%8E%E9%A1%B5%E9%9D%A2"><span class="nav-text">欢迎页面</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%A7%84%E5%88%99"><span class="nav-text">自定义静态资源规则</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">配置方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E6%96%B9%E5%BC%8F"><span class="nav-text">代码方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-text">错误处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E6%9C%BA%E5%88%B6"><span class="nav-text">默认机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E5%93%8D%E5%BA%94"><span class="nav-text">自定义错误响应</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-text">错误处理的最佳实践</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%AE%B9%E5%99%A8"><span class="nav-text">嵌入式容器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="nav-text">自动配置原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%AE%B9%E5%99%A8"><span class="nav-text">自定义嵌入式容器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%95%E5%B1%82%E6%BA%90%E7%A0%81%E6%B5%85%E6%9E%90"><span class="nav-text">底层源码浅析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-MVC-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="nav-text">Web MVC 自动配置原理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%94%9F%E6%95%88%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="nav-text">自动配置生效的条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%95%88%E6%9E%9C"><span class="nav-text">自动配置实现的效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WebMvcConfigurer-%E6%8E%A5%E5%8F%A3"><span class="nav-text">WebMvcConfigurer 接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99%E7%9A%84%E6%BA%90%E7%A0%81"><span class="nav-text">静态资源映射规则的源码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EnableWebMvcConfiguration-%E7%9A%84%E6%BA%90%E7%A0%81"><span class="nav-text">EnableWebMvcConfiguration 的源码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%AE%9A%E4%B9%89-WebMvcConfigurer-%E5%B0%B1%E8%83%BD%E9%85%8D%E7%BD%AE%E5%BA%95%E5%B1%82%E8%A1%8C%E4%B8%BA"><span class="nav-text">为什么定义 WebMvcConfigurer 就能配置底层行为</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A8%E9%9D%A2%E6%8E%A5%E7%AE%A1-Spring-MVC"><span class="nav-text">全面接管 Spring MVC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WebMvcAutoConfiguration-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E4%BA%86%E5%93%AA%E4%BA%9B%E8%A7%84%E5%88%99"><span class="nav-text">WebMvcAutoConfiguration 自动配置了哪些规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EnableWebMvc-%E7%A6%81%E7%94%A8%E9%BB%98%E8%AE%A4%E8%A1%8C%E4%B8%BA"><span class="nav-text">@EnableWebMvc 禁用默认行为</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebMvcConfigurer-%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="nav-text">WebMvcConfigurer 的功能</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-text">最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E7%A7%8D%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">三种配置方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%A4%E7%A7%8D%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F"><span class="nav-text">两种开发模式</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">697</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/12fb0f17.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="SpringBoot3 基础教程之三 Web 开发 | Clay 的技术空间"><meta itemprop="description" content="本文主要记录 SpringBoot 3 的基础教程，包括 MVC 自动配置、静态资源、错误处理、嵌入式容器、源码分析等内容。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> SpringBoot3 基础教程之三 Web 开发</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-06-16 23:12:42" itemprop="dateCreated datePublished" datetime="2023-06-16T23:12:42+08:00">2023-06-16</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-07-22 23:12:42" itemprop="dateModified" datetime="2023-07-22T23:12:42+08:00">2023-07-22</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/12fb0f17.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/12fb0f17.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>9.8k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>9 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/79ae6590.html">SpringBoot3 基础教程之一快速入门</a></li><li><a href="/posts/e7a270a6.html">SpringBoot3 基础教程之二常规配置</a></li><li><a href="/posts/12fb0f17.html">SpringBoot3 基础教程之三 Web 开发</a></li><li><a href="/posts/223fd9f.html">SpringBoot3 基础教程之四 Web 开发</a></li><li><a href="/posts/6bcf09.html">SpringBoot3 基础教程之五基础特性</a></li><li><a href="/posts/b6463873.html">SpringBoot3 基础教程之六场景整合</a></li><li><a href="/posts/6b38f8f0.html">SpringBoot3 基础教程之七场景整合</a></li><li><a href="/posts/27928f6f.html">SpringBoot3 基础教程之八场景整合</a></li><li><a href="/posts/1dfe3056.html">SpringBoot3 基础教程之九核心原理</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本章节所需的案例代码，可以直接从 <a target="_blank" rel="external nofollow" href="https://github.com/rqh656418510/spring-cloud-share/tree/main/spring-boot/spring-boot-3-study">GitHub</a> 下载对应章节 <code>spring-boot3-04</code>。</p><h2 id="自动配置"><a href="#自动配置" class="headerlink" title="自动配置"></a>自动配置</h2><h3 id="自动配置的原理"><a href="#自动配置的原理" class="headerlink" title="自动配置的原理"></a>自动配置的原理</h3><ul><li>Web 场景的自动配置原理<ul><li> 1、导入 <code>spring-boot-starter-web</code>，会导入 <code>spring-boot-starter</code>，也就会导入 <code>spring-boot-autoconfigure</code> 包。</li><li>2、<code>spring-boot-autoconfigure</code> 包里面有一个文件 <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>，里面指定了应用启动时所有要加载的自动配置类。</li><li>3、<code>@EnableAutoConfiguration</code> 会自动地将上面文件里写的所有自动配置类都导入进来，同时 <code>xxxAutoConfiguration</code> 是有声明条件注解的，目的是按需加载。</li><li>4、<code>xxxAutoConfiguration</code> 往容器中导入一堆组件，这些组件都是从 <code>xxxProperties</code> 中获取属性值。</li><li>5、<code>xxxProperties</code> 又是和配置文件进行了绑定。</li></ul></li></ul><span id="more"></span><ul><li>Web 场景的所有自动配置类</li></ul><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration</span></span><br><span class="line"></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.HttpHandlerAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.ReactiveMultipartAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.ReactiveWebServerFactoryAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.WebFluxAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.WebSessionIdResolverAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.error.ErrorWebFluxAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.function.client.ClientHttpConnectorAutoConfiguration</span></span><br><span class="line"><span class="attr">org.springframework.boot.autoconfigure.web.reactive.function.client.WebClientAutoConfiguration</span></span><br></pre></td></tr></tbody></table></figure><ul><li>Web 场景下配置文件的前缀配置项说明<ul><li> 1、服务器的配置 <code>server</code></li><li>2、Web 场景通用配置 <code>spring.web</code></li><li>3、Spring MVC 的所有配置 <code>spring.mvc</code></li><li>4、文件上传配置 <code>spring.servlet.multipart</code></li></ul></li></ul><h3 id="自动配置的默认效果"><a href="#自动配置的默认效果" class="headerlink" title="自动配置的默认效果"></a>自动配置的默认效果</h3><p>SpringBoot Web 场景自动配置的效果如下：</p><ul><li>支持静态 <code>index.html</code></li><li>支持默认的静态资源处理机制，静态资源放在 <code>static</code> 文件夹下即可直接访问</li><li>包含了 <code>ContentNegotiatingViewResolver</code> 和 <code>BeanNameViewResolver</code> 组件，用于视图解析</li><li>自动注册了 <code>Converter</code>，<code>GenericConverter</code>，<code>Formatter</code> 组件，适配了常见的数据类型转换和格式化需求</li><li>支持 <code>HttpMessageConverters</code>，可以方便返回 JSON 等数据类型</li><li>注册 <code>MessageCodesResolver</code>，方便国际化及错误消息处理</li><li>自动使用 <code>ConfigurableWebBindingInitializer</code> 实现消息处理、数据绑定、类型转化、数据校验等功能</li></ul><div class="admonition note"><p class="admonition-title">重点知识</p><ul><li>如果想保持 SpringBoot MVC 的默认配置，并且自定义更多的 MVC 配置（如 interceptors，formatters，view controllers 等），可以使用 <code>@Configuration</code> 标注一个配置类，让配置类实现 <code>WebMvcConfigurer</code> 接口，并不要使用 <code>@EnableWebMvc</code> 注解。</li><li>如果想保持 SpringBoot MVC 的默认配置，但要自定义核心组件的实例（如 <code>RequestMappingHandlerMapping</code>，<code>RequestMappingHandlerAdapter</code>，<code>ExceptionHandlerExceptionResolver</code>），往容器中放一个 <code>WebMvcRegistrations</code> 组件，并不要使用 <code>@EnableWebMvc</code> 注解。</li><li>如果想全面接管 SpringBoot MVC 的配置，可以使用 <code>@Configuration</code> 标注一个配置类，让配置类实现 <code>WebMvcConfigurer</code> 接口，并加上 <code>@EnableWebMvc</code> 注解即可。</li></ul></div><h2 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h2><h3 id="默认静态资源规则"><a href="#默认静态资源规则" class="headerlink" title="默认静态资源规则"></a>默认静态资源规则</h3><h4 id="静态资源映射"><a href="#静态资源映射" class="headerlink" title="静态资源映射"></a>静态资源映射</h4><p>静态资源映射规则都在 <code>WebMvcAutoConfiguration</code> 自动配置类中进行了定义。</p><ul><li>访问 <code>/webjars/**</code> 路径就会去 <code>classpath:/META-INF/resources/webjars/</code> 下找资源，一般用于访问通过 Maven 引入的第三方前端组件（如 Vue、Bootstrap）</li><li>访问 <code>/**</code> 路径就会去静态资源默认的四个位置找资源，包括 <code>classpath:/META-INF/resources/</code>、<code>classpath:/resources/</code>、<code>classpath:/static/</code>、<code>classpath:/public/</code></li></ul><h4 id="静态资源缓存"><a href="#静态资源缓存" class="headerlink" title="静态资源缓存"></a>静态资源缓存</h4><p>所有静态资源都定义了缓存规则，浏览器访问过一次，就会缓存一段时间，但此功能的参数无默认值。</p><ul><li><code>cachePeriod</code>：缓存周期，多久不用找服务器要新的，默认值 0s，以秒为单位</li><li><code>cacheControl</code>： HTTP 缓存控制，参照 <a target="_blank" rel="external nofollow" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching">Mozilla 文档</a></li><li><code>useLastModified</code>：是否使用 <code>Last-Modified</code> 头，默认值 <code>false</code>，配合 HTTP Cache 规则使用</li><li>所有缓存参数的配置，都可以通过配置文件里的 <code>spring.web</code> 前缀配置项指定（如下）</li></ul><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 缓存周期（秒）</span></span><br><span class="line"><span class="meta">spring.web.resources.cache.period</span>=<span class="string">3600</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># HTTP 缓存控制（秒），浏览器第一次请求服务器时，服务器会告诉浏览器此资源缓存7200秒，即7200秒以内访问此资源的所有请求都不会发送给服务器</span></span><br><span class="line"><span class="meta">spring.web.resources.cache.cachecontrol.max-age</span>=<span class="string">7200</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 是否使用 Last-Modified 头，对比服务器和浏览器的资源是否有变化，如果资源没有变化，服务器会返回304码，此时浏览器会使用本地缓存中的资源</span></span><br><span class="line"><span class="meta">spring.web.resources.cache.use-last-modified</span>=<span class="string">true</span></span><br></pre></td></tr></tbody></table></figure><h4 id="Favicon-图标"><a href="#Favicon-图标" class="headerlink" title="Favicon 图标"></a>Favicon 图标</h4><ul><li>在默认的四个静态资源路径下查找 <code>favicon.ico</code></li></ul><h4 id="欢迎页面"><a href="#欢迎页面" class="headerlink" title="欢迎页面"></a>欢迎页面</h4><p>欢迎页面的映射规则在 <code>WebMvcAutoConfiguration</code> 中进行了定义：</p><ul><li>首先会在默认的四个静态资源路径下查找 <code>index.html</code></li><li>如果静态资源路径下找不到，就会在 <code>templates</code> 目录下找 <code>index</code> 模板页面</li></ul><h3 id="自定义静态资源规则"><a href="#自定义静态资源规则" class="headerlink" title="自定义静态资源规则"></a>自定义静态资源规则</h3><h4 id="配置方式"><a href="#配置方式" class="headerlink" title="配置方式"></a>配置方式</h4><ul><li><code>spring.mvc</code>：配置静态资源访问路径的前缀</li><li><code>spring.web</code>：配合静态资源目录、静态资源策略 (开启映射、处理链、缓存规则)、国际化的区域信息</li></ul><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 自定义静态资源访问路径的前缀</span></span><br><span class="line"><span class="meta">spring.mvc.static-path-pattern</span>=<span class="string">/static/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 自定义webjars访问路径的前缀</span></span><br><span class="line"><span class="meta">spring.mvc.webjars-path-pattern</span>=<span class="string">/webjars/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 自定义静态资源文件夹的位置</span></span><br><span class="line"><span class="meta">spring.web.resources.static-locations</span>=<span class="string">classpath:/static/,classpath:/public/,classpath:/asset/</span></span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">提示</p><ul><li>当不使用 <code>spring.mvc.static-path-pattern</code> 自定义静态资源访问路径的前缀时，静态资源默认的访问路径示例是 <code>http://127.0.0.1:8080/backgrond.png</code></li><li>当使用 <code>spring.mvc.static-path-pattern=/static/**</code> 自定义静态资源访问路径的前缀时，静态资源的访问路径示例是 <code>http://127.0.0.1:8080/static/backgrond.png</code></li></ul></div><h4 id="代码方式"><a href="#代码方式" class="headerlink" title="代码方式"></a>代码方式</h4><div class="admonition note"><p class="admonition-title">提示</p><ul><li>如果希望完全禁用 SpringBoot MVC 的自动配置，可以在配置类上添加 <code>@EnableWebMvc</code> 注解，此时相当于采用全手动的方式配置 MVC。</li></ul></div><ul><li>第一种写法：实现 <code>WebMvcConfigurer</code> 接口，同样可以自定义静态资源规则</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.CacheControl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfiguration</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>{</span><br><span class="line">        <span class="comment">// 保留默认的配置规则，并添加新的配置规则</span></span><br><span class="line">        registry</span><br><span class="line">            <span class="comment">// 自定义静态资源访问路径的前缀</span></span><br><span class="line">            .addResourceHandler(<span class="string">"/static/**"</span>)</span><br><span class="line">            <span class="comment">// 自定义静态资源文件夹的位置</span></span><br><span class="line">            .addResourceLocations(<span class="string">"classpath:/static/"</span>, <span class="string">"classpath:/public/"</span>, <span class="string">"classpath:/asset/"</span>)</span><br><span class="line">            <span class="comment">// 自定义HTTP缓存控制</span></span><br><span class="line">            .setCacheControl(CacheControl.maxAge(<span class="number">7200</span>, TimeUnit.SECONDS));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>第二种写法：使用 <code>@Bean</code> 注解，定义 <code>WebMvcConfigurer</code> 组件，同样可以自定义静态资源规则</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.CacheControl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfiguration</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebMvcConfigurer() {</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>{</span><br><span class="line">                <span class="comment">// 保留默认的配置规则，并添加新的配置规则</span></span><br><span class="line">                registry</span><br><span class="line">                    <span class="comment">// 自定义静态资源访问路径的前缀</span></span><br><span class="line">                    .addResourceHandler(<span class="string">"/static/**"</span>)</span><br><span class="line">                    <span class="comment">// 自定义静态资源文件夹的位置</span></span><br><span class="line">                    .addResourceLocations(<span class="string">"classpath:/static/"</span>, <span class="string">"classpath:/public/"</span>, <span class="string">"classpath:/asset/"</span>)</span><br><span class="line">                    <span class="comment">// 自定义HTTP缓存控制</span></span><br><span class="line">                    .setCacheControl(CacheControl.maxAge(<span class="number">7200</span>, TimeUnit.SECONDS));</span><br><span class="line">            }</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><h3 id="默认机制"><a href="#默认机制" class="headerlink" title="默认机制"></a>默认机制</h3><p>SpringBoot 错误处理的自动配置都在 <code>ErrorMvcAutoConfiguration</code> 中，两大核心机制：</p><ul><li>1、SpringBoot 会自适应处理错误，响应页面或 JSON 数据给客户端</li><li> 2、SpringMVC 的错误处理机制依然保留，SpringMVC 处理不了的，才会交给 SpringBoot 进行处理</li></ul><p><img data-src="../../../asset/2023/06/spring-boot3-study-17.png"></p><ul><li>发生错误以后，请求转发给 <code>/error</code> 路径，SpringBoot 在底层写好一个 <code>BasicErrorController</code> 组件，专门处理这个请求</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回HTML</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(produces = MediaType.TEXT_HTML_VALUE)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>{</span><br><span class="line">    HttpStatus status = getStatus(request);</span><br><span class="line">    Map&lt;String, Object&gt; model = Collections</span><br><span class="line">        .unmodifiableMap(getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.TEXT_HTML)));</span><br><span class="line">    response.setStatus(status.value());</span><br><span class="line">    ModelAndView modelAndView = resolveErrorView(request, response, status, model);</span><br><span class="line">    <span class="keyword">return</span> (modelAndView != <span class="keyword">null</span>) ? modelAndView : <span class="keyword">new</span> ModelAndView(<span class="string">"error"</span>, model);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回 ResponseEntity，JSON</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) {</span><br><span class="line">    HttpStatus status = getStatus(request);</span><br><span class="line">    <span class="keyword">if</span> (status == HttpStatus.NO_CONTENT) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(status);</span><br><span class="line">    }</span><br><span class="line">    Map&lt;String, Object&gt; body = getErrorAttributes(request, getErrorAttributeOptions(request, MediaType.ALL));</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(body, status);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>错误页面是这么解析到的</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 解析错误的自定义视图地址</span></span><br><span class="line">ModelAndView modelAndView = resolveErrorView(request, response, status, model);</span><br><span class="line"><span class="comment">// 如果解析不到错误页面的地址，默认的错误页就是 error</span></span><br><span class="line"><span class="keyword">return</span> (modelAndView != <span class="keyword">null</span>) ? modelAndView : <span class="keyword">new</span> ModelAndView(<span class="string">"error"</span>, model);</span><br></pre></td></tr></tbody></table></figure><ul><li>容器中专门有一个错误视图解析器</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(DispatcherServlet.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(ErrorViewResolver.class)</span></span><br><span class="line"><span class="function">DefaultErrorViewResolver <span class="title">conventionErrorViewResolver</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DefaultErrorViewResolver(<span class="keyword">this</span>.applicationContext, <span class="keyword">this</span>.resources);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>SpringBoot 解析自定义错误页的默认规则</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status, Map&lt;String, Object&gt; model)</span> </span>{</span><br><span class="line">    ModelAndView modelAndView = resolve(String.valueOf(status.value()), model);</span><br><span class="line">    <span class="keyword">if</span> (modelAndView == <span class="keyword">null</span> &amp;&amp; SERIES_VIEWS.containsKey(status.series())) {</span><br><span class="line">        modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>{</span><br><span class="line">    String errorViewName = <span class="string">"error/"</span> + viewName;</span><br><span class="line">    TemplateAvailabilityProvider provider = <span class="keyword">this</span>.templateAvailabilityProviders.getProvider(errorViewName, <span class="keyword">this</span>.applicationContext);</span><br><span class="line">    <span class="keyword">if</span> (provider != <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(errorViewName, model);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> resolveResource(errorViewName, model);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolveResource</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (String location : <span class="keyword">this</span>.resources.getStaticLocations()) {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            Resource resource = <span class="keyword">this</span>.applicationContext.getResource(location);</span><br><span class="line">            resource = resource.createRelative(viewName + <span class="string">".html"</span>);</span><br><span class="line">            <span class="keyword">if</span> (resource.exists()) {</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="keyword">new</span> HtmlResourceView(resource), model);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) {</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>容器中有一个默认的名为 <code>error</code> 的 View，提供了默认错误页面的功能</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(name = "error")</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(name = "error")</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> View <span class="title">defaultErrorView</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.defaultErrorView;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>封装了 JSON 格式的错误信息</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(value = ErrorAttributes.class, search = SearchStrategy.CURRENT)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DefaultErrorAttributes <span class="title">errorAttributes</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> DefaultErrorAttributes();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>错误页面的解析规则<ul><li> 1、解析一个错误页<ul><li> a. 如果发生了 500、404、503、403 这些错误<ul><li> ⅰ. 如果有模板引擎，模板文件默认在 <code>classpath:/templates/error/精确码.html</code></li><li>ⅱ. 如果没有模板引擎，在静态资源文件夹下找 <code>精确码.html</code></li></ul></li><li>b. 如果匹配不到 <code>精确码.html</code> 这些精确的错误页，就去找 <code>5xx.html</code>，<code>4xx.html</code> 模糊匹配<ul><li> ⅰ. 如果有模板引擎，模板文件默认在 <code>classpath:/templates/error/5xx.html</code></li><li>ⅱ. 如果没有模板引擎，在静态资源文件夹下找 <code>5xx.html</code></li></ul></li></ul></li><li>2、如果模板引擎路径 <code>templates</code> 下有 <code>error.html</code> 页面，就直接渲染并返回给客户端</li></ul></li></ul><h3 id="自定义错误响应"><a href="#自定义错误响应" class="headerlink" title="自定义错误响应"></a>自定义错误响应</h3><ul><li>自定义 JSON 响应，使用 <code>@ControllerAdvice</code> + <code>@ExceptionHandler</code> 进行统一异常处理</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">handleException</span><span class="params">(Exception exception)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> R.error(exception.getMessage());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>自定义页面响应，根据 SpringBoot 的错误页面解析规则，自定义错误页面。</li></ul><h3 id="错误处理的最佳实践"><a href="#错误处理的最佳实践" class="headerlink" title="错误处理的最佳实践"></a>错误处理的最佳实践</h3><ul><li>前后端分离开发模式<ul><li>后台发生的所有错误，通过 <code>@ControllerAdvice</code> + <code>@ExceptionHandler</code> 进行统一异常处理</li></ul></li><li>前后端不分离模式（服务端模板页面渲染）<ul><li>一些不可预知的错误，如使用 HTTP 码表示的服务器或客户端错误<ul><li>在 <code>classpath:/templates/error/</code> 下面，存放常用精确的错误码页面，如 <code>500.html</code>、<code>404.html</code></li><li>在 <code>classpath:/templates/error/</code> 下面，存放通用模糊匹配的错误码页面，如 <code>5xx.html</code>、<code>4xx.html</code></li></ul></li><li>发生业务错误<ul><li>核心业务的每一种错误，都应该通过代码控制，跳转到定制的错误页</li><li>通用业务，可以通过 <code>classpath:/templates/error.html</code> 错误页面，显示通用的错误信息</li></ul></li></ul></li><li>在模板页面或者服务端返回的 JSON 数据中，可用的 Model 数据如下：</li></ul><p><img data-src="../../../asset/2023/06/spring-boot3-study-18.png"></p><h2 id="嵌入式容器"><a href="#嵌入式容器" class="headerlink" title="嵌入式容器"></a>嵌入式容器</h2><p>Servlet 容器指的是管理、运行 Servlet 组件（<code>Servlet</code>、<code>Filter</code>、<code>Listener</code>）的环境，一般指 Web 服务器。</p><h3 id="自动配置原理"><a href="#自动配置原理" class="headerlink" title="自动配置原理"></a>自动配置原理</h3><ul><li>SpringBoot 默认使用嵌入的 Tomcat 作为 Servlet 容器</li><li>嵌入式容器的自动配置类是 <code>ServletWebServerFactoryAutoConfiguration</code>，<code>EmbeddedWebServerFactoryCustomizerAutoConfiguration</code></li><li><code>ServletWebServerFactoryAutoConfiguration</code> 自动配置了嵌入式容器场景</li><li>绑定了 <code>ServerProperties</code> 配置类，所有和服务器相关的配置都使用 <code>server</code> 作为开始前缀</li><li><code>ServletWebServerFactoryAutoConfiguration</code> 默认导入了嵌入式的三大服务器，包括 <code>Tomcat</code>、<code>Jetty</code>、<code>Undertow</code><ul><li>导入 <code>Tomcat</code>、<code>Jetty</code>、<code>Undertow</code> 时都有条件注解，系统中有对应的类才会生效（也就是导了包）</li><li>在默认情况下，Tomcat 的配置会生效，SpringBoot 往容器中放了 <code>TomcatServletWebServerFactory</code> 组件</li><li>往容器中放一个 Web 服务器工厂 <code>ServletWebServerFactory</code> 后，可以创建 Web 服务器</li><li> Web 服务器工厂都有一个功能，可以调用 <code>getWebServer()</code> 获取 Web 服务器</li><li><code>TomcatServletWebServerFactory</code> 创建了 Tomcat Web 服务器</li></ul></li><li><code>ServletWebServerApplicationContext</code> IOC 容器在启动的时候，会调用 <code>ServletWebServerFactory</code> 创建 Web 服务器</li><li> Spring 容器刷新（启动）的时候，会预留一个时机，调用 <code>onRefresh()</code> 刷新子容器</li><li><code>refresh()</code> 容器刷新，十二大步的刷新子容器会调用 <code>onRefresh()</code></li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(ServletRequest.class)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(ServerProperties.class)</span></span><br><span class="line"><span class="meta">@Import({ ServletWebServerFactoryAutoConfiguration.BeanPostProcessorsRegistrar.class,</span></span><br><span class="line"><span class="meta">		ServletWebServerFactoryConfiguration.EmbeddedTomcat.class,</span></span><br><span class="line"><span class="meta">		ServletWebServerFactoryConfiguration.EmbeddedJetty.class,</span></span><br><span class="line"><span class="meta">		ServletWebServerFactoryConfiguration.EmbeddedUndertow.class })</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletWebServerFactoryAutoConfiguration</span> </span>{</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">super</span>.onRefresh();</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        createWebServer();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">catch</span> (Throwable ex) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ApplicationContextException(<span class="string">"Unable to start web server"</span>, ex);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">总结</p><ul><li>Web 场景的 Spring 容器启动，在调用 <code>onRefresh()</code> 的时候，会调用创建 Web 服务器的方法。</li><li>Web 服务器的创建是通过 <code>WebServerFactory</code> 实现的，容器中又会根据条件注解，启动相关的服务器配置，默认 <code>EmbeddedTomcat</code> 会往容器中放一个 <code>TomcatServletWebServerFactory</code> 组件，导致项目启动后，自动创建出 Tomcat 服务器。</li></ul></div><h3 id="自定义嵌入式容器"><a href="#自定义嵌入式容器" class="headerlink" title="自定义嵌入式容器"></a>自定义嵌入式容器</h3><ul><li>嵌入式三大容器有 <code>Tomcat</code>、<code>Jetty</code>、<code>Undertow</code>，SpringBoot 默认使用 Tomcat 作为容器。若希望切换到其他容器，只需要更改 Maven 的配置即可，如下所示：</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义Servlet版本 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-api.version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">servlet-api.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 排除Tomcat依赖 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 使用Undertow容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>最佳实践<ul><li>修改以 <code>server</code> 为开始前缀的相关配置，这样就可以修改服务器参数</li><li>通过往容器中放一个 <code>ServletWebServerFactory</code> 组件，来禁用掉 SpringBoot 默认引入的 Web 服务器工厂，这样就可以实现自定义任意的嵌入服务器。</li></ul></li></ul><h2 id="底层源码浅析"><a href="#底层源码浅析" class="headerlink" title="底层源码浅析"></a>底层源码浅析</h2><h3 id="Web-MVC-自动配置原理"><a href="#Web-MVC-自动配置原理" class="headerlink" title="Web MVC 自动配置原理"></a>Web MVC 自动配置原理</h3><h4 id="自动配置生效的条件"><a href="#自动配置生效的条件" class="headerlink" title="自动配置生效的条件"></a>自动配置生效的条件</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * WebMvcAutoConfiguration 的底层源码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AutoConfiguration(after = { DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class, ValidationAutoConfiguration.class })</span> <span class="comment">// 在这些自动配置之后</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span> <span class="comment">// 如果是 Web 应用就生效，类型： SERVLET、REACTIVE</span></span><br><span class="line"><span class="meta">@ConditionalOnClass({ Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class })</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span> <span class="comment">// 容器中没有这个 Bean 才生效，默认就是没有</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span> <span class="comment">// 优先级</span></span><br><span class="line"><span class="meta">@ImportRuntimeHints(WebResourcesRuntimeHints.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfiguration</span> </span>{</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="自动配置实现的效果"><a href="#自动配置实现的效果" class="headerlink" title="自动配置实现的效果"></a>自动配置实现的效果</h4><p>效果一：往容器中放了两个 Filter</p><ul><li><code>HiddenHttpMethodFilter</code>：页面表单提交 REST 请求（支持 GET、POST、PUT、DELETE 方法）</li><li><code>FormContentFilter</code>： 表单内容 Filter，GET（数据放 URL 后面）、POST（数据放请求体）请求可以携带数据，PUT、DELETE 的请求体数据会被忽略</li></ul><p>效果二：往容器中放了 <code>WebMvcConfigurer</code> 组件，给 Spring MVC 添加各种定制功能，所有功能最终都会和配置文件的内容进行绑定</p><ul><li><code>WebMvcProperties</code>： 绑定了以 <code>spring.mvc</code> 为开始前缀的配置项</li><li><code>WebProperties</code>： 绑定了以 <code>spring.web</code> 为开始前缀的配置项</li></ul><h4 id="WebMvcConfigurer-接口"><a href="#WebMvcConfigurer-接口" class="headerlink" title="WebMvcConfigurer 接口"></a>WebMvcConfigurer 接口</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@Import(EnableWebMvcConfiguration.class)</span> <span class="comment">// 额外导入了其他配置</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties({ WebMvcProperties.class, WebProperties.class })</span></span><br><span class="line"><span class="meta">@Order(0)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span>, <span class="title">ServletContextAware</span></span>{</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><img data-src="../../../asset/2023/06/spring-boot3-study-7.png"></p><h4 id="静态资源映射规则的源码"><a href="#静态资源映射规则的源码" class="headerlink" title="静态资源映射规则的源码"></a>静态资源映射规则的源码</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span>, <span class="title">ServletContextAware</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) {</span><br><span class="line">            logger.debug(<span class="string">"Default resource handling disabled"</span>);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">this</span>.addResourceHandler(registry, <span class="keyword">this</span>.mvcProperties.getWebjarsPathPattern(), <span class="string">"classpath:/META-INF/resources/webjars/"</span>);</span><br><span class="line">            <span class="keyword">this</span>.addResourceHandler(registry, <span class="keyword">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; {</span><br><span class="line">                registration.addResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.servletContext != <span class="keyword">null</span>) {</span><br><span class="line">                    ServletContextResource resource = <span class="keyword">new</span> ServletContextResource(<span class="keyword">this</span>.servletContext, <span class="string">"/"</span>);</span><br><span class="line">                    registration.addResourceLocations(<span class="keyword">new</span> Resource[]{resource});</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">            });</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>规则一：访问 <code>/webjars/**</code> 路径就会去 <code>classpath:/META-INF/resources/webjars/</code> 下找资源，一般用于访问通过 Maven 引入的第三方前端组件（如 Vue、Bootstrap）<br>规则二：访问 <code>/**</code> 路径就会去静态资源默认的四个位置找资源，包括 <code>classpath:/META-INF/resources/</code>、<code>classpath:/resources/</code>、<code>classpath:/static/</code>、<code>classpath:/public/</code><br>规则三：静态资源默认都有缓存规则的设置</p><ul><li>所有缓存参数的配置，都可以通过配置文件里的 <code>spring.web</code> 前缀配置项指定</li><li><code>cachePeriod</code>：缓存周期，多久不用找服务器要新的，默认值 0s，以秒为单位</li><li><code>cacheControl</code>： HTTP 缓存控制，参照 <a target="_blank" rel="external nofollow" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching">Mozilla 文档</a></li><li><code>useLastModified</code>：是否使用 <code>Last-Modified</code> 头，默认值 <code>false</code>，配合 HTTP Cache 规则使用</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">registration.setCachePeriod(getSeconds(<span class="keyword">this</span>.resourceProperties.getCache().getPeriod()));</span><br><span class="line">registration.setUseLastModified(<span class="keyword">this</span>.resourceProperties.getCache().isUseLastModified());</span><br><span class="line">registration.setCacheControl(<span class="keyword">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl());</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">提示</p><p>当浏览器访问了一个静态资源文件 <code>index.js</code>，如果在服务器中这个资源文件没有发生变化，那么在用户下次访问的时候，就可以直接让浏览器用本地缓存中的资源文件，而不用给服务器发送请求。</p></div><h4 id="EnableWebMvcConfiguration-的源码"><a href="#EnableWebMvcConfiguration-的源码" class="headerlink" title="EnableWebMvcConfiguration 的源码"></a>EnableWebMvcConfiguration 的源码</h4><p><code>EnableWebMvcConfiguration</code> 继承了 <code>DelegatingWebMvcConfiguration</code>，而 <code>DelegatingWebMvcConfiguration</code> 则继承了 <code>WebMvcConfigurationSupport</code>。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>{</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(WebProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">EnableWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title">DelegatingWebMvcConfiguration</span> <span class="keyword">implements</span> <span class="title">ResourceLoaderAware</span> </span>{</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>SpringBoot 默认会往容器中放入 <code>WebMvcConfigurationSupport</code> 组件，如果开发者注册了 <code>WebMvcConfigurationSupport</code> 组件，那么 SpringBoot 的 <code>WebMvcAutoConfiguration</code> 组件就会失效。这相当于禁用 SpringBoot 的自动配置，采用全手动的方式配置 MVC。</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration(after = { DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class, ValidationAutoConfiguration.class })</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass({ Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class })</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span> <span class="comment">// 容器中没有这个 Bean 才生效，默认就是没有</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span></span><br><span class="line"><span class="meta">@ImportRuntimeHints(WebResourcesRuntimeHints.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfiguration</span> </span>{</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>欢迎页面的查找规则<ul><li><code>HandlerMapping</code>：根据请求路径找到能处理请求的 Handler</li><li><code>WelcomePageHandlerMapping</code>：<ul><li>访问 <code>/**</code> 路径下的所有请求，都会去默认的四个静态资源路径下查找页面，这也适用于欢迎页面</li><li>只要在任意一个静态资源路径下有一个 <code>index.html</code> 页面，项目启动后就可以正常访问它</li></ul></li></ul></li></ul><h4 id="为什么定义-WebMvcConfigurer-就能配置底层行为"><a href="#为什么定义-WebMvcConfigurer-就能配置底层行为" class="headerlink" title="为什么定义 WebMvcConfigurer 就能配置底层行为"></a>为什么定义 WebMvcConfigurer 就能配置底层行为</h4><ul><li><code>WebMvcAutoConfiguration</code> 是一个自动配置类，它里面有一个 <code>EnableWebMvcConfiguration</code> 配置类</li><li><code>EnableWebMvcConfiguration</code> 继承了 <code>DelegatingWebMvcConfiguration</code>，且两者都会生效</li><li><code>DelegatingWebMvcConfiguration</code> 利用 DI (自动注入) 将容器中所有的 <code>WebMvcConfigurer</code> 都注入进来</li><li>别人调用 <code>DelegatingWebMvcConfiguration</code> 的方法配置底层规则，而它自身则调用所有 <code>WebMvcConfigurer</code> 的底层配置方法。</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * DelegatingWebMvcConfiguration 的底层源码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelegatingWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurationSupport</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> WebMvcConfigurerComposite configurers = <span class="keyword">new</span> WebMvcConfigurerComposite();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired(required = false)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConfigurers</span><span class="params">(List&lt;WebMvcConfigurer&gt; configurers)</span> </span>{</span><br><span class="line">		<span class="keyword">if</span> (!CollectionUtils.isEmpty(configurers)) {</span><br><span class="line">			<span class="keyword">this</span>.configurers.addWebMvcConfigurers(configurers);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> </span>{</span><br><span class="line">		<span class="keyword">this</span>.configurers.configurePathMatch(configurer);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer configurer)</span> </span>{</span><br><span class="line">		<span class="keyword">this</span>.configurers.configureContentNegotiation(configurer);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="全面接管-Spring-MVC"><a href="#全面接管-Spring-MVC" class="headerlink" title="全面接管 Spring MVC"></a>全面接管 Spring MVC</h2><p>SpringBoot 默认配置好了 Spring MVC 的所有常用特性，如果需要全面接管 Spring MVC 的所有配置并禁用默认配置，仅需要编写一个 <code>WebMvcConfigurer</code> 配置类，并标注 <code>@EnableWebMvc</code> 即可。</p><h3 id="WebMvcAutoConfiguration-自动配置了哪些规则"><a href="#WebMvcAutoConfiguration-自动配置了哪些规则" class="headerlink" title="WebMvcAutoConfiguration 自动配置了哪些规则"></a>WebMvcAutoConfiguration 自动配置了哪些规则</h3><p>Spring MVC 自动配置场景给我们配置了如下所有默认行为：</p><ul><li><p><code>WebMvcAutoConfiguration</code> Web 场景的自动配置类</p><ul><li>支持 RESTful 的 Filter：<code>HiddenHttpMethodFilter</code></li><li>支持非 POST 请求体携带数据：<code>FormContentFilter</code></li><li>导入 <code>EnableWebMvcConfiguration</code> 配置类后：<ul><li><code>RequestMappingHandlerAdapter</code></li><li><code>WelcomePageHandlerMapping</code>： 欢迎页功能支持（模板引擎目录、静态资源目录放 <code>index.html</code> 页面），项目访问 <code>/</code> 就默认展示这个页面</li><li><code>RequestMappingHandlerMapping</code>：找每个请求由谁处理的映射关系</li><li><code>ExceptionHandlerExceptionResolver</code>：默认的异常解析器</li><li><code>LocaleResolver</code>：国际化解析器</li><li><code>ThemeResolver</code>：主题解析器</li><li><code>FlashMapManager</code>：临时数据共享</li><li><code>FormattingConversionService</code>： 数据格式化 、类型转化</li><li><code>Validator</code>：JSR303 提供的数据校验功能</li><li><code>WebBindingInitializer</code>：请求参数的封装与绑定</li><li><code>ContentNegotiationManager</code>：内容协商管理器</li></ul></li></ul></li><li><p><code>WebMvcAutoConfigurationAdapter</code> 配置生效，它是一个 <code>WebMvcConfigurer</code>，定义了 MVC 底层组件</p><ul><li>定义好 <code>WebMvcConfigurer</code>：底层组件的默认功能</li><li>视图解析器：<code>InternalResourceViewResolver</code></li><li>视图解析器：<code>BeanNameViewResolver</code>，视图名（Controller 方法的返回值字符串）就是组件名</li><li>内容协商解析器：<code>ContentNegotiatingViewResolver</code></li><li>请求上下文过滤器：<code>RequestContextFilter</code>，在任意位置直接获取当前请求</li><li>静态资源链规则</li><li>错误详情：<code>ProblemDetailsExceptionHandler</code>，Spring MVC 内部场景的异常都会被它捕获</li></ul></li></ul><h3 id="EnableWebMvc-禁用默认行为"><a href="#EnableWebMvc-禁用默认行为" class="headerlink" title="@EnableWebMvc 禁用默认行为"></a>@EnableWebMvc 禁用默认行为</h3><ul><li><code>@EnableWebMvc</code> 往容器中导入了 <code>DelegatingWebMvcConfiguration</code> 组件，它继承自 <code>WebMvcConfigurationSupport</code></li><li><code>WebMvcAutoConfiguration</code> 有一个核心的条件注解，<code>@ConditionalOnMissingBean (WebMvcConfigurationSupport.class)</code>，当容器中没有 <code>WebMvcConfigurationSupport</code> 组件时，<code>WebMvcAutoConfiguration</code> 才生效</li><li><code>@EnableWebMvc</code> 导入了 <code>WebMvcConfigurationSupport</code>，从而会导致 <code>WebMvcAutoConfiguration</code> 失效，即会导致 SpringBoot 禁用 MVC 自动配置的所有功能</li></ul><h3 id="WebMvcConfigurer-的功能"><a href="#WebMvcConfigurer-的功能" class="headerlink" title="WebMvcConfigurer 的功能"></a>WebMvcConfigurer 的功能</h3><p><code>WebMvcConfigurer</code> 定义并扩展了 Spring MVC 的底层功能，其中的功能列表如下：</p><table><thead><tr><th>提供方法</th><th>核心参数</th><th>功能</th><th>默认</th></tr></thead><tbody><tr><td> addFormatters</td><td>FormatterRegistry</td><td> 格式化器：支持属性上 <code>@NumberFormat</code> 和 <code>@DatetimeFormat</code> 的数据类型转换</td><td> GenericConversionService</td></tr><tr><td>getValidator</td><td> 无</td><td>数据校验：校验 Controller 上使用 <code>@Valid</code> 标注的参数合法性。需要导入 <code>spring-boot-starter-validator</code></td><td>无</td></tr><tr><td> addInterceptors</td><td>InterceptorRegistry</td><td> 拦截器：拦截收到的所有请求</td><td>无</td></tr><tr><td> configureContentNegotiation</td><td>ContentNegotiationConfigurer</td><td> 内容协商：支持多种数据格式返回。需要配合支持这种类型的 <code>HttpMessageConverter</code></td><td>支持 JSON</td></tr><tr><td>configureMessageConverters</td><td>List&lt;HttpMessageConverter&lt;?&gt;&gt;</td><td> 消息转换器：标注 <code>@ResponseBody</code> 的返回值会利用 <code>MessageConverter</code> 直接写出去</td><td>支持 8 种数据类型，包括 <code>byte</code>，<code>string</code>，<code>multipart</code>，<code>resource</code>，<code>json</code></td></tr><tr><td>addViewControllers</td><td>ViewControllerRegistry</td><td> 视图映射：直接将请求路径与物理视图映射。用于无 Java 业务逻辑的直接视图页渲染</td><td>无</td></tr><tr><td> configureViewResolvers</td><td>ViewResolverRegistry</td><td> 视图解析器：逻辑视图转为物理视图</td><td> ViewResolverComposite</td></tr><tr><td>addResourceHandlers</td><td>ResourceHandlerRegistry</td><td> 静态资源处理：静态资源路径映射、缓存控制</td><td> ResourceHandlerRegistry</td></tr><tr><td>configureDefaultServletHandling</td><td>DefaultServletHandlerConfigurer</td><td> 默认 <code>Servlet</code>：可以覆盖 Tomcat 的 <code>DefaultServlet</code>。让 <code>DispatcherServlet</code> 拦截 <code>/</code></td><td>无</td></tr><tr><td> configurePathMatch</td><td>PathMatchConfigurer</td><td> 路径匹配：自定义 URL 路径匹配。可以自动为所有路径加上指定前缀，比如 <code>/api</code></td><td>无</td></tr><tr><td> configureAsyncSupport</td><td>AsyncSupportConfigurer</td><td> 异步支持</td><td> TaskExecutionAutoConfiguration</td></tr><tr><td>addCorsMappings</td><td>CorsRegistry</td><td> 跨域支持</td><td>无</td></tr><tr><td> addArgumentResolvers</td><td>List<handlermethodargumentresolver></handlermethodargumentresolver></td><td> 参数解析器</td><td> MVC 默认提供</td></tr><tr><td> addReturnValueHandlers</td><td>List<handlermethodreturnvaluehandler></handlermethodreturnvaluehandler></td><td> 返回值解析器</td><td> MVC 默认提供</td></tr><tr><td> configureHandlerExceptionResolvers</td><td>List<handlerexceptionresolver></handlerexceptionresolver></td><td> 异常处理器</td><td> 3 个核心类：<code>ExceptionHandlerExceptionResolver</code>，<code>ResponseStatusExceptionResolver</code>，<code>DefaultHandlerExceptionResolver</code></td></tr><tr><td>getMessageCodesResolver</td><td> 无</td><td>消息码解析器：国际化使用</td><td>无</td></tr></tbody></table><h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><p>SpringBoot 已经默认配置好了 Web 开发场景常用的功能，一般情况下直接使用即可。</p><h3 id="三种配置方式"><a href="#三种配置方式" class="headerlink" title="三种配置方式"></a>三种配置方式</h3><p>在 SpringBoot Web 开发场景下，有以下三种方式可以配置 SpringBoot MVC。</p><table><thead><tr><th>方式</th><th>用法</th><th>重点</th><th>效果</th></tr></thead><tbody><tr><td>全自动</td><td>直接编写控制器的业务逻辑</td><td></td><td>全部使用 SpringBoot 自动配置的默认效果</td></tr><tr><td>手自一体</td><td><code>@Configuration</code> + 配置 <code>WebMvcConfigurer</code> 或者配置 <code>WebMvcRegistrations</code></td><td>不要标注 <code>@EnableWebMvc</code> 注解</td><td>保留 SpringBoot 自动配置效果，手动配置部分功能，自定义 MVC 底层组件</td></tr><tr><td>全手动</td><td><code>@Configuration</code> + 配置 <code>WebMvcConfigurer</code></td><td>标注 <code>@EnableWebMvc</code> 注解</td><td>禁用 SpringBoot 自动配置效果，全手动配置</td></tr></tbody></table><h3 id="两种开发模式"><a href="#两种开发模式" class="headerlink" title="两种开发模式"></a>两种开发模式</h3><ul><li>前后端分离模式： <code>@RestController</code> 直接响应 JSON 数据</li><li>前后端不分离模式：<code>@Controller</code> + <code>Thymeleaf</code> 模板引擎</li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/12fb0f17.html" title="SpringBoot3 基础教程之三 Web 开发">https://www.techgrow.cn/posts/12fb0f17.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag"><i class="fa fa-tag"></i> 微服务</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/bcb943df.html" rel="prev" title="C++ 设计模式使用教程之二"><i class="fa fa-angle-left"></i> C++ 设计模式使用教程之二</a></div><div class="post-nav-item"> <a href="/posts/faebf827.html" rel="next" title="Spring 之 @Async 与线程池的使用">Spring 之 @Async 与线程池的使用<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">1.8m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">27:25</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/12fb0f17.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>