<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 Dubbo 的入门教程。"><meta property="og:type" content="article"><meta property="og:title" content="Dubbo 2 入门教程之三"><meta property="og:url" content="https://www.techgrow.cn/posts/fab9c84c.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 Dubbo 的入门教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/dubbo-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/dubbo-5.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/dubbo-6.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-10.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-11.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-12.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-13.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-14.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-9.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/07/dubbo-multi-protocol.png"><meta property="article:published_time" content="2019-07-10T15:42:35.000Z"><meta property="article:modified_time" content="2025-07-10T15:42:35.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="微服务"><meta property="article:tag" content="分布式"><meta property="article:tag" content="RPC"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2025/01/dubbo-1.png"><link rel="canonical" href="https://www.techgrow.cn/posts/fab9c84c.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/fab9c84c.html","path":"posts/fab9c84c.html","title":"Dubbo 2 入门教程之三"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Dubbo 2 入门教程之三 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script>
  (function () {

  // 防止 Pjax 重复绑定事件
  if (window.__moonMenuCodeExpandBound) {
    return;
  }
  window.__moonMenuCodeExpandBound = true;

  const STORAGE_KEY = 'moon_menu_code_fold';

  /* ===============================
   * 1. 设置 moon-menu 按钮的 title
   * =============================== */
  (function bindMoonMenuTitles() {
    const items = [
      { selector: '#moon-menu-item-code',        title: '展开 / 折叠代码块' },
      { selector: '#moon-menu-item-back2top',    title: '回到页面顶部' },
      { selector: '#moon-menu-item-back2bottom', title: '回到页面底部' }
    ];

    let allReady = true;

    items.forEach(item => {
      const el = document.querySelector(item.selector);
      if (!el) {
        allReady = false;
        return;
      }
      el.setAttribute('title', item.title);
    });

    if (!allReady) {
      setTimeout(bindMoonMenuTitles, 100);
    }
  })();

  /* =================================
   * 2. 页面首次加载：代码块恢复展开或折叠状态
   * ================================= */
  function applyStoredCodeState() {
    const containers = document.querySelectorAll('.code-container');
    if (!containers.length) {
      return;
    }

    const state = localStorage.getItem(STORAGE_KEY);
    if (!state) {
      return;
    }

    containers.forEach(container => {
      if (state === 'expanded') {
        // 展开代码块
        container.classList.remove('highlight-fold');
      } else if (state === 'folded') {
        // 折叠代码块
        container.classList.add('highlight-fold');
      }
    });
  }

  // 等代码块出现后，再恢复展开或折叠状态
  function waitAndApplyState() {
    const containers = document.querySelectorAll('.code-container');

    if (!containers.length) {
      setTimeout(waitAndApplyState, 100);
      return;
    }

    applyStoredCodeState();
  }

  // 页面首次加载时恢复状态
  waitAndApplyState();
  
  // Pjax 切换页面后，必须重新恢复状态
  document.addEventListener('pjax:complete', function () {
    waitAndApplyState();
  });

  /* ===============================
   * 3. 点击按钮：切换状态并保存
   * =============================== */
  document.addEventListener('click', function (e) {
    const codeMenu = e.target.closest('#moon-menu-item-code');
    if (!codeMenu) {
      return;
    }

    toggleAllCodeBlocks();
  });

  // 展开或折叠代码块
  function toggleAllCodeBlocks() {
    const containers = document.querySelectorAll('.code-container');
    if (!containers.length) {
      return;
    }

    // 只要存在折叠的代码块，就认为当前是折叠状态
    const hasFolded = Array.from(containers).some(c => {
      return c.classList.contains('highlight-fold');
    });

    containers.forEach(container => {
      if (hasFolded) {
        // 展开代码块
        container.classList.remove('highlight-fold');
      } else {
        // 折叠代码块
        container.classList.add('highlight-fold');
      }
    });

    // 记录展开或折叠状态
    localStorage.setItem(
      STORAGE_KEY,
      hasFolded ? 'expanded' : 'folded'
    );
  }

})();
</script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90"><span class="nav-text">学习资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="nav-text">Dubbo 核心特性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%8D%8F%E8%AE%AE"><span class="nav-text">序列化协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E6%80%A7%E8%AF%B4%E6%98%8E"><span class="nav-text">特性说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%8F%E8%AE%AE%E9%80%89%E6%8B%A9"><span class="nav-text">协议选择</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-text">使用方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">注解配置方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#XML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">XML 配置方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83"><span class="nav-text">多版本发布</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E6%80%A7%E8%AF%B4%E6%98%8E-1"><span class="nav-text">特性说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-1"><span class="nav-text">注解配置方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#XML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-1"><span class="nav-text">XML 配置方式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E6%B3%A8%E5%86%8C"><span class="nav-text">多注册中心注册</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E6%80%A7%E8%AF%B4%E6%98%8E-2"><span class="nav-text">特性说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F-1"><span class="nav-text">使用方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#YML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">YML 配置方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#XML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-2"><span class="nav-text">XML 配置方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%E5%8F%91%E5%B8%83"><span class="nav-text">多通信协议发布</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E6%80%A7%E8%AF%B4%E6%98%8E-3"><span class="nav-text">特性说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%8F%E8%AE%AE%E9%80%89%E6%8B%A9-1"><span class="nav-text">协议选择</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F-2"><span class="nav-text">使用方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-2"><span class="nav-text">注解配置方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#XML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-3"><span class="nav-text">XML 配置方式</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">796</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">56</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/fab9c84c.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Dubbo 2 入门教程之三 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 Dubbo 的入门教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Dubbo 2 入门教程之三</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-07-10 23:42:35" itemprop="dateCreated datePublished" datetime="2019-07-10T23:42:35+08:00">2019-07-10</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-07-10 23:42:35" itemprop="dateModified" datetime="2025-07-10T23:42:35+08:00">2025-07-10</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/fab9c84c.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/fab9c84c.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>4.8k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>4 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/d484ffa3.html">Dubbo 2 入门教程之一</a>、<a href="/posts/ad584707.html">Dubbo 2 入门教程之二</a>、<a href="/posts/fab9c84c.html">Dubbo 2 入门教程之三</a></li><li><a href="/posts/b66ba452.html">Dubbo 2 入门教程之四</a>、<a href="/posts/ab89c617.html">Dubbo 2 入门教程之五</a>、<a href="/posts/ad900e14.html">Dubbo 2 入门教程之六</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h3><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/incubator-dubbo/">Dubbo 官方项目（GitHub）</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-samples">Dubbo 官方案例（GitHub）</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docsv2.7/">Dubbo 官方文档（2.7 版本）</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docs/">Dubbo 官方文档（快照版本）</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/">Dubbo 官方文档（最新版本）</a></li></ul><span id="more"></span><h2 id="Dubbo-核心特性"><a href="#Dubbo-核心特性" class="headerlink" title="Dubbo 核心特性"></a>Dubbo 核心特性</h2><h3 id="序列化协议"><a href="#序列化协议" class="headerlink" title="序列化协议"></a>序列化协议</h3><div class="admonition note"><p class="admonition-title">Java 序列化库性能测试</p><ul><li>各种 Java 的序列化库的性能测试比较结果可以看 <a target="_blank" rel="external nofollow" href="https://www.51cto.com/article/480273.html">这里</a> 或者 <a target="_blank" rel="external nofollow" href="https://github.com/eishay/jvm-serializers/wiki">GitHub Wiki</a>。</li></ul></div><h4 id="特性说明"><a href="#特性说明" class="headerlink" title="特性说明"></a>特性说明</h4><p><img data-src="../../../asset/2025/01/dubbo-1.png"></p><ul><li>Dubbo 内部已经将序列化和反序列化的过程封装起来了。</li><li>开发者只需要在定义 POJO 类时实现 <code>Seria1izable</code> 接口，这样就可以使用 Dubbo 提供的序列化机制。</li><li>在企业开发中，一般会定义一个公共的 POJO 模块或者 API 模块，让生产者和消费者都依赖该模块。</li></ul><h4 id="协议选择"><a href="#协议选择" class="headerlink" title="协议选择"></a>协议选择</h4><ul><li>Dubbo 支持的序列化协议</li></ul><table><thead><tr><th>序列化协议</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td> Hessian2（默认协议）</td><td>- 跨语言支持好<br>- 二进制序列化，协议紧凑<br>- 使用简单，Dubbo 原生支持</td><td> - 性能中等，不是最高<br>- 不支持对象引用共享</td><td>默认通用场景，适合大多数 RPC 调用</td></tr><tr><td> FastJson（JSON 格式）</td><td>- 可读性强，易于调试<br>- 跨语言方便，尤其适合前端交互</td><td> - 文本冗余，体积大<br>- 性能低于二进制序列化协议（如 Hessian、Protobuf）</td><td>需要与前端或非 Java 系统交互，或调试、日志记录场景</td></tr><tr><td> GSON（JSON 格式）</td><td>- 可读性强，易于调试<br>- 跨语言方便，尤其适合前端交互</td><td> - 文本冗余，体积大<br>- 性能低于二进制序列化协议（如 Hessian、Protobuf）</td><td>需要与前端或非 Java 系统交互，或调试、日志记录场景</td></tr><tr><td> Kryo</td><td>- 高性能，二进制序列化速度快<br>- 体积小<br>- 支持对象图</td><td> - 不支持跨语言<br>- 需要手动注册类才能获得最佳性能</td><td>内部 Java 服务之间的高性能 RPC 调用，大数据领域用得较多</td></tr><tr><td> FST（Fast-Serialization）</td><td>- 二进制序列化速度快，性能接近 Kryo<br>- 使用更简单</td><td> - 不支持跨语言<br>- 对类版本变化敏感</td><td>内部 Java 服务之间的高性能 RPC 调用</td></tr><tr><td> Protobuf（Google Protocol Buffers）</td><td>- 高性能，二进制序列化速度快<br>- 体积小<br>- 强类型定义<br>- 跨语言支持好</td><td> - 需要 <code>.proto</code> 文件定义<br>- 学习成本高</td><td>跨语言、高性能 RPC 或需要协议稳定性的场景</td></tr><tr><td> Protostuff（基于 Protobuf）</td><td>- 高性能二进制序列化，速度快、体积小<br>- 无需 <code>.proto</code> 文件定义，直接支持 Java POJO<br>- 序列化 / 反序列化效率显著高于 Hessian2</td><td>- 仅适用于 Java 环境（不支持跨语言）<br>- 对象类结构变化后兼容性较差（需保持字段一致）</td><td>对性能要求高的 Java 内部服务调用，如高并发、高吞吐的微服务场景</td></tr><tr><td> Avro</td><td>- Hadoop 的子项目<br>- 支持动态 Schema<br>- 跨语言支持好<br>- 二进制序列化</td><td> - 性能不如 Protobuf<br>- 使用复杂</td><td>大数据场景，如 Kafka、Hadoop，需要动态 Schema</td></tr><tr><td>Java 原生序列化</td><td> - Java 原生支持，无需额外依赖<br>- 保留完整对象结构<br>- 二进制序列化</td><td> - 体积大，性能低<br>- 安全性差（反序列化漏洞风险高）<br>- 不支持跨语言</td><td>仅用于内部 Java 服务调试或原型验证，不建议生产使用</td></tr></tbody></table><ul><li> Dubbo 序列化协议的选择建议</li></ul><table><thead><tr><th>场景</th><th>推荐的序列化协议</th><th>说明</th></tr></thead><tbody><tr><td>默认场景（通用 RPC 调用）</td><td>Hessian2</td><td>Dubbo 默认的序列化协议，跨语言支持好、易用，性能中等，适合大多数场景</td></tr><tr><td> Java 内部高性能 RPC 调用</td><td> Protostuff、Kryo、FST</td><td> 二进制序列化速度快、体积小，适合 Java 内部服务之间的高性能调用</td></tr><tr><td>跨语言且追求极致性能</td><td> Protobuf</td><td> 高性能、体积小、跨语言支持好，但需要 <code>.proto</code> 文件定义，学习成本较高</td></tr><tr><td>调试或日志场景</td><td> FastJson</td><td> 可读性强，易于调试，适合调试、日志记录或与前端交互，但性能较低</td></tr><tr><td>不建议使用</td><td> Java 原生序列化</td><td>性能低、体积大、安全性差（反序列化漏洞风险高），仅适合内部调试或原型验证</td></tr></tbody></table><div class="admonition note"><p class="admonition-title">Dubbo 支持多端口多序列化协议</p><ul><li>如果同一个服务需要支持多种序列化协议，可以通过不同 <code>&lt;dubbo:protocol&gt;</code> 配置多个端口，比如：<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">port</span>=<span class="string">"20881"</span> <span class="attr">serialization</span>=<span class="string">"kryo"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">port</span>=<span class="string">"20880"</span> <span class="attr">serialization</span>=<span class="string">"hessian2"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure></li></ul></div><h4 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h4><h5 id="注解配置方式"><a href="#注解配置方式" class="headerlink" title="注解配置方式"></a>注解配置方式</h5><ul><li>服务提供者定义通信协议</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="comment"># 服务信息</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-provider-application</span></span><br><span class="line">  <span class="comment"># 注册中心地址</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">zookeeper://127.0.0.1:2181</span></span><br><span class="line">  <span class="comment"># 服务提供者的通信协议</span></span><br><span class="line">  <span class="attr">protocol:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo</span>                 <span class="comment"># 使用 Dubbo 作为通信协议</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">20880</span>                 <span class="comment"># 监听端口</span></span><br><span class="line">    <span class="attr">serialization:</span> <span class="string">hessian2</span>     <span class="comment"># 使用 Hessian2 作为序列化协议</span></span><br></pre></td></tr></tbody></table></figure><ul><li>服务提供者暴露服务</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DubboService</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>{ }</span><br></pre></td></tr></tbody></table></figure><ul><li>服务消费者引用服务</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用 Hessian2 作为序列化协议</span></span><br><span class="line"><span class="meta">@DubboReference(protocol = "dubbo", serialization = "hessian2")</span></span><br><span class="line"><span class="keyword">private</span> UserService userService;</span><br></pre></td></tr></tbody></table></figure><ul><li>在服务消费者中，还可以全局指定通信协议和序列化协议，这样就不需要在每个 <code>@DubboReference</code> 注解中单独指定</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="comment"># 服务信息</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-consumer-application</span></span><br><span class="line">  <span class="comment"># 注册中心地址</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">zookeeper://127.0.0.1:2181</span></span><br><span class="line">  <span class="comment"># 服务消费者的通信协议</span></span><br><span class="line">  <span class="attr">protocol:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo</span>                 <span class="comment"># 使用 Dubbo 作为通信协议</span></span><br><span class="line">    <span class="attr">serialization:</span> <span class="string">hessian2</span>     <span class="comment"># 使用 Hessian2 作为序列化协议</span></span><br></pre></td></tr></tbody></table></figure><h5 id="XML-配置方式"><a href="#XML-配置方式" class="headerlink" title="XML 配置方式"></a>XML 配置方式</h5><ul><li>服务提供者定义协议</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置服务应用名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"dubbo-provider-application"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 注册中心配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">"zookeeper://127.0.0.1:2181"</span> <span class="attr">timeout</span>=<span class="string">"5000"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用 Hessian2 作为序列化协议 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">port</span>=<span class="string">"20880"</span> <span class="attr">serialization</span>=<span class="string">"hessian2"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>服务提供者暴露服务</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 服务实现类 Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.example.service.impl.UserServiceImpl"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 声明要暴露的服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.example.service.UserService"</span> <span class="attr">ref</span>=<span class="string">"userServiceImpl"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>服务消费者引用服务</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引用远程服务，并使用 Hessian2 作为序列化协议 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">interface</span>=<span class="string">"com.example.service.UserService"</span> <span class="attr">protocol</span>=<span class="string">"dubbo"</span> <span class="attr">serialization</span>=<span class="string">"hessian2"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="多版本发布"><a href="#多版本发布" class="headerlink" title="多版本发布"></a>多版本发布</h3><h4 id="特性说明-1"><a href="#特性说明-1" class="headerlink" title="特性说明"></a>特性说明</h4><p><img data-src="../../../asset/2025/01/dubbo-5.png"></p><p>在 Dubbo 中使用 <code>version</code> 属性来设置同一个接口的不同版本（即同一个接口有的不同实现类）时，会有多个不同版本的服务被注册到注册中心，如下图所示：</p><p><img data-src="../../../asset/2025/01/dubbo-6.png"></p><div class="admonition note"><p class="admonition-title">提示</p><p>Dubbo 的多版本机制可以用于实现灰度发布功能。当发布新功能（新版本）时，会让一部分用户先使用新功能（新版本），用户反馈没问题后，再将新功能（新版本）应用到所有用户。</p></div><h4 id="注解配置方式-1"><a href="#注解配置方式-1" class="headerlink" title="注解配置方式"></a>注解配置方式</h4><ul><li>第一步：服务提供者配置多版本（即同一个接口有多个不同的实现类）</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 暴露 Dubbo 服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DubboService(version = "1.0")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>{</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(Long id)</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"===&gt; invoke getById() v1.0"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(id, <span class="string">"Peter"</span>, <span class="number">18</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 暴露 Dubbo 服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DubboService(timeout = 1000, retries = 3, version = "2.0")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl2</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(Long id)</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">"===&gt; invoke getById() v2.0"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(id, <span class="string">"Peter"</span>, <span class="number">18</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>第二步：服务消费者调用指定版本</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 引用 Dubbo 服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DubboReference(version = "2.0")</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/getById/{id}")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(<span class="meta">@PathVariable("id")</span> Long id)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> userService.getById(id);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="XML-配置方式-1"><a href="#XML-配置方式-1" class="headerlink" title="XML 配置方式"></a>XML 配置方式</h4><ul><li>第一步：服务提供者配置多版本（即同一个接口有多个不同的实现类）</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 服务实现类 Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">class</span>=<span class="string">"com.clay.dubbo.provider.service.DemoServiceImpl"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demoService2"</span> <span class="attr">class</span>=<span class="string">"com.clay.dubbo.provider.service.DemoServiceImpl2"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 声明要暴露的服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.clay.dubbo.service.DemoService"</span> <span class="attr">ref</span>=<span class="string">"demoService"</span> <span class="attr">version</span>=<span class="string">"1.0"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.clay.dubbo.service.DemoService"</span> <span class="attr">ref</span>=<span class="string">"demoService2"</span> <span class="attr">version</span>=<span class="string">"2.0"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>第二步：服务消费者调用指定版本</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引用远程服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">interface</span>=<span class="string">"com.clay.dubbo.service.DemoService"</span> <span class="attr">version</span>=<span class="string">"2.0"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="多注册中心注册"><a href="#多注册中心注册" class="headerlink" title="多注册中心注册"></a>多注册中心注册</h3><h4 id="特性说明-2"><a href="#特性说明-2" class="headerlink" title="特性说明"></a>特性说明</h4><blockquote><p>多注册中心的概述</p></blockquote><ul><li>Dubbo 支持同一个服务向多个注册中心同时注册，或者不同的服务分别注册到不同的注册中心上去，甚至可以同时引用注册在不同注册中心上的同名服务。</li></ul><blockquote><p>多注册中心的使用</p></blockquote><ul><li>同一个服务注册到不同的注册中心。比如：中文站有些服务来不及在青岛部署，只在杭州部署，而青岛的其它应用需要引用此服务，就可以将青岛的服务同时注册到两个注册中心，具体配置如下图所示：</li></ul><p><img data-src="../../../asset/2025/09/dubbo-config-10.png"></p><ul><li>不同的服务注册到不同的注册中心。比如：CRM 系统中有些服务是专门为国际站设计的，有些服务是专门为中文站设计的，具体配置如下图所示：</li></ul><p><img data-src="../../../asset/2025/09/dubbo-config-11.png"></p><ul><li>单独引用不同注册中心的服务。比如：CRM 系统中需要同时调用中文站和国际站的 PC2 服务，而 PC2 服务在中文站和国际站均有部署，接口及版本号都一样，但连接的数据库不一样，具体配置如下图所示：</li></ul><p><img data-src="../../../asset/2025/09/dubbo-config-12.png"></p><ul><li>同时引用不同注册中心的同名服务，可以使用竖号分隔多个不同注册中心地址。比如：CRM 系统中需要同时调用中文站和国际站的 Pay 服务，而 Pay 服务在中文站和国际站均有部署，接口及版本号都一样，连接的数据库也一样，具体配置如下图所示：</li></ul><p><img data-src="../../../asset/2025/09/dubbo-config-13.png"></p><blockquote><p>一个服务多个注册中心的应用场景</p></blockquote><p><img data-src="../../../asset/2025/09/dubbo-config-14.png"></p><blockquote><p>Dubbo 支持的注册中心类型</p></blockquote><p>Dubbo 支持的注册中心有以下几种（不限于）：</p><p><img data-src="../../../asset/2025/09/dubbo-config-9.png"></p><div class="admonition note"><p class="admonition-title">Dubbo 3 支持的注册中心类型</p><p>在 Dubbo 3 中，默认支持 ZooKeeper 与 Nacos 作为注册中心，而且 Dubbo 扩展生态提供了 Consul、Etcd、Redis、Multicast 等注册中心的扩展实现，还支持 Kubernetes、Mesh 体系的服务发现。</p></div><h4 id="使用方式-1"><a href="#使用方式-1" class="headerlink" title="使用方式"></a>使用方式</h4><h5 id="YML-配置方式"><a href="#YML-配置方式" class="headerlink" title="YML 配置方式"></a>YML 配置方式</h5><ul><li>定义注册中心的方式一（适用于注册中心不同协议、不同集群的混合配置场景）</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="comment"># 多注册中心配置</span></span><br><span class="line">  <span class="attr">registries:</span></span><br><span class="line">    <span class="attr">chinaRegistry:</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">zookeeper</span></span><br><span class="line">      <span class="attr">address:</span> <span class="number">10.20</span><span class="number">.141</span><span class="number">.150</span><span class="string">:2181</span></span><br><span class="line">      <span class="attr">default:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">intlRegistry:</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">nacos</span></span><br><span class="line">      <span class="attr">address:</span> <span class="number">10.20</span><span class="number">.154</span><span class="number">.177</span><span class="string">:8848</span> </span><br><span class="line">      <span class="attr">default:</span> <span class="literal">false</span></span><br></pre></td></tr></tbody></table></figure><ul><li>定义注册中心的方式二（适用于不同注册中心均为同一协议类型的场景）</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="comment"># 多注册中心配置</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">zookeeper</span></span><br><span class="line">    <span class="attr">address:</span> <span class="number">10.20</span><span class="number">.141</span><span class="number">.150</span><span class="string">:2181|10.20.145.136:2181</span></span><br></pre></td></tr></tbody></table></figure><ul><li>服务提供者暴露服务</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个接口向中文站注册中心注册服务</span></span><br><span class="line"><span class="meta">@DubboService(registry = "chinaRegistry")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServiceImpl</span> <span class="keyword">implements</span> <span class="title">HelloService</span> </span>{ }</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个接口向国际站注册中心注册服务</span></span><br><span class="line"><span class="meta">@DubboService(registry = "intlRegistry")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoServiceImpl</span> <span class="keyword">implements</span> <span class="title">DemoService</span> </span>{ }</span><br></pre></td></tr></tbody></table></figure><ul><li>服务消费者引用服务</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个接口引用中文站注册中心里的服务</span></span><br><span class="line"><span class="meta">@DubboReference(registry = "chinaRegistry")</span></span><br><span class="line"><span class="keyword">private</span> HelloService helloService;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个接口引用国际站注册中心里的服务</span></span><br><span class="line"><span class="meta">@DubboReference(registry = "intlRegistry")</span></span><br><span class="line"><span class="keyword">private</span> DemoService demoService;</span><br></pre></td></tr></tbody></table></figure><h5 id="XML-配置方式-2"><a href="#XML-配置方式-2" class="headerlink" title="XML 配置方式"></a>XML 配置方式</h5><ul><li>定义注册中心的方式一（适用于注册中心不同协议、不同集群的混合配置场景）</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 多注册中心配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">id</span>=<span class="string">"chinaRegistry"</span> <span class="attr">protocol</span>=<span class="string">"zookeeper"</span> <span class="attr">address</span>=<span class="string">"10.20.141.150:2181"</span> <span class="attr">default</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">id</span>=<span class="string">"intlRegistry"</span> <span class="attr">protocol</span>=<span class="string">"nacos"</span> <span class="attr">address</span>=<span class="string">"10.20.154.177:8848 "</span> <span class="attr">default</span>=<span class="string">"false"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>定义注册中心的方式二（适用于不同注册中心均为同一协议类型的场景）</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">protocol</span>=<span class="string">"zookeeper"</span> <span class="attr">address</span>=<span class="string">"10.20.141.150:2181|10.20.145.136:2181"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>服务提供者暴露服务</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 向中文站注册中心注册服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.clay.api.HelloService"</span> <span class="attr">ref</span>=<span class="string">"helloService"</span> <span class="attr">registry</span>=<span class="string">"chinaRegistry"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 向国际站注册中心注册服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.clay.api.DemoService"</span> <span class="attr">ref</span>=<span class="string">"demoService"</span> <span class="attr">registry</span>=<span class="string">"intlRegistry"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>服务消费者引用服务</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这个接口引用中文站注册中心里的服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"helloService"</span> <span class="attr">interface</span>=<span class="string">"com.example.api.HelloService"</span> <span class="attr">registry</span>=<span class="string">"chinaRegistry"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 这个接口引用国际站注册中心里的服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">interface</span>=<span class="string">"com.example.api.DemoService"</span> <span class="attr">registry</span>=<span class="string">"intlRegistry"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="多通信协议发布"><a href="#多通信协议发布" class="headerlink" title="多通信协议发布"></a>多通信协议发布</h3><h4 id="特性说明-3"><a href="#特性说明-3" class="headerlink" title="特性说明"></a>特性说明</h4><p><img data-src="../../../asset/2025/07/dubbo-multi-protocol.png"></p><ul><li><p>多端口多通信协议</p><ul><li>多通信协议发布是指为同一个服务同时提供多种通信协议访问方式，多通信协议可以是任意两个或多个通信协议的组合。</li><li>比如：一个服务基于不同的端口同时支持 <code>dubbo</code> + <code>rest</code> 通信协议。<ul><li>服务提供者实例同时监听两个端口 <code>20880</code> 和 <code>8080</code>。</li><li>同一个服务提供者实例，会在注册中心注册两条地址 URL。</li><li>不同的消费端可以选择以不同通信协议调用同一个提供者发布的服务。</li></ul></li><li>对于消费端而言，如果用户没有明确配置，默认情况下 Dubbo 框架会自动选择 <code>dubbo</code> 通信协议调用。</li><li>Dubbo 框架支持配置通过哪个通信协议访问服务，如 <code>@DubboReference (protocol="rest")</code>，或者在 <code>application.yml</code> 配置文件中指定全局默认值：<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">consumer:</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">rest</span></span><br></pre></td></tr></tbody></table></figure></li></ul></li><li><p>单端口多通信协议</p><ul><li>Dubbo 3 除了支持多端口多通信协议、注册多条 URL 到注册中心的方式，对于 <code>dubbo</code>、<code>triple</code> 这两个内置通信协议，还提供了在单个端口上同时支持 <code>dubbo</code> 和 <code>triple</code> 通信协议的能力，具体配置方式如下所示。</li><li>这对于老用户来说是一个非常重要的能力，因为它可以做到不增加任何负担的情况下，让使用 <code>dubbo</code> 通信协议的用户可以额外发布 <code>triple</code> 通信协议，这样当所有的应用都实现多通信协议发布之后，就可以设置消费端去通过 <code>triple</code> 通信协议发起调用了。<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">//</span> <span class="string">在单个端口上，同时支持</span> <span class="string">dubbo</span> <span class="string">和</span> <span class="string">triple</span> <span class="string">通信协议</span></span><br><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">protocol:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo</span></span><br><span class="line">    <span class="attr">ext-protocol:</span> <span class="string">tri</span></span><br></pre></td></tr></tbody></table></figure></li></ul></li></ul><h4 id="协议选择-1"><a href="#协议选择-1" class="headerlink" title="协议选择"></a>协议选择</h4><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>Dubbo 支持多种通信协议，在 <code>3.0</code> 版本之前支持 Dubbo、gRPC、Hessian2、REST 等核心通信协议。</li><li>从 Dubbo <code>3.0</code> 开始，Dubbo 官方新引入了自研的 Triple 通信协议，不过也保留了 Dubbo 和 REST 通信协议的支持。</li><li>从 Dubbo <code>3.2</code> 开始，Dubbo 官方已经废弃原有的 gRPC 通信协议，使用 Triple 通信协议进行替代，Triple 通信协议完全兼容 gRPC 通信协议。</li><li>从 Dubbo <code>3.3</code> 开始，Dubbo 官方直接移除了 REST 通信协议的直接支持，使用 Triple 通信协议间接支持 REST 通信协议。</li></ul></div><ul><li>Dubbo 3 支持的通信协议</li></ul><table><thead><tr><th>通信协议</th><th>通信协议名 / 标识</th><th>传输层</th><th>核心特性</th><th>适用场景</th><th>是否为默认通信协议</th></tr></thead><tbody><tr><td> Dubbo 通信协议</td><td><code>dubbo</code></td><td>TCP</td><td> 单一长连接、NIO 异步通信、高性能</td><td>高并发小数据量场景（消费者数 &gt;&gt; 提供者）</td><td>是</td></tr><tr><td> Triple 通信协议</td><td><code>tri</code></td><td>HTTP/2</td><td> 兼容 gRPC 生态、支持流式通信、跨语言能力增强</td><td>多语言交互、流式数据传输</td><td>否</td></tr><tr><td> REST 通信协议</td><td><code>rest</code></td><td>HTTP</td><td> 严格遵循 RESTful 规范、支持 JSON/XML 格式</td><td>浏览器调用、跨平台集成</td><td>否</td></tr><tr><td> gRPC 通信协议</td><td><code>grpc</code></td><td>HTTP/2</td><td>Google 开源 RPC 框架、高性能跨语言通信</td><td>跨语言高性能服务调用</td><td>否</td></tr><tr><td> Thrift 通信协议</td><td><code>thrift</code></td><td>TCP</td><td>Apache 开源 RPC 框架、强类型接口定义</td><td>多语言服务交互</td><td>否</td></tr><tr><td> Hessian 通信协议</td><td><code>hessian</code></td><td>HTTP</td><td> 表单序列化、短连接、传输效率优于 WebService</td><td> 文件 / 视频等大数据传输</td><td>否</td></tr><tr><td> HTTP 通信协议</td><td><code>http</code></td><td>HTTP</td><td> 通用同步传输、支持表单序列化</td><td>混合数据大小场景</td><td>否</td></tr><tr><td> Redis 通信协议</td><td><code>redis</code></td><td>文本通信协议</td><td>基于 Redis 的轻量级通信</td><td>缓存操作、简单消息队列</td><td>否</td></tr><tr><td> MQTT 通信协议</td><td><code>mqtt</code></td><td>TCP</td><td> 发布 / 订阅模式、低带宽占用</td><td>物联网设备通信</td><td>否</td></tr><tr><td> WebService</td><td><code>webservice</code></td><td>HTTP</td><td> 基于 SOAP 通信协议、XML 序列化</td><td>传统企业系统集成</td><td>否</td></tr></tbody></table><ul><li>通信协议的选择对比</li></ul><table><thead><tr><th>维度</th><th> Triple</th><th>Dubbo</th><th>REST</th><th>gRPC</th></tr></thead><tbody><tr><td> 性能</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐⭐</td></tr><tr><td>跨语言</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td>流式通信</td><td>支持</td><td>不支持</td><td>不支持</td><td>支持</td></tr><tr><td>浏览器兼容</td><td>支持</td><td>不支持</td><td>直接支持</td><td>需要依赖 Gateway（网关）</td></tr><tr><td>配置复杂度</td><td>低</td><td>低</td><td>中</td><td>高</td></tr></tbody></table><ul><li>通信协议使用的注意事项</li></ul><table><thead><tr><th>问题</th><th>解决方案</th></tr></thead><tbody><tr><td> gRPC 通信协议浏览器无法直接调用</td><td>通过 API Gateway（如 gRPC-Gateway）转换 HTTP 请求</td></tr><tr><td>序列化机制不一致</td><td> Triple 强制使用 Protobuf，其他通信协议使用 Protobuf 需要配置 <code>serialization="protobuf"</code></td></tr><tr><td>多通信协议端口冲突</td><td>确保每个通信协议使用的端口唯一</td></tr></tbody></table><h4 id="使用方式-2"><a href="#使用方式-2" class="headerlink" title="使用方式"></a>使用方式</h4><h5 id="注解配置方式-2"><a href="#注解配置方式-2" class="headerlink" title="注解配置方式"></a>注解配置方式</h5><ul><li>服务提供者定义通信协议</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="comment"># 服务信息</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-provider-application</span></span><br><span class="line">  <span class="comment"># 注册中心地址</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">zookeeper://127.0.0.1:2181</span></span><br><span class="line">  <span class="comment"># 服务提供者的通信协议</span></span><br><span class="line">  <span class="attr">protocols:</span></span><br><span class="line">    <span class="comment"># Dubbo 通信协议</span></span><br><span class="line">    <span class="attr">dubbo-protocol:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">dubbo</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">20880</span></span><br><span class="line">    <span class="comment"># REST 通信协议</span></span><br><span class="line">    <span class="attr">rest-protocol:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">rest</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">7777</span></span><br><span class="line">      <span class="attr">server:</span> <span class="string">tomcat</span></span><br><span class="line">    <span class="comment"># Hessian 通信协议</span></span><br><span class="line">    <span class="attr">hessian-protocol:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">hessian</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8888</span></span><br><span class="line">      <span class="attr">server:</span> <span class="string">tomcat</span></span><br></pre></td></tr></tbody></table></figure><ul><li>服务提供者暴露服务</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个接口仅支持 Dubbo 通信协议</span></span><br><span class="line"><span class="meta">@DubboService(protocol = "dubbo")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderService</span> </span>{ }</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个接口仅支持 REST 通信协议</span></span><br><span class="line"><span class="meta">@DubboService(protocol = "rest")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoleServiceImpl</span> <span class="keyword">implements</span> <span class="title">RoleService</span> </span>{ }</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个接口仅支持 Hessian 通信协议</span></span><br><span class="line"><span class="meta">@DubboService(protocol = "hessian")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>{ }</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个接口支持 Dubbo 通信协议和 REST 通信协议</span></span><br><span class="line"><span class="meta">@DubboService(protocol = {"dubbo", "rest"})</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SystemServiceImpl</span> <span class="keyword">implements</span> <span class="title">SystemService</span> </span>{ }</span><br></pre></td></tr></tbody></table></figure><ul><li>服务消费者引用服务</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个接口使用 Dubbo 通信协议</span></span><br><span class="line"><span class="meta">@DubboReference(protocol = "dubbo")</span></span><br><span class="line"><span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个接口使用 REST 通信协议</span></span><br><span class="line"><span class="meta">@DubboReference(protocol = "rest")</span></span><br><span class="line"><span class="keyword">private</span> RoleService roleService;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个接口使用 Dubbo 通信协议和 REST 通信协议（多种通信协议使用逗号隔开），消费者默认会按 Dubbo -&gt; REST 的通信协议顺序尝试调用</span></span><br><span class="line"><span class="meta">@DubboReference(protocol = "dubbo,rest")</span></span><br><span class="line"><span class="keyword">private</span> SystemService systemService;</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">实战案例</p><ul><li><a href="/posts/f0051416.html">Dubbo 2 基于 SpringBoot 支持 REST 通信协议</a></li></ul></div><h5 id="XML-配置方式-3"><a href="#XML-配置方式-3" class="headerlink" title="XML 配置方式"></a>XML 配置方式</h5><ul><li>服务提供者定义通信协议</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置服务应用名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"dubbo-provider-application"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 注册中心配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">"zookeeper://127.0.0.1:2181"</span> <span class="attr">timeout</span>=<span class="string">"5000"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Dubbo 通信协议 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">port</span>=<span class="string">"20880"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- REST 通信协议 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"rest"</span> <span class="attr">port</span>=<span class="string">"7777"</span> <span class="attr">server</span>=<span class="string">"tomcat"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Hessian 通信协议 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"hessian"</span> <span class="attr">port</span>=<span class="string">"8888"</span> <span class="attr">server</span>=<span class="string">"tomcat"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>服务提供者暴露服务</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这个接口仅支持 Dubbo 通信协议 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.example.api.OrderService"</span> <span class="attr">ref</span>=<span class="string">"orderServiceImpl"</span> <span class="attr">protocol</span>=<span class="string">"dubbo"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 这个接口仅支持 REST 通信协议 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.example.api.RoleService"</span> <span class="attr">ref</span>=<span class="string">"roleServiceImpl"</span> <span class="attr">protocol</span>=<span class="string">"rest"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 这个接口仅支持 Hessian 通信协议 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.example.api.UserService"</span> <span class="attr">ref</span>=<span class="string">"userServiceImpl"</span> <span class="attr">protocol</span>=<span class="string">"hessian"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 这个接口支持 Dubbo 通信协议和 REST 通信协议（多种通信协议使用逗号隔开） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.example.api.SystemService"</span> <span class="attr">ref</span>=<span class="string">"systemServiceImpl"</span> <span class="attr">protocol</span>=<span class="string">"dubbo,rest"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>服务消费者引用服务</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这个接口使用 Dubbo 通信协议 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"orderService"</span> <span class="attr">interface</span>=<span class="string">"com.example.api.OrderService"</span> <span class="attr">protocol</span>=<span class="string">"dubbo"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 这个接口使用 REST 通信协议 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"roleService"</span> <span class="attr">interface</span>=<span class="string">"com.example.api.RoleService"</span> <span class="attr">protocol</span>=<span class="string">"rest"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 这个接口使用 Dubbo 通信协议和 REST 通信协议（多种通信协议使用逗号隔开），消费者默认会按 Dubbo -&gt; REST 的通信协议顺序尝试调用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"systemService"</span> <span class="attr">interface</span>=<span class="string">"com.example.api.SystemService"</span> <span class="attr">protocol</span>=<span class="string">"dubbo,rest"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">实战案例</p><ul><li><a href="/posts/fd250e35.html#Spring-%E4%B8%8E-SpringMVC-%E9%A1%B9%E7%9B%AE">Dubbo 2 基于 Spring 与 SpringMVC 支持 REST 通信协议</a></li></ul></div><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docsv2.7/user/examples/">Dubbo 官方文档（2.7 版本）- 特性示例</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/more/">Dubbo 官方文档（最新版本）- 更多特性</a></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/fab9c84c.html" title="Dubbo 2 入门教程之三">https://www.techgrow.cn/posts/fab9c84c.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag"><i class="fa fa-tag"></i> 微服务</a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a><a href="/tags/RPC/" rel="tag"><i class="fa fa-tag"></i> RPC</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/a6aa7529.html" rel="prev" title="数据库读写分离解决方案介绍"><i class="fa fa-angle-left"></i> 数据库读写分离解决方案介绍</a></div><div class="post-nav-item"> <a href="/posts/2cbf33d2.html" rel="next" title="MyBatis-Plus 入门教程之四">MyBatis-Plus 入门教程之四<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2026</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2.4m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">35:37</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"/lib/mathjax/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/js/third-party/math/mathjax.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/fab9c84c.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div><div id="moon-menu-item-code" class="moon-menu-item"><i class="fa-solid fa-code"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>