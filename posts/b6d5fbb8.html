<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 Dubbo 的巩固教程。"><meta property="og:type" content="article"><meta property="og:title" content="Dubbo 2 巩固教程之二"><meta property="og:url" content="https://www.techgrow.cn/posts/b6d5fbb8.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 Dubbo 的巩固教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-9.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/dubbo-12.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-10.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-11.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-12.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-13.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-14.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-registry-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-registry-3.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-3.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-4.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-5.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-6.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-7.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-8.png"><meta property="article:published_time" content="2019-09-15T15:42:35.000Z"><meta property="article:modified_time" content="2025-09-15T15:42:35.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="微服务"><meta property="article:tag" content="分布式"><meta property="article:tag" content="RPC"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-config-9.png"><link rel="canonical" href="https://www.techgrow.cn/posts/b6d5fbb8.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/b6d5fbb8.html","path":"posts/b6d5fbb8.html","title":"Dubbo 2 巩固教程之二"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Dubbo 2 巩固教程之二 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90"><span class="nav-text">学习资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3"><span class="nav-text">Dubbo 深入理解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E5%BB%BA%E8%AE%AE"><span class="nav-text">学习建议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%E4%BB%A3%E7%90%86"><span class="nav-text">接口代理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%E4%BB%A3%E7%90%86%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="nav-text">接口代理的底层实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%AF%E6%8C%81%E7%9A%84%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E7%AD%96%E7%95%A5"><span class="nav-text">支持的动态代理策略</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="nav-text">注册中心</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%AF%E6%8C%81%E7%9A%84%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="nav-text">支持的注册中心</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ZK-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E4%BD%BF%E7%94%A8"><span class="nav-text">ZK 注册中心使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E6%B3%A8%E5%86%8C"><span class="nav-text">多注册中心注册</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E7%9A%84%E6%89%A9%E5%B1%95"><span class="nav-text">注册中心的扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E6%8E%A5%E5%8F%A3"><span class="nav-text">扩展接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SPI-%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6"><span class="nav-text">SPI 扩展机制</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD"><span class="nav-text">配置加载</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Dubbo-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%9D%A5%E6%BA%90"><span class="nav-text">Dubbo 的配置来源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dubbo-%E7%9A%84%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="nav-text">Dubbo 的核心配置类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E9%85%8D%E7%BD%AE%E7%B1%BB%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-text">不同配置类之间的关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E7%B2%92%E5%BA%A6%E9%85%8D%E7%BD%AE%E7%9A%84%E8%A6%86%E7%9B%96%E5%85%B3%E7%B3%BB"><span class="nav-text">不同粒度配置的覆盖关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E8%A6%86%E7%9B%96%E5%85%B3%E7%B3%BB"><span class="nav-text">不同配置文件的覆盖关系</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E9%A1%B9%E5%88%86%E7%B1%BB%E5%92%8C%E9%85%8D%E7%BD%AE%E9%A1%B9%E6%A0%BC%E5%BC%8F"><span class="nav-text">配置项分类和配置项格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dubbo-%E6%94%AF%E6%8C%81%E7%9A%84-XML-%E9%85%8D%E7%BD%AE%E6%A0%87%E7%AD%BE"><span class="nav-text">Dubbo 支持的 XML 配置标签</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dubbo-%E7%9A%84%E5%A4%96%E9%83%A8%E5%8C%96%E9%85%8D%E7%BD%AE%EF%BC%88%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%EF%BC%89"><span class="nav-text">Dubbo 的外部化配置（配置中心）</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">742</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/b6d5fbb8.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Dubbo 2 巩固教程之二 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 Dubbo 的巩固教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Dubbo 2 巩固教程之二</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-09-15 23:42:35" itemprop="dateCreated datePublished" datetime="2019-09-15T23:42:35+08:00">2019-09-15</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-09-15 23:42:35" itemprop="dateModified" datetime="2025-09-15T23:42:35+08:00">2025-09-15</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/b6d5fbb8.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/b6d5fbb8.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>7.7k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>7 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/d484ffa3.html">Dubbo 2 入门教程之一</a>、<a href="/posts/ad584707.html">Dubbo 2 入门教程之二</a>、<a href="/posts/fab9c84c.html">Dubbo 2 入门教程之三</a>、<a href="/posts/b66ba452.html">Dubbo 2 入门教程之四</a>、<a href="/posts/ab89c617.html">Dubbo 2 入门教程之五</a></li><li><a href="/posts/ef04d10a.html">Dubbo 2 巩固教程之一</a>、<a href="/posts/b6d5fbb8.html">Dubbo 2 巩固教程之二</a>、<a href="/posts/ea9ce835.html">Dubbo 2 巩固教程之三</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h3><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/incubator-dubbo/">Dubbo 官方项目</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/">Dubbo 官方文档</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-samples">Dubbo 官方案例</a></li></ul><span id="more"></span><h2 id="Dubbo-深入理解"><a href="#Dubbo-深入理解" class="headerlink" title="Dubbo 深入理解"></a>Dubbo 深入理解</h2><h3 id="学习建议"><a href="#学习建议" class="headerlink" title="学习建议"></a>学习建议</h3><ul><li><p>学习内容</p><ul><li>基于接口代理、注册中心、配置加载</li></ul></li><li><p>学习方法</p><ul><li><code>接口代理</code>：Dubbo 的接口代理是如何实现的？</li><li><code>注册中心</code>：Dubbo 在 Zookeeper 上面干了什么？</li><li><code>配置加载</code>：Dubbo 配置加载流程、不同粒度配置的覆盖关系是怎样？</li></ul></li></ul><div class="admonition warning"><p class="admonition-title">特别注意</p><p>在学习 Dubbo 的底层源码时，建议使用<a href="/posts/d484ffa3.html#%E5%8E%9F%E7%94%9F-API-%E6%96%B9%E5%BC%8F%E4%BD%BF%E7%94%A8-Dubbo">原生 API 的方式</a>来使用 Dubbo，这样更容易探寻 Dubbo 内部细节的入口。</p></div><h3 id="接口代理"><a href="#接口代理" class="headerlink" title="接口代理"></a>接口代理</h3><h4 id="接口代理的底层实现"><a href="#接口代理的底层实现" class="headerlink" title="接口代理的底层实现"></a>接口代理的底层实现</h4><ul><li>Dubbo 接口代理的底层源码<ul><li> Dubbo 基于接口的代理实现<ul><li><code>ReferenceConfig.get()</code> -&gt; <code>ReferenceConfig.init()</code> -&gt; <code>ReferenceConfig.createProxy()</code> -&gt; <code>StubProxyFactoryWrapper.getProxy()</code> -&gt; <code>JavassistProxyFactory.getProxy()</code> -&gt; <code>DubboInvoker.doInvoke()</code></li></ul></li><li>Nettty 在远程过程调用的应用<ul><li><code>NettyClient.doOpen()</code> -&gt; <code>NettyClientHandler</code></li><li><code>NettyServer.doOpen()</code> -&gt; <code>NettyHandler</code></li></ul></li></ul></li></ul><h4 id="支持的动态代理策略"><a href="#支持的动态代理策略" class="headerlink" title="支持的动态代理策略"></a>支持的动态代理策略</h4><ul><li><p>Dubbo 支持的动态代理策略有以下三种</p><ul><li>Javassist（基于字节码）：默认，使用 Javassist 字节码操作库生成代理类。</li><li>JDK 动态代理（基于反射）：使用 JDK 动态代理生成代理类。</li><li>CGLib（基于 ASM）：使用 CGLib 字节码操作库生成代理类。</li></ul></li><li><p>Dubbo 默认使用 Javassist 来实现动态代理，而不是使用 CGlib 的原因如下</p></li></ul><table><thead><tr><th>原因</th><th>说明</th></tr></thead><tbody><tr><td>功能冗余</td><td> Dubbo 只需要接口代理，CGlib 面向类代理，其优势无法发挥。</td></tr><tr><td>Javassist 足够优秀</td><td>生成速度快，运行性能高，API 友好，完全可以替代 CGlib。</td></tr><tr><td>依赖冲突</td><td> Spring 等框架也使用 CGlib，如果 Dubbo 也使用 CGlib 容易产生版本冲突和类加载问题。</td></tr><tr><td>维护成本高</td><td> ASM 对 JDK 版本敏感，Dubbo 不希望承担额外的版本升级压力，增加维护成本。</td></tr><tr><td>社区策略</td><td> Dubbo 官方逐步废弃 CGlib，未来版本彻底移除。</td></tr></tbody></table><div class="admonition note"><p class="admonition-title">提示</p><p>Dubbo 默认使用 Javassist 字节码操作来生成代理类，还可以通过 Dubbo 的 SPI 扩展机制配置用户自己的动态代理实现。</p></div><h3 id="注册中心"><a href="#注册中心" class="headerlink" title="注册中心"></a>注册中心</h3><div class="admonition note"><p class="admonition-title">Dubbo 官方文档</p><p>更多关于 Dubbo 注册中心的介绍请看 <a target="_blank" rel="external nofollow" href="https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/registry/">Dubbo 官方文档 - 注册中心与服务发现</a>。</p></div><h4 id="支持的注册中心"><a href="#支持的注册中心" class="headerlink" title="支持的注册中心"></a>支持的注册中心</h4><p>Dubbo 支持的注册中心有以下几种（不限于）：</p><p><img data-src="../../../asset/2025/09/dubbo-config-9.png"></p><div class="admonition note"><p class="admonition-title">Dubbo 3 支持的注册中心类型</p><p>在 Dubbo 3 中，默认支持 ZooKeeper 与 Nacos 作为注册中心，而且 Dubbo 扩展生态提供了 Consul、Etcd、Redis、Multicast 等注册中心的扩展实现，还支持 Kubernetes、Mesh 体系的服务发现。</p></div><h4 id="ZK-注册中心使用"><a href="#ZK-注册中心使用" class="headerlink" title="ZK 注册中心使用"></a>ZK 注册中心使用</h4><ul><li><p>Dubbo 中 ZooKeeper 注册中心相关的底层源码</p><ul><li>将服务注册到 ZooKeeper<ul><li><code>ZookeeperRegistry.doRegister()</code></li></ul></li><li>从 ZooKeeper 订阅服务<ul><li><code>ZookeeperRegistry.doSubscribe()</code></li></ul></li></ul></li><li><p>Dubbo 在 ZooKeeper 注册中心中的数据存储结构和数据格式</p></li></ul><p><img data-src="../../../asset/2024/12/dubbo-12.png"></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/dubbo</span><br><span class="line">└── com.clay.dubbo.service.DemoService</span><br><span class="line">    ├── providers</span><br><span class="line">    │   └── [dubbo%3A%2F%2F127.0.0.1%3A20880%2Fcom.clay.dubbo.service.DemoService%3Fanyhost%3Dtrue%26application%3Ddubbo-provider-application%26bean.name%3Dcom.clay.dubbo.service.DemoService%26dubbo%3D2.0.2%26generic%3Dfalse%26interface%3Dcom.clay.dubbo.service.DemoService%26methods%3DsayHello%26pid%3D36945%26side%3Dprovider%26timestamp%3D1735281570416]</span><br><span class="line">    │</span><br><span class="line">    ├── consumers</span><br><span class="line">    │   └── [consumer%3A%2F%2F172.17.0.1%2Fcom.clay.dubbo.service.DemoService%3Fapplication%3Ddubbo-consumer-application%26category%3Dconsumers%26check%3Dfalse%26dubbo%3D2.0.2%26init%3Dfalse%26interface%3Dcom.clay.dubbo.service.DemoService%26loadbalance%3Drandom%26metadata-type%3Dremote%26methods%3DsayHello%26pid%3D2581%26qos.enable%3Dfalse%26release%3D2.7.23%26retries%3D0%26side%3Dconsumer%26sticky%3Dfalse%26timeout%3D1000%26timestamp%3D1758801158327]</span><br><span class="line">    │</span><br><span class="line">    ├── configurators</span><br><span class="line">    │   └── empty</span><br><span class="line">    │</span><br><span class="line">    └── routers</span><br><span class="line">        └── empty</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 ZooKeeper 的节点信息（Root Node）</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 7] ls /dubbo</span><br><span class="line">[com.clay.dubbo.service.DemoService, config, metadata]</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 ZooKeeper 的节点信息（Service）</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 9] ls /dubbo/com.clay.dubbo.service.DemoService</span><br><span class="line">[configurators, consumers, providers, routers]</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 ZooKeeper 的节点信息（Provider - 服务提供者），默认通过 <code>URLEncoder</code> 进行编码</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 10] ls /dubbo/com.clay.dubbo.service.DemoService/providers </span><br><span class="line">[dubbo%3A%2F%2F127.0.0.1%3A20880%2Fcom.clay.dubbo.service.DemoService%3Fanyhost%3Dtrue%26application%3Ddubbo-provider-application%26bean.name%3Dcom.clay.dubbo.service.DemoService%26dubbo%3D2.0.2%26generic%3Dfalse%26interface%3Dcom.clay.dubbo.service.DemoService%26methods%3DsayHello%26pid%3D36945%26side%3Dprovider%26timestamp%3D1735281570416]</span><br></pre></td></tr></tbody></table></figure><ul><li>将上述的节点信息（Provider - 服务提供者）通过 <code>URLDecoder</code> 解码后，得到的内容如下：</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[dubbo://127.0.0.1:20880/com.clay.dubbo.service.DemoService?anyhost=true&amp;application=dubbo-provider-application&amp;deprecated=false&amp;dubbo=2.0.2&amp;dynamic=true&amp;generic=false&amp;interface=com.clay.dubbo.service.DemoService&amp;methods=sayHello&amp;pid=24895&amp;release=2.7.6&amp;side=provider&amp;timestamp=1735287128612]</span><br></pre></td></tr></tbody></table></figure><h4 id="多注册中心注册"><a href="#多注册中心注册" class="headerlink" title="多注册中心注册"></a>多注册中心注册</h4><blockquote><p>Dubbo 支持同一个服务向多个注册中心同时注册，或者不同的服务分别注册到不同的注册中心上去，甚至可以同时引用注册在不同注册中心上的同名服务。</p></blockquote><ul><li>同一个服务注册到不同的注册中心。比如：中文站有些服务来不及在青岛部署，只在杭州部署，而青岛的其它应用需要引用此服务，就可以将青岛的服务同时注册到两个注册中心，具体配置如下图所示：</li></ul><p><img data-src="../../../asset/2025/09/dubbo-config-10.png"></p><ul><li>不同的服务注册到不同的注册中心。比如：CRM 系统中有些服务是专门为国际站设计的，有些服务是专门为中文站设计的，具体配置如下图所示：</li></ul><p><img data-src="../../../asset/2025/09/dubbo-config-11.png"></p><ul><li>单独引用不同注册中心的服务。比如：CRM 系统中需要同时调用中文站和国际站的 PC2 服务，而 PC2 服务在中文站和国际站均有部署，接口及版本号都一样，但连接的数据库不一样，具体配置如下图所示：</li></ul><p><img data-src="../../../asset/2025/09/dubbo-config-12.png"></p><ul><li>同时引用不同注册中心的同名服务，可以使用竖号分隔多个不同注册中心地址。比如：CRM 系统中需要同时调用中文站和国际站的 Pay 服务，而 Pay 服务在中文站和国际站均有部署，接口及版本号都一样，连接的数据库也一样，具体配置如下图所示：</li></ul><p><img data-src="../../../asset/2025/09/dubbo-config-13.png"></p><blockquote><p>一个服务多个注册中心的应用场景</p></blockquote><p><img data-src="../../../asset/2025/09/dubbo-config-14.png"></p><h4 id="注册中心的扩展"><a href="#注册中心的扩展" class="headerlink" title="注册中心的扩展"></a>注册中心的扩展</h4><h5 id="扩展接口"><a href="#扩展接口" class="headerlink" title="扩展接口"></a>扩展接口</h5><ul><li>扩展说明<ul><li>负责服务注册与发现</li></ul></li><li>扩展接口<ul><li><code>org.apache.dubbo.registry.RegistryFactory</code></li><li><code>org.apache.dubbo.registry.Registry</code></li></ul></li><li>扩展配置<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 定义注册中心 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">id</span>=<span class="string">"xxx1"</span> <span class="attr">address</span>=<span class="string">"xxx://ip:port"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 设置注册中心（服务提供者），如果没有配置 registry 属性，将在 ApplicationContext 中自动扫描 registry 配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">registry</span>=<span class="string">"xxx1"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 设置默认注册中心（服务提供者缺省配置），当 &lt;dubbo:sevice&gt; 没有配置 registry 属性时，默认会使用此配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">registry</span>=<span class="string">"xxx1"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure></li><li>扩展契约<br> <img data-src="../../../asset/2025/09/dubbo-registry-2.png"><br> <img data-src="../../../asset/2025/09/dubbo-registry-3.png"></li></ul><h5 id="SPI-扩展机制"><a href="#SPI-扩展机制" class="headerlink" title="SPI 扩展机制"></a>SPI 扩展机制</h5><p>Dubbo 支持通过 Registry SPI 机制扩展更多的注册中心实现到 Dubbo 生态，比如 Dubbo 官方通过该机制扩展支持了 Consul、Etcd 等注册中心。</p><div class="admonition note"><p class="admonition-title">SPI 机制详解</p><ul><li><a href="/posts/ef54a41c.html">Java 与 Dubbo 的 SPI 机制介绍</a></li></ul></div><ul><li><p> <strong>Java SPI 机制</strong></p><ul><li>概述<ul><li> Java 原生支持 SPI 机制，SPI 全称为 Service Provider Interface，是一种服务发现机制。</li><li>SPI 的本质是将接口实现类的全限定名配置在文件中，并由服务加载器（<code>ServiceLoader</code>）读取配置文件，加载具体的实现类。</li><li>这样就可以在运行时，动态为接口替换实现类。因此，开发者可以很容易的通过 SPI 机制为程序提供拓展功能（比如插件功能）。</li><li>比如：运行时通过 <code>ServiceLoader</code> 等工具扫描依赖的 Jar 包，在其中查找对应的文件，并加载指定的实现类<ul><li><code>ServiceLoader&lt;HelloService&gt; loader = ServiceLoader.load(HelloService.class);</code></li></ul></li></ul></li><li>使用步骤<ul><li> (1) 定义接口</li><li> (2) 实现多个接口实现类</li><li> (3) 在项目的 <code>META-INF/services</code> 目录中新增全限定接口名文件，指定具体的实现类<ul><li>文件名是接口的全限定名</li><li>文件内容是接口实现类的全限定名</li></ul></li></ul></li><li>应用场景<ul><li> SPI 机制常用于插件式扩展。</li><li>比如：如果你在开发一个框架，可以通过 SPI 让外部开发者编写插件，扩展框架的功能，而不必修改框架的源码。</li></ul></li><li>典型案例<ul><li> JDBC<ul><li>Java 标准库只定义了一套 JDBC 接口，并没有真正的实现。</li><li>数据库厂商（如 MySQL、Oracle）会提供自己的实现，并通过 SPI 机制声明在 <code>resources/META-INF/services/</code> 目录中。</li><li>运行时，Java 会根据项目引入的数据库驱动 Jar 包，自动找到对应的 JDBC 实现类。</li></ul></li></ul></li></ul></li><li><p><strong>Dubbo SPI 机制</strong></p><ul><li>概述<ul><li> Dubbo 并未使用 Java SPI 机制，而是重新实现了一套功能更强的 SPI 机制。</li><li>Dubbo SPI 机制的相关逻辑被封装在 <code>ExtensionLoader</code> 类中，通过 <code>ExtensionLoader</code>，用户可以加载指定的实现类，具体使用步骤跟 Java SPI 稍有不同。</li></ul></li><li>工作原理<ul><li> (1) 接口声明<ul><li>在 Dubbo 中，如果某个接口需要支持 SPI 扩展，就会加上 <code>@SPI</code> 注解，比如 <code>Protocol</code> 接口：<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接口定义</span></span><br><span class="line"><span class="meta">@SPI("dubbo")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Protocol</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getDefaultPort</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Adaptive</span></span><br><span class="line">    &lt;T&gt; <span class="function">Exporter&lt;T&gt; <span class="title">export</span><span class="params">(Invoker&lt;T&gt; invoker)</span> <span class="keyword">throws</span> RpcException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Adaptive</span></span><br><span class="line">    &lt;T&gt; <span class="function">Invoker&lt;T&gt; <span class="title">refer</span><span class="params">(Class&lt;T&gt; type, URL url)</span> <span class="keyword">throws</span> RpcException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载实现类</span></span><br><span class="line">Protocol protocol = ExtensionLoader.getExtensionLoader(Protocol.class).getAdaptiveExtension();</span><br></pre></td></tr></tbody></table></figure></li><li><code>@SPI("dubbo")</code> 表示默认实现是 <code>dubbo</code>。</li><li><code>@Adaptive</code> 表示该方法会生成代理逻辑，运行时根据参数动态选择实现类。</li></ul></li><li>(2) 实现类配置<ul><li> Dubbo 在自己 Jar 包中的 <code>resources/META-INF/dubbo/internal/</code> 路径下提供了一个配置文件，文件名是接口的全限定名，比如：<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resources/META-INF/dubbo/internal/com.alibaba.dubbo.rpc.Protocol</span><br></pre></td></tr></tbody></table></figure></li><li>配置文件的内容是 <code>key=实现类的全限定名</code>，key 对应 <code>@SPI</code> 注解中的扩展名称，比如：<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dubbo=com.alibaba.dubbo.rpc.protocol.dubbo.DubboProtocol</span><br><span class="line">http=com.alibaba.dubbo.rpc.protocol.http.HttpProtocol</span><br><span class="line">hessian=com.alibaba.dubbo.rpc.protocol.hessian.HessianProtocol</span><br></pre></td></tr></tbody></table></figure></li></ul></li><li>(3) 默认实现加载<ul><li>如果用户没有配置扩展，Dubbo 会根据 <code>@SPI("dubbo")</code> 的默认值 <code>dubbo</code>，从配置文件中加载对应的实现类 <code>DubboProtocol</code>。</li><li>这也是 Dubbo 默认使用 Dubbo 协议作为 RPC 通信协议的原因。</li></ul></li><li>(4) 动态切换实现类<ul><li>在 <code>Protocol</code> 接口中，有两个方法加了 <code>@Adaptive</code> 注解。</li><li>Dubbo 会在运行时生成代理类，在代理方法内部根据传入的 URL 参数的 <code>protocol</code> 值决定使用哪个实现类。</li><li>如果 URL 参数中没指定协议，就用默认的 <code>dubbo</code>；如果指定了其他值（如 <code>http</code>），则加载对应的实现类。</li></ul></li></ul></li></ul></li></ul><h3 id="配置加载"><a href="#配置加载" class="headerlink" title="配置加载"></a>配置加载</h3><div class="admonition note"><p class="admonition-title">Dubbo 官方文档</p><p>更多关于 Dubbo 配置加载的介绍请看 <a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/config/principle/">Dubbo 官方文档 - 配置加载流程</a>。</p></div><h4 id="Dubbo-的配置来源"><a href="#Dubbo-的配置来源" class="headerlink" title="Dubbo 的配置来源"></a>Dubbo 的配置来源</h4><ul><li>Dubbo 的四种配置来源和优先级高低如下所示，<strong>优先级高的会覆盖优先级低的</strong></li></ul><table><thead><tr><th>优先级</th><th>配置来源</th><th>说明</th></tr></thead><tbody><tr><td> 1</td><td>JVM System Properties，通过启动参数 <code>-D</code> 指定</td><td>最高优先级，通常用于紧急覆盖配置，无需改代码或配置文件，应用重启即可生效。</td></tr><tr><td>2</td><td>Externalized Configuration，外部化配置</td><td>如 Apollo、Nacos、Spring Cloud Config 等配置中心动态下发的配置。Dubbo 运行时会监听这些配置的变化，支持热更新。</td></tr><tr><td>3</td><td> 编程接口配置，比如 <code>ServiceConfig、ReferenceConfig</code> 等</td><td>在代码中直接通过 <code>ServiceConfig</code>、<code>ReferenceConfig</code> 等 API 设置的参数。优先级低于外部化配置，便于后期通过配置中心进行覆盖。</td></tr><tr><td>4</td><td> 本地配置文件，比如 <code>dubbo.properties</code></td><td>最低优先级，通常用于本地开发，或作为兜底默认值。</td></tr></tbody></table><p><img data-src="../../../asset/2025/09/dubbo-config-3.png"></p><h4 id="Dubbo-的核心配置类"><a href="#Dubbo-的核心配置类" class="headerlink" title="Dubbo 的核心配置类"></a>Dubbo 的核心配置类</h4><p>Dubbo 的配置类分为 4 大类：应用配置、服务消费方配置、服务提供方配置、公共方法配置。</p><ul><li>应用配置<ul><li><code>ApplicationConfig</code>：配置当前应用的信息，不管该应用是服务提供方还是服务消费方</li><li><code>RegistryConfig</code>：配置连接注册中心相关的信息</li><li><code>MonitorConfig</code>：配置连接监控中心相关的信息（可选）</li><li><code>ModuleConfig</code>：用于配置当前模块的信息（可选）</li></ul></li><li>服务消费方配置<ul><li><code>RefrenceConfig</code>：创建一个远程服务代理，一个引用可以指向多个注册中心</li><li><code>ConsumerConfig</code>：当 <code>ReferenceConfig</code> 中某属性没有配置时，会采用此配置的缺省值（可选），即 <code>ConsumerConfig</code> 相当于服务消费方的全局配置</li></ul></li><li>服务提供方配置<ul><li><code>ProtocolConfig</code>：配置提供服务的协议信息，协议由提供方指定，消费方被动接受</li><li><code>ServiceConfig</code>：暴露单个服务，定义服务的元信息，单个服务可以用多个协议暴露、注册到多个注册中心</li><li><code>ProviderConfig</code>：当 <code>ProtocolConfig</code> 和 <code>ServiceConfig</code> 中某属性没有配置时，会采用此配置的缺省值（可选），即 <code>ProviderConfig</code> 相当于服务提供方的全局配置</li></ul></li><li>公共方法配置<ul><li><code>MethodConfig</code>：指定方法级别的配置信息，如超时时间、重试次数、负载均衡策略等，可配置在 <code>ReferenceConfig</code> 和 <code>ServiceConfig</code> 下</li><li><code>ArgumentConfig</code>：指定方法参数的配置信息，如参数验证、回调方法等。</li></ul></li></ul><h4 id="不同配置类之间的关系"><a href="#不同配置类之间的关系" class="headerlink" title="不同配置类之间的关系"></a>不同配置类之间的关系</h4><ul><li>在 Dubbo 中，配置类之间的引用和继承关系如下图所示（不同版本有所区别）。在引用和继承关系图中，左边是服务提供方的相关配置，右边是服务消费方的相关配置，中间是双方的共享配置，下边是方法和方法参数的相关配置。</li></ul><p><img data-src="../../../asset/2025/09/dubbo-config-1.png"></p><ul><li><code>ReferenceConfig</code> 引用了 <code>ConsumerConfig</code>，而 <code>ServiceConfig</code> 引用了 <code>ProviderConfig</code>。</li><li>如果没有进行 <code>ReferenceConfig</code> 的配置，默认使用 <code>ConsumerConfig</code> 的配置。</li><li>如果没有进行 <code>ServiceConfig</code> 的配置，默认使用 <code>ProviderConfig</code> 的配置。</li></ul><h4 id="不同粒度配置的覆盖关系"><a href="#不同粒度配置的覆盖关系" class="headerlink" title="不同粒度配置的覆盖关系"></a>不同粒度配置的覆盖关系</h4><p>以超时时间（<code>timeout</code>）的配置为例，下图显示了 Dubbo 配置的查找顺序（从上到下，配置的优先级逐渐降低），其它配置如 <code>retries</code>、<code>loadbalance</code> 等类似。蓝色部分表示服务消费方的配置，绿色部分表示服务提供方的配置。</p><p><img data-src="../../../asset/2025/09/dubbo-config-2.png"></p><ul><li><p>配置的优先级</p><ul><li>优先级高低：方法级别的配置 &gt; 接口级别的配置 &gt; 全局的配置，<strong>优先级高的会覆盖优先级低的</strong><ul><li><code>精确优先</code>：<strong>方法级别的配置优先，接口级别的配置次之，全局的配置再次之。</strong></li><li><code>消费方配置优先</code>：<strong>如果级别一样，则服务消费方的配置优先，服务提供方的配置次之。</strong></li></ul></li><li>其中，服务提供方的配置信息，是通过 URL 经由注册中心（比如 ZooKeeper）传递给服务消费方。</li></ul></li><li><p>配置的覆盖规则</p><ul><li>值得注意的是，下面的 <code>&gt;</code> 符号可以理解为 “覆盖”。</li><li>方法级别的配置 &gt; 接口级别的配置，即小 Scope（范围）配置优先。</li><li>服务消费方的配置 &gt; 服务提供方的配置 &gt; 全局配置。</li><li>最后是 Dubbo Hard Code（硬编码）的配置（详见官方配置文档）。</li></ul></li></ul><p>在 Dubbo 框架中，推荐在服务提供方（Provider）尽量多配置服务消费方（Consumer）相关的属性，主要原因如下：</p><ul><li>(1) 服务提供方更了解服务性能特征：作为服务的实现者，Provider 比 Consumer 更清楚服务的性能参数，例如方法调用的合理超时时间、重试次数等关键配置。</li><li>(2) Provider 配置可作为 Consumer 的缺省值：当 Provider 配置相关属性后，如果 Consumer 未显式配置对应项，则会自动使用 Provider 的配置值。这样既避免了 Consumer 不配置时直接使用其全局默认值（可能对当前服务不合理），也提升了配置的可控性和合理性。</li><li>(3) 此外，从实践角度建议，应由服务提供方设定超时时间、重试次数等关键配置，因为服务执行所需的时长通常只有服务提供方最清楚。这样也能减轻 Consumer 的配置负担，特别是当一个 Consumer 调用多个服务时，无需逐一关注每个服务的超时设置。</li><li>(4) 从配置约定上看，理论上在 <code>ReferenceConfig</code> 中，除了 <code>interface</code> 为必需配置项之外，其余所有配置项均可缺省。此时框架会自动逐级查找缺省配置，优先使用 <code>ConsumerConfig</code>、<code>ServiceConfig</code> 或 <code>ProviderConfig</code> 中提供的默认值。</li></ul><div class="admonition note"><p class="admonition-title">提示</p><ul><li>Dubbo 的引用默认是延迟初始化的，只有引用被注入到其它 Bean，或被 <code>getBean()</code> 获取才会初始化。如果需要饥饿加载，即没有被引用也立即生成动态代理对象，可以配置：<code>&lt;dubbo:reference ... init="true"/&gt;</code>。</li><li>在服务消费方配置一个接口级别的配置超时时间是 5000，而在服务提供方配置一个方法级别精确的超时时间为 1000，配置为 <code>&lt;dubbo:method name="getUserList" timeout"1000"&gt;</code>，这个情况下生效的是服务提供方配置的超时时间 1000；因为方法级别的配置优先级更高，只有配置级别一样时，服务消费方的配置才优先。</li></ul></div><h4 id="不同配置文件的覆盖关系"><a href="#不同配置文件的覆盖关系" class="headerlink" title="不同配置文件的覆盖关系"></a>不同配置文件的覆盖关系</h4><p>下图显示了 Dubbo 配置文件的优先级高低（从上到下，优先级逐渐降低），<strong>优先级高的会覆盖优先级低的</strong>。</p><p><img data-src="../../../asset/2025/09/dubbo-config-4.png"></p><ul><li>配置文件的优先级<ul><li> JVM 启动参数（<code>-D</code>）<ul><li>优先级最高</li><li>可在服务部署和启动时通过 <code>-D</code> 参数动态覆盖配置，例如修改协议端口：<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Ddubbo.protocol.port=20890 -jar app.jar</span><br></pre></td></tr></tbody></table></figure></li><li>适用于临时 / 紧急覆盖配置，无需改代码或配置文件，应用重启即可生效。</li></ul></li><li>XML 配置文件<ul><li>优先级次于 JVM 启动参数（<code>-D</code>）</li><li>如果在 XML 文件中配置了某项内容，则 Properties 配置文件（如 <code>dubbo.properties</code>）中对应的配置项将失效。</li></ul></li><li>Properties 配置文件<ul><li>优先级最低</li><li>仅当 XML 中未配置某项内容时才会生效，相当于默认值。</li><li>通常用于本地开发存放公共或共享配置，例如应用名称等基础配置。</li></ul></li></ul></li></ul><h4 id="配置项分类和配置项格式"><a href="#配置项分类和配置项格式" class="headerlink" title="配置项分类和配置项格式"></a>配置项分类和配置项格式</h4><ul><li><p>配置项的分类</p><ul><li>(1) 服务发现：表示该配置项用于服务的注册与发现，目的是让服务消费方找到服务提供方。</li><li>(2) 服务治理：表示该配置项用于治理服务间的关系，或为开发测试提供便利条件。</li><li>(3) 性能调优：表示该配置项用于调优性能，不同的配置项对性能会产生影响。</li></ul></li><li><p>配置项的格式</p></li></ul><p><img data-src="../../../asset/2025/09/dubbo-config-5.png"></p><div class="admonition note"><p class="admonition-title">Dubbo 配置参考手册</p><p>Dubbo 完整的可配置项列表可以看 <a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/config/properties/">Dubbo 官方文档 - 配置项参考手册</a>。</p></div><h4 id="Dubbo-支持的-XML-配置标签"><a href="#Dubbo-支持的-XML-配置标签" class="headerlink" title="Dubbo 支持的 XML 配置标签"></a>Dubbo 支持的 XML 配置标签</h4><p>Dubbo 支持的 XML 配置标签如下表所示：</p><p><img data-src="../../../asset/2025/09/dubbo-config-6.png"></p><h4 id="Dubbo-的外部化配置（配置中心）"><a href="#Dubbo-的外部化配置（配置中心）" class="headerlink" title="Dubbo 的外部化配置（配置中心）"></a>Dubbo 的外部化配置（配置中心）</h4><blockquote><p>Dubbo 外部化配置的介绍</p></blockquote><ul><li>Dubbo 外部化配置和其他本地配置在内容和格式上并没有任何区别，可以简单理解为 <code>dubbo.properties</code> 的外部化存储，配置中心更适合将一些公共配置（如注册中心、元数据中心等配置）抽取出来，以便做集中管理。</li><li>Dubbo 外部化配置的主要目的是实现配置的集中式管理，支持的成熟配置系统有：ZooKeeper、Apollo、Nacos、Etcd、Consul，而 Dubbo 做的主要是支持这些配置系统正常工作，让集成更加方便。</li><li>举个例子：当 Dubbo 使用 Apollo、Nacos 等配置中心后，可以将以下全局配置（比如注册中心地址、元数据中心地址、协议、QOS 等）统一存储在配置中心，这样应用在本地就不再需要配置。<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将注册中心地址、元数据中心地址、协议、QOS 等配置存储在配置中心（如 Nacos），这样可以做到统一管理、减少开发侧感知</span></span><br><span class="line"></span><br><span class="line"><span class="meta">dubbo.application.qos.qosEnable</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">dubbo.application.qos.port</span>=<span class="string">33333</span></span><br><span class="line"></span><br><span class="line"><span class="meta">dubbo.registry.address</span>=<span class="string">zookeeper://127.0.0.1:2181</span></span><br><span class="line"><span class="meta">dubbo.registry.simplified</span>=<span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="meta">dubbo.metadata-report.address</span>=<span class="string">zookeeper://127.0.0.1:2181</span></span><br><span class="line"></span><br><span class="line"><span class="meta">dubbo.protocol.name</span>=<span class="string">dubbo</span></span><br><span class="line"><span class="meta">dubbo.protocol.port</span>=<span class="string">20880</span></span><br></pre></td></tr></tbody></table></figure></li><li>当 Dubbo 使用 ZooKeeper 作为配置中心时，ZooKeeper 中的数据存储结构如下图所示：<br> <img data-src="../../../asset/2025/09/dubbo-config-7.png"></li></ul><blockquote><p>Dubbo 外部化配置的优先级</p></blockquote><ul><li>优先级：外部化配置默认比本地配置拥有更高的优先级，因此这里配置的内容会覆盖本地配置值。</li><li>作用域：外部化配置有全局和应用两个级别，全局配置是所有应用共享的，应用级配置是由每个应用自己维护且只对自身可见的。当前已支持的扩展实现有 Zookeeper、Apollo、Nacos 等。</li></ul><blockquote><p>Dubbo 外部化配置的使用步骤</p></blockquote><ul><li><p>(1) 增加 <code>config-center</code> 配置（用于指定配置中心地址），比如：<code>&lt;dubbo:config-center address="nacos://127.0.0.1:8848"/&gt;</code></p></li><li><p>(2) 在相应的配置中心（Zookeeper、Nacos 等）增加全局配置项（如下图所示，以 Nacos 为例）</p><ul><li>开启外部化配置后，<code>registry</code>、<code>metadata-report</code>、<code>protocol</code>、<code>qos</code> 等全局范围的配置理论上都不再需要在应用中配置，应用开发侧专注业务服务配置，一些全局共享的全局配置转而由运维人员统一配置在远端配置中心。</li><li>这样能做到的效果就是，应用只需要关心：<ul><li>服务暴露、订阅服务；</li><li>配置中心地址当部署到不同的环境时，其他配置就能自动的被从对应的配置中心读取到。</li></ul></li><li>举例来说，每个应用中 Dubbo 相关的全局配置只要有以下内容可能就足够了，其余的都托管给相应环境下的配置中心：<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">dubbo</span></span><br><span class="line"><span class="string">application</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">demo</span></span><br><span class="line"><span class="string">config-center</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">nacos://127.0.0.1:8848</span></span><br></pre></td></tr></tbody></table></figure></li></ul><p> <img data-src="../../../asset/2025/09/dubbo-config-8.png"></p></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/b6d5fbb8.html" title="Dubbo 2 巩固教程之二">https://www.techgrow.cn/posts/b6d5fbb8.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag"><i class="fa fa-tag"></i> 微服务</a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a><a href="/tags/RPC/" rel="tag"><i class="fa fa-tag"></i> RPC</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/f023325d.html" rel="prev" title="SpringBoot 常用代码块"><i class="fa fa-angle-left"></i> SpringBoot 常用代码块</a></div><div class="post-nav-item"> <a href="/posts/26aba73.html" rel="next" title="Centos7 安装搜狗输入法">Centos7 安装搜狗输入法<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2.1m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">31:20</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/b6d5fbb8.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>