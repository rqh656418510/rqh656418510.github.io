<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 Dubbo 的核心协议，包括 Dubbo、Triple、gRPC、Hessian2、REST 等。"><meta property="og:type" content="article"><meta property="og:title" content="Dubbo 核心协议介绍"><meta property="og:url" content="https://www.techgrow.cn/posts/8b34128.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 Dubbo 的核心协议，包括 Dubbo、Triple、gRPC、Hessian2、REST 等。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/07/dubbo-protocol.png"><meta property="article:published_time" content="2018-12-19T15:42:35.000Z"><meta property="article:modified_time" content="2025-02-25T15:42:35.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="微服务"><meta property="article:tag" content="分布式"><meta property="article:tag" content="RPC"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2024/07/dubbo-protocol.png"><link rel="canonical" href="https://www.techgrow.cn/posts/8b34128.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/8b34128.html","path":"posts/8b34128.html","title":"Dubbo 核心协议介绍"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Dubbo 核心协议介绍 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90"><span class="nav-text">学习资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E6%B5%81%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="nav-text">主流的协议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Triple-%E6%96%B0%E5%8D%8F%E8%AE%AE"><span class="nav-text">Triple 新协议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%8F%E8%AE%AE%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B"><span class="nav-text">协议发展历程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%89%E6%8B%A9-RPC-%E5%8D%8F%E8%AE%AE"><span class="nav-text">选择 RPC 协议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">725</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/8b34128.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Dubbo 核心协议介绍 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 Dubbo 的核心协议，包括 Dubbo、Triple、gRPC、Hessian2、REST 等。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Dubbo 核心协议介绍</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-12-19 23:42:35" itemprop="dateCreated datePublished" datetime="2018-12-19T23:42:35+08:00">2018-12-19</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-02-25 23:42:35" itemprop="dateModified" datetime="2025-02-25T23:42:35+08:00">2025-02-25</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/8b34128.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/8b34128.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>5.4k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>5 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h3><ul><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/">Dubbo 官方文档</a></li></ul><h2 id="主流的协议"><a href="#主流的协议" class="headerlink" title="主流的协议"></a>主流的协议</h2><p>Dubbo 3 支持多种协议，核心的协议包括：Dubbo、Triple、gRPC、Hessian、REST 等。</p><blockquote><p>各种协议的对比</p></blockquote><table><thead><tr><th>协议类型</th><th>协议名 / 标识</th><th>传输层</th><th>核心特性</th><th>适用场景</th><th>是否默认协议</th></tr></thead><tbody><tr><td> Dubbo 协议</td><td><code>dubbo</code></td><td>TCP</td><td> 单一长连接、NIO 异步通信、高性能</td><td>高并发小数据量场景（消费者数 &gt;&gt; 提供者）</td><td>是</td></tr><tr><td> Triple 协议</td><td><code>tri</code></td><td>HTTP/2</td><td> 兼容 gRPC 生态、支持流式通信、跨语言能力增强</td><td>多语言交互、流式数据传输</td><td>否</td></tr><tr><td> gRPC 协议</td><td><code>grpc</code></td><td>HTTP/2</td><td>Google 开源 RPC 框架、高性能跨语言通信</td><td>跨语言高性能服务调用</td><td>否</td></tr><tr><td> REST 协议</td><td><code>rest</code></td><td>HTTP</td><td> 严格遵循 RESTful 规范、支持 JSON/XML 格式</td><td>浏览器调用、跨平台集成</td><td>否</td></tr><tr><td> Hessian 协议</td><td><code>hessian</code></td><td>HTTP</td><td> 表单序列化、短连接、传输效率优于 WebService</td><td> 文件 / 视频等大数据传输</td><td>否</td></tr><tr><td> Thrift 协议</td><td><code>thrift</code></td><td>TCP</td><td>Apache 开源 RPC 框架、强类型接口定义</td><td>多语言服务交互</td><td>否</td></tr><tr><td> RMI 协议</td><td><code>rmi</code></td><td>TCP</td><td>Java 远程方法调用、基于 JRMP 协议</td><td>仅限 Java 生态的远程调用</td><td>否</td></tr><tr><td> WebService</td><td><code>webservice</code></td><td>HTTP</td><td> 基于 SOAP 协议、XML 序列化</td><td>传统企业系统集成</td><td>否</td></tr><tr><td> MQTT 协议</td><td><code>mqtt</code></td><td>TCP</td><td> 发布 / 订阅模式、低带宽占用</td><td>物联网设备通信</td><td>否</td></tr><tr><td> Redis 协议</td><td><code>redis</code></td><td>文本协议</td><td>基于 Redis 的轻量级通信</td><td>缓存操作、简单消息队列</td><td>否</td></tr><tr><td> Memcached 协议</td><td><code>memcached</code></td><td>文本协议 / 二进制协议</td><td>轻量级键值存储、高效缓存机制</td><td>分布式缓存、加速数据访问</td><td>否</td></tr></tbody></table><span id="more"></span><p><img data-src="../../../asset/2024/07/dubbo-protocol.png"></p><blockquote><p>核心协议的介绍</p></blockquote><ul><li><p>Dubbo 协议</p><ul><li>Dubbo 默认使用 Dubbo 协议，基于单一长连接（TCP）和 NIO 异步通信，并采用 Hessian2 作为序列化协议。Dubbo 协议适用于单次传输数据量较小（通常在 100KB 以内）但并发量极高的场景。</li><li>为了支撑高并发，通常服务提供者只部署少量机器，而服务消费者可能有上百台，每天调用量可达数亿次。此时，采用长连接最为合适 — 服务提供者只需与每个服务消费者维持一个长连接，例如总共 100 个连接，然后通过 NIO 异步通信处理所有请求，能够有效支撑大规模并发。</li><li>如果在高并发场景下使用短连接，那么上亿次请求都会触发频繁的 TCP 连接建立与释放，服务提供者难以承受这种开销。需要注意的是，由于 Dubbo 协议是单一长连接，如果单次传输的数据量过大，会占用连接时间，从而降低整体并发处理能力。因此，Dubbo 协议更适合传输小数据量、支持高并发访问的业务场景。</li></ul></li><li><p>Triple 协议</p><ul><li>基于 HTTP/1、HTTP/2 的高性能通信协议，使用 Protobuf 传输数据，完全兼容 gRPC 协议；支持 Unary、Streming 等通信模式；支持发布 REST 风格的 HTTP 服务。</li><li>Protobuf（Protocol Buffers） 是由 Google 开发的一种轻量级、高效的数据交换格式，它被用于结构化数据的序列化、反序列化和传输。相比于 XML 和 JSON 等文本格式，Protobuf 具有更小的数据体积、更快的解析速度和更强的可扩展性。</li></ul></li><li><p>REST 协议</p><ul><li>REST 协议就是平时常说的 RESTful，本质上把它称为协议是不准确的，因为 RESTful 是基于 HTTP/1 协议的。</li><li>使⽤ REST 协议这种⽅式可以让 Dubbo 服务直接通过 URL 进⾏访问，同时也可以更好地与 SpringCloud 技术栈进⾏整合。</li></ul></li><li><p>Hessian 协议</p><ul><li>Hessian 协议使用 Hessian 作为序列化方式，采用多个短连接的通信模式。它适用于服务提供者数量多于消费者数量的场景，并且支持传输较大数据量（比如文件传输）。</li><li>由于短连接在高并发情况下会带来较高的连接建立与释放开销，因此 Hessian 协议在分布式 RPC 调用中使用较少，更多用于需要传输文件或大数据块的特定业务场景。</li></ul></li><li><p>gRPC 协议</p><ul><li>Dubbo 中的 gRPC 协议就是使用 gRPC 来替换 Dubbo 的 RPC 调⽤，本质上将它称为协议是不准确的，因为 gRPC 是 Google 开源的高性能、通用的 RPC 框架。</li><li>gRPC 基于 HTTP/2 协议，默认使用 Protobuf 作为序列化协议，支持多路复用长连接，在一条 TCP 连接上同时处理多个并发请求。<strong>本质上 Dubbo 对于 gRPC 协议的⽀持，就是在原有 gRPC 客户端代码上进行了封装。</strong></li><li>gRPC 适用于跨语言、跨平台的分布式系统，能够满足低延迟、高吞吐的同时提供良好的流式传输能力（支持客户端流、服务端流和双向流）。gRPC 在大文件传输场景下需要额外优化（如分块传输、流式传输），否则会占用连接资源并影响并发性能。</li><li>由于 HTTP/2 的多路复用机制，gRPC 在传输中可同时进行多个请求而不会互相阻塞，适合数据量中等、需要高性能通信的场景，例如微服务之间的交互、移动端与服务端通信、IoT 设备数据上报等。</li></ul></li><li><p>RMI 协议</p><ul><li>RMI 协议基于 Java RMI（远程方法调用）实现，采用 Java 对象序列化（二进制）进行数据传输。通信方式为多个短连接，适用于服务消费者与服务提供者数量相近的场景，并支持传输较大数据（比如文件传输）。</li><li>由于 Java 对象序列化的性能相对较低，且短连接在高并发情况下会带来较高的连接建立与释放开销，该协议在分布式 RPC 中应用较少，通常仅用于特定的文件传输或 Java 生态内的兼容性需求。</li></ul></li></ul><blockquote><p>gRPC 的开发流程</p></blockquote><ul><li>(1) 通过 Protobuf 的 IDL 定义通信数据及操作。</li><li>(2) 通过 Maven 的插件，根据不同的编程语言生成成对应的代码</li><li> (3) 服务端发布 RPC 服务<ul><li> (3.1) ⼀元调⽤</li><li> (3.2) 服务端流式 RPC</li><li>(3.3) 客户端流式 RPC</li><li>(3.4) 双向流式 RPC</li></ul></li><li>(4) 客户端进⾏ RPC 服务的调⽤<ul><li> (4.1) 通过 Stub 代理进⾏远程 RPC 的调⽤</li></ul></li></ul><h2 id="Triple-新协议"><a href="#Triple-新协议" class="headerlink" title="Triple 新协议"></a>Triple 新协议</h2><p>Triple 是 Dubbo 3 新设计的基于 HTTP/1、HTTP/2 的高性能 RPC 通信协议，使用 Protobuf 传输数据，完全兼容 gRPC 协议；支持 Request-Response、Streaming 流式等通信模型，可同时运行在 HTTP/1 和 HTTP/2 之上。在阿里巴巴，Triple 协议广泛用于跨环境、跨语言、跨生态互通，已有数十万容器生产级使用。</p><blockquote><p>Triple 协议的设计</p></blockquote><ul><li><p>传输层</p><ul><li>Triple 协议的底层是基于 HTTP/2 协议实现网络通信，所有数据（包括请求元数据和业务数据）均通过 HTTP/2 二进制帧传输‌。</li></ul></li><li><p>序列化层</p><ul><li>Dubbo 3 默认采用 Protobuf 作为序列化协议，将 Java 对象转换为二进制数据流‌。</li></ul></li></ul><blockquote><p>Triple 协议的特性</p></blockquote><ul><li>多语言友好，<strong>推荐配合 Protobuf 使用 Triple 协议，使用 IDL 定义服务，并使用 Protobuf 编码业务数据</strong></li><li>更容易适配网关、Mesh 架构，可以更好地支持异构语言通信，且更加适应云原生场景</li><li>支持 Streaming 流式通信，包括 Request Stream、Response Stream、Bi-direction Stream</li><li> 采用分层设计，其数据交换格式基于 Protobuf 协议开发，具备优秀的序列化 / 反序列化效率，当然还支持多种序列化方式，也支持众多开发语言</li><li>不仅可以用于 Server 端服务调用，也可以支持浏览器、移动 App 和 IoT 设备与后端服务的交互，同时 Triple 协议无缝支持 Dubbo 3 的全部服务治理能力</li></ul><blockquote><p>Triple 协议的序列化机制</p></blockquote><ul><li><p>Triple 协议的本质：</p><ul><li>传输层：HTTP/2</li><li> 编解码：<ul><li>默认支持 <code>application/grpc+proto</code>，完全兼容 gRPC 标准</li><li>兼容 HTTP/JSON 调用（但严格来说，gRPC 标准并没有支持 <code>application/grpc+json</code>，而是 Dubbo 自行扩展了 JSON 兼容功能）</li></ul></li></ul></li><li><p>Triple 接口类型与序列化逻辑：</p><ul><li>如果是 <code>.proto</code> 生成的接口<ul><li>完全走 Protobuf 序列化<ul><li>客户端和服务端都用 <code>.proto</code> 定义的结构进行 Protobuf 编解码</li><li>兼容标准 gRPC 协议</li></ul></li></ul></li><li>如果是 Java 接口（非 <code>.proto</code> 生成）<ul><li>HTTP/JSON 调用（如 <code>curl</code> + <code>application/json</code>）：<ul><li>完全走 Hessian2Json 或 Jackson 等 JSON 序列化</li><li>传输层是 HTTP/1.1</li><li> 不会经过 Protobuf 序列化</li></ul></li></ul></li></ul></li><li><p> Triple 协议为什么这样设计：</p><ul><li>Triple 协议本质上是 gRPC 兼容协议</li><li> gRPC 强制要求底层用 Protobuf 编解码</li><li> Dubbo 为兼容老用户，支持「Java 接口直发」</li><li>如果是 HTTP/JSON 调用，仍保持兼容 JSON（非 Protobuf 序列化）</li></ul></li><li><p>Triple 协议的序列化机制总结</p></li></ul><table><thead><tr><th>调用方式</th><th>序列化</th><th>服务定义模式</th></tr></thead><tbody><tr><td> gRPC 标准调用（HTTP/2 + <code>application/grpc+proto</code>）</td><td>直接走 Protobuf 序列化</td><td>基于 <code>.proto</code> 文件定义服务</td></tr><tr><td> HTTP/JSON 调用（HTTP/1 + <code>application/json</code>）</td><td>直接走 Hessian2Json 或 Jackson 序列化（不经过 Protobuf 序列化）</td><td>基于 Java 接口（纯 POJO 接口）定义服务</td></tr></tbody></table><blockquote><p>Triple 协议的两种调用方式</p></blockquote><table><thead><tr><th>服务定义方式</th><th>是否支持 HTTP + JSON 调用</th><th>是否支持 gRPC 客户端（协议）调用</th><th>是否支持跨编程语言调用</th></tr></thead><tbody><tr><td>基于 <code>.proto</code> 文件的服务定义</td><td>❌ 不支持 HTTP + JSON 调用</td><td>✅ 支持 gRPC 客户端（协议）调用，由于必须用 Protobuf 二进制，通常用 gRPC 调用</td><td>✅ 支持跨编程语言调用</td></tr><tr><td>基于 Java 接口的服务定义（纯 POJO 接口）</td><td>✅ 支持 HTTP + JSON 调用，内部直接走 Hessian2Json 或 Jackson 序列化（不经过 Protobuf 序列化）</td><td>❌ 不支持 gRPC 客户端（协议）调用，由于 gRPC 仅支持 Protobuf 模式（使用 <code>.proto</code> 文件定义服务），因此 Java 接口 + Triple 协议的模式无法与谷歌官方原生的 gRPC 协议互相调用</td><td>❌ 不支持跨编程语言调用</td></tr></tbody></table><blockquote><p>Triple 协议与经典 Dubbo 协议的区别</p></blockquote><table><thead><tr><th>特性</th><th> Triple（Dubbo 3）</th><th>Dubbo 协议（Dubbo 2）</th></tr></thead><tbody><tr><td>传输协议</td><td> HTTP/2</td><td> 自定义 TCP 协议（单连接）</td></tr><tr><td>序列化协议</td><td> Protobuf / Hessian2 / JSON</td><td>Hessian2（默认）</td></tr><tr><td>多语言支持</td><td>是，天然支持 gRPC 互通</td><td>较差（主要 Java）</td></tr><tr><td>网关支持</td><td>支持 Envoy、APISIX、Kong</td><td> 不兼容</td></tr><tr><td>流式通信</td><td>支持（Streaming RPC）</td><td>不支持</td></tr><tr><td>扩展性</td><td>兼容 gRPC 插件生态</td><td>自定义扩展（Dubbo Filter）</td></tr><tr><td>可观测性</td><td>标准化 Trace、Metrics</td><td> 自行扩展</td></tr><tr><td>连接复用</td><td> HTTP/2 多路复用</td><td>单连接单请求</td></tr><tr><td>协议标准化程度</td><td>标准协议，开放生态</td><td>私有协议</td></tr></tbody></table><blockquote><p>Dubbo 官方给出为什么选择 Triple 协议的原因</p></blockquote><ul><li>容器化和微服务的兴起促进了针对负载内容优化技术的发展，客户端中使用的传统通信协议（RESTful 或其他基于 HTTP 的自定义协议）难以满足应用在性能、可维护性、扩展性、安全性等方便的需求。一个跨语言、模块化的协议会逐渐成为新的应用开发协议标准。</li><li>自从 2017 年 gRPC 协议成为 CNCF 的项目后，包括 K8S、ETCD 等越来越多的基础设施和业务都开始使用 gRPC 的生态，作为云原生的微服务化框架，Dubbo 的新协议也完美兼容了 gRPC。并且，对于 gRPC 协议中一些不完善的部分，Triple 也将进行增强和补充。</li><li>Triple 协议的推出，旨在解决 Dubbo 2 中私有 Dubbo 协议带来的互通性问题。简而言之，Dubbo 协议虽然性能好，但是大家不认，带来的问题就是：<ul><li>跨语言限制：对于有多语言诉求的公司来说不够友好，需要额外的工作量。</li><li>缺乏标准化：Dubbo 协议没有被广泛认可和标准化，无法享受到标准化协议的优势。</li><li>穿透性差：网络环境中的防火墙、网关、代理服务器等不能识别 Dubbo 协议。</li></ul></li></ul><blockquote><p>Dubbo 原本已经支持了 gRPC 协议，为什么还要自研 Triple 协议</p></blockquote><ul><li>如果只支持 gRPC 协议，不能够体现 Dubbo 的价值，毕竟 gRPC 是 Google 开源的。</li><li><strong>Triple 协议不绑定 IDL，支持使用 Java 接口定义服务。gRPC 需要使用 Protobuf，而 Triple 可以通过 Java 接口的方式进行服务暴露。</strong></li><li>Triple 协议同时支持 HTTP/1 和 HTTP/2 协议，而 gRPC 只支持 HTTP/2 协议。</li></ul><h2 id="协议发展历程"><a href="#协议发展历程" class="headerlink" title="协议发展历程"></a>协议发展历程</h2><ul><li>Dubbo 支持多种协议，在 <code>3.0</code> 版本之前支持 Dubbo、gRPC、Hessian2、REST 等核心协议。</li><li>从 Dubbo <code>3.0</code> 开始，Dubbo 官方新引入了自研的 Triple 协议，不过也保留了 Dubbo 和 REST 协议的支持。</li><li>从 Dubbo <code>3.2</code> 开始，Dubbo 官方已经废弃原有的 gRPC 协议，使用 Triple 协议进行替代，Triple 协议完全兼容 gRPC 协议。</li><li>从 Dubbo <code>3.3</code> 开始，Dubbo 官方直接移除了 REST 协议的直接支持，使用 Triple 协议间接支持 REST 协议。</li></ul><div class="admonition note"><p class="admonition-title">提示</p><ul><li>自 Dubbo <code>2.6.0</code> 版本开始，Dubbo 合并了当当网捐献的 DubboX 4 中的主要特性，其中就包括了基于 RESTeasy <code>3.0.19.Final</code> 的 REST 支持，具备 JAX-RS <code>2.0</code> 规范中所有的能力。</li><li>自 Dubbo <code>3.3</code> 版本开始，原有的 REST 协议实现已被移除，由 Triple 协议提供更全面的 REST 支持。使用 Triple 协议发布 REST 风格的服务非常简单，通常只需要在服务接口上添加相应的注解，支持三种注解方式：内置注解、Spring Web 注解、JAX-RS 注解。</li></ul></div><h2 id="选择-RPC-协议"><a href="#选择-RPC-协议" class="headerlink" title="选择 RPC 协议"></a>选择 RPC 协议</h2><ul><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/protocols/protocol/">Dubbo 官方文档 - 如何选择 RPC 协议</a></li></ul><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/reference/protocols/triple/">Triple 协议的优势与目标</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/reference/protocols/triple-spec/">Triple 协议的设计理念与规范</a></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/8b34128.html" title="Dubbo 核心协议介绍">https://www.techgrow.cn/posts/8b34128.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag"><i class="fa fa-tag"></i> 微服务</a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a><a href="/tags/RPC/" rel="tag"><i class="fa fa-tag"></i> RPC</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/48ccc519.html" rel="prev" title="Dubbo 发展历程介绍"><i class="fa fa-angle-left"></i> Dubbo 发展历程介绍</a></div><div class="post-nav-item"> <a href="/posts/d70c90c.html" rel="next" title="Dubbo 管理与监控中心的安装部署">Dubbo 管理与监控中心的安装部署<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">29:50</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/8b34128.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>