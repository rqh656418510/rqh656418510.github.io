<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要记录 MySQL 日常使用的笔记。"><meta property="og:type" content="article"><meta property="og:title" content="MySQL 开发随笔"><meta property="og:url" content="https://www.techgrow.cn/posts/10c00880.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要记录 MySQL 日常使用的笔记。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/06/mysql-transaction-isolation-level-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/06/mysql-transaction-isolation-level-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/08/mysql-limit-1.png"><meta property="article:published_time" content="2020-06-14T14:39:42.000Z"><meta property="article:modified_time" content="2020-06-14T14:39:42.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="数据库"><meta property="article:tag" content="开发随笔"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2024/06/mysql-transaction-isolation-level-1.png"><link rel="canonical" href="https://www.techgrow.cn/posts/10c00880.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/10c00880.html","path":"posts/10c00880.html","title":"MySQL 开发随笔"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>MySQL 开发随笔 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD"><span class="nav-text">MySQL 数据库备份</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%87%BA%E6%95%B4%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">导出整个数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%87%BA%E5%A4%9A%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">导出多个数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AA%E5%AF%BC%E5%87%BA%E6%9F%90%E5%BC%A0%E8%A1%A8"><span class="nav-text">只导出某张表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AA%E5%AF%BC%E5%87%BA%E6%9F%90%E4%BA%9B%E8%A1%A8"><span class="nav-text">只导出某些表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%92%E9%99%A4%E5%AF%BC%E5%87%BA%E6%9F%90%E5%BC%A0%E8%A1%A8"><span class="nav-text">排除导出某张表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%92%E9%99%A4%E5%AF%BC%E5%87%BA%E5%A4%9A%E5%BC%A0%E8%A1%A8"><span class="nav-text">排除导出多张表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AA%E5%AF%BC%E5%87%BA%E8%A1%A8%E7%BB%93%E6%9E%84%EF%BC%88%E4%B8%8D%E5%8C%85%E5%90%AB%E6%95%B0%E6%8D%AE%EF%BC%89"><span class="nav-text">只导出表结构（不包含数据）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AA%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%EF%BC%88%E4%B8%8D%E5%8C%85%E5%90%AB%E8%A1%A8%E7%BB%93%E6%9E%84%EF%BC%89"><span class="nav-text">只导出数据（不包含表结构）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="nav-text">MySQL 服务器配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL-8-%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="nav-text">MySQL 8 设置默认字符集</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-%E8%AE%BE%E7%BD%AE%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-text">MySQL 设置事务隔离级别</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="nav-text">事务隔离级别的介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E6%A1%88%E4%BE%8B"><span class="nav-text">事务隔离级别的案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E8%AE%BE%E7%BD%AE"><span class="nav-text">事务隔离级别的设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E7%9A%84%E6%80%BB%E7%BB%93"><span class="nav-text">事务隔离级别的总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E5%A6%82%E4%BD%95%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE"><span class="nav-text">数据库表如何删除重复数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E5%8D%83%E4%B8%87%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%9A%84%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="nav-text">优化千万级数据的分页查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E7%9A%84%E5%85%B3%E9%94%AE"><span class="nav-text">优化的关键</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E7%9A%84%E6%96%B9%E6%A1%88"><span class="nav-text">优化的方案</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80%EF%BC%8C%E4%BD%BF%E7%94%A8%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">方案一，使用覆盖索引 + 子查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C%EF%BC%8C%E8%B5%B7%E5%A7%8B%E4%BD%8D%E7%BD%AE%E9%87%8D%E5%AE%9A%E4%B9%89"><span class="nav-text">方案二，起始位置重定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%A1%88%E4%B8%89%EF%BC%8C%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7%E4%B8%8D%E5%8F%AF%E7%94%A8"><span class="nav-text">方案三，服务降级不可用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%BE%80%E6%8B%A5%E6%9C%89%E5%8D%83%E4%B8%87%E7%BA%A7%E6%95%B0%E6%8D%AE%E9%87%8F%E7%9A%84%E8%A1%A8%E6%B7%BB%E5%8A%A0%E7%B4%A2%E5%BC%95"><span class="nav-text">如何往拥有千万级数据量的表添加索引</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">703</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/10c00880.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="MySQL 开发随笔 | Clay 的技术空间"><meta itemprop="description" content="本文主要记录 MySQL 日常使用的笔记。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> MySQL 开发随笔</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-06-14 22:39:42" itemprop="dateCreated datePublished" datetime="2020-06-14T22:39:42+08:00">2020-06-14</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/10c00880.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/10c00880.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>3.1k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>3 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="MySQL-数据库备份"><a href="#MySQL-数据库备份" class="headerlink" title="MySQL 数据库备份"></a>MySQL 数据库备份</h2><span id="more"></span><h3 id="导出整个数据库"><a href="#导出整个数据库" class="headerlink" title="导出整个数据库"></a>导出整个数据库</h3><ul><li>导出某个数据库的表结构和表数据</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h 127.0.0.1 -u your_username -p --databases shop &gt; shop.sql</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">提示</p><ul><li>当添加了参数 <code>--databases</code>，导出的 SQL 文件会包含 <code>CREATE DATABASE</code> 语句，适用于导入到全新 MySQL 服务器中。</li><li>当不添加参数 <code>--databases</code>，导出的 SQL 文件不会包含 <code>CREATE DATABASE</code> 语句，适用于在另一个已存在的数据库中导入。</li></ul></div><h3 id="导出多个数据库"><a href="#导出多个数据库" class="headerlink" title="导出多个数据库"></a>导出多个数据库</h3><ul><li>一次性导出多个数据库的表结构和表数据</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h 127.0.0.1 -u your_username -p --databases db1 db2 &gt; backup.sql</span><br></pre></td></tr></tbody></table></figure><h3 id="只导出某张表"><a href="#只导出某张表" class="headerlink" title="只导出某张表"></a>只导出某张表</h3><ul><li>只导出某个数据库的某张表的表结构和表数据</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h 127.0.0.1 -u your_username -p shop table1 &gt; shop_selected.sql</span><br></pre></td></tr></tbody></table></figure><h3 id="只导出某些表"><a href="#只导出某些表" class="headerlink" title="只导出某些表"></a>只导出某些表</h3><ul><li>只导出某个数据库的某些表的表结构和表数据</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h 127.0.0.1 -u your_username -p shop table1 table2 &gt; shop_selected.sql</span><br></pre></td></tr></tbody></table></figure><h3 id="排除导出某张表"><a href="#排除导出某张表" class="headerlink" title="排除导出某张表"></a>排除导出某张表</h3><ul><li>导出某个数据库的表结构和表数据，除了某张表之外</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h 127.0.0.1 -u your_username -p --databases shop --ignore-table=shop.user &gt; shop_without_user.sql</span><br></pre></td></tr></tbody></table></figure><h3 id="排除导出多张表"><a href="#排除导出多张表" class="headerlink" title="排除导出多张表"></a>排除导出多张表</h3><ul><li>导出某个数据库的表结构和表数据，除了某些表之外</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (1) 首先，获取 shop 数据库中的所有表</span></span><br><span class="line">mysql -u your_username -p -e <span class="string">"SHOW TABLES FROM shop;"</span> &gt; tables.txt</span><br></pre></td></tr></tbody></table></figure><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (2) 然后，在 `tables.txt` 文件中删除某些表</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># (3) 最后，导出 `tables.txt` 文件中指定的表</span></span><br><span class="line">mysqldump -h 127.0.0.1 -u your_username -p shop $(cat tables.txt) &gt; shop_filtered.sql</span><br></pre></td></tr></tbody></table></figure><h3 id="只导出表结构（不包含数据）"><a href="#只导出表结构（不包含数据）" class="headerlink" title="只导出表结构（不包含数据）"></a>只导出表结构（不包含数据）</h3><ul><li>只导出某个数据库的表结构，不导出数据</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h 127.0.0.1 -u your_username -p --no-data shop &gt; shop_schema.sql</span><br></pre></td></tr></tbody></table></figure><h3 id="只导出数据（不包含表结构）"><a href="#只导出数据（不包含表结构）" class="headerlink" title="只导出数据（不包含表结构）"></a>只导出数据（不包含表结构）</h3><ul><li>只导出某个数据库的数据，不导出表结构</li></ul><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h 127.0.0.1 -u your_username -p --no-create-info shop &gt; shop_data.sql</span><br></pre></td></tr></tbody></table></figure><h2 id="MySQL-服务器配置"><a href="#MySQL-服务器配置" class="headerlink" title="MySQL 服务器配置"></a>MySQL 服务器配置</h2><h3 id="MySQL-8-设置默认字符集"><a href="#MySQL-8-设置默认字符集" class="headerlink" title="MySQL 8 设置默认字符集"></a>MySQL 8 设置默认字符集</h3><p>为了让 MySQL 8 支持存储 Emoji 表情包（占用 4 个字节），可以在 MySQL 服务端的 <code>/etc/my.conf</code> 配置文件中指定默认使用的字符集为 <code>utf8mb4</code>，如下所示：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line"># 设置客户端的默认字符集</span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line"># 设置命令行客户端的默认字符集</span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"># 设置每个客户端在连接时默认使用的字符集，如何客户端在连接时明确指定了字符集，则客户端指定的字符集具有较高优先级</span><br><span class="line">init_connect = 'SET NAMES utf8mb4'</span><br><span class="line"># 设置服务端的默认字符集</span><br><span class="line">character-set-server = utf8mb4</span><br><span class="line"># 设置服务端的默认排序规则</span><br><span class="line">collation-server=utf8mb4_unicode_ci</span><br></pre></td></tr></tbody></table></figure><h2 id="MySQL-设置事务隔离级别"><a href="#MySQL-设置事务隔离级别" class="headerlink" title="MySQL 设置事务隔离级别"></a>MySQL 设置事务隔离级别</h2><h3 id="事务隔离级别的介绍"><a href="#事务隔离级别的介绍" class="headerlink" title="事务隔离级别的介绍"></a>事务隔离级别的介绍</h3><p>事务表示多个数据操作组成一个完整的事务单元，在这个事务内的所有数据操作要么同时成功，要么同时失败。数据库系统必须具有隔离并发运行各个事务的能力，使它们不会相互影响，避免各种并发问题。一个事务与其他事务隔离的程度称为 <code>隔离级别</code>。SQL 标准中规定了多种事务隔离级别，不同隔离级别对应不同的干扰程度，隔离级别越高，数据一致性就越好，但数据库的并发性能越差。为了解决事务并发问题（脏读、不可重复读、幻读），主流的关系型数据库都会提供以下四种事务隔离级别。</p><ul><li><strong>读未提交（Read Uncommitted）</strong><ul><li>在该隔离级别，<strong>所有事务都可以看到其他未提交事务所做的改变</strong>。</li><li>该隔离级别是最低的隔离级别，虽然拥有超高的并发处理能力及很低的系统开销，但很少用于实际应用。</li><li>该隔离级别只能解决第一类更新丢失问题，不能解决脏读、不可重复读、幻读的问题。</li></ul></li><li><strong>读已提交（Read Committed）</strong><ul><li>这是大多数数据库系统的默认隔离级别（但不是 MySQL 默认的），例如 Oracle 数据库。</li><li>该隔离级别满足了隔离的简单定义：<strong>一个事务只能看见已提交事务所做的改变</strong>。</li><li>该隔离级别可以解决脏读问题，但会出现不可重复读、幻读问题。</li></ul></li><li><strong>可重复读（Repeatable Read）</strong><ul><li>这是 MySQL 的默认事务隔离级别，<strong>它可以确保在整个事务过程中，对同一条数据的读取结果是相同的，不管其他事务是否在对共享数据进行更新，也不管其他事务更新提交与否</strong>。</li><li>该隔离级别可以解决脏读、不可重复读的问题，但会出现幻读问题。</li></ul></li><li><strong>串行化（Serializable）</strong><ul><li>这是最高的事务隔离级别，<strong>它通过强制事务排序，使之不可能相互冲突，从而解决脏读、不可重复读、幻读、第一类更新丢失、第二类更新丢失问题</strong>。</li><li>该隔离级别可以解决所有的事务并发问题，但可能导致大量的超时现象和锁竞争，通常数据库不会用这个隔离级别，可用其他的方案来解决这些问题，例如乐观锁和悲观锁。</li></ul></li></ul><h3 id="事务隔离级别的案例"><a href="#事务隔离级别的案例" class="headerlink" title="事务隔离级别的案例"></a>事务隔离级别的案例</h3><p><img data-src="../../../asset/2024/06/mysql-transaction-isolation-level-1.png"></p><p>上图中是典型的第二类丢失更新问题，后果非常严重。当数据库隔离级别为读已提交（Read Committed）及以下隔离级别时，会出现不可重复读的现象。从上面的表格可以看出，当事务隔离级别设置为可重复读（Repeatable Read）时，可以避免不可重复读的现象出现。</p><h3 id="事务隔离级别的设置"><a href="#事务隔离级别的设置" class="headerlink" title="事务隔离级别的设置"></a>事务隔离级别的设置</h3><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 设置下一次事务的隔离级别</span></span><br><span class="line"><span class="keyword">set</span> transaction isolation level repeatable read;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置当前会话的事务隔离级别</span></span><br><span class="line"><span class="keyword">set</span> session transaction isolation level repeatable read;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 设置全局的事务隔离级别</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> session transaction isolation level repeatable read;</span><br></pre></td></tr></tbody></table></figure><h3 id="事务隔离级别的总结"><a href="#事务隔离级别的总结" class="headerlink" title="事务隔离级别的总结"></a>事务隔离级别的总结</h3><p>上述四种事务隔离级别会产生的并发问题如下（YES 表示存在对应的问题，NO 表示不存在对应的问题）：</p><p><img data-src="../../../asset/2024/06/mysql-transaction-isolation-level-2.png"></p><p>各种关系型数据库对事务隔离级别的支持程度如下（YES 表示支持，NO 表示不支持）：</p><table><thead><tr><th></th><th>Oracle</th><th>MySQL</th></tr></thead><tbody><tr><td>Read Uncommitted</td><td>NO</td><td>YES</td></tr><tr><td>Read Committed</td><td>YES (默认)</td><td>YES</td></tr><tr><td>Repeatable Read</td><td>NO</td><td>YES (默认)</td></tr><tr><td>Serializable</td><td>YES</td><td>YES</td></tr></tbody></table><div class="admonition note"><p class="admonition-title">提示</p><ul><li>在 Spring 框架中，事务隔离级别可以通过 <code>@Transactional</code> 注解中的 <code>isolation</code> 属性定义。</li><li>MySQL 的默认隔离级别是可重复读 (Repeatable Read)，而 Oracle 的默认隔离级别是读已提交 (Read Committed)。</li></ul></div><h2 id="数据库表如何删除重复数据"><a href="#数据库表如何删除重复数据" class="headerlink" title="数据库表如何删除重复数据"></a>数据库表如何删除重复数据</h2><div class="admonition note"><p class="admonition-title">面试题</p><p>线上数据库表存在重复数据，如何删除同一字段下的所有重复数据，或者仅仅留下一条数据。</p></div><ul><li>创建表，并插入数据</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `student` (</span><br><span class="line">  `id` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `age` <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>INNODB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_bin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student` (`id`, `name`, `age`) <span class="keyword">VALUES</span> (<span class="string">'1'</span>, <span class="string">'cat'</span>, <span class="number">22</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student` (`id`, `name`, `age`) <span class="keyword">VALUES</span> (<span class="string">'2'</span>, <span class="string">'dog'</span>, <span class="number">33</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student` (`id`, `name`, `age`) <span class="keyword">VALUES</span> (<span class="string">'3'</span>, <span class="string">'fish'</span>, <span class="number">44</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student` (`id`, `name`, `age`) <span class="keyword">VALUES</span> (<span class="string">'4'</span>, <span class="string">'cat'</span>, <span class="number">55</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student` (`id`, `name`, `age`) <span class="keyword">VALUES</span> (<span class="string">'5'</span>, <span class="string">'dog'</span>, <span class="number">11</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `student` (`id`, `name`, `age`) <span class="keyword">VALUES</span> (<span class="string">'6'</span>, <span class="string">'cat'</span>, <span class="number">45</span>);</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 <code>name</code> 字段的重复数据</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> NAME, <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="keyword">FROM</span> student <span class="keyword">GROUP</span> <span class="keyword">BY</span> NAME <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="operator">&gt;</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 或者</span></span><br><span class="line"><span class="keyword">SELECT</span> NAME, <span class="built_in">COUNT</span>(NAME) <span class="keyword">FROM</span> student <span class="keyword">GROUP</span> <span class="keyword">BY</span> NAME <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(NAME) <span class="operator">&gt;</span> <span class="number">1</span>;</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+------+-------------+</span><br><span class="line">| NAME | COUNT(NAME) |</span><br><span class="line">+------+-------------+</span><br><span class="line">| cat  |           3 |</span><br><span class="line">| dog  |           2 |</span><br></pre></td></tr></tbody></table></figure><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 或者</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> NAME <span class="keyword">IN</span> ( <span class="keyword">SELECT</span> NAME <span class="keyword">FROM</span> student <span class="keyword">GROUP</span> <span class="keyword">BY</span> NAME <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="operator">&gt;</span> <span class="number">1</span> );</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+----+------+------+</span><br><span class="line">| id | name | age  |</span><br><span class="line">+----+------+------+</span><br><span class="line">|  1 | cat  |   22 |</span><br><span class="line">|  2 | dog  |   33 |</span><br><span class="line">|  4 | cat  |   55 |</span><br><span class="line">|  5 | dog  |   11 |</span><br><span class="line">|  6 | cat  |   45 |</span><br><span class="line">+----+------+------+</span><br></pre></td></tr></tbody></table></figure><ul><li>删除 <code>name</code> 字段下的所有重复数据，只要有重复都删除掉</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> NAME <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> t.NAME <span class="keyword">FROM</span> ( <span class="keyword">SELECT</span> NAME <span class="keyword">FROM</span> student <span class="keyword">GROUP</span> <span class="keyword">BY</span> NAME <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="number">1</span>) <span class="operator">&gt;</span> <span class="number">1</span> ) t</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询删除重复数据后的结果</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student;</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+------+------+</span><br><span class="line">| id | name | age  |</span><br><span class="line">+----+------+------+</span><br><span class="line">|  3 | fish |   44 |</span><br><span class="line">+----+------+------+</span><br></pre></td></tr></tbody></table></figure><ul><li>删除 <code>name</code> 字段下的重复数据，仅仅留下一条数据</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 此方法要求主键（ID）为自增长</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> id <span class="keyword">NOT</span> <span class="keyword">IN</span> ( </span><br><span class="line">    <span class="keyword">SELECT</span> t.id <span class="keyword">FROM</span> ( <span class="keyword">SELECT</span> <span class="built_in">MIN</span>( id ) <span class="keyword">AS</span> id <span class="keyword">FROM</span> student <span class="keyword">GROUP</span> <span class="keyword">BY</span> `name` ) t</span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询删除重复数据后的结果</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student;</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+----+------+------+</span><br><span class="line">| id | name | age  |</span><br><span class="line">+----+------+------+</span><br><span class="line">|  1 | cat  |   22 |</span><br><span class="line">|  2 | dog  |   33 |</span><br><span class="line">|  3 | fish |   44 |</span><br><span class="line">+----+------+------+</span><br></pre></td></tr></tbody></table></figure><h2 id="优化千万级数据的分页查询"><a href="#优化千万级数据的分页查询" class="headerlink" title="优化千万级数据的分页查询"></a>优化千万级数据的分页查询</h2><h3 id="优化的关键"><a href="#优化的关键" class="headerlink" title="优化的关键"></a>优化的关键</h3><p>在 <code>SELECT</code> 语句中，可以使用 <code>LIMIT</code> 子句来约束结果集中的行数。<code>LIMIT</code> 子句接受一个或两个参数，两个参数的值都必须为零或者正整数，具体的参数说明如下：</p><ul><li><code>offset</code>：指定要返回的第一行数据的偏移量。第一行数据的偏移量为 0，而不是 1。</li><li><code>count</code>：指定要返回的最大行数。</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ... <span class="keyword">FROM</span> <span class="keyword">table</span> LIMIT <span class="keyword">offset</span>, count;</span><br></pre></td></tr></tbody></table></figure><p>假设 <code>emp</code> 表中有 600 万条的数据，使用以下 SQL 进行分页查询，大概需要花费 18 秒才能查询得到结果。</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SQL_NO_CACHE</span><br><span class="line">  a.empno,</span><br><span class="line">  a.ename,</span><br><span class="line">  a.job,</span><br><span class="line">  a.sal,</span><br><span class="line">  b.deptno,</span><br><span class="line">  b.dname </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  emp a </span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept b </span><br><span class="line">    <span class="keyword">ON</span> a.deptno <span class="operator">=</span> b.deptno </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> a.id</span><br><span class="line">LIMIT <span class="number">4950000</span>, <span class="number">30</span>;</span><br></pre></td></tr></tbody></table></figure><p>为什么上面的查询会耗费那么多时间呢？其实这是因为 <code>LIMIT</code> 后面的偏移量太大导致的。比如 <code>LIMIT 4950000, 30</code>，这等同于数据库要扫描出 4950030 条数据，然后再丢弃前面的 49500000 条数据，最后返回剩下的 30 条数据给用户，显然这种做法是不合理的。MySQL 的分页操作通常会使用 <code>LIMIT</code> 加上偏移量的办法来实现，可能还会加上合适的 <code>ORDER BY</code> 子句。当偏移量非常大的时候，它会导致 MySQL 扫描大量不需要的行，然后再抛弃掉，这在生产环境存在一定的性能隐患。<strong>在阿里巴巴的开发手册中，提到以下的分页查询优化方案：</strong></p><p><img data-src="../../../asset/2024/08/mysql-limit-1.png"></p><h3 id="优化的方案"><a href="#优化的方案" class="headerlink" title="优化的方案"></a>优化的方案</h3><h4 id="方案一，使用覆盖索引-子查询"><a href="#方案一，使用覆盖索引-子查询" class="headerlink" title="方案一，使用覆盖索引 + 子查询"></a>方案一，使用覆盖索引 + 子查询</h4><p>如果数据库表中有 ID 字段，并且在上面建立了索引（主键索引），那么可以先在索引树中找到开始位置的 ID 值，然后再根据找到的 ID 值查询数据。</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  a.empno,</span><br><span class="line">  a.ename,</span><br><span class="line">  a.job,</span><br><span class="line">  a.sal,</span><br><span class="line">  b.deptno,</span><br><span class="line">  b.dname </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  emp a </span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept b </span><br><span class="line">    <span class="keyword">ON</span> a.deptno <span class="operator">=</span> b.deptno </span><br><span class="line"><span class="keyword">WHERE</span> a.id <span class="operator">&gt;=</span> (<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> emp <span class="keyword">ORDER</span> <span class="keyword">BY</span> id LIMIT <span class="number">4950000</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> a.id</span><br><span class="line">LIMIT <span class="number">30</span>;</span><br></pre></td></tr></tbody></table></figure><h4 id="方案二，起始位置重定义"><a href="#方案二，起始位置重定义" class="headerlink" title="方案二，起始位置重定义"></a>方案二，起始位置重定义</h4><p>记住上次分页查询结果的主键位置，避免使用 <code>LIMIT</code> 的偏移量 <code>offset</code>。比如，记住上次分页查询结果的最后一条数据的 ID 是 4950000，然后就直接跳过 4950000，从 4950001 开始扫描表进行查询。</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  a.empno,</span><br><span class="line">  a.ename,</span><br><span class="line">  a.job,</span><br><span class="line">  a.sal,</span><br><span class="line">  b.deptno,</span><br><span class="line">  b.dname </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  emp a </span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept b </span><br><span class="line">    <span class="keyword">ON</span> a.deptno <span class="operator">=</span> b.deptno </span><br><span class="line"><span class="keyword">WHERE</span> a.id <span class="operator">&gt;</span> <span class="number">4950000</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> a.id</span><br><span class="line">LIMIT <span class="number">30</span>;</span><br></pre></td></tr></tbody></table></figure><h4 id="方案三，服务降级不可用"><a href="#方案三，服务降级不可用" class="headerlink" title="方案三，服务降级不可用"></a>方案三，服务降级不可用</h4><ul><li><p>这是阿里巴巴推荐的解决方案，首先配置 <code>LIMIT</code> 的偏移量和获取行数的最大值，超过这个最大值，就返回空数据。因为按照业务来说，超过这个最大值后，用户已经不是在分页了，而是在刷数据。如果确认要查询数据，应该输入合适的查询条件来缩小范围，而不是一页一页地分页查询。</p></li><li><p>当用户发出请求后，如果 <code>offset</code> 大于某个数值就直接返回一个 <code>4xx</code> 的错误，避免黑客攻击或者刷单行为。毕竟，正常人很少翻查 10 页以后的内容。另外，该有的服务降级、限流也应该考虑进去。比如，用户利用多线程工具调用接口，在短时间内执行 5000 次调用，那么就可以简单地使用计数器进行判断，并反馈给用户调用过于频繁，最后直接抛弃用户的请求。</p></li></ul><h2 id="如何往拥有千万级数据量的表添加索引"><a href="#如何往拥有千万级数据量的表添加索引" class="headerlink" title="如何往拥有千万级数据量的表添加索引"></a>如何往拥有千万级数据量的表添加索引</h2><p>在千万级数据量的表中添加索引，操作步骤为：创建新表 + 创建索引 + 导入旧数据 + 废弃旧表。简而言之，” 腾笼换鸟”，稳定性压倒一切，保守一点不出错即可。</p><ul><li>(1) 先创建一张跟原表 A 数据结构相同的新表 B。</li><li>(2) 在新表 B 上建立新的索引。</li><li>(3) 将原表 A 的数据迁移到新表 B。</li><li>(4) 将原表 A 改为别的表名，并将新表 B 改为原表的表名 A。</li></ul><div class="admonition warning"><p class="admonition-title">特别注意</p><p>在给表添加索引的时候，是会对表加锁的（表锁）。如果不谨慎操作，可能会出现严重的生产事故。比如，在添加索引的过程中，如果发生了数据修改（如 DELETE、UPDATE），则可能会导致客户端读取到不一致或错误的数据。因此，对应大数据量的表，需要使用 "腾笼换鸟" 的方式来添加索引。</p></div><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/10c00880.html" title="MySQL 开发随笔">https://www.techgrow.cn/posts/10c00880.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"><i class="fa fa-tag"></i> 数据库</a><a href="/tags/%E5%BC%80%E5%8F%91%E9%9A%8F%E7%AC%94/" rel="tag"><i class="fa fa-tag"></i> 开发随笔</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/9781d890.html" rel="prev" title="算法刷题网站推荐"><i class="fa fa-angle-left"></i> 算法刷题网站推荐</a></div><div class="post-nav-item"> <a href="/posts/ee7f1a35.html" rel="next" title="OpenWrt 设置 IP 地址">OpenWrt 设置 IP 地址<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">1.8m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">27:47</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/10c00880.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>