<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","width":300,"display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍如何构建集成了 Privoxy、Tor、ExpressVPN、SpeedTest 服务的 Docker 镜像，支持使用 SpeedTest 测试 ExpressVPN 的连接速度。"><meta property="og:type" content="article"><meta property="og:title" content="构建 Privoxy、Tor、ExpressVPN 的 Docker 镜像"><meta property="og:url" content="https://www.techgrow.cn/posts/3fe8dbc5.html"><meta property="og:site_name" content="Clay 的技术博客"><meta property="og:description" content="本文主要介绍如何构建集成了 Privoxy、Tor、ExpressVPN、SpeedTest 服务的 Docker 镜像，支持使用 SpeedTest 测试 ExpressVPN 的连接速度。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2021-04-13T14:18:44.000Z"><meta property="article:modified_time" content="2021-10-25T14:18:44.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="容器化"><meta property="article:tag" content="开发工具"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.techgrow.cn/posts/3fe8dbc5.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/3fe8dbc5.html","path":"posts/3fe8dbc5.html","title":"构建 Privoxy、Tor、ExpressVPN 的 Docker 镜像"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>构建 Privoxy、Tor、ExpressVPN 的 Docker 镜像 | Clay 的技术博客</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn:9360"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术博客" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax>!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/app/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt></div><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术博客</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-openplatform"><a href="https://open.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-toolbox fa-fw"></i>开放平台</a></li><li class="menu-item menu-item-readingnotes"><a href="https://docs.techgrow.cn/notes/" rel="external nofollow" target="_blank"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn:9360/ui/login?lng=zh-cn" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%99%E7%A8%8B%E7%9B%AE%E6%A0%87"><span class="nav-text">教程目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E5%9C%B0%E5%9D%80"><span class="nav-text">项目地址</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="nav-text">构建镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Dockerfile-%E6%96%87%E4%BB%B6"><span class="nav-text">Dockerfile 文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shell-%E8%84%9A%E6%9C%AC%E6%96%87%E4%BB%B6"><span class="nav-text">Shell 脚本文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA-Docker-%E9%95%9C%E5%83%8F"><span class="nav-text">构建 Docker 镜像</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8"><span class="nav-text">运行容器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8"><span class="nav-text">Docker 运行容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-Compose-%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8"><span class="nav-text">Docker-Compose 运行容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95-Privoxy-%E4%B8%8E-Tor-%E4%BB%A3%E7%90%86%E6%98%AF%E5%90%A6%E5%8F%AF%E7%94%A8"><span class="nav-text">测试 Privoxy 与 Tor 代理是否可用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9B%E9%98%B6%E9%85%8D%E7%BD%AE"><span class="nav-text">进阶配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Privoxy-%E4%BB%A3%E7%90%86-Tor%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89"><span class="nav-text">Privoxy 代理 Tor（可选）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%99%90%E5%88%B6%E8%AF%B7%E6%B1%82%E6%9D%A5%E6%BA%90%E7%9A%84-IP%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89"><span class="nav-text">限制请求来源的 IP（可选）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%82%E8%BD%BD%E6%9C%AC%E5%9C%B0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89"><span class="nav-text">挂载本地配置文件（可选）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VPN-%E7%AE%A1%E7%90%86"><span class="nav-text">VPN 管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ExpressVPN-%E5%B8%B8%E7%94%A8%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4"><span class="nav-text">ExpressVPN 常用管理命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VPN-%E6%B5%8B%E9%80%9F"><span class="nav-text">VPN 测速</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ExpressVPN-%E4%BD%BF%E7%94%A8-SpeedTest-%E6%B5%8B%E9%80%9F"><span class="nav-text">ExpressVPN 使用 SpeedTest 测速</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="nav-text">常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ExpressVPN-%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0"><span class="nav-text">ExpressVPN 版本更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chrome-%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BD%BF%E7%94%A8-Privoxy-%E4%BB%A3%E7%90%86"><span class="nav-text">Chrome 浏览器使用 Privoxy 代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA-Docker-%E9%95%9C%E5%83%8F%E6%97%B6%E6%97%A0%E6%B3%95%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91"><span class="nav-text">构建 Docker 镜像时无法科学上网</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">410</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">43</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → &#x2F;sitemap.xml"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="external nofollow" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/3fe8dbc5.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术博客"><meta itemprop="description" content="专注于 Java、前端、移动端、微服务、分布式系统、数据库、系统架构、人工智能、大数据、云计算、物联网、虚拟化学习的技术博客。"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="构建 Privoxy、Tor、ExpressVPN 的 Docker 镜像 | Clay 的技术博客"><meta itemprop="description" content="本文主要介绍如何构建集成了 Privoxy、Tor、ExpressVPN、SpeedTest 服务的 Docker 镜像，支持使用 SpeedTest 测试 ExpressVPN 的连接速度。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 构建 Privoxy、Tor、ExpressVPN 的 Docker 镜像</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-04-13 22:18:44" itemprop="dateCreated datePublished" datetime="2021-04-13T22:18:44+08:00">2021-04-13</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-10-25 22:18:44" itemprop="dateModified" datetime="2021-10-25T22:18:44+08:00">2021-10-25</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/3fe8dbc5.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/3fe8dbc5.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>1.8k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>2 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><div id="readmore-container"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="教程目标"><a href="#教程目标" class="headerlink" title="教程目标"></a>教程目标</h3><p>构建集成了 Privoxy、Tor、ExpressVPN、SpeedTest 服务的 Docker 镜像，支持使用 SpeedTest 测试 ExpressVPN 的连接速度。Docker 镜像构建成功后，可以利用 Privoxy 与 Tor 在 ExpressVPN 的基础上，实现普通代理与匿名代理服务。</p><h3 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h3><span id="more"></span><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/rqh656418510/expressvpn-dockerfiles/tree/master/expressvpn-privoxy-tor">expressvpn-privoxy-tor</a></li></ul><h2 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h2><h3 id="Dockerfile-文件"><a href="#Dockerfile-文件" class="headerlink" title="Dockerfile 文件"></a>Dockerfile 文件</h3><p>Dockerfile 文件的内容如下，核心内容是安装 Privoxy、Tor、ExpressVPN，并指定 Privoxy 与 Tor 的监听端口</p><figure class="highlight docker"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:bullseye-slim</span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> maintainer=<span class="string">"benjamin@polkaned.net"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> ACTIVATION_CODE Code</span><br><span class="line"><span class="keyword">ENV</span> LOCATION smart</span><br><span class="line"><span class="keyword">ARG</span> APP=expressvpn_3.<span class="number">25.0</span>.<span class="number">13</span>-<span class="number">1</span>_amd64.deb</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update &amp;&amp; apt-get install -y --no-install-recommends \</span></span><br><span class="line"><span class="bash">    wget curl apt-utils apt-transport-https dirmngr ca-certificates expect iproute2 procps libnm0 gnupg2 tor privoxy \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/lib/apt/lists/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q <span class="string">"https://www.expressvpn.works/clients/linux/<span class="variable">${APP}</span>"</span> -O /tmp/<span class="variable">${APP}</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; dpkg -i /tmp/<span class="variable">${APP}</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /tmp/*.deb \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get purge -y --auto-remove wget \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i \</span></span><br><span class="line"><span class="bash">        -e <span class="string">'s/#SocksPort 192.168.0.1:9100/SocksPort 0.0.0.0:9050/g'</span> \</span></span><br><span class="line"><span class="bash">        -e <span class="string">'s/#ControlPort 9051/ControlPort 9052/g'</span> \</span></span><br><span class="line"><span class="bash">        /etc/tor/torrc \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i \</span></span><br><span class="line"><span class="bash">        -e <span class="string">'s/listen-address\s*127.0.0.1:8118/listen-address 0.0.0.0:8118/g'</span> \</span></span><br><span class="line"><span class="bash">        /etc/privoxy/config</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> entrypoint.sh /tmp/entrypoint.sh</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> expressvpnActivate.sh /tmp/expressvpnActivate.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"/bin/bash"</span>, <span class="string">"/tmp/entrypoint.sh"</span>]</span></span><br></pre></td></tr></tbody></table></figure><h3 id="Shell-脚本文件"><a href="#Shell-脚本文件" class="headerlink" title="Shell 脚本文件"></a>Shell 脚本文件</h3><p><code>entrypoint.sh</code> 文件的内容如下：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/bash</span></span><br><span class="line"></span><br><span class="line">service tor start</span><br><span class="line">service privoxy start</span><br><span class="line"></span><br><span class="line">cp /etc/resolv.conf /tmp/resolv.conf</span><br><span class="line">su<span class="params"> -c</span> <span class="string">'umount /etc/resolv.conf'</span></span><br><span class="line">cp /tmp/resolv.conf /etc/resolv.conf</span><br><span class="line">sed<span class="params"> -i</span> <span class="string">'s/DAEMON_ARGS=.*/DAEMON_ARGS=""/'</span> /etc/init.d/expressvpn</span><br><span class="line">service expressvpn restart</span><br><span class="line">/usr/bin/expect /tmp/expressvpnActivate.sh</span><br><span class="line">expressvpn connect <span class="variable">$SERVER</span></span><br><span class="line"><span class="built_in">exec</span> <span class="string">"<span class="variable">$@</span>"</span></span><br></pre></td></tr></tbody></table></figure><p><code>expressvpnActivate.sh</code> 文件的内容如下：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line">spawn expressvpn activate</span><br><span class="line">expect <span class="string">"code:"</span></span><br><span class="line">send <span class="string">"<span class="variable">$env</span>(ACTIVATION_CODE)\r"</span></span><br><span class="line">expect <span class="string">"information."</span></span><br><span class="line">send <span class="string">"n\r"</span></span><br><span class="line">expect eof</span><br></pre></td></tr></tbody></table></figure><h3 id="构建-Docker-镜像"><a href="#构建-Docker-镜像" class="headerlink" title="构建 Docker 镜像"></a>构建 Docker 镜像</h3><p>由于这里需要从官网下载 ExpressVPN 的安装包，因此构建 Docker 镜像时，必须保证可以科学上网，否则无法正常构建镜像。温馨提示，若无法提供科学上网的条件，可参考<a href="/posts/3fe8dbc5.html#%E6%9E%84%E5%BB%BA-Docker-%E9%95%9C%E5%83%8F%E6%97%B6%E6%97%A0%E6%B3%95%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91">这里</a>的方案来解决。</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword"># docker</span> build<span class="params"> --pull</span><span class="params"> --no</span>-cache<span class="params"> --rm</span><span class="params"> --force</span>-rm<span class="params"> -f</span> Dockerfile<span class="params"> -t</span> polkaned/privoxy-tor-expressvpn:latest .</span><br></pre></td></tr></tbody></table></figure><h2 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h2><h3 id="Docker-运行容器"><a href="#Docker-运行容器" class="headerlink" title="Docker 运行容器"></a>Docker 运行容器</h3><ul><li><code>{% your-activation-code %}</code>：ExpressVPN 的激活码，例如 <code>ACTIVATION_CODE=ABCD1EBGH2IJAL3MNOP4QRS</code></li><li><code>{% LOCATION/ALIAS/COUNTRY %}</code>：ExpressVPN 的连接位置，例如 <code>SERVER=jpyo</code>，若为空值则默认使用 ExpressVPN 的<code>智能位置</code></li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker run \<span class="params"></span></span><br><span class="line"><span class="params">  --env</span>=ACTIVATION_CODE={% your-activation-code %} \<span class="params"></span></span><br><span class="line"><span class="params">  --env</span>=SERVER={% LOCATION/ALIAS/COUNTRY %} \<span class="params"></span></span><br><span class="line"><span class="params">  --cap</span>-add=NET_ADMIN \<span class="params"></span></span><br><span class="line"><span class="params">  --device</span>=/dev/net/tun \<span class="params"></span></span><br><span class="line"><span class="params">  --privileged</span> \<span class="params"></span></span><br><span class="line"><span class="params">  --detach</span>=<span class="literal">true</span> \<span class="params"></span></span><br><span class="line"><span class="params">  --tty</span>=<span class="literal">true</span> \<span class="params"></span></span><br><span class="line"><span class="params">  -p</span> 9050:9050 \<span class="params"></span></span><br><span class="line"><span class="params">  -p</span> 9052:9052 \<span class="params"></span></span><br><span class="line"><span class="params">  -p</span> 8118:8118 \<span class="params"></span></span><br><span class="line"><span class="params">  --name</span>=expressvpn \</span><br><span class="line">  polkaned/privoxy-tor-expressvpn \</span><br><span class="line">  /bin/bash</span><br></pre></td></tr></tbody></table></figure><h3 id="Docker-Compose-运行容器"><a href="#Docker-Compose-运行容器" class="headerlink" title="Docker-Compose 运行容器"></a>Docker-Compose 运行容器</h3><p><code>docker-compose.yml</code> 文件的内容如下：</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.5"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">expressvpn:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">expressvpn</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">polkaned/privoxy-tor-expressvpn:latest</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ACTIVATION_CODE={%</span> <span class="string">your-activation-code</span> <span class="string">%}</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SERVER={%</span> <span class="string">LOCATION/ALIAS/COUNTRY</span> <span class="string">%}</span></span><br><span class="line">    <span class="attr">cap_add:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NET_ADMIN</span></span><br><span class="line">    <span class="attr">devices:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/dev/net/tun</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9050</span><span class="string">:9050</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9052</span><span class="string">:9052</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8118</span><span class="string">:8118</span></span><br><span class="line">    <span class="attr">tty:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">stdin_open:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">/bin/bash</span></span><br></pre></td></tr></tbody></table></figure><p>若其他容器需要使用 ExpressVPN，那么可以参考以下配置内容：</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.5"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">expressvpn:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">expressvpn</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">polkaned/privoxy-tor-expressvpn:latest</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ACTIVATION_CODE={%</span> <span class="string">your-activation-code</span> <span class="string">%}</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SERVER={%</span> <span class="string">LOCATION/ALIAS/COUNTRY</span> <span class="string">%}</span></span><br><span class="line">    <span class="attr">cap_add:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NET_ADMIN</span></span><br><span class="line">    <span class="attr">devices:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/dev/net/tun</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9050</span><span class="string">:9050</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9052</span><span class="string">:9052</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8118</span><span class="string">:8118</span></span><br><span class="line">    <span class="attr">tty:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">stdin_open:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">/bin/bash</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">downloader:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/downloader</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">downloader</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">service:expressvpn</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">expressvpn</span></span><br></pre></td></tr></tbody></table></figure><p>通过 Docker-Compose 创建并启动 Docker 容器</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建并启动容器</span></span><br><span class="line"><span class="keyword"># docker</span>-compose up<span class="params"> -d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看容器的日志信息</span></span><br><span class="line"><span class="keyword"># docker</span> logs<span class="params"> -f</span><span class="params"> --tail</span> 20 expressvpn</span><br></pre></td></tr></tbody></table></figure><h3 id="测试-Privoxy-与-Tor-代理是否可用"><a href="#测试-Privoxy-与-Tor-代理是否可用" class="headerlink" title="测试 Privoxy 与 Tor 代理是否可用"></a>测试 Privoxy 与 Tor 代理是否可用</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试Privoxy</span></span><br><span class="line"><span class="keyword">$ curl</span><span class="params"> -I</span><span class="params"> -x</span> 127.0.0.1:8118 www.google.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试Tor</span></span><br><span class="line"><span class="keyword">$ curl</span><span class="params"> --socks5</span> 127.0.0.1:9050 www.google.com</span><br></pre></td></tr></tbody></table></figure><h2 id="进阶配置"><a href="#进阶配置" class="headerlink" title="进阶配置"></a>进阶配置</h2><h3 id="Privoxy-代理-Tor（可选）"><a href="#Privoxy-代理-Tor（可选）" class="headerlink" title="Privoxy 代理 Tor（可选）"></a>Privoxy 代理 Tor（可选）</h3><p>若希望 Privoxy 代理 Tor，可以在 <code>/etc/privoxy/config</code> 配置文件的末尾添加以下内容：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forward-socks5 / 0.0.0.0:9050 .</span><br></pre></td></tr></tbody></table></figure><h3 id="限制请求来源的-IP（可选）"><a href="#限制请求来源的-IP（可选）" class="headerlink" title="限制请求来源的 IP（可选）"></a>限制请求来源的 IP（可选）</h3><p>若希望限制访问 Privoxy 代理服务的 IP，即新增 IP 白名单，则可以在 <code>/etc/privoxy/config</code> 配置文件的末尾添加以下内容：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑配置文件，IP需要根据实际情况进行更改</span></span><br><span class="line"><span class="keyword"># vim</span> /etc/privoxy/config</span><br><span class="line">permit-access 14.215.177.38/26</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启容器让配置变更生效</span></span><br><span class="line"><span class="keyword"># docker</span> restart expressvpn</span><br></pre></td></tr></tbody></table></figure><h3 id="挂载本地配置文件（可选）"><a href="#挂载本地配置文件（可选）" class="headerlink" title="挂载本地配置文件（可选）"></a>挂载本地配置文件（可选）</h3><p>1）启动 Docker 容器后，分别拷贝一份 Privoxy、Tor 的配置文件到宿主机的本地磁盘</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建宿主机本地的配置文件目录</span></span><br><span class="line"><span class="keyword"># mkdir</span><span class="params"> -p</span> /usr/<span class="built_in">local</span>/tor</span><br><span class="line"><span class="keyword"># mkdir</span><span class="params"> -p</span> /usr/<span class="built_in">local</span>/privoxy</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝容器里的配置文件到宿主机的本地磁盘</span></span><br><span class="line"><span class="keyword"># docker</span> cp expressvpn:/etc/tor/torrc /usr/<span class="built_in">local</span>/tor/torrc</span><br><span class="line"><span class="keyword"># docker</span> cp expressvpn:/etc/privoxy/config /usr/<span class="built_in">local</span>/privoxy/config</span><br></pre></td></tr></tbody></table></figure><p>2）创建 Privoxy 的 <code>user.action</code> 配置文件，用于阻止 Privoxy 指向服务器本身的 IP 和域名，这里请替换为你自己真实服务器的 IP 和域名</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建文件</span></span><br><span class="line"><span class="keyword">$ touch</span> /usr/<span class="built_in">local</span>/privoxy/user.action</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入以下内容到文件中</span></span><br><span class="line"><span class="keyword">$ vim</span> /usr/<span class="built_in">local</span>/privoxy/user.action</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">{+block{block ip and domain which point to server itself}}</span><br><span class="line">127.0.0.1</span><br></pre></td></tr></tbody></table></figure><p>3）创建 Privoxy 的 <code>user.filter</code> 配置文件，用于存放 Privoxy 的过滤规则，暂时不需要填写任何内容</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$ touch</span> /usr/<span class="built_in">local</span>/privoxy/user.filter</span><br></pre></td></tr></tbody></table></figure><p>4）更改 <code>docker-compose.yml</code> 文件，添加数据卷的配置内容（如下所示）</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.5"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">expressvpn:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">expressvpn</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">polkaned/privoxy-tor-expressvpn:latest</span></span><br><span class="line">    <span class="attr">privileged:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ACTIVATION_CODE={%</span> <span class="string">your-activation-code</span> <span class="string">%}</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SERVER={%</span> <span class="string">LOCATION/ALIAS/COUNTRY</span> <span class="string">%}</span></span><br><span class="line">    <span class="attr">cap_add:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NET_ADMIN</span></span><br><span class="line">    <span class="attr">devices:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/dev/net/tun</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9050</span><span class="string">:9050</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9052</span><span class="string">:9052</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8118</span><span class="string">:8118</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">/usr/local/tor/torrc:/etc/privoxy/torrc</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">/usr/local/privoxy/config:/etc/privoxy/config</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">/usr/local/privoxy/user.action:/etc/privoxy/user.action</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">/usr/local/privoxy/user.filter:/etc/privoxy/user.filter</span></span><br><span class="line">    <span class="attr">tty:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">stdin_open:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">/bin/bash</span></span><br></pre></td></tr></tbody></table></figure><h2 id="VPN-管理"><a href="#VPN-管理" class="headerlink" title="VPN 管理"></a>VPN 管理</h2><h3 id="ExpressVPN-常用管理命令"><a href="#ExpressVPN-常用管理命令" class="headerlink" title="ExpressVPN 常用管理命令"></a>ExpressVPN 常用管理命令</h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 优化ExpressVPN的配置</span></span><br><span class="line"><span class="keyword"># docker</span> <span class="built_in">exec</span><span class="params"> -it</span> expressvpn expressvpn protocol lightway_udp</span><br><span class="line"><span class="keyword"># docker</span> <span class="built_in">exec</span><span class="params"> -it</span> expressvpn expressvpn preferences <span class="built_in">set</span> desktop_notifications <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看ExpressVP的配置信息</span></span><br><span class="line"><span class="keyword"># docker</span> <span class="built_in">exec</span><span class="params"> -it</span> expressvpn expressvpn preferences</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看ExpressVPN的连接状态</span></span><br><span class="line"><span class="keyword"># docker</span> <span class="built_in">exec</span><span class="params"> -it</span> expressvpn expressvpn status</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看ExpressVPN的可连接地区</span></span><br><span class="line"><span class="keyword"># docker</span> <span class="built_in">exec</span><span class="params"> -it</span> expressvpn expressvpn list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接VPN（智能连接）</span></span><br><span class="line"><span class="keyword"># docker</span> <span class="built_in">exec</span><span class="params"> -it</span> expressvpn expressvpn connect</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接VPN，并指定连接的地区</span></span><br><span class="line"><span class="keyword"># docker</span> <span class="built_in">exec</span><span class="params"> -it</span> expressvpn expressvpn connect jpyo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 断开VPN连接</span></span><br><span class="line"><span class="keyword"># docker</span> <span class="built_in">exec</span><span class="params"> -it</span> expressvpn expressvpn disconnect</span><br></pre></td></tr></tbody></table></figure><h2 id="VPN-测速"><a href="#VPN-测速" class="headerlink" title="VPN 测速"></a>VPN 测速</h2><h3 id="ExpressVPN-使用-SpeedTest-测速"><a href="#ExpressVPN-使用-SpeedTest-测速" class="headerlink" title="ExpressVPN 使用 SpeedTest 测速"></a>ExpressVPN 使用 SpeedTest 测速</h3><p>若希望测试 ExpressVPN 的连接速度，则可以安装 SpeedTest 来实现，更改后完整的 Dockerfile 如下：</p><figure class="highlight docker"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:bullseye-slim</span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> maintainer=<span class="string">"benjamin@polkaned.net"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> ACTIVATION_CODE Code</span><br><span class="line"><span class="keyword">ENV</span> LOCATION smart</span><br><span class="line"><span class="keyword">ARG</span> APP=expressvpn_3.<span class="number">18.1</span>.<span class="number">0</span>-<span class="number">1</span>_amd64.deb</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update &amp;&amp; apt-get install -y --no-install-recommends \</span></span><br><span class="line"><span class="bash">    wget curl apt-utils apt-transport-https dirmngr ca-certificates expect iproute2 procps libnm0 gnupg2 tor privoxy \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/lib/apt/lists/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; wget -q <span class="string">"https://www.expressvpn.works/clients/linux/<span class="variable">${APP}</span>"</span> -O /tmp/<span class="variable">${APP}</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; dpkg -i /tmp/<span class="variable">${APP}</span> \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /tmp/*.deb \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get purge -y --auto-remove wget \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i \</span></span><br><span class="line"><span class="bash">        -e <span class="string">'s/#SocksPort 192.168.0.1:9100/SocksPort 0.0.0.0:9050/g'</span> \</span></span><br><span class="line"><span class="bash">        -e <span class="string">'s/#ControlPort 9051/ControlPort 9052/g'</span> \</span></span><br><span class="line"><span class="bash">        /etc/tor/torrc \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i \</span></span><br><span class="line"><span class="bash">        -e <span class="string">'s/listen-address\s*127.0.0.1:8118/listen-address 0.0.0.0:8118/g'</span> \</span></span><br><span class="line"><span class="bash">        /etc/privoxy/config \</span></span><br><span class="line"><span class="bash">    &amp;&amp; curl -s https://install.speedtest.net/app/cli/install.deb.sh | bash \</span></span><br><span class="line"><span class="bash">    &amp;&amp; apt-get install speedtest</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> entrypoint.sh /tmp/entrypoint.sh</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> expressvpnActivate.sh /tmp/expressvpnActivate.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"/bin/bash"</span>, <span class="string">"/tmp/entrypoint.sh"</span>]</span></span><br></pre></td></tr></tbody></table></figure><p>使用命令行测试 ExpressVPN 的连接速度：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测速</span></span><br><span class="line"><span class="keyword"># docker</span> <span class="built_in">exec</span><span class="params"> -it</span> expressvpn speedtest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测速，并指定网速的显示单位</span></span><br><span class="line"><span class="keyword"># docker</span> <span class="built_in">exec</span><span class="params"> -it</span> expressvpn speedtest<span class="params"> -u</span> kB/s</span><br></pre></td></tr></tbody></table></figure><p>SpeedTest 支持显示的网速单位如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Decimal prefix, bits per second:  bps, kbps, Mbps, Gbps</span><br><span class="line">Decimal prefix, bytes per second: B/s, kB/s, MB/s, GB/s</span><br><span class="line">Binary prefix, bits per second:   kibps, Mibps, Gibps</span><br><span class="line">Binary prefix, bytes per second:  kiB/s, MiB/s, GiB/s</span><br></pre></td></tr></tbody></table></figure><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="ExpressVPN-版本更新"><a href="#ExpressVPN-版本更新" class="headerlink" title="ExpressVPN 版本更新"></a>ExpressVPN 版本更新</h3><p>若日后希望更新 ExpressVPN 的版本，只需要执行以下两步操作即可：</p><ul><li>1）更改 Dockerfile 里 ExpressVPN 安装包的文件名</li></ul><figure class="highlight docker"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:bullseye-slim</span><br><span class="line">...</span><br><span class="line"><span class="keyword">ARG</span> APP=expressvpn_3.<span class="number">18.1</span>.<span class="number">0</span>-<span class="number">1</span>_amd64.deb</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure><ul><li>2）重新构建 Docker 镜像</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword"># docker</span> build<span class="params"> --pull</span><span class="params"> --no</span>-cache<span class="params"> --rm</span><span class="params"> --force</span>-rm<span class="params"> -f</span> Dockerfile<span class="params"> -t</span> polkaned/privoxy-tor-expressvpn:latest .</span><br></pre></td></tr></tbody></table></figure><h3 id="Chrome-浏览器使用-Privoxy-代理"><a href="#Chrome-浏览器使用-Privoxy-代理" class="headerlink" title="Chrome 浏览器使用 Privoxy 代理"></a>Chrome 浏览器使用 Privoxy 代理</h3><p>若希望 Chrome 浏览器智能切换至 Docker + ExpressVPN + Privoxy/Tor 提供的代理服务（实现国内外流量分流功能），可以安装 <code>SwitchyOmega</code> 浏览器插件来实现，具体使用方式这里不再累述，更多资料可参考以下链接：</p><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/FelisCatus/SwitchyOmega">Proxy SwitchyOmega 的项目地址</a></li><li><a target="_blank" rel="external nofollow" href="https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif?utm_source=chrome-ntp-icon">Proxy SwitchyOmega 的 Chrome 应用商店安装地址</a></li></ul><h3 id="构建-Docker-镜像时无法科学上网"><a href="#构建-Docker-镜像时无法科学上网" class="headerlink" title="构建 Docker 镜像时无法科学上网"></a>构建 Docker 镜像时无法科学上网</h3><p>在上面的教程里，必须保证可以科学上网才能正常构建 Docker 镜像。特殊情况下，可能无法提供科学上网的条件，此时可以通过其他途径手动下载 ExpressVPN 最新版本的 Debian/Ubuntu 安装包，并将安装包重命名为 <code>expressvpn_amd64.deb</code>，然后更改上面的 Dockerfile 的内容（如下所示），这样就可以直接构建 Docker 镜像，不再需要依赖科学上网了。</p><figure class="highlight docker"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> debian:bullseye-slim</span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> maintainer=<span class="string">"benjamin@polkaned.net"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> ACTIVATION_CODE Code</span><br><span class="line"><span class="keyword">ENV</span> LOCATION smart</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> expressvpn_amd64.deb /tmp/expressvpn_amd64.deb</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> dpkg -i /tmp/expressvpn_amd64.deb &amp;&amp; rm -rf /tmp/expressvpn_amd64.deb</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update &amp;&amp; apt-get install -y --no-install-recommends \</span></span><br><span class="line"><span class="bash">    curl apt-utils apt-transport-https dirmngr ca-certificates expect iproute2 procps libnm0 gnupg2 tor privoxy \</span></span><br><span class="line"><span class="bash">    &amp;&amp; rm -rf /var/lib/apt/lists/* \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i \</span></span><br><span class="line"><span class="bash">        -e <span class="string">'s/#SocksPort 192.168.0.1:9100/SocksPort 0.0.0.0:9050/g'</span> \</span></span><br><span class="line"><span class="bash">        -e <span class="string">'s/#ControlPort 9051/ControlPort 9052/g'</span> \</span></span><br><span class="line"><span class="bash">        /etc/tor/torrc \</span></span><br><span class="line"><span class="bash">    &amp;&amp; sed -i \</span></span><br><span class="line"><span class="bash">        -e <span class="string">'s/listen-address\s*127.0.0.1:8118/listen-address 0.0.0.0:8118/g'</span> \</span></span><br><span class="line"><span class="bash">        /etc/privoxy/config</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> entrypoint.sh /tmp/entrypoint.sh</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> expressvpnActivate.sh /tmp/expressvpnActivate.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">"/bin/bash"</span>, <span class="string">"/tmp/entrypoint.sh"</span>]</span></span><br></pre></td></tr></tbody></table></figure><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/dockage/tor-privoxy">Tor Privoxy</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/polkaned/dockerfiles">ExpressVPN Dockerfiles</a></li><li><a href="https://www.techgrow.cn/posts/1b7c9c6f.html">Docker 安装 Privoxy 代理服务</a></li><li><a href="https://www.techgrow.cn/posts/4d31c632.html">Centos7 安装 ExpressVPN 客户端</a></li></ul></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script>var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if(!isMobile)try{var plugin=new ReadmorePlugin;plugin.init({id:"readmore-container",blogId:"96641-5333172926158-056",name:"全栈技术驿站",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",lockToc:"yes",type:"hexo",random:"0.9",interval:"30",expires:"365",height:"auto"})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/3fe8dbc5.html" title="构建 Privoxy、Tor、ExpressVPN 的 Docker 镜像">https://www.techgrow.cn/posts/3fe8dbc5.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎加入微信群</span><br> <img src="/img/wx-group-qr-technology.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%AE%B9%E5%99%A8%E5%8C%96/" rel="tag"><i class="fa fa-tag"></i> 容器化</a><a href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" rel="tag"><i class="fa fa-tag"></i> 开发工具</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/894ad1eb.html" rel="prev" title="Spring Security + OAuth 2.0 + JWT 开发随笔"><i class="fa fa-chevron-left"></i> Spring Security + OAuth 2.0 + JWT 开发随笔</a></div><div class="post-nav-item"> <a href="/posts/2cb9090c.html" rel="next" title="Gateway + Security + OAuth 2.0 + JWT 实现统一的认证授权">Gateway + Security + OAuth 2.0 + JWT 实现统一的认证授权<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright &copy; 2018 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">818k</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">12:23</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="beian"> <span><img src="/img/gonganbeian.png" alt></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备19024664号</a></span></div></div></footer><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-ZfzwelSToHk5YAcr9wbXAmWgyn9Jyq08fSLrLhZE89w="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://unpkg.com/qiniu-js@3.3.1/dist/qiniu.min.js"></script><script>
    var qiniu_domain = "https://qiniu.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/app/api/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn:9360","cssUrl":"https://unpkg.com/@waline/client@2.5.1/dist/waline.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://unpkg.com/@waline/client@2.5.1/dist/waline.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://qiniu.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/app/api/qiniu/token/upload","el":"#waline","comment":true,"path":"/posts/3fe8dbc5.html"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@2.5.1/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>