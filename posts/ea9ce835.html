<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 Dubbo 的入门教程。"><meta property="og:type" content="article"><meta property="og:title" content="Dubbo2 巩固教程之三"><meta property="og:url" content="https://www.techgrow.cn/posts/ea9ce835.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 Dubbo 的入门教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo2-service-manage-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-admin-service-manage.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-expose-service-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-provider-configs.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-expose-service-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-expose-service-3.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-expose-service-4.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-expose-service-5.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-expose-service-6.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-expose-service-7.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-expose-service-8.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-expose-service-sequence.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-spi-5.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-spi-6.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-spi-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-spi-4.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-spi-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-spi-3.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-invoke-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-invoke-2.png"><meta property="article:published_time" content="2019-09-18T15:42:35.000Z"><meta property="article:modified_time" content="2025-09-18T15:42:35.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="微服务"><meta property="article:tag" content="分布式"><meta property="article:tag" content="RPC"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2025/11/dubbo2-service-manage-1.png"><link rel="canonical" href="https://www.techgrow.cn/posts/ea9ce835.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/ea9ce835.html","path":"posts/ea9ce835.html","title":"Dubbo2 巩固教程之三"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Dubbo2 巩固教程之三 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script>
  (function () {

  // 防止 Pjax 重复绑定事件
  if (window.__moonMenuCodeExpandBound) {
    return;
  }
  window.__moonMenuCodeExpandBound = true;

  const STORAGE_KEY = 'moon_menu_code_fold';

  /* ===============================
   * 1. 设置 moon-menu 按钮的 title
   * =============================== */
  (function bindMoonMenuTitles() {
    const items = [
      { selector: '#moon-menu-item-code',        title: '展开 / 折叠代码块' },
      { selector: '#moon-menu-item-back2top',    title: '回到页面顶部' },
      { selector: '#moon-menu-item-back2bottom', title: '回到页面底部' }
    ];

    let allReady = true;

    items.forEach(item => {
      const el = document.querySelector(item.selector);
      if (!el) {
        allReady = false;
        return;
      }
      el.setAttribute('title', item.title);
    });

    if (!allReady) {
      setTimeout(bindMoonMenuTitles, 100);
    }
  })();

  /* =================================
   * 2. 页面首次加载：代码块恢复展开或折叠状态
   * ================================= */
  function applyStoredCodeState() {
    const containers = document.querySelectorAll('.code-container');
    if (!containers.length) {
      return;
    }

    const state = localStorage.getItem(STORAGE_KEY);
    if (!state) {
      return;
    }

    containers.forEach(container => {
      if (state === 'expanded') {
        // 展开代码块
        container.classList.remove('highlight-fold');
      } else if (state === 'folded') {
        // 折叠代码块
        container.classList.add('highlight-fold');
      }
    });
  }

  // 等代码块出现后，再恢复展开或折叠状态
  function waitAndApplyState() {
    const containers = document.querySelectorAll('.code-container');

    if (!containers.length) {
      setTimeout(waitAndApplyState, 100);
      return;
    }

    applyStoredCodeState();
  }

  // 页面首次加载时恢复状态
  waitAndApplyState();
  
  // Pjax 切换页面后，必须重新恢复状态
  document.addEventListener('pjax:complete', function () {
    waitAndApplyState();
  });

  /* ===============================
   * 3. 点击按钮：切换状态并保存
   * =============================== */
  document.addEventListener('click', function (e) {
    const codeMenu = e.target.closest('#moon-menu-item-code');
    if (!codeMenu) {
      return;
    }

    toggleAllCodeBlocks();
  });

  // 展开或折叠代码块
  function toggleAllCodeBlocks() {
    const containers = document.querySelectorAll('.code-container');
    if (!containers.length) {
      return;
    }

    // 只要存在折叠的代码块，就认为当前是折叠状态
    const hasFolded = Array.from(containers).some(c => {
      return c.classList.contains('highlight-fold');
    });

    containers.forEach(container => {
      if (hasFolded) {
        // 展开代码块
        container.classList.remove('highlight-fold');
      } else {
        // 折叠代码块
        container.classList.add('highlight-fold');
      }
    });

    // 记录展开或折叠状态
    localStorage.setItem(
      STORAGE_KEY,
      hasFolded ? 'expanded' : 'folded'
    );
  }

})();
</script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90"><span class="nav-text">学习资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3"><span class="nav-text">Dubbo 深入理解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%B2%BB%E7%90%86%E7%9A%84%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90"><span class="nav-text">服务治理的源码剖析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E"><span class="nav-text">版本说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="nav-text">基础概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2"><span class="nav-text">服务暴露</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="nav-text">服务暴露的流程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-text">服务提供者的配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2%E7%9A%84%E5%85%A5%E5%8F%A3%E6%96%B9%E6%B3%95"><span class="nav-text">服务暴露的入口方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2%E7%9A%84-URL-%E7%BB%84%E8%A3%85"><span class="nav-text">服务暴露的 URL 组装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%9A%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E3%80%81%E5%A4%9A%E5%8D%8F%E8%AE%AE%E6%9A%B4%E9%9C%B2%E6%9C%8D%E5%8A%A1"><span class="nav-text">多注册中心、多协议暴露服务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AF%BC%E5%87%BA%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E4%B8%8E%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1"><span class="nav-text">导出本地服务与远程服务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%91%E5%AE%9A%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="nav-text">绑定服务端口的过程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="nav-text">服务注册的过程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2%E6%80%BB%E7%BB%93"><span class="nav-text">服务暴露总结</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SPI-%E6%89%A9%E5%B1%95%E6%9C%BA%E5%88%B6"><span class="nav-text">SPI 扩展机制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#SPI-%E5%9C%A8%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-text">SPI 在服务暴露中的应用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SPI-%E8%87%AA%E9%80%82%E5%BA%94%E6%89%A9%E5%B1%95%E7%82%B9%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="nav-text">SPI 自适应扩展点的介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SPI-%E6%9C%BA%E5%88%B6%E7%9A%84%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-text">SPI 机制的使用示例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SPI-%E6%9C%BA%E5%88%B6%E7%9A%84%E6%A0%B8%E5%BF%83%E6%B3%A8%E8%A7%A3"><span class="nav-text">SPI 机制的核心注解</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SPI-%E6%9C%BA%E5%88%B6%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-text">SPI 机制的实现原理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SPI-%E6%9C%BA%E5%88%B6%E7%9A%84%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B"><span class="nav-text">SPI 机制的加载流程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SPI-%E6%9C%BA%E5%88%B6%E7%9A%84%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90"><span class="nav-text">SPI 机制的源码剖析</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dubbo-%E4%B8%AD%E7%9A%84-Invoker"><span class="nav-text">Dubbo 中的 Invoker</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Invoker-%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-text">Invoker 的概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Wrapper-%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-text">Wrapper 的概念</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">789</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">54</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/ea9ce835.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Dubbo2 巩固教程之三 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 Dubbo 的入门教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Dubbo2 巩固教程之三</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-09-18 23:42:35" itemprop="dateCreated datePublished" datetime="2019-09-18T23:42:35+08:00">2019-09-18</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-09-18 23:42:35" itemprop="dateModified" datetime="2025-09-18T23:42:35+08:00">2025-09-18</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/ea9ce835.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/ea9ce835.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>9.5k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>9 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/ef04d10a.html">Dubbo 2 巩固教程之一</a>、<a href="/posts/b6d5fbb8.html">Dubbo 2 巩固教程之二</a>、<a href="/posts/ea9ce835.html">Dubbo 2 巩固教程之三</a></li><li><a href="/posts/a64e842b.html">Dubbo 2 巩固教程之四</a>、<a href="/posts/bbace66e.html">Dubbo 2 巩固教程之五</a>、<a href="/posts/a49012b.html">Dubbo 2 巩固教程之六</a></li><li><a href="/posts/bdb52e6d.html">Dubbo 2 巩固教程之七</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h3><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/incubator-dubbo/">Dubbo 官方项目（GitHub）</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-samples">Dubbo 官方案例（GitHub）</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docsv2.7/">Dubbo 官方文档（2.7 版本）</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docs/">Dubbo 官方文档（快照版本）</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/">Dubbo 官方文档（最新版本）</a></li></ul><span id="more"></span><h2 id="Dubbo-深入理解"><a href="#Dubbo-深入理解" class="headerlink" title="Dubbo 深入理解"></a>Dubbo 深入理解</h2><h3 id="服务治理的源码剖析"><a href="#服务治理的源码剖析" class="headerlink" title="服务治理的源码剖析"></a>服务治理的源码剖析</h3><h4 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h4><table><thead><tr><th>组件</th><th>版本</th><th>说明</th></tr></thead><tbody><tr><td> Dubbo</td><td><code>2.6.6</code></td><td>在阅读 Dubbo 源码时要注意，不同版本由于协议升级、SPI 改动、注册中心增强等因素，底层实现会出现细微差异；版本跨度越大，差异通常越明显。</td></tr></tbody></table><h4 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h4><p>使用 Dubbo 开发时，可能会遇到以下问题：</p><ul><li>(1) 服务接口粒度较粗时，如何实现读写场景的分离？</li><li>(2) 查询接口返回列表时，如何区分单条查询与多条查询的调用场景？</li><li>(3) 运行过程中，如果需要为某个应用额外增加服务实例，该如何实现？</li><li>(4) 运行过程中，如果需要动态调整服务权重，该如何实现？</li><li>(5) 运行过程中，如何需要动态调整服务的负载均衡策略，该如何实现？</li><li>(6) 如何在不停服的情况下发布新的服务版本？</li></ul><p>Dubbo 的服务治理主要用于在运行时动态调整服务的行为和调用选址策略，从而实现限流、权重调整、路由控制等能力。</p><p><img data-src="../../../asset/2025/11/dubbo2-service-manage-1.png"></p><p>Dubbo 的服务治理（包括条件路由、标签路由、黑白名单、动态配置、权重调整、负载均衡等），都支持通过 <a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-admin">Dubbo-Admin</a> 服务治理控制台进行配置（动态调整），如下图所示：</p><p><img data-src="../../../asset/2025/11/dubbo-admin-service-manage.png"></p><div class="admonition note"><p class="admonition-title">思考问题</p><ul><li>Dubbo 如何实现灰度发布、蓝绿发布、红黑发布、滚动发布、金丝雀发布、A/B 测试呢？</li><li>Dubbo 本身是服务治理框架，不负责流量调度，但它提供了条件路由 (ConditionRouter)、标签路由（TagRouter）、动态配置等机制，使得可以基于这些能力实现各种灰度与流量控制策略。</li></ul></div><h4 id="服务暴露"><a href="#服务暴露" class="headerlink" title="服务暴露"></a>服务暴露</h4><h5 id="服务暴露的流程"><a href="#服务暴露的流程" class="headerlink" title="服务暴露的流程"></a>服务暴露的流程</h5><ul><li><p>1、读取配置</p><ul><li>Spring 启动 → 解析 <code>@DubboService</code> / <code>&lt;dubbo:service&gt;</code> → 生成 ServiceBean。</li></ul></li><li><p>2、初始化 ServiceBean</p><ul><li>ServiceBean 触发 <code>afterPropertiesSet()</code> → 准备接口、实现类、协议、端口等信息。</li></ul></li><li><p>3、导出服务（Export）</p><ul><li>调用 <code>ServiceConfig.export()</code> → 进入真正的暴露逻辑。</li></ul></li><li><p>4、本地导出服务（可选）</p><ul><li>如果 Provider 配置了 <code>scope=local</code>（或旧版本的写法 <code>scope=injvm</code>） → 导出服务到本地 JVM，通过 <code>InjvmProtocol</code> 将服务放入本地内存 Map。</li></ul></li><li><p>5、远程导出服务</p><ul><li>走 <code>doExportUrls()</code> → 选择协议（如 <code>dubbo</code>）</li><li>调用 <code>DubboProtocol.export()</code> → 创建 Exporter 并打开 Netty Server 监听端口。</li></ul></li><li><p>6、注册中心注册服务</p><ul><li>如果有 Registry（比如 ZooKeeper） → 调用 <code>ZookeeperRegistry.register()</code> → 将 URL 节点写入 <code>/dubbo/${serviceInterface}/providers/</code>。</li></ul></li><li><p>7、启动完成，写入元数据（Metadata）</p><ul><li><code>MetadataService</code> 写入元数据 → 用于服务治理和服务消费者订阅。</li></ul></li></ul><p><img data-src="../../../asset/2025/11/dubbo-expose-service-1.png"></p><h5 id="服务提供者的配置"><a href="#服务提供者的配置" class="headerlink" title="服务提供者的配置"></a>服务提供者的配置</h5><ul><li>Dubbo 服务提供者的配置信息如下图所示：</li></ul><p><img data-src="../../../asset/2025/11/dubbo-provider-configs.png"></p><h5 id="服务暴露的入口方法"><a href="#服务暴露的入口方法" class="headerlink" title="服务暴露的入口方法"></a>服务暴露的入口方法</h5><ul><li>Dubbo 服务暴露的入口方法是　<code>ServiceConfig.export()</code>，可以从这个方法入手阅读 Dubbo 服务暴露的底层源码实现</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.ServiceConfig;</span><br><span class="line"></span><br><span class="line">ServiceConfig&lt;DemoService&gt; service = <span class="keyword">new</span> ServiceConfig&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...(省略其他赋值代码)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 暴露及注册服务</span></span><br><span class="line">service.export();</span><br></pre></td></tr></tbody></table></figure><h5 id="服务暴露的-URL-组装"><a href="#服务暴露的-URL-组装" class="headerlink" title="服务暴露的 URL 组装"></a>服务暴露的 URL 组装</h5><ul><li><p>Dubbo 负责组装并导出服务 URL 的方法是 <code>ServiceConfig.doExportUrlsFor1Protocol()</code>（部分核心代码如下图所示）。该方法的主要作用：</p><ul><li>为单个协议（Protocol）生成并导出服务 URL（比如 <code>dubbo://127.0.0.1:20880/com.demo.service.DemoService?anyhost=true...</code>）</li><li>完成服务的本地导出 + 远程导出逻辑</li><li>注册服务到注册中心（Registry）</li><li>处理协议相关的参数（比如：权重、<code>token</code>、<code>timeout</code>）等配置</li></ul><p><img data-src="../../../asset/2025/11/dubbo-expose-service-2.png"></p></li><li><p> Dubbo 中 URL 是一个非常重要的契约，所有扩展点都要遵守。</p></li><li><p>所有扩展点参数都包含 URL 参数，URL 作为上下文信息贯穿了整个扩展点设计体系。</p></li><li><p>URL 采用标准格式：<code>protocol://username:password@host:port/path?key1=value1&amp;key2=value2...</code>。</p><ul><li>比如：<code>dubbo://127.0.0.1:20880/com.demo.service.DemoService?anyhost=true&amp;application=provider-application&amp;dubbo=2.0.2&amp;dynamic=true&amp;generic=false&amp;side=provider...</code></li></ul></li></ul><div class="admonition note"><p class="admonition-title">提示</p><p>Dubbo 将服务注册到 ZooKeper 注册中心后，ZooKeper 注册中心里面的数据存储结构和数据格式可以看 <a href="/posts/b6d5fbb8.html#ZK-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E4%BD%BF%E7%94%A8">这里</a> 的介绍。</p></div><h5 id="多注册中心、多协议暴露服务"><a href="#多注册中心、多协议暴露服务" class="headerlink" title="多注册中心、多协议暴露服务"></a>多注册中心、多协议暴露服务</h5><ul><li>Dubbo 暴露服务时，支持多注册中心、多协议，具体方法是（部分核心代码如下图所示）：<ul><li><code>ServiceConfig.doExportUrls()</code></li><li><code>ServiceConfig.doExportUrlsFor1Protocol()</code></li></ul></li></ul><p><img data-src="../../../asset/2025/11/dubbo-expose-service-3.png"></p><h5 id="导出本地服务与远程服务"><a href="#导出本地服务与远程服务" class="headerlink" title="导出本地服务与远程服务"></a>导出本地服务与远程服务</h5><blockquote><p>Exporter 导出本地服务</p></blockquote><p>在 <code>ServiceConfig.doExportUrlsFor1Protocol()</code> 方法中，会调用 <code>ServiceConfig.exportLocal()</code> 方法将服务导出到本地，即导出服务到本地 JVM（<code>injvm</code>）。下图展示了 <code>ServiceConfig.exportLocal()</code> 方法的核心源码：</p><p><img data-src="../../../asset/2025/11/dubbo-expose-service-4.png"></p><blockquote><p>Exporter 导出远程服务</p></blockquote><p>Dubbo 将服务导出到远程的流程较为复杂，包含 <strong>服务导出</strong> 和 <strong>服务注册</strong> 两个阶段。当循环遍历到协议头为 <code>registry://</code> 的 <code>registryURL</code> 时，就会进入 <code>RegistryProtocol.export()</code> 方法进行处理。下图展示了 <code>RegistryProtocol.export()</code> 方法的核心源码：</p><p><img data-src="../../../asset/2025/11/dubbo-expose-service-5.png"></p><h5 id="绑定服务端口的过程"><a href="#绑定服务端口的过程" class="headerlink" title="绑定服务端口的过程"></a>绑定服务端口的过程</h5><p>在 <code>RegistryProtocol.doLocalExport()</code> 方法中，会执行服务端口的绑定（即启动 TCP 服务器），下图展示了 <code>RegistryProtocol.doLocalExport()</code> 方法的核心源码：</p><p><img data-src="../../../asset/2025/11/dubbo-expose-service-6.png"></p><p>当使用的是 <code>dubbo</code> 协议时，<code>RegistryProtocol.doLocalExport()</code> 方法会调用 <code>DubboProtocol.export()</code> 方法，后续的方法调用链是 <code>DubboProtocol.openServer()</code> -&gt; <code>DubboProtocol.createServer()</code> -&gt; <code>Exchangers.bind()</code> -&gt; <code>HeaderExchanger.bind()</code> -&gt; <code>Transporters.bind()</code> -&gt; <code>NettyTransporter.bind()</code> -&gt; <code>NettyServer()</code> -&gt; <code>AbstractServer()</code> -&gt; <code>AbstractServer.doOpen()</code> -&gt; <code>NettyServer.doOpen()</code></p><p><img data-src="../../../asset/2025/11/dubbo-expose-service-7.png"></p><h5 id="服务注册的过程"><a href="#服务注册的过程" class="headerlink" title="服务注册的过程"></a>服务注册的过程</h5><p>Dubbo 将服务注册到注册中心（比如　Zookeeper）的方法调用链是 <code>RegistryProtocol.export()</code> -&gt; <code>ZookeeperRegistry.register()</code>。下图展示了 <code>RegistryProtocol.export()</code> 方法的核心源码：</p><p><img data-src="../../../asset/2025/11/dubbo-expose-service-8.png"></p><h5 id="服务暴露总结"><a href="#服务暴露总结" class="headerlink" title="服务暴露总结"></a>服务暴露总结</h5><p>Dubbo（<code>2.7.x</code>）服务暴露的时序图（源自 Dubbo 官方文档）如下所示：</p><p><img data-src="../../../asset/2025/11/dubbo-expose-service-sequence.png"></p><p>Dubbo（<code>2.6.6</code>）服务暴露的完整调用链如下（仅供参考，并非绝对严谨）：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ServiceConfig.export()                                 ─► 服务暴露入口</span><br><span class="line">  └─ ServiceConfig.doExport()                          ─► 处理延迟暴露、状态检查，真正进入导出流程</span><br><span class="line">    └─ ServiceConfig.doExportUrls()                    ─► 构建所有需要导出的 URL（包括本地导出与远程导出）</span><br><span class="line">        └─ ServiceConfig.doExportUrlsFor1Protocol()    ─► 针对单个协议执行导出流程</span><br><span class="line">            └─ Protocol$Adaptive.export()              ─► 选择具体协议，SPI 自适应扩展，根据 registry:// 选择 RegistryProtocol</span><br><span class="line">                └─ RegistryProtocol.export()           ─► 进入注册中心协议处理流程（服务注册核心位置）</span><br><span class="line">                      └─ doLocalExport(originInvoker)                    ─► 执行本地服务导出，创建 Exporter，启动协议层服务（如 DubboProtocol + NettyServer）</span><br><span class="line">                          └─ DubboProtocol.export()                      ─► 构建 Exporter、准备服务暴露逻辑</span><br><span class="line">                              └─ new NettyServer(...)                    ─► 创建底层网络服务器（默认基于 Netty）</span><br><span class="line">                                  └─ NettyServer.doOpen()                ─► 真正绑定端口，启动 Netty 服务器，开始监听请求</span><br><span class="line">                      ├─ registry = registryFactory.getRegistry()        ─► 通过 SPI 创建 / 获取对应的 Registry 实例（如 ZookeeperRegistry）</span><br><span class="line">                      ├─ registry.register(providerUrl)                  ─► 将服务 URL 注册到注册中心（写入 Zookeeper）</span><br><span class="line">                      └─ 返回 Exporter（最终服务暴露完成）</span><br></pre></td></tr></tbody></table></figure><h4 id="SPI-扩展机制"><a href="#SPI-扩展机制" class="headerlink" title="SPI 扩展机制"></a>SPI 扩展机制</h4><div class="admonition note"><p class="admonition-title">扩展阅读</p><ul><li><a href="/posts/ef54a41c.html">Java 与 Dubbo 的 SPI 机制介绍</a></li></ul></div><h5 id="SPI-在服务暴露中的应用"><a href="#SPI-在服务暴露中的应用" class="headerlink" title="SPI 在服务暴露中的应用"></a>SPI 在服务暴露中的应用</h5><ul><li><p>在 Dubbo 服务暴露的源码中，难以理解的地方（以下源码位于 <code>ServiceConfig.doExportUrlsFor1Protocol()</code>）</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Invoker、Exporter 是什么? 为什么 proxyFactory、protocol 能创造它们?</span></span><br><span class="line">Invoker&lt;?&gt; invoker = proxyFactory.getInvoker(ref, (Class) interfaceClass, registryURL.addParameterAndEncoded(Constants.EXPORT_KEY, url.toFullString()));</span><br><span class="line">DelegateProviderMetaDataInvoker wrapperInvoker = <span class="keyword">new</span> DelegateProviderMetaDataInvoker(invoker, <span class="keyword">this</span>);</span><br><span class="line">Exporter&lt;?&gt; exporter = protocol.export(wrapperInvoker);</span><br><span class="line">exporters.add(exporter);</span><br></pre></td></tr></tbody></table></figure></li><li><p>Invoker 与 Exporter</p><ul><li><code>Invoker</code> 是实体域，作为 Dubbo 的核心模型，其他模型都向它靠拢或转换成它。它代表一个可执行体，能够将所有需要代理执行的方法，用 <code>Invoker</code> 进行抽象和转换。</li><li><code>Exporter</code> 是一个服务暴露控制接口，用于获取暴露的 <code>Invoker</code>，以及注销暴露的 <code>Invoker</code>。</li></ul></li><li><p>API 与 SPI</p><ul><li>Dubbo 框架有两类用户：框架使用者和框架扩展开发者。</li><li>为了对这两类用户进行隔离，使用者通过 API 来使用框架，开发者通过 SPI 来对框架进行扩展。</li><li>使用者无需从编码层面知道扩展类型，只需配置即可；扩展者也能很方便地扩展功能，不需要考虑适应不同的业务代码场景。</li><li>Dubbo 没有采用 JDK 内置的 SPI 机制，而是自己实现了一套 SPI 机制。</li></ul></li></ul><h5 id="SPI-自适应扩展点的介绍"><a href="#SPI-自适应扩展点的介绍" class="headerlink" title="SPI 自适应扩展点的介绍"></a>SPI 自适应扩展点的介绍</h5><ul><li>Dubbo SPI 自适应扩展的介绍<ul><li> <strong>Dubbo SPI 自适应扩展的作用是：在运行时根据参数值动态决定采用哪个扩展点实现类。</strong><br><img data-src="../../../asset/2025/11/dubbo-spi-5.png"></li><li>Dubbo 中有多种类型的扩展点，例如协议、集群容错、负载均衡、注册中心、序列化等。这些扩展点在运行时获取参数的方式并不统一：有的依赖 URL 参数名获取参数值，有的在没有 URL 信息时只能通过 <code>Invocation</code> 获取方法级参数。</li><li>为了解决不同扩展点参数来源不一致的问题<ul><li> Dubbo 通过 Adaptive（自适应）动态代码生成机制自动生成代理类，比如 Dubbo 自动生成的 <code>Protocol$Adaptive</code> 代理类的代码示例可以看 <a href="../../../downloads/2025/11/Protocol$Adaptive.java">这里</a>；</li><li>Dubbo 自动生成的代理类，可以在运行时根据实际上下文（如 URL、<code>Invocation</code>、<code>ReferenceConfig</code>、<code>ServiceConfig</code> 等）灵活选择具体扩展实现，从而屏蔽参数来源差异，保证扩展点能够自适应地工作。</li></ul></li></ul></li></ul><hr><ul><li>Dubbo SPI 自适应扩展的使用<ul><li>在需要进行自适应的扩展类或接口方法标注 <code>@Adaptive</code> 注解。</li><li>当 <code>@Adaptive</code> 注解在接口方法上（最常见）<ul><li>Dubbo 会为该接口方法生成代理逻辑，实现运行时根据参数动态选择具体扩展实现。</li></ul></li><li>当 <code>@Adaptive</code> 注解在扩展类上（较少使用）<ul><li>Dubbo 不会为该扩展类生成代理类；</li><li>这种情况在 Dubbo 中很少见，目前仅有两个扩展类标注了 <code>@Adaptive</code>，分别是 <code>AdaptiveCompiler</code> 和 <code>AdaptiveExtensionFactory</code>，表示这些扩展类的加载逻辑由人工编码（静态编码）完成。</li></ul></li></ul></li></ul><hr><ul><li>Dubbo SPI 自适应扩展的实现<br><img data-src="../../../asset/2025/11/dubbo-spi-6.png"></li></ul><h5 id="SPI-机制的使用示例"><a href="#SPI-机制的使用示例" class="headerlink" title="SPI 机制的使用示例"></a>SPI 机制的使用示例</h5><ul><li><p>Dubbo 内部使用 SPI 机制的源码案例<br><img data-src="../../../asset/2025/11/dubbo-spi-1.png"></p></li><li><p>自定义 Dubbo SPI 扩展的基本步骤（例如，自定义协议扩展实现）</p><ul><li>(1) 提供 SPI 插件的扩展实现类<ul><li>提供一个 Java 类实现 <code>org.apache.dubbo.rpc.Protocol</code> 接口<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.spi.demo;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.rpc.Protocol;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现自己的 Dubbo 协议</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomizedProtocol</span> <span class="keyword">implements</span> <span class="title">Protocol</span> </span>{</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ul></li><li>(2) 在指定的文件里面配置扩展实现类<ul><li>在应用的 <code>resources/META-INF/dubbo/</code> 目录下创建 <code>org.apache.dubbo.rpc.Protocol</code> 文件，并在文件中添加如下配置内容：<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">customized=com.spi.demo.CustomizedProtocol</span><br></pre></td></tr></tbody></table></figure></li><li>文件名必须为 SPI 接口的全限定名，例如：<code>META-INF/dubbo/org.apache.dubbo.rpc.Protocol</code>，对应你要扩展的接口。</li><li>文件内容必须为 <code>key=value</code> 形式，其中 <code>key</code> 为扩展名（可自定义，建议添加特定前缀避免与 Dubbo 内置实现冲突），<code>value</code> 为扩展实现类的全限定名。</li></ul></li><li>(3) 通过 Dubbo 配置启用自定义协议实现<ul><li>在应用中修改 Dubbo 的协议配置，告诉 Dubbo 框架使用自定义协议：<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 SpringBoot 时，可修改 application.yml 或 application.properties 配置文件</span></span><br><span class="line"><span class="string">dubbo</span></span><br><span class="line">  <span class="string">protocol</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">customized</span></span><br></pre></td></tr></tbody></table></figure></li><li>或者，使用原生 API 告诉 Dubbo 框架使用自定义协议：<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ProtocolConfig protocol = <span class="keyword">new</span> ProtocolConfig();</span><br><span class="line">protocol.setName(<span class="string">"cutomized"</span>);</span><br></pre></td></tr></tbody></table></figure></li></ul></li></ul></li></ul><h5 id="SPI-机制的核心注解"><a href="#SPI-机制的核心注解" class="headerlink" title="SPI 机制的核心注解"></a>SPI 机制的核心注解</h5><p>Dubbo SPI 机制有两个核心注解，分别是 <code>@Adaptive</code> 和 <code>@Activate</code>。</p><ul><li><strong><code>@Adaptive</code> 注解（自适应）</strong><ul><li>主要作用<ul><li>表示该扩展类或接口方法需要自适应扩展，Dubbo 会在运行时根据 URL 或其他条件动态选择具体扩展实现。</li></ul></li><li>常见使用方式<ul><li><code>@Adaptive</code> 标注在接口方法上（最常见）<ul><li>表示由 Dubbo 自动生成 <code>Xxx$Adaptive</code> 代理类</li><li>方法内部会根据 URL 参数在运行时选择具体扩展实现</li><li>使用例子：<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Protocol</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Adaptive({"protocol", "defaultProtocol"})</span></span><br><span class="line">    <span class="function">Exporter <span class="title">export</span><span class="params">(Invoker invoker)</span></span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>当上面调用 <code>export()</code> 方法时，Dubbo 会根据 URL 的 <code>protocol</code> 或 <code>defaultProtocol</code> 参数决定使用哪个协议实现</li></ul></li></ul></li><li><code>@Adaptive</code> 标注在扩展类上（较少使用）<ul><li>表示该扩展类是一个手工编写的自适应扩展类</li><li> Dubbo 将直接使用这个扩展类，而不会再自动生成代理类</li><li>一般用于非常复杂的场景，比如需要手写逻辑替代 Dubbo 自动生成代理类</li><li>目前 Dubbo 中仅有两个扩展类标注了 <code>@Adaptive</code>，分别是 <code>AdaptiveCompiler</code> 和 <code>AdaptiveExtensionFactory</code>，表示这些扩展类的加载逻辑由人工编码（静态编码）完成</li><li>使用例子：<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Adaptive</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomAdaptiveCompiler</span> <span class="keyword">implements</span> <span class="title">Compiler</span> </span>{</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; compile(String code, ClassLoader loader) {</span><br><span class="line">        <span class="comment">// 自定义代码编译逻辑</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ul></li></ul></li><li>使用注意事项<ul><li>接口上不能标注 <code>@Adaptive</code></li><li>接口方法上可以标注 <code>@Adaptive</code>，表示使用 Dubbo 自动生成的代理类，适用大多数场景</li><li>扩展类上可以标注 <code>@Adaptive</code>，表示使用手写的自适应逻辑，适用特殊复杂场景</li></ul></li></ul></li></ul><hr><ul><li><strong><code>@Activate</code> 注解（自动激活）</strong><ul><li>主要作用<ul><li>表示当扩展类被自动加载时，满足 <code>group</code>、<code>value</code>、<code>order</code> 等条件，该扩展会自动加入扩展链，无需手动在配置中指定扩展名。</li></ul></li><li>常见使用方式<ul><li><code>@Activate</code> 标注在扩展类上（最常见）<ul><li>扩展类在满足 Activate 条件时自动激活</li><li>一般用于 Filter、Router、ExporterListener、Registry 等扩展点</li><li>使用例子：<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Activate(group = {"provider"}, order = 10)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProviderFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">invoke</span><span class="params">(Invoker&lt;?&gt; invoker, Invocation invocation)</span> </span>{</span><br><span class="line">        <span class="comment">// 自定义过滤逻辑</span></span><br><span class="line">        <span class="keyword">return</span> invoker.invoke(invocation);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ul></li><li><code>@Activate</code> 标注在接口方法上（较少使用）<ul><li>表示该接口方法返回的扩展类实例在调用时可自动激活</li><li>可结合 URL 参数或 <code>group</code>、<code>value</code>、<code>order</code> 条件进行动态控制</li><li>使用例子：<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SomeFactory</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Activate(value = {"feature"}, group = "consumer")</span></span><br><span class="line">    <span class="function">Extension <span class="title">create</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li></ul></li></ul></li><li>典型使用 <code>@Activate</code> 自动激活的扩展点（最常见场景）<ul><li>Filter 自动生效（过滤器）</li><li>Router 自动生效（路由）</li><li>ExporterListener 自动生效（监听服务暴露）</li><li>Registry（如注册中心相关监听、通知）自动生效</li></ul></li><li>可使用 <code>@Activate</code> 激活，但通常是通过 URL 指定或者明确选择的的扩展点<ul><li> Cluster（有些装饰逻辑可能自动封装，但多数是由 Dubbo 主流程显式选择）</li><li>Protocol（支持 <code>@Activate</code>，但较少用于自动激活，一般是 URL 或显式选择）</li><li>ProxyFactory（可自动激活，但通常通过指定实现选择）</li></ul></li><li>使用注意事项<ul><li>接口上不能标注 <code>@Activate</code></li></ul></li></ul></li></ul><div class="admonition note"><p class="admonition-title">总结</p><ul><li><code>@Adaptive</code>（自适应）的作用：让扩展在运行时根据 URL 或条件动态选择具体扩展实现；标注在方法上，则表示由 Dubbo 自动生成代理类；标注在类上，则表示使用手写的自适应逻辑。</li><li><code>@Activate</code>（自动激活）的作用：让扩展类在满足 Activate 条件时自动激活加入调用链；可以省略，但省略后不会自动激活，必须通过扩展名主动加载，例如： <code>extensionLoader.getExtension("customizedProtocol");</code>。</li></ul></div><h5 id="SPI-机制的实现原理"><a href="#SPI-机制的实现原理" class="headerlink" title="SPI 机制的实现原理"></a>SPI 机制的实现原理</h5><ul><li>(1) 使用 <code>@SPI</code> 注解<ul><li>在接口上标注 <code>@SPI</code> 注解，表示这个接口是 Dubbo 的扩展点</li><li><code>@SPI</code> 注解可以设置参数：<ul><li>比如 <code>@SPI("defaultName")</code>：指定该扩展点的默认扩展名<ul><li>当调用 <code>getDefaultExtension()</code> 或未明确指定扩展名时，会使用此默认实现</li></ul></li><li>如果 <code>@SPI</code> 注解不设置参数，则该扩展点没有默认实现，必须在调用时明确指定扩展名。</li></ul></li></ul></li><li>(2) 创建扩展配置文件<ul><li>扩展配置文件存放位置：<code>META-INF/dubbo/接口全限定名文件</code></li><li>文件名称是：接口全限定名</li><li>文件内容是：<code>扩展名 = 扩展类全限定名</code></li></ul></li><li>(3) 由 <code>ExtensionLoader</code> 类加载扩展<ul><li>读取扩展配置文件</li><li>建立 “扩展名 → 扩展类” 映射</li><li>完成实例化、缓存、生命周期管理</li><li>首次使用时才加载（即懒加载）</li></ul></li><li>(4) 支持通过 <code>@Adaptive</code> 注解动态选择扩展<ul><li> Dubbo 会自动生成代理类，根据 URL 参数在运行时选择具体扩展实现</li></ul></li><li> (5) 支持通过 <code>@Activate</code> 注解自动激活扩展<ul><li>根据 <code>group</code>、<code>value</code>、<code>order</code> 等条件自动激活扩展，可实现过滤器链（Filter）等机制</li></ul></li></ul><h5 id="SPI-机制的加载流程"><a href="#SPI-机制的加载流程" class="headerlink" title="SPI 机制的加载流程"></a>SPI 机制的加载流程</h5><ul><li>Dubbo SPI 机制加载扩展的核心步骤：<ul><li>(1) 读取并解析配置文件</li><li> (2) 缓存所有扩展实现类</li><li> (3) 基于用户执行的扩展名，实例化对应的扩展实现类</li><li> (4) 执行扩展实例属性的 IOC 注入（基于 <code>Setter</code> 注入），以及实例化扩展的包装类，实现 AOP 特性</li></ul></li></ul><hr><ul><li> Dubbo SPI 机制加载扩展的整个流程：<br><img data-src="../../../asset/2025/11/dubbo-spi-4.png"></li></ul><h5 id="SPI-机制的源码剖析"><a href="#SPI-机制的源码剖析" class="headerlink" title="SPI 机制的源码剖析"></a>SPI 机制的源码剖析</h5><ul><li><p>Dubbo SPI 机制的核心实现源码</p><ul><li>核心实现源码位于 <code>com.alibaba.dubbo.common.extension.ExtensionLoader</code> 类<ul><li>负责加载扩展配置文件、创建扩展实例、缓存实例、处理依赖注入，以及生成 Adaptive 代理对象或包装 Wrapper 扩展等</li></ul></li><li><code>ExtensionLoader</code> 类的核心方法有以下几个（不限于）：<ul><li><code>getExtensionLoader()</code> —— 获取指定接口类型的 <code>ExtensionLoader</code> 实例，是 SPI 的入口。</li><li><code>getExtensionClass()</code> —— 获取指定扩展名对应的扩展实现类。</li><li><code>loadExtensionClasses()</code> —— 加载接口对应的所有扩展实现类，解析 <code>META-INF/dubbo</code> 配置文件。</li><li><code>getExtension()</code> —— 根据扩展名获取单个扩展实例（普通扩展）。</li><li><code>getActivateExtension()</code> —— 获取符合条件的自动激活扩展集合。</li><li><code>createExtension()</code> —— 创建普通扩展实例，并注入其依赖扩展。</li><li><code>createAdaptiveExtension()</code> —— 创建 Adaptive 代理对象，实现方法级别自适应扩展逻辑。</li><li><code>createAdaptiveExtensionClassCode()</code> —— 生成 Adaptive（自适应）动态代理类的 Java 源码，用于根据 URL 参数选择具体扩展实现。</li></ul></li></ul><p><img data-src="../../../asset/2025/11/dubbo-spi-2.png"></p><p><img data-src="../../../asset/2025/11/dubbo-spi-3.png"></p></li><li><p>Dubbo SPI 机制的源码剖析</p><ul><li><p>(1) 通过反射创建扩展类实例</p><ul><li>Dubbo 使用 <code>Class.newInstance()</code> 或构造函数反射来创建扩展类对象实例。</li><li>扩展类实例化的逻辑集中在 <code>ExtensionLoader.createExtension()</code> 中。</li></ul></li><li><p>(2) 依赖注入：<code>injectExtension()</code> 方法</p><ul><li>扩展类实例创建后，Dubbo 会遍历其所有 <code>setter</code> 方法。</li><li>如果某个 <code>setter</code> 方法的参数类型是另一个扩展点接口：<ul><li>则通过 <code>ExtensionLoader.getExtension()</code> 获取对应扩展实例</li><li>调用 <code>setter</code> 方法将其注入</li></ul></li><li>这相当于一个轻量级的 IOC 容器，但只对扩展点生效。</li></ul></li><li><p>(3) 包装类（Wrapper）的处理机制</p><ul><li>Dubbo 支持 “包装类” 扩展机制，用于为扩展点添加通用逻辑（如 Filter 链、Cluster 封装）。</li><li>wrapper 类特征：<ul><li>它有一个构造函数参数刚好为当前扩展接口，例如：<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">XxxWrapper</span><span class="params">(Xxx extension)</span> </span>{}</span><br></pre></td></tr></tbody></table></figure></li><li>Dubbo 以此判断该类是 Wrapper，而不是普通扩展实现。</li></ul></li></ul></li><li><p>(4) Wrapper 的装饰顺序和依赖注入</p><ul><li>Dubbo 会先创建原始扩展实例（<code>realExtension</code>）。</li><li>然后按定义顺序用多个 Wrapper 层层包装实例：<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Wrapper3(Wrapper2(Wrapper1(realExtension)))</span><br></pre></td></tr></tbody></table></figure></li><li>每个 Wrapper 创建后也会走 <code>injectExtension()</code>，同样支持注入依赖扩展点。</li></ul></li><li><p>(5) Wrapper 的核心作用</p><ul><li>封装通用逻辑，例如：<ul><li>Filter 责任链</li><li> Cluster 对 Invoker 的封装</li><li>监控、日志、限流等逻辑</li></ul></li><li>使用装饰器模式，不修改原始扩展类即可增强行为。</li></ul></li><li><p>(6) 最终返回的扩展实例</p><ul><li>扩展实例 = 多层 Wrapper + 真实扩展类</li><li>所有依赖扩展均自动注入完成</li><li>整个对象结构由 <code>ExtensionLoader</code> 全面管理</li></ul></li></ul></li></ul><div class="admonition note"><p class="admonition-title">Dubbo SPI 机制源码剖析的总结</p><p>在 Dubbo SIP 机制中，通过 Class 反射类来构造 Class 对象实例，<code>injectExtension()</code> 方法通过 <code>setter</code> 注入扩展类中依赖的其他扩展点。包装类 <code>Wrapper</code> 封装了通用的逻辑，通过有无当前扩展接口参数的构造函数来判断，并注入依赖扩展。</p></div><h4 id="Dubbo-中的-Invoker"><a href="#Dubbo-中的-Invoker" class="headerlink" title="Dubbo 中的 Invoker"></a>Dubbo 中的 Invoker</h4><h5 id="Invoker-的概念"><a href="#Invoker-的概念" class="headerlink" title="Invoker 的概念"></a>Invoker 的概念</h5><ul><li>Invoker 是 Dubbo 的核心模型，也是实体域，其它模型都围绕它展开或可以转换为它。</li><li>Invoker 表示一个可执行体，可以对其发起 <code>invoke()</code> 调用，它可能是本地实现、远程实现，也可能是集群实现。在 Dubbo 中，所有需要代理执行的方法都可以通过 Invoker 进行抽象和转换。</li><li>Invoker 是由 ProxyFactory 创建的，Dubbo 默认的 ProxyFactory 实现类是 <strong>JavassistProxyFactory</strong>，即默认使用 Javassist 字节码操作技术来实现动态代理。下图展示了 <code>JavassistProxyFactory.getInvoker()</code> 方法的核心源码：</li></ul><p><img data-src="../../../asset/2025/11/dubbo-invoke-1.png"></p><h5 id="Wrapper-的概念"><a href="#Wrapper-的概念" class="headerlink" title="Wrapper 的概念"></a>Wrapper 的概念</h5><ul><li>Wrapper 的核心概念<ul><li>主要作用：<ul><li>对目标类的方法和属性进行统一封装，提高方法调用和属性访问的效率。</li></ul></li><li>实现原理：<ul><li>通过动态生成字节码（默认基于 Javassist），避免依赖反射调用，从而提升方法调用性能</li></ul></li><li>核心功能：<ul><li>快速调用目标类的方法（通过　<code>invokeMethod()</code> 调用）</li><li>快速访问目标类的字段</li><li>缓存生成的 Wrapper 实例，减少重复生成字节码的开销</li></ul></li><li>应用场景：<ul><li>在 Dubbo 中，用于对服务接口或实现类进行统一代理和方法调用</li><li>提高 RPC 调用和本地方法调用的效率</li></ul></li></ul></li></ul><hr><ul><li> Wrapper 的核心方法<ul><li><code>invokeMethod(Object instance, String methodName, Class&lt;?&gt;[] parameterTypes, Object[] args)</code><ul><li>作用：通过 Wrapper 对目标对象的方法进行调用分发。</li><li>说明：Wrapper 会根据传入的对象（<code>instance</code>）、方法名（<code>methodName</code>）、参数类型和参数值，将调用分发到具体的方法实现上，从而实现对目标类方法的统一调用封装，避免直接使用反射的性能开销。</li></ul></li><li><code>getWrapper(Class&lt;?&gt; c)</code><ul><li>作用：获取指定类对应的 Wrapper 实例（通常是已缓存的 Wrapper）。</li><li>说明：调用 <code>getWrapper()</code> 时，若 Wrapper 已经生成，会直接返回缓存的实例；否则，会调用 <code>makeWrapper()</code> 动态生成一个新的 Wrapper。通过缓存机制，可以减少重复生成 Wrapper，提高性能。</li></ul></li><li><code>makeWrapper(Class&lt;?&gt; c)</code><ul><li>作用：为指定的类生成一个 Wrapper 类实例。</li><li>说明：Wrapper 内部通过动态生成字节码（默认使用 Javassist）封装目标类的方法和属性，从而提供快速的方法调用和属性访问能力。生成后的 Wrapper 可以高效地对目标类进行方法调用和字段操作，而不需要每次都通过 Java 反射来实现。</li></ul></li></ul></li></ul><p><img data-src="../../../asset/2025/11/dubbo-invoke-2.png"></p><ul><li>Invoker 与 Wrapper 的关系<ul><li> Invoker 用来执行方法调用，而 Wrapper 用来辅助 Invoker 更高效地调用目标对象的方法。<ul><li>Wrapper：通过字节码技术（默认使用 Javassist）为目标类动态生成高性能的 “方法调用辅助类”，避免使用反射来调用方法。</li><li>Invoker：Dubbo 的核心执行体，通过 <code>invoke()</code> 调用目标对象的方法。</li></ul></li><li>简而言之，Invoker 在执行方法调用时，会使用 Wrapper 动态生成的快速调用代码来调目标对象的方法。</li></ul></li></ul><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="/posts/ef54a41c.html">Java 与 Dubbo 的 SPI 机制介绍</a></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/ea9ce835.html" title="Dubbo2 巩固教程之三">https://www.techgrow.cn/posts/ea9ce835.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag"><i class="fa fa-tag"></i> 微服务</a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a><a href="/tags/RPC/" rel="tag"><i class="fa fa-tag"></i> RPC</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/4688dc15.html" rel="prev" title="Centos7 管理 YUM 源与 EPEL 源"><i class="fa fa-angle-left"></i> Centos7 管理 YUM 源与 EPEL 源</a></div><div class="post-nav-item"> <a href="/posts/f83b3bd2.html" rel="next" title="Centos7 安装 Zsh 与 Guake">Centos7 安装 Zsh 与 Guake<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2026</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2.3m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">35:09</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/ea9ce835.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div><div id="moon-menu-item-code" class="moon-menu-item"><i class="fa-solid fa-code"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>