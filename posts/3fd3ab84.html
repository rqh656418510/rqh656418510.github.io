<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","width":300,"display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 MyBatis-Plus 的入门教程内容，包括常用注解、通用 CRUD 操作、数据库分表等内容。"><meta property="og:type" content="article"><meta property="og:title" content="MyBatis-Plus 入门教程之二"><meta property="og:url" content="https://www.techgrow.cn/posts/3fd3ab84.html"><meta property="og:site_name" content="远方的思念"><meta property="og:description" content="本文主要介绍 MyBatis-Plus 的入门教程内容，包括常用注解、通用 CRUD 操作、数据库分表等内容。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2022/09/mybatis-db-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2020/12/snowflake-1.png"><meta property="article:published_time" content="2019-07-05T15:12:41.000Z"><meta property="article:modified_time" content="2022-09-03T15:12:41.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="Java"><meta property="article:tag" content="数据库"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2022/09/mybatis-db-1.png"><link rel="canonical" href="https://www.techgrow.cn/posts/3fd3ab84.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/3fd3ab84.html","path":"posts/3fd3ab84.html","title":"MyBatis-Plus 入门教程之二"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>MyBatis-Plus 入门教程之二 | 远方的思念</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn:9360"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="远方的思念" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax>!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/app/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt></div><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">远方的思念</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-openplatform"><a href="https://open.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-toolbox fa-fw"></i>开放平台</a></li><li class="menu-item menu-item-readingnotes"><a href="https://docs.techgrow.cn/notes/" rel="external nofollow" target="_blank"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn:9360/ui/login?lng=zh-cn" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E"><span class="nav-text">版本说明</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MyBatis-Plus-%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="nav-text">MyBatis-Plus 常用注解</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TableName"><span class="nav-text">@TableName</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TableId"><span class="nav-text">@TableId</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#IdType"><span class="nav-text">IdType</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TableField"><span class="nav-text">@TableField</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#FieldStrategy"><span class="nav-text">FieldStrategy</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#FieldFill"><span class="nav-text">FieldFill</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Version"><span class="nav-text">@Version</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OrderBy"><span class="nav-text">@OrderBy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EnumValue"><span class="nav-text">@EnumValue</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TableLogic"><span class="nav-text">@TableLogic</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#KeySequence"><span class="nav-text">@KeySequence</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E7%94%A8-Mapper-CRUD-%E6%93%8D%E4%BD%9C"><span class="nav-text">通用 Mapper CRUD 操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="nav-text">查询数据操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="nav-text">删除数据操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="nav-text">插入数据操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96%E4%B8%BB%E9%94%AE%E5%80%BC"><span class="nav-text">插入数据获取主键值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E9%9D%9E%E7%A9%BA%E5%88%A4%E6%96%AD"><span class="nav-text">插入数据进行非空判断</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C"><span class="nav-text">更新数据操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E9%9D%9E%E7%A9%BA%E5%88%A4%E6%96%AD"><span class="nav-text">更新数据进行非空判断</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E7%94%A8-Service-CRUD-%E6%93%8D%E4%BD%9C"><span class="nav-text">通用 Service CRUD 操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-Service-%E6%8E%A5%E5%8F%A3%E5%92%8C%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-text">创建 Service 接口和实现类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8-Service-%E6%8E%A5%E5%8F%A3%E5%92%8C%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-text">调用 Service 接口和实现类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%89%A9%E5%B1%95%E4%BB%8B%E7%BB%8D"><span class="nav-text">数据库扩展介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%86%E8%A1%A8"><span class="nav-text">数据库分表</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9E%82%E7%9B%B4%E5%88%86%E8%A1%A8"><span class="nav-text">垂直分表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B0%B4%E5%B9%B3%E5%88%86%E8%A1%A8"><span class="nav-text">水平分表</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#UUID"><span class="nav-text">UUID</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%BB%E9%94%AE%E8%87%AA%E5%A2%9E"><span class="nav-text">主键自增</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%96%E6%A8%A1%E8%BF%90%E7%AE%97"><span class="nav-text">取模运算</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95"><span class="nav-text">雪花算法</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">404</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">41</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → &#x2F;sitemap.xml"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="external nofollow" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/3fd3ab84.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="远方的思念"><meta itemprop="description" content="专注于 Java、前端、移动端、微服务、分布式系统、数据库、系统架构、人工智能、大数据、云计算、物联网、虚拟化学习的技术博客。"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="MyBatis-Plus 入门教程之二 | 远方的思念"><meta itemprop="description" content="本文主要介绍 MyBatis-Plus 的入门教程内容，包括常用注解、通用 CRUD 操作、数据库分表等内容。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> MyBatis-Plus 入门教程之二</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-07-05 23:12:41" itemprop="dateCreated datePublished" datetime="2019-07-05T23:12:41+08:00">2019-07-05</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-09-03 23:12:41" itemprop="dateModified" datetime="2022-09-03T23:12:41+08:00">2022-09-03</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/3fd3ab84.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/3fd3ab84.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>7.7k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>7 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><div id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/ed9df8e6.html">MyBatis-Plus 入门教程之一</a></li><li><a href="/posts/3fd3ab84.html">MyBatis-Plus 入门教程之二</a></li><li><a href="/posts/7d8f3d89.html">MyBatis-Plus 入门教程之三</a></li><li><a href="/posts/2cbf33d2.html">MyBatis-Plus 入门教程之四</a></li><li><a href="/posts/c5f15a9c.html">MyBatis-Plus 入门教程之五</a></li><li><a href="/posts/315d5197.html">MyBatis-Plus 入门教程之六</a></li><li><a href="/posts/2aa6fbd1.html">MyBatis-Plus 入门教程之七</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h3><p>本文的教程内容是基于 MyBatis-Plus <code>3.5.2</code> 版本编写的，若你使用的是 <code>2.x</code> 或其他版本，可能会有部分知识点、案例代码不兼容，一切以 MyBatis-Plus 官方文档为准。</p><h2 id="MyBatis-Plus-常用注解"><a href="#MyBatis-Plus-常用注解" class="headerlink" title="MyBatis-Plus 常用注解"></a>MyBatis-Plus 常用注解</h2><div class="admonition note"><p class="admonition-title">提示</p><p>MyBatis-Plus 3.x 注解类包的源码：👉 <a target="_blank" rel="external nofollow" href="https://github.com/baomidou/mybatis-plus/tree/3.0/mybatis-plus-annotation/src/main/java/com/baomidou/mybatisplus/annotation">mybatis-plus-annotation</a></p></div><h3 id="TableName"><a href="#TableName" class="headerlink" title="@TableName"></a>@TableName</h3><ul><li>描述：表名注解，标识实体类对应的表</li><li>使用位置：实体类</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableName("sys_user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><span id="more"></span><table><thead><tr><th>属性</th><th>类型</th><th>必须指定</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td> value</td><td>String</td><td> 否</td><td><code>""</code></td><td>表名</td></tr><tr><td> schema</td><td>String</td><td> 否</td><td><code>""</code></td><td>Schema</td></tr><tr><td>keepGlobalPrefix</td><td>boolean</td><td> 否</td><td><code>false</code></td><td>是否保持使用全局的 <code>tablePrefix</code> 的值（当全局 <code>tablePrefix</code> 生效时）</td></tr><tr><td>resultMap</td><td>String</td><td> 否</td><td><code>""</code></td><td>SQL 映射文件中 <code>resultMap</code> 的 <code>id</code>（用于满足特定类型的实体类对象绑定）</td></tr><tr><td>autoResultMap</td><td>boolean</td><td> 否</td><td><code>false</code></td><td>是否自动构建 <code>resultMap</code> 并使用（如果设置 <code>resultMap</code> 则不会进行 <code>resultMap</code> 的自动构建与注入）</td></tr><tr><td>excludeProperty</td><td>String[]</td><td> 否</td><td><code>{}</code></td><td>需要排除的属性名（<code>@since 3.3.1 version</code>）</td></tr></tbody></table><div class="admonition warning"><p class="admonition-title">关于 autoResultMap 的说明</p></div><p>MyBatis-Plus 会自动构建一个 <code>resultMap</code> 并注入到 MyBatis 里（一般用不上），请注意以下内容：</p><ul><li>因为 MyBatis-Plus 的底层是 MyBatis，所以 MyBatis-Plus 只是帮开发者注入了常用 CRUD 到 MyBatis 里，注入之前是动态的（根据开发者的 Entity 字段以及注解变化而变化），但是注入之后是静态的（等同于 XML 配置中的内容）</li><li>对于 <code>typeHandler</code> 属性，MyBatis 只支持写在两个地方<ul><li>第一个地方：定义在 <code>resultMap</code> 里，作用于查询结果的封装</li><li>第二个地方：定义在 <code>insert</code> 和 <code>update</code> 语句的 <code>#{property}</code> 中的 <code>property</code> 后面（例：<code>#{property, typehandler=xxx.xxx.xxx}</code>），并且只作用于当前 <code>设置值</code></li><li>除了以上两种直接指定 <code>typeHandler</code> 的形式，MyBatis 还支持在全局配置文件中自定义 <code>typeHandler</code> 包的配置，原理是根据开发者的 <code>property</code> 类型去找其对应的 <code>typeHandler</code> 并使用。</li></ul></li></ul><h3 id="TableId"><a href="#TableId" class="headerlink" title="@TableId"></a>@TableId</h3><ul><li>描述：主键注解</li><li>使用位置：实体类主键属性</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableName("sys_user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><table><thead><tr><th>属性</th><th>类型</th><th>必须指定</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td> value</td><td>String</td><td> 否</td><td><code>""</code></td><td>主键字段名</td></tr><tr><td> type</td><td>Enum</td><td> 否</td><td><code>IdType.NONE</code></td><td>指定主键类型</td></tr></tbody></table><h4 id="IdType"><a href="#IdType" class="headerlink" title="IdType"></a>IdType</h4><ul><li>描述：主键类型</li></ul><table><thead><tr><th>值</th><th>描述</th></tr></thead><tbody><tr><td> AUTO</td><td> 数据库 ID 自增，该类型必须确保数据库表的主键字段设置了 ID 自增，否则无法生效</td></tr><tr><td> NONE</td><td> 无状态，该类型为未设置主键类型（注解里等于跟随全局，全局里约等于 INPUT）</td></tr><tr><td>INPUT</td><td> 用户自行设置主键值，该类型可以通过自己注册自动填充插件进行填充</td></tr><tr><td> ASSIGN_ID</td><td> 分配 ID，主键类型为 Number [Long 和 Integer] 或 String（<code>@since 3.3.0 version</code>），使用的是 <code>IdentifierGenerator</code> 接口的 <code>nextId</code> 方法（默认实现类为 <code>DefaultIdentifierGenerator</code>，使用的是雪花算法）</td></tr><tr><td>ASSIGN_UUID</td><td> 分配 UUID，主键类型为 String（<code>@since 3.3.0 version</code>），使用的是 <code>IdentifierGenerator</code> 接口的 <code>nextUUID</code> 方法</td></tr><tr><td><del>ID_WORKER</del></td><td> 分布式全局唯一 ID 长整型类型（请使用 <code>ASSIGN_ID</code>）</td></tr><tr><td><del>UUID</del></td><td>32 位 UUID 字符串（请使用 <code>ASSIGN_UUID</code>）</td></tr><tr><td><del>ID_WORKER_STR</del></td><td> 分布式全局唯一 ID 字符串类型（请使用 <code>ASSIGN_ID</code>）</td></tr></tbody></table><div class="admonition warning"><p class="admonition-title">注意</p><p>1、<code>AUTO</code> 主键类型必须确保数据库表的主键字段设置了 ID 自增，否则无法生效<br> 2、<code>ASSIGN_ID</code> 主键类型（使用雪花算法生成 ID），与数据库表的主键字段是否设置 ID 自增没有任何关系<br> 3、<code>ASSIGN_ID</code> 和 <code>ASSIGN_UUID</code> 这两种主键类型，只有当插入对象的 ID 为空时，才会自动填充主键值<br></p></div><h3 id="TableField"><a href="#TableField" class="headerlink" title="@TableField"></a>@TableField</h3><ul><li>描述：字段注解（非主键）</li><li>使用位置：实体类非主键属性</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableName("sys_user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@TableField("nickname")</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><table><thead><tr><th>属性</th><th>类型</th><th>必须指定</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td> value</td><td>String</td><td> 否</td><td><code>""</code></td><td>数据库字段名</td></tr><tr><td> exist</td><td>boolean</td><td> 否</td><td><code>true</code></td><td>是否为数据库表字段</td></tr><tr><td> condition</td><td>String</td><td> 否</td><td><code>""</code></td><td>字段 <code>where</code> 实体查询比较条件，有值设置则按设置的值为准，没有则为默认全局的 <code>%s=#{%s}</code></td></tr><tr><td>update</td><td>String</td><td> 否</td><td><code>""</code></td><td>字段 <code>update set</code> 部分注入，例如：当在 <code>version</code> 字段上注解 <code>update="%s+1"</code>，表示更新时会 <code>set version=version+1</code> （该属性优先级高于 <code>el</code> 属性）</td></tr><tr><td>insertStrategy</td><td>Enum</td><td> 否</td><td><code>FieldStrategy.DEFAULT</code></td><td>举例：NOT_NULL<br> <code>insert into table_a(&lt;if test="columnProperty != null"&gt;column&lt;/if&gt;) values (&lt;if test="columnProperty != null"&gt;#{columnProperty}&lt;/if&gt;)</code></td></tr><tr><td>updateStrategy</td><td>Enum</td><td> 否</td><td><code>FieldStrategy.DEFAULT</code></td><td>举例：IGNORED<br> <code>update table_a set column=#{columnProperty}</code></td></tr><tr><td>whereStrategy</td><td>Enum</td><td> 否</td><td><code>FieldStrategy.DEFAULT</code></td><td>举例：NOT_EMPTY<br> <code>where &lt;if test="columnProperty != null and columnProperty!=''"&gt;column=#{columnProperty}&lt;/if&gt;</code></td></tr><tr><td>fill</td><td>Enum</td><td> 否</td><td><code>FieldFill.DEFAULT</code></td><td>字段自动填充策略</td></tr><tr><td> select</td><td>boolean</td><td> 否</td><td><code>true</code></td><td>是否进行 <code>select</code> 查询</td></tr><tr><td> keepGlobalFormat</td><td>boolean</td><td> 否</td><td><code>false</code></td><td>是否保持使用全局的 <code>format</code> 进行处理</td></tr><tr><td> jdbcType</td><td>JdbcType</td><td> 否</td><td><code>JdbcType.UNDEFINED</code></td><td>JDBC 类型 (该默认值不代表会按照该值生效)</td></tr><tr><td>typeHandler</td><td>Class&lt;? extends TypeHandler&gt;</td><td> 否</td><td><code>UnknownTypeHandler.class</code></td><td>类型处理器 (该默认值不代表会按照该值生效)</td></tr><tr><td>numericScale</td><td>String</td><td> 否</td><td><code>""</code></td><td>指定小数点后保留的位数</td></tr></tbody></table><div class="admonition warning"><p class="admonition-title">关于 jdbcType 和 typeHandler 以及 numericScale 的说明</p></div><ul><li><code>numericScale</code> 只生效于 <code>update</code> 的 SQL 语句</li><li><code>jdbcType</code> 和 <code>typeHandler</code> 如果不配合 <code>@TableName(autoResultMap = true)</code> 一起使用，也只生效于 <code>update</code> 的 SQL 语句</li><li>对于 <code>typeHandler</code>，如果你的字段类型和 set 进去的类型为 <code>equals</code> 关系，则只需要让你的 <code>typeHandler</code> 让 Mybatis 加载到即可，不需要使用注解</li></ul><h4 id="FieldStrategy"><a href="#FieldStrategy" class="headerlink" title="FieldStrategy"></a>FieldStrategy</h4><p>字段策略 <code>FieldStrategy</code> 的作用主要是在进行新增、更新时，根据配置的策略判断是否对实体对象的值进行空值判断，如果策略为字段不能为空，则不会对为空的字段进行赋值或更新。同样的，在进行 <code>where</code> 条件查询时，根据 <code>whereStrategy</code> 策略判断是否对字段进行空值判断，如果策略为字段不能为空，则为空的字段不会作为查询条件组装到 <code>where</code> 条件中。</p><table><thead><tr><th>值</th><th>描述</th></tr></thead><tbody><tr><td> IGNORED</td><td> 忽略判断</td></tr><tr><td> NOT_NULL</td><td> 非 NULL 判断</td></tr><tr><td> NOT_EMPTY</td><td> 非空判断（只对字符串类型字段，其他类型字段依然为非 NULL 判断）</td></tr><tr><td>DEFAULT</td><td> 追随全局配置</td></tr><tr><td> NEVER</td><td> 不加入 SQL</td></tr></tbody></table><h4 id="FieldFill"><a href="#FieldFill" class="headerlink" title="FieldFill"></a>FieldFill</h4><ul><li>描述：字段自动填充策略</li></ul><table><thead><tr><th>值</th><th>描述</th></tr></thead><tbody><tr><td> DEFAULT</td><td> 默认不处理</td></tr><tr><td> INSERT</td><td> 插入时填充字段</td></tr><tr><td> UPDATE</td><td> 更新时填充字段</td></tr><tr><td> INSERT_UPDATE</td><td> 插入和更新时填充字段</td></tr></tbody></table><h3 id="Version"><a href="#Version" class="headerlink" title="@Version"></a>@Version</h3><ul><li>描述：乐观锁注解</li><li>使用位置：实体类属性</li><li>使用案例：<a href="/posts/315d5197.html#MyBatis-Plus-%E4%B9%90%E8%A7%82%E9%94%81%E6%8F%92%E4%BB%B6">乐观锁插件</a></li></ul><h3 id="OrderBy"><a href="#OrderBy" class="headerlink" title="@OrderBy"></a>@OrderBy</h3><ul><li>描述：内置 SQL 默认排序规则，优先级低于 <code>wrapper</code> 条件查询</li></ul><table><thead><tr><th>属性</th><th>类型</th><th>必须指定</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td> asc</td><td>boolean</td><td> 否</td><td> false</td><td> 是否升序查询</td></tr><tr><td> isDesc</td><td>boolean</td><td> 否</td><td> true</td><td> 是否倒序查询</td></tr><tr><td> sort</td><td>short</td><td> 否</td><td> Short.MAX_VALUE</td><td> 数字越小越靠前</td></tr></tbody></table><h3 id="EnumValue"><a href="#EnumValue" class="headerlink" title="@EnumValue"></a>@EnumValue</h3><ul><li>描述：普通枚举类注解</li><li>使用位置：实体类枚举类型的属性</li><li>使用案例：<a href="/posts/2cbf33d2.html#MyBatis-Plus-%E9%80%9A%E7%94%A8%E6%9E%9A%E4%B8%BE">通用枚举</a></li></ul><h3 id="TableLogic"><a href="#TableLogic" class="headerlink" title="@TableLogic"></a>@TableLogic</h3><ul><li>描述：表字段逻辑处理注解（逻辑删除）</li><li>使用场景：数据删除后需要进行数据恢复</li><li>物理删除：真实删除，将对应数据从数据库中删除，之后查询不到此条被删除的数据</li><li>逻辑删除：假删除，将对应数据中代表是否被删除字段的状态修改为 “被删除状态”，之后在数据库中仍旧能看到此条数据记录</li><li>使用案例：<a href="/posts/2cbf33d2.html#MyBatis-Plus-%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4">逻辑删除</a></li></ul><table><thead><tr><th>属性</th><th>类型</th><th>必须指定</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td> value</td><td>String</td><td> 否</td><td> “”</td><td> 逻辑未删除时的值</td></tr><tr><td> delval</td><td>String</td><td> 否</td><td> “”</td><td> 逻辑删除时的值</td></tr></tbody></table><h3 id="KeySequence"><a href="#KeySequence" class="headerlink" title="@KeySequence"></a>@KeySequence</h3><ul><li>描述：序列主键策略 <code>oracle</code></li><li>属性：<code>value</code>、<code>resultMap</code></li></ul><table><thead><tr><th>属性</th><th>类型</th><th>必须指定</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td> value</td><td>String</td><td> 否</td><td> “”</td><td> 序列名</td></tr><tr><td> clazz</td><td>Class</td><td> 否</td><td> Long.class</td><td>id 的类型，可以指定 <code>String.class</code>，这样返回的 Sequence 值是字符串 <code>1</code></td></tr></tbody></table><h2 id="通用-Mapper-CRUD-操作"><a href="#通用-Mapper-CRUD-操作" class="headerlink" title="通用 Mapper CRUD 操作"></a>通用 Mapper CRUD 操作</h2><p>本节所需的案例代码，可以直接从 <a target="_blank" rel="external nofollow" href="https://github.com/rqh656418510/mybatis-code/tree/main/mybatis-plus-study">GitHub</a> 下载对应章节 <code>mybatis-plus-lesson-03</code>。</p><h3 id="查询数据操作"><a href="#查询数据操作" class="headerlink" title="查询数据操作"></a>查询数据操作</h3><ul><li>Mapper 接口</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Employee</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>Junit 测试代码</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisPlusApplicationTest</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> EmployeeMapper empMapper;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据ID查询</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectById</span><span class="params">()</span> </span>{</span><br><span class="line">		Employee employee = empMapper.selectById(<span class="number">1L</span>);</span><br><span class="line">		System.out.println(employee);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据多个ID查询</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectBatchIds</span><span class="params">()</span> </span>{</span><br><span class="line">		List&lt;Long&gt; ids = Arrays.asList(<span class="number">1L</span>, <span class="number">2L</span>, <span class="number">3L</span>);</span><br><span class="line">		List&lt;Employee&gt; list = empMapper.selectBatchIds(ids);</span><br><span class="line">		list.forEach(System.out::println);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据Map条件查询</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectByMap</span><span class="params">()</span> </span>{</span><br><span class="line">		Map&lt;String, Object&gt; columnMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">		<span class="comment">// 查询条件，指定的是表字段的名称，而不是实体类的属性名</span></span><br><span class="line">		columnMap.put(<span class="string">"last_name"</span>, <span class="string">"Jim"</span>);</span><br><span class="line">		List&lt;Employee&gt; list = empMapper.selectByMap(columnMap);</span><br><span class="line">		list.forEach(System.out::println);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 查询所有数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectList</span><span class="params">()</span> </span>{</span><br><span class="line">		List&lt;Employee&gt; list = empMapper.selectList(<span class="keyword">null</span>);</span><br><span class="line">		list.forEach(System.out::println);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="删除数据操作"><a href="#删除数据操作" class="headerlink" title="删除数据操作"></a>删除数据操作</h3><ul><li>Mapper 接口</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Employee</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>Junit 测试代码</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisPlusApplicationTest</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> EmployeeMapper empMapper;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据ID删除数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">()</span> </span>{</span><br><span class="line">		Integer deleteResult = empMapper.deleteById(<span class="number">2L</span>);</span><br><span class="line">		System.out.println(<span class="string">"deleteResult: "</span> + deleteResult);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据多个ID删除数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteBatchIds</span><span class="params">()</span> </span>{</span><br><span class="line">		List&lt;Long&gt; ids = Arrays.asList(<span class="number">2L</span>, <span class="number">3L</span>);</span><br><span class="line">		Integer deleteResult = empMapper.deleteBatchIds(ids);</span><br><span class="line">		System.out.println(<span class="string">"deleteResult: "</span> + deleteResult);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据Map条件删除数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByMap</span><span class="params">()</span> </span>{</span><br><span class="line">		Map&lt;String, Object&gt; columnMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">		<span class="comment">// 查询条件，指定的是表字段的名称，而不是实体类的属性名</span></span><br><span class="line">		columnMap.put(<span class="string">"gender"</span>, <span class="string">"0"</span>);</span><br><span class="line">		Integer deleteResult = empMapper.deleteByMap(columnMap);</span><br><span class="line">		System.out.println(<span class="string">"deleteResult: "</span> + deleteResult);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="插入数据操作"><a href="#插入数据操作" class="headerlink" title="插入数据操作"></a>插入数据操作</h3><h4 id="插入数据获取主键值"><a href="#插入数据获取主键值" class="headerlink" title="插入数据获取主键值"></a>插入数据获取主键值</h4><p>若数据库表使用的是自增主键，MyBatis 支持在插入数据后返回自增的主键值，详细的使用教程可以看 <a href="/posts/2092c024.html#%E8%87%AA%E5%A2%9E%E4%B8%BB%E9%94%AE%E7%94%9F%E6%88%90">这里</a>。值得一提的是，MyBatis-Plus 在插入数据后会自动将主键值回写到 JavaBean 中，不需要任何配置。示例代码如下：</p><ul><li>Mapper 接口</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Employee</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>Junit 测试代码</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisPlusTest</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> EmployeeMapper empMapper;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> </span>{</span><br><span class="line">		Employee employee = <span class="keyword">new</span> Employee(<span class="string">"David"</span>, <span class="string">"1"</span>, <span class="string">"david@gmail.com"</span>, <span class="number">23</span>);</span><br><span class="line">		Integer insertResult = empMapper.insert(employee);</span><br><span class="line">		System.out.println(<span class="string">"insert result: "</span> + insertResult);</span><br><span class="line">		System.out.println(employee);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>上述代码执行后的结果如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert result: 1</span><br><span class="line">Employee [id=41, lastName=David, gender=1, email=david@gmail.com, age=23]</span><br></pre></td></tr></tbody></table></figure><h4 id="插入数据进行非空判断"><a href="#插入数据进行非空判断" class="headerlink" title="插入数据进行非空判断"></a>插入数据进行非空判断</h4><p>MyBatis-Plus 在插入数据的时候，默认会对实体类的每个属性进行非空判断，只有非空的实体类属性会拼接到 SQL 语句中。</p><ul><li>实体类</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> String lastName;</span><br><span class="line">	<span class="keyword">private</span> String gender;</span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>Mapper 接口</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Employee</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>Junit 测试代码</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisPlusTest</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> EmployeeMapper empMapper;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> </span>{</span><br><span class="line">		Employee employee = <span class="keyword">new</span> Employee();</span><br><span class="line">		employee.setLastName(<span class="string">"David"</span>);</span><br><span class="line">		employee.setEmail(<span class="string">"david@gmail.com"</span>);</span><br><span class="line">		Integer insertResult = empMapper.insert(employee);</span><br><span class="line">		System.out.println(<span class="string">"insertResult: "</span> + insertResult);</span><br><span class="line">		System.out.println(employee);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>观察下述的代码执行结果，可以发现只有非空的实体类属性会拼接到 SQL 语句中。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">==&gt;  Preparing: INSERT INTO t_employee ( last_name, email ) VALUES ( ?, ? )</span><br><span class="line">==&gt; Parameters: David(String), david@gmail.com(String)</span><br><span class="line">&lt;==    Updates: 1</span><br><span class="line">insertResult: 1</span><br><span class="line">Employee [id=44, lastName=David, gender=null, email=david@gmail.com, age=null]</span><br></pre></td></tr></tbody></table></figure><p>若希望新增操作忽略实体类属性的非空判断，可以在实体类的属性上使用 <code>@TableField</code> 注解，并通过 <code>@TableField</code> 注解的 <code>insertStrategy</code> 参数来指定判断策略。</p><ul><li>实体类</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String lastName;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@TableField(insertStrategy = FieldStrategy.IGNORED)</span></span><br><span class="line">	<span class="keyword">private</span> String gender;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@TableField(insertStrategy = FieldStrategy.IGNORED)</span></span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>重新执行 Junit 测试代码，观察下述的执行结果，可以发现非空的实体类属性也会拼接到 SQL 语句中。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">==&gt;  Preparing: INSERT INTO t_employee ( last_name, gender, email, age ) VALUES ( ?, ?, ?, ? )</span><br><span class="line">==&gt; Parameters: David(String), null, david@gmail.com(String), null</span><br><span class="line">&lt;==    Updates: 1</span><br><span class="line">insertResult: 1</span><br><span class="line">Employee [id=45, lastName=David, gender=null, email=david@gmail.com, age=null]</span><br></pre></td></tr></tbody></table></figure><h3 id="更新数据操作"><a href="#更新数据操作" class="headerlink" title="更新数据操作"></a>更新数据操作</h3><h4 id="更新数据进行非空判断"><a href="#更新数据进行非空判断" class="headerlink" title="更新数据进行非空判断"></a>更新数据进行非空判断</h4><p>MyBatis-Plus 在更新数据的时候，默认会对实体类的每个属性进行非空判断，只有非空的属性才会拼接到 SQL 语句中。</p><ul><li>实体类</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line">	<span class="keyword">private</span> String lastName;</span><br><span class="line">	<span class="keyword">private</span> String gender;</span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>Mapper 接口</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Employee</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>Junit 测试代码</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisPlusTest</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> EmployeeMapper empMapper;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>{</span><br><span class="line">		Employee employee = <span class="keyword">new</span> Employee();</span><br><span class="line">		employee.setId(<span class="number">1L</span>);</span><br><span class="line">		employee.setLastName(<span class="string">"David"</span>);</span><br><span class="line">		employee.setEmail(<span class="string">"david@gmail.com"</span>);</span><br><span class="line">		Integer updateReuslt = empMapper.updateById(employee);</span><br><span class="line">		System.out.println(<span class="string">"updateReuslt: "</span> + updateReuslt);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>观察下述的代码执行结果，可以发现只有非空的实体类属性会拼接到 SQL 语句中。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">==&gt;  Preparing: UPDATE t_employee SET last_name=?, email=? WHERE id=?</span><br><span class="line">==&gt; Parameters: David(String), david@gmail.com(String), 1(Long)</span><br><span class="line">&lt;==    Updates: 1</span><br><span class="line">updateReuslt: 1</span><br></pre></td></tr></tbody></table></figure><p>若希望更新操作忽略实体类属性的非空判断，可以在实体类的属性上使用 <code>@TableField</code> 注解，并通过 <code>@TableField</code> 注解的 <code>updateStrategy</code> 参数来指定判断策略。</p><ul><li>实体类</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String lastName;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@TableField(updateStrategy = FieldStrategy.IGNORED)</span></span><br><span class="line">	<span class="keyword">private</span> String gender;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@TableField(updateStrategy = FieldStrategy.IGNORED)</span></span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>重新执行 Junit 测试代码，观察下述的执行结果，可以发现非空的实体类属性也会拼接到 SQL 语句中。</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">==&gt;  Preparing: UPDATE t_employee SET email=?, last_name=?, gender=?, age=? WHERE id=?</span><br><span class="line">==&gt; Parameters: david@gmail.com(String), David(String), null, null, 1(Long)</span><br><span class="line">&lt;==    Updates: 1</span><br><span class="line">updateReuslt: 1</span><br></pre></td></tr></tbody></table></figure><h2 id="通用-Service-CRUD-操作"><a href="#通用-Service-CRUD-操作" class="headerlink" title="通用 Service CRUD 操作"></a>通用 Service CRUD 操作</h2><p>MyBatis-Plus 为通用的 Service CRUD 操作提供了 <code>IService</code> 接口 和 <code>ServiceImpl</code> 实现类，里面封装了常用的 CRUD 方法。本节所需的案例代码，可以直接从 <a target="_blank" rel="external nofollow" href="https://github.com/rqh656418510/mybatis-code/tree/main/mybatis-plus-study">GitHub</a> 下载对应章节 <code>mybatis-plus-lesson-04</code>。</p><h3 id="创建-Service-接口和实现类"><a href="#创建-Service-接口和实现类" class="headerlink" title="创建 Service 接口和实现类"></a>创建 Service 接口和实现类</h3><ul><li>Service 接口</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * IEmployeeService 接口继承 IService 接口提供的基础功能</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IEmployeeService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">Employee</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>Service 实现类</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * EmployeeServiceImpl 类实现了 IEmployeeService 接口，并继承 ServiceImpl 类提供的基础功能</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">EmployeeMapper</span>, <span class="title">Employee</span>&gt; <span class="keyword">implements</span> <span class="title">IEmployeeService</span> </span>{</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="调用-Service-接口和实现类"><a href="#调用-Service-接口和实现类" class="headerlink" title="调用 Service 接口和实现类"></a>调用 Service 接口和实现类</h3><ul><li>Junit 测试代码</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisPlusApplicationTest</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> IEmployeeService empService;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 查询总记录数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">count</span><span class="params">()</span> </span>{</span><br><span class="line">		Long count = empService.count();</span><br><span class="line">		System.out.println(<span class="string">"count: "</span> + count);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 更新数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>{</span><br><span class="line">		Employee employee = <span class="keyword">new</span> Employee();</span><br><span class="line">		employee.setId(<span class="number">1L</span>);</span><br><span class="line">		employee.setGender(<span class="string">"0"</span>);</span><br><span class="line">		<span class="keyword">boolean</span> updateResult = empService.updateById(employee);</span><br><span class="line">		System.out.println(<span class="string">"updateResult: "</span> + updateResult);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 批量插入</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveBatch</span><span class="params">()</span> </span>{</span><br><span class="line">		List&lt;Employee&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) {</span><br><span class="line">			Employee emp = <span class="keyword">new</span> Employee();</span><br><span class="line">			emp.setAge(<span class="number">26</span>);</span><br><span class="line">			emp.setGender(<span class="string">"1"</span>);</span><br><span class="line">			emp.setLastName(<span class="string">"user-"</span> + i);</span><br><span class="line">			list.add(emp);</span><br><span class="line">		}</span><br><span class="line">		<span class="keyword">boolean</span> saveResult = <span class="keyword">this</span>.empService.saveBatch(list);</span><br><span class="line">		System.out.println(<span class="string">"saveResult: "</span> + saveResult);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 删除数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">boolean</span> deleteResult = <span class="keyword">this</span>.empService.removeById(<span class="number">11L</span>);</span><br><span class="line">		System.out.println(<span class="string">"deleteResult: "</span> + deleteResult);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="数据库扩展介绍"><a href="#数据库扩展介绍" class="headerlink" title="数据库扩展介绍"></a>数据库扩展介绍</h2><p>在企业开发中，往往需要选择合适的方案去应对数据规模的增长，以应对数据库逐渐增长的访问压力和数据量。数据库的扩展方式主要包括：业务分库、主从复制、数据库分表、数据库分片、数据库分区。</p><h3 id="数据库分表"><a href="#数据库分表" class="headerlink" title="数据库分表"></a>数据库分表</h3><p>将不同业务数据分散存储到不同的数据库服务器，能够支撑百万甚至千万用户规模的业务，但如果业务继续发展，同一业务的单表数据也会达到单台数据库服务器的处理瓶颈。例如，淘宝的几亿用户数据，如果全部存放在一台数据库服务器的一张表中，肯定是无法满足性能要求的，此时就需要对单表数据进行拆分。单表数据拆分有两种方式，包括垂直分表和水平分表。示意图如下:</p><p><img data-src="../../../asset/2022/09/mybatis-db-1.png"></p><h4 id="垂直分表"><a href="#垂直分表" class="headerlink" title="垂直分表"></a>垂直分表</h4><p>垂直分表适合将表中某些不常用且占了大量空间的列拆分出去。例如，上面示意图中的 <code>nickname</code> 和 <code>description</code> 字段，假设开发一个婚恋网站，用户在筛选其他用户的时候，主要是用 <code>age</code> 和 <code>sex</code> 两个字段进行查询，而 <code>nickname</code> 和 <code>description</code> 两个字段主要用于展示，一般不会在业务查询中用到。<code>description</code> 字段本身又比较占存储空间，因此可以将这两个字段独立到另外一张表中，这样在查询 <code>age</code> 和 <code>sex</code> 时，就能带来一定的性能提升。</p><h4 id="水平分表"><a href="#水平分表" class="headerlink" title="水平分表"></a>水平分表</h4><p>水平分表适合表行数特别大的表，有的公司要求单表行数超过 <code>5000万</code> 就必须进行分表，这个数字可以作为参考，但并不是绝对标准，关键还是要看表的访问性能。对于一些比较复杂的表，可能超过 <code>1000万</code> 就要分表了；而对于一些简单的表，即使存储数据超过 <code>1亿</code> 行，也可以不分表。但不管怎样，当看到表的数据量达到千万级别时，作为架构师就要警觉起来，因为这很可能是架构的性能瓶颈或者隐患。值得一提的是，水平分表相比垂直分表，会引入更多的复杂性，例如要处理全局唯一的数据 ID（分布式唯一全局 ID）。</p><div class="admonition note"><p class="admonition-title">提示</p><p>更多关于分布式唯一全局 ID 的生成方案可以看 <a href="/posts/b2330a87.html">这里</a>。</p></div><h5 id="UUID"><a href="#UUID" class="headerlink" title="UUID"></a>UUID</h5><p>UUID 按照 OSF 制定的标准计算，用到了以太网卡地址、纳秒级时间、芯片 ID 码和许多可能的数字，并由以下几部分的组成：当前日期和时间、时钟序列、全局唯一的 IEEE 机器识别号。UUID 的标准形式包含 32 个 16 进制的数字，以连字号分为 5 段，形式为 <code>cb6ce510-74fe-4e18-ac3d-05a5c96d3a0f</code> 的 36 个字符。<strong>特别注意，基于 MAC 地址生成 UUID 的算法可能会造成 MAC 地址泄露，这个漏洞曾被用于寻找梅丽莎病毒的制作者位置。</strong></p><ul><li><code>适用场景</code>：只要对存储空间没有苛刻要求的都能够适用，比如各种链路追踪、日志存储等。</li><li><code>优点</code>：性能高，本地生成，没有网络消耗。如果只考虑唯一性，那么可以使用。</li><li><code>缺点</code>：<ul><li><code>无序</code>：即无法预测 ID 的生成顺序，不能生成递增的有序数字。</li><li><code>ID 长度过长</code>：分布式 ID 一般都是作为主键，但是 MySQL 官方推荐主键尽量越短越好，36 个字符长度的 UUID 不是很推荐。</li><li><code>入库性能差</code>：既然分布式 ID 是主键，然后主键是包含索引的，MySQL 的索引是通过 B+ 树来实现的，每一次新的 UUID 数据的插入，为了查询的优化，都会对索引的底层 B+ 树进行修改。因为 UUID 数据是无序的，所以每一次 UUID 的数据插入都会对主键底层的 B+ 树进行很大的修改，这一点非常不好。插入的 ID 完全无序，不但会导致一些中间节点产生分裂（<code>B+ 树索引分裂</code>），也会白白的创造出很多的不饱和节点，这样大大的降低了数据库的插入性能。</li></ul></li></ul><h5 id="主键自增"><a href="#主键自增" class="headerlink" title="主键自增"></a>主键自增</h5><p>以最常见的用户 ID 为例，可以按照 1000000 的范围大小进行分段，1 ~ 999999 放到表 1 中，1000000 ~ 1999999 放到表 2 中，以此类推。</p><ul><li><code>复杂点</code>：分段大小的选取。分段太小会导致切分后子表数量过多，增加维护复杂度；分段太大可能会导致单表依然存在性能问题，一般建议分段大小在 <code>100万</code> 至 <code>2000万</code> 之间，具体需要根据业务需求选取合适的分段大小。</li><li><code>优点</code>：可以随着数据的增加平滑地扩充新的表。例如，现在的用户是 100 万，如果增加到 1000 万，只需要增加新的表就可以了，原有的数据不需要动。</li><li><code>缺点</code>：分布不均匀。假如按照 1000 万来进行分表，有可能某个分段实际存储的数据量只有 1 条，而另外一个分段实际存储的数据量有 1000 万条。</li></ul><h5 id="取模运算"><a href="#取模运算" class="headerlink" title="取模运算"></a>取模运算</h5><p>同样以用户 ID 为例，假如一开始就规划了 10 个数据库表，可以简单地用 <code>user_id % 10</code> 的值来表示数据所属的数据库表编号，ID 为 985 的用户放到编号为 5 的子表中，ID 为 10086 的用户放到编号为 6 的子表中。</p><ul><li><code>复杂点</code>：初始表数量的确定。表数量太多维护比较麻烦，表数量太少又可能导致单表性能存在问题。</li><li><code>优点</code>：表分布比较均匀。</li><li><code>缺点</code>：扩充新的表很麻烦，所有表的数据都要重新迁移。</li></ul><h5 id="雪花算法"><a href="#雪花算法" class="headerlink" title="雪花算法"></a>雪花算法</h5><p>雪花算法（SnowFlake）是由 Twitter 公布的分布式主键生成算法，它能够保证不同表的主键的不重复性，以及相同表的主键的有序性。雪花算法的特性是有序、全局唯一、高性能、低延迟（响应时间在 2ms 以内），可在分布式环境（多集群，跨机房）下使用，因此使用雪花算法得到的 ID 是分段组成的：</p><ul><li>与指定日期的时间差（毫秒级），41 位，够用 69 年</li><li>集群 ID + 机器 ID，一共 10 位，包括 5 位 <code>datacenterId</code> 和 5 位 <code>workerId</code>，最多支持 1024 台机器</li><li>序列号，12 位，每台机器每毫秒内最多产生 4096 个序列号</li></ul><p><img data-src="../../../asset/2020/12/snowflake-1.png" alt="snowflake-1"></p><ul><li><code>1bit</code>：符号位，固定是 0，表示全部 ID 都是正整数</li><li><code>41bit</code>：时间戳（毫秒数时间差），从指定的日期算起，够用 69 年，用 Long 类型表示的时间戳是从 <code>1970-01-01 00:00:00</code> 开始算起的</li><li><code>10bit</code>：机器 ID，有异地部署，多集群的也可以配置，需要线下规划好各地机房，各集群，各实例 ID 的编号</li><li><code>12bit</code>：序列号，前面都相同的话，最多可以支持到 4096 个</li></ul><p><strong>优缺点：</strong></p><ul><li><code>适用场景：</code>分布式应用环境的数据主键</li><li><code>优点：</code><ul><li>可以根据自身业务特性分配 <code>bit</code> 位，非常灵活</li><li>毫秒数在高位，自增序列在低位，整个 ID 都是趋势递增的</li><li>不依赖数据库等三方系统，以服务的方式部署，稳定性更高，生成 ID 的效率也是非常高，低延迟</li></ul></li><li><code>缺点：</code><ul><li>强依赖机器时钟，如果机器的时钟回拨了，会导致生成重复的 ID</li><li> 若生成环境中使用了容器化技术，实例的个数随时有变化，那么 SnowFlake 算法需要一定的改造才能更好地应用到生产环境中</li><li>在单机上是递增的，但是由于涉及到分布式环境，每台机器上的时钟不可能完全同步（如时钟回拨），有时候可能会出现不是全局递增的情况（此缺点可认为无所谓，一般分布式 ID 只是要求趋势递增，并不会严格要求递增，90% 的业务需求都只需要趋势递增）</li></ul></li></ul></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script>var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if(!isMobile)try{var plugin=new ReadmorePlugin;plugin.init({id:"readmore-container",blogId:"96641-5333172926158-056",name:"全栈技术驿站",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",lockToc:"yes",type:"hexo",random:"0.9",interval:"30",expires:"365",height:"auto"})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/3fd3ab84.html" title="MyBatis-Plus 入门教程之二">https://www.techgrow.cn/posts/3fd3ab84.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎加入微信群</span><br> <img src="/img/wx-group-qr-technology.png"></div></div></div><div class="post-tags"><a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"><i class="fa fa-tag"></i> 数据库</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/a548291f.html" rel="prev" title="《区块链原理、设计与应用》摘录之一"><i class="fa fa-chevron-left"></i> 《区块链原理、设计与应用》摘录之一</a></div><div class="post-nav-item"> <a href="/posts/c8f728b3.html" rel="next" title="J2Cache - 两级缓存框架介绍">J2Cache - 两级缓存框架介绍<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright &copy; 2018 – <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">800k</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">12:07</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="beian"> <span><img src="/img/gonganbeian.png" alt></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备19024664号</a></span></div></div></footer><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-ZfzwelSToHk5YAcr9wbXAmWgyn9Jyq08fSLrLhZE89w="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://unpkg.com/qiniu-js@3.3.1/dist/qiniu.min.js"></script><script>
    var qiniu_domain = "https://qiniu.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/app/api/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn:9360","cssUrl":"https://unpkg.com/@waline/client@2.5.1/dist/waline.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://unpkg.com/@waline/client@2.5.1/dist/waline.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://qiniu.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/app/api/qiniu/token/upload","el":"#waline","comment":true,"path":"/posts/3fd3ab84.html"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@2.5.1/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>