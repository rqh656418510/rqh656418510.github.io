<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","width":300,"display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 Spring Security 5 的基础教程，包括 CSRF 使用、微服务权限实战等内容。"><meta property="og:type" content="article"><meta property="og:title" content="Spring Security 5 基础教程之四"><meta property="og:url" content="https://www.techgrow.cn/posts/10cb1122.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 Spring Security 5 的基础教程，包括 CSRF 使用、微服务权限实战等内容。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2023/10/spring-security-14.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2023/10/spring-security-15.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2023/10/spring-security-16.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2023/10/spring-security-17.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2023/10/spring-security-18.png"><meta property="article:published_time" content="2018-05-11T13:12:35.000Z"><meta property="article:modified_time" content="2022-08-06T13:12:35.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="Java"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2023/10/spring-security-14.png"><link rel="canonical" href="https://www.techgrow.cn/posts/10cb1122.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/10cb1122.html","path":"posts/10cb1122.html","title":"Spring Security 5 基础教程之四"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Spring Security 5 基础教程之四 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn:9360"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/app/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn:9360/ui/login?lng=zh-cn" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CSRF"><span class="nav-text">CSRF</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CSRF-%E4%BB%8B%E7%BB%8D"><span class="nav-text">CSRF 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSRF-%E4%BD%BF%E7%94%A8"><span class="nav-text">CSRF 使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSRF-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-text">CSRF 实现原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9D%83%E9%99%90%E5%AE%9E%E6%88%98"><span class="nav-text">微服务权限实战</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E"><span class="nav-text">版本说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="nav-text">实现思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E6%A8%A1%E5%9E%8B"><span class="nav-text">权限模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ACL-%E6%A8%A1%E5%9E%8B"><span class="nav-text">ACL 模型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RBAC-%E6%A8%A1%E5%9E%8B"><span class="nav-text">RBAC 模型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JWT-%E6%A6%82%E8%BF%B0"><span class="nav-text">JWT 概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="nav-text">实战案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-text">项目结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">初始化数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E4%BB%A3%E7%A0%81%E4%B8%8B%E8%BD%BD"><span class="nav-text">案例代码下载</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">474</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">44</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/10cb1122.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java、前端、移动端、微服务、分布式系统、数据库、系统架构、人工智能、大数据、云计算、物联网、虚拟化学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Spring Security 5 基础教程之四 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 Spring Security 5 的基础教程，包括 CSRF 使用、微服务权限实战等内容。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Spring Security 5 基础教程之四</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-05-11 21:12:35" itemprop="dateCreated datePublished" datetime="2018-05-11T21:12:35+08:00">2018-05-11</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2022-08-06 21:12:35" itemprop="dateModified" datetime="2022-08-06T21:12:35+08:00">2022-08-06</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/10cb1122.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/10cb1122.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>2k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>2 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/935cdb32.html">Spring Security 5 基础教程之一</a></li><li><a href="/posts/1e45eb31.html">Spring Security 5 基础教程之二</a></li><li><a href="/posts/5c197d3c.html">Spring Security 5 基础教程之三</a></li><li><a href="/posts/10cb1122.html">Spring Security 5 基础教程之四</a></li><li><a href="/posts/d297367.html">Spring Security 5 基础教程之五</a></li></ul><h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><h3 id="CSRF-介绍"><a href="#CSRF-介绍" class="headerlink" title="CSRF 介绍"></a>CSRF 介绍</h3><p>跨站请求伪造 (Cross-site request forgery)，也被称为 one-clickattack 或者 session riding，通常缩写为 CSRF 或者 XSRF，是一种挟持用户在当前已登录的 Web 应用程序上执行非本意的操作的攻击方法。跟跨网站脚本 (XSS) 相比，XSS 利用的是用户对指定网站的信任，CSRF 利用的是网站对用户网页浏览器的信任。跨站请求攻击，简单地说，是攻击者通过一些技术手段欺骗用户的浏览器去访问一个自己曾经认证过的网站并执行一些操作 (如发邮件，发消息，甚至财产操作如转账和购买商品)。由于浏览器曾经认证过，所以被访问的网站会认为是真正的用户操作而去执行。这利用了 Web 中用户身份验证的一个漏洞：简单的身份验证只能保证请求发自某个用户的浏览器，却不能保证请求本身是用户自愿发出的。</p><blockquote><p>从 Spring Security 4.0 开始，默认情况下会启用 CSRF 保护，以防止 CSRF 攻击应用程序，Spring Security CSRF 会针对 PATCH，POST，PUT 和 DELETE 方法进行防护。</p></blockquote><span id="more"></span><h3 id="CSRF-使用"><a href="#CSRF-使用" class="headerlink" title="CSRF 使用"></a>CSRF 使用</h3><p>在 Form 表单中添加一个隐藏标签，如下所示：</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">th:if</span>=<span class="string">"${_csrf}!=null"</span> <span class="attr">th:value</span>=<span class="string">"${_csrf.token}"</span> <span class="attr">name</span>=<span class="string">"_csrf"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>Spring Security 默认启用 CSRF，若手动禁用了 CSRF，则需要在配置类中注释掉相关代码，如下所示：</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http.csrf().disable(); </span></span><br></pre></td></tr></tbody></table></figure><h3 id="CSRF-实现原理"><a href="#CSRF-实现原理" class="headerlink" title="CSRF 实现原理"></a>CSRF 实现原理</h3><ul><li>生成 CsrfToken，并保存到 HttpSession 或者 Cookie 中</li></ul><p><img data-src="../../../asset/2023/10/spring-security-14.png"></p><ul><li><code>SaveOnAccessCsrfToken</code> 类有个接口 <code>CsrfTokenRepository</code></li></ul><p><img data-src="../../../asset/2023/10/spring-security-15.png"></p><ul><li><code>CookieCsrfTokenRepository</code> 实现类的底层源码</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CookieCsrfTokenRepository</span> <span class="keyword">implements</span> <span class="title">CsrfTokenRepository</span> </span>{</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_CSRF_COOKIE_NAME = <span class="string">"XSRF-TOKEN"</span>;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_CSRF_PARAMETER_NAME = <span class="string">"_csrf"</span>;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_CSRF_HEADER_NAME = <span class="string">"X-XSRF-TOKEN"</span>;</span><br><span class="line">	<span class="keyword">private</span> String parameterName = DEFAULT_CSRF_PARAMETER_NAME;</span><br><span class="line">	<span class="keyword">private</span> String headerName = DEFAULT_CSRF_HEADER_NAME;</span><br><span class="line">	<span class="keyword">private</span> String cookieName = DEFAULT_CSRF_COOKIE_NAME;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> cookieHttpOnly = <span class="keyword">true</span>;</span><br><span class="line">	<span class="keyword">private</span> String cookiePath;</span><br><span class="line">	<span class="keyword">private</span> String cookieDomain;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CookieCsrfTokenRepository</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	......</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> CsrfToken <span class="title">generateToken</span><span class="params">(HttpServletRequest request)</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> DefaultCsrfToken(<span class="keyword">this</span>.headerName, <span class="keyword">this</span>.parameterName, createNewToken());</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> String <span class="title">createNewToken</span><span class="params">()</span> </span>{</span><br><span class="line">		<span class="keyword">return</span> UUID.randomUUID().toString();</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>当请求到来时，Spring Security 从请求中获取 CsrfToken，并与已保存的 CsrfToken 做比较，进而判断当前请求是否合法，整个过程主要是通过 CsrfFilter 过滤器来完成</li></ul><h2 id="微服务权限实战"><a href="#微服务权限实战" class="headerlink" title="微服务权限实战"></a>微服务权限实战</h2><p>这里主要演示如何在微服务系统中，基于 Spring Cloud、Spring Security、JWT、RBAC 权限模型实现权限管理。</p><h3 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h3><p>本案例使用了以下技术，具体版本说明如下：</p><table><thead><tr><th>技术</th><th>版本</th><th>说明</th></tr></thead><tbody><tr><td> Spring Boot</td><td>2.2.1.RELEASE</td><td></td></tr><tr><td>Spring Cloud</td><td>Hoxton.RELEASE</td><td> 引入了 Gateway 组件，用于 API 网关</td></tr><tr><td> Spring Cloud Alibaba</td><td>0.2.2.RELEASE</td><td> 引入了 Nacos 组件，用于注册中心</td></tr><tr><td> Spring Security</td><td>5.2.1.RELEASE</td><td></td></tr><tr><td>MyBatis-Plus</td><td>3.0.5</td><td></td></tr><tr><td>Swagger</td><td>2.7.0</td><td></td></tr><tr><td>Redis</td><td>6.0.4</td><td></td></tr><tr><td>JWT</td><td>0.7.0</td><td></td></tr></tbody></table><h3 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h3><ul><li>如果是基于 Session，那么 Spring Security 会对 Cookie 里的 <code>sessionid</code> 进行解析，找到服务器端存储的 Session 信息，然后判断当前用户是否符合请求的要求。</li><li>如果是基于 Token，则是解析出 Token，然后将当前请求加入到 Spring Security 管理的权限信息中去，完整的认证与授权流程和图解如下：<ul><li>(1) 由于系统的模块众多，每个模块都需要进行授权与认证，所以一般选择基于 Token 的形式进行认证与授权。</li><li>(2) 用户根据用户名与密码认证成功后，获取当前用户角色的一系列权限值，以用户名为 Key，权限列表为 Value 的形式存入 Redis 缓存；同时根据用户名相关信息生成 Token 并返回浏览器，然后浏览器将 Token 存入 Cookie。</li><li>(3) 前端每次调用 API 接口的时候，默认将 Cookie 中的 Token 携带到 Header 请求头。</li><li>(4) Spring Security 处理请求的 Header 头，从中解析 Token 信息，得到当前用户名，根据用户名就可以从 Redis 中获取权限列表，这样 Spring Security 就能够判断当前请求是否有权限访问。</li></ul></li></ul><p><img data-src="../../../asset/2023/10/spring-security-16.png"></p><h3 id="权限模型"><a href="#权限模型" class="headerlink" title="权限模型"></a>权限模型</h3><p>权限模型有两种，分别是 ACL 和 RBAC。</p><h4 id="ACL-模型"><a href="#ACL-模型" class="headerlink" title="ACL 模型"></a>ACL 模型</h4><ul><li>ACL (Access Controll List)<ul><li> 用户（t_user）</li><li>用户_权限 (t_user_perm)<ul><li>N 对 N 关系，需要有中间表</li></ul></li><li>权限（t_permission）</li></ul></li></ul><h4 id="RBAC-模型"><a href="#RBAC-模型" class="headerlink" title="RBAC 模型"></a>RBAC 模型</h4><ul><li>RBAC (Role Based Access Controll)<ul><li> 用户 (<code>t_user</code>)</li><li> 用户_角色 (<code>t_user_role</code>)<ul><li>N 对 N 关系，需要有中间表</li></ul></li><li>角色 (<code>t_role</code>)</li><li> 角色_权限 (<code>t_role_perm</code>)<ul><li>N 对 N 关系，需要有中间表</li></ul></li><li>权限 (<code>t_permission</code>)</li></ul></li></ul><blockquote><p>RBAC 权限模型对应的数据库表设计如下：</p></blockquote><p><img data-src="../../../asset/2023/10/spring-security-17.png"></p><h3 id="JWT-概述"><a href="#JWT-概述" class="headerlink" title="JWT 概述"></a>JWT 概述</h3><ul><li><a href="/posts/1b9bb05b.html">JWT 基础使用教程</a></li></ul><h3 id="实战案例"><a href="#实战案例" class="headerlink" title="实战案例"></a>实战案例</h3><h4 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h4><p><img data-src="../../../asset/2023/10/spring-security-18.png"></p><h4 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h4><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE `micro_service_acl` <span class="keyword">DEFAULT</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 切换数据库</span></span><br><span class="line">USE `micro_service_acl`;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建用户表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `acl_user` (</span><br><span class="line">  `id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'会员id'</span>,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> COMMENT <span class="string">'微信openid'</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> COMMENT <span class="string">'密码'</span>,</span><br><span class="line">  `nick_name` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'昵称'</span>,</span><br><span class="line">  `salt` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'用户头像'</span>,</span><br><span class="line">  `token` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'用户签名'</span>,</span><br><span class="line">  `is_deleted` tinyint(<span class="number">1</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">'逻辑删除 1（true）已删除， 0（false）未删除'</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'创建时间'</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'更新时间'</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_username` (`username`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">'用户表'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建角色表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `acl_role` (</span><br><span class="line">  `id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> COMMENT <span class="string">'角色id'</span>,</span><br><span class="line">  `role_name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> COMMENT <span class="string">'角色名称'</span>,</span><br><span class="line">  `role_code` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'角色编码'</span>,</span><br><span class="line">  `remark` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'备注'</span>,</span><br><span class="line">  `is_deleted` tinyint(<span class="number">1</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">'逻辑删除 1（true）已删除， 0（false）未删除'</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'创建时间'</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'更新时间'</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建权限表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `acl_permission` (</span><br><span class="line">  `id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> COMMENT <span class="string">'编号'</span>,</span><br><span class="line">  `pid` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> COMMENT <span class="string">'所属上级'</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> COMMENT <span class="string">'名称'</span>,</span><br><span class="line">  `type` tinyint(<span class="number">3</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">'类型(1:菜单,2:按钮)'</span>,</span><br><span class="line">  `permission_value` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'权限值'</span>,</span><br><span class="line">  `path` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'访问路径'</span>,</span><br><span class="line">  `component` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'组件路径'</span>,</span><br><span class="line">  `icon` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'图标'</span>,</span><br><span class="line">  `status` tinyint(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'状态(0:禁止,1:正常)'</span>,</span><br><span class="line">  `is_deleted` tinyint(<span class="number">1</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">'逻辑删除 1（true）已删除， 0（false）未删除'</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'创建时间'</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'更新时间'</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `idx_pid` (`pid`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">'权限'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建用户角色表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `acl_user_role` (</span><br><span class="line">  `id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span> COMMENT <span class="string">'主键id'</span>,</span><br><span class="line">  `role_id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">'角色id'</span>,</span><br><span class="line">  `user_id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">'用户id'</span>,</span><br><span class="line">  `is_deleted` tinyint(<span class="number">1</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">'逻辑删除 1（true）已删除， 0（false）未删除'</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'创建时间'</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'更新时间'</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `idx_role_id` (`role_id`),</span><br><span class="line">  KEY `idx_user_id` (`user_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建角色权限表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `acl_role_permission` (</span><br><span class="line">  `id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  `role_id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  `permission_id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">''</span>,</span><br><span class="line">  `is_deleted` tinyint(<span class="number">1</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> COMMENT <span class="string">'逻辑删除 1（true）已删除， 0（false）未删除'</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'创建时间'</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">'更新时间'</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `idx_role_id` (`role_id`),</span><br><span class="line">  KEY `idx_permission_id` (`permission_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">'角色权限'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入用户数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `acl_user` <span class="keyword">VALUES</span> (<span class="string">'1'</span>,<span class="string">'admin'</span>,<span class="string">'96e79218965eb72c92a549dd5a330112'</span>,<span class="string">'admin'</span>,<span class="string">''</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-01 10:39:47'</span>,<span class="string">'2018-05-01 10:39:47'</span>),(<span class="string">'2'</span>,<span class="string">'test'</span>,<span class="string">'96e79218965eb72c92a549dd5a330112'</span>,<span class="string">'test'</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-01 16:36:07'</span>,<span class="string">'2018-05-01 16:40:08'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入角色数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `acl_role` <span class="keyword">VALUES</span> (<span class="string">'1'</span>,<span class="string">'普通管理员'</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-11 13:09:32'</span>,<span class="string">'2018-05-18 10:27:18'</span>),(<span class="string">'2'</span>,<span class="string">'测试员'</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:35:58'</span>,<span class="string">'2018-05-18 13:35:58'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入权限数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `acl_permission` <span class="keyword">VALUES</span> (<span class="string">'1'</span>,<span class="string">'0'</span>,<span class="string">'全部数据'</span>,<span class="number">0</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:13:06'</span>,<span class="string">'2018-05-15 17:13:06'</span>),(<span class="string">'1195268474480156673'</span>,<span class="string">'1'</span>,<span class="string">'权限管理'</span>,<span class="number">1</span>,<span class="keyword">NULL</span>,<span class="string">'/acl'</span>,<span class="string">'Layout'</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:13:06'</span>,<span class="string">'2018-05-18 13:54:25'</span>),(<span class="string">'1195268616021139457'</span>,<span class="string">'1195268474480156673'</span>,<span class="string">'用户管理'</span>,<span class="number">1</span>,<span class="keyword">NULL</span>,<span class="string">'user/list'</span>,<span class="string">'/acl/user/list'</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:13:40'</span>,<span class="string">'2018-05-18 13:53:12'</span>),(<span class="string">'1195268788138598401'</span>,<span class="string">'1195268474480156673'</span>,<span class="string">'角色管理'</span>,<span class="number">1</span>,<span class="keyword">NULL</span>,<span class="string">'role/list'</span>,<span class="string">'/acl/role/list'</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:14:21'</span>,<span class="string">'2018-05-15 17:14:21'</span>),(<span class="string">'1195268893830864898'</span>,<span class="string">'1195268474480156673'</span>,<span class="string">'菜单管理'</span>,<span class="number">1</span>,<span class="keyword">NULL</span>,<span class="string">'menu/list'</span>,<span class="string">'/acl/menu/list'</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:14:46'</span>,<span class="string">'2018-05-15 17:14:46'</span>),(<span class="string">'1195269143060602882'</span>,<span class="string">'1195268616021139457'</span>,<span class="string">'查看'</span>,<span class="number">2</span>,<span class="string">'user.list'</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:15:45'</span>,<span class="string">'2018-05-17 21:57:16'</span>),(<span class="string">'1195269295926206466'</span>,<span class="string">'1195268616021139457'</span>,<span class="string">'添加'</span>,<span class="number">2</span>,<span class="string">'user.add'</span>,<span class="string">'user/add'</span>,<span class="string">'/acl/user/form'</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:16:22'</span>,<span class="string">'2018-05-15 17:16:22'</span>),(<span class="string">'1195269473479483394'</span>,<span class="string">'1195268616021139457'</span>,<span class="string">'修改'</span>,<span class="number">2</span>,<span class="string">'user.update'</span>,<span class="string">'user/update/:id'</span>,<span class="string">'/acl/user/form'</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:17:04'</span>,<span class="string">'2018-05-15 17:17:04'</span>),(<span class="string">'1195269547269873666'</span>,<span class="string">'1195268616021139457'</span>,<span class="string">'删除'</span>,<span class="number">2</span>,<span class="string">'user.remove'</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:17:22'</span>,<span class="string">'2018-05-15 17:17:22'</span>),(<span class="string">'1195269821262782465'</span>,<span class="string">'1195268788138598401'</span>,<span class="string">'修改'</span>,<span class="number">2</span>,<span class="string">'role.update'</span>,<span class="string">'role/update/:id'</span>,<span class="string">'/acl/role/form'</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:18:27'</span>,<span class="string">'2018-05-15 17:19:53'</span>),(<span class="string">'1195269903542444034'</span>,<span class="string">'1195268788138598401'</span>,<span class="string">'查看'</span>,<span class="number">2</span>,<span class="string">'role.list'</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:18:47'</span>,<span class="string">'2018-05-15 17:18:47'</span>),(<span class="string">'1195270037005197313'</span>,<span class="string">'1195268788138598401'</span>,<span class="string">'添加'</span>,<span class="number">2</span>,<span class="string">'role.add'</span>,<span class="string">'role/add'</span>,<span class="string">'/acl/role/form'</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:19:19'</span>,<span class="string">'2018-05-18 11:05:42'</span>),(<span class="string">'1195270442602782721'</span>,<span class="string">'1195268788138598401'</span>,<span class="string">'删除'</span>,<span class="number">2</span>,<span class="string">'role.remove'</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:20:55'</span>,<span class="string">'2018-05-15 17:20:55'</span>),(<span class="string">'1195270621548568578'</span>,<span class="string">'1195268788138598401'</span>,<span class="string">'角色权限'</span>,<span class="number">2</span>,<span class="string">'role.acl'</span>,<span class="string">'role/distribution/:id'</span>,<span class="string">'/acl/role/roleForm'</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:21:38'</span>,<span class="string">'2018-05-15 17:21:38'</span>),(<span class="string">'1195270744097742849'</span>,<span class="string">'1195268893830864898'</span>,<span class="string">'查看'</span>,<span class="number">2</span>,<span class="string">'permission.list'</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:22:07'</span>,<span class="string">'2018-05-15 17:22:07'</span>),(<span class="string">'1195270810560684034'</span>,<span class="string">'1195268893830864898'</span>,<span class="string">'添加'</span>,<span class="number">2</span>,<span class="string">'permission.add'</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:22:23'</span>,<span class="string">'2018-05-15 17:22:23'</span>),(<span class="string">'1195270862100291586'</span>,<span class="string">'1195268893830864898'</span>,<span class="string">'修改'</span>,<span class="number">2</span>,<span class="string">'permission.update'</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:22:35'</span>,<span class="string">'2018-05-15 17:22:35'</span>),(<span class="string">'1195270887933009922'</span>,<span class="string">'1195268893830864898'</span>,<span class="string">'删除'</span>,<span class="number">2</span>,<span class="string">'permission.remove'</span>,<span class="string">''</span>,<span class="string">''</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-15 17:22:41'</span>,<span class="string">'2018-05-15 17:22:41'</span>),(<span class="string">'1196301740985311234'</span>,<span class="string">'1195268616021139457'</span>,<span class="string">'分配角色'</span>,<span class="number">2</span>,<span class="string">'user.assgin'</span>,<span class="string">'user/role/:id'</span>,<span class="string">'/acl/user/roleForm'</span>,<span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:38:56'</span>,<span class="string">'2018-05-18 13:38:56'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入角色权限数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `acl_role_permission` <span class="keyword">VALUES</span> (<span class="string">'1196301979754455041'</span>,<span class="string">'1'</span>,<span class="string">'1'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301979792203778'</span>,<span class="string">'1'</span>,<span class="string">'1195268474480156673'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301979821563906'</span>,<span class="string">'1'</span>,<span class="string">'1195268616021139457'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301979842535426'</span>,<span class="string">'1'</span>,<span class="string">'1195269143060602882'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301979855118338'</span>,<span class="string">'1'</span>,<span class="string">'1195269295926206466'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301979880284161'</span>,<span class="string">'1'</span>,<span class="string">'1195269473479483394'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301979913838593'</span>,<span class="string">'1'</span>,<span class="string">'1195269547269873666'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301979926421506'</span>,<span class="string">'1'</span>,<span class="string">'1196301740985311234'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301979951587330'</span>,<span class="string">'1'</span>,<span class="string">'1195268788138598401'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980014501889'</span>,<span class="string">'1'</span>,<span class="string">'1195269821262782465'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980035473410'</span>,<span class="string">'1'</span>,<span class="string">'1195269903542444034'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980052250626'</span>,<span class="string">'1'</span>,<span class="string">'1195270037005197313'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980077416450'</span>,<span class="string">'1'</span>,<span class="string">'1195270442602782721'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980094193665'</span>,<span class="string">'1'</span>,<span class="string">'1195270621548568578'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980119359489'</span>,<span class="string">'1'</span>,<span class="string">'1195268893830864898'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980136136706'</span>,<span class="string">'1'</span>,<span class="string">'1195270744097742849'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980249382913'</span>,<span class="string">'1'</span>,<span class="string">'1195270810560684034'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980270354434'</span>,<span class="string">'1'</span>,<span class="string">'1195270862100291586'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980287131649'</span>,<span class="string">'1'</span>,<span class="string">'1195270887933009922'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980287131748'</span>,<span class="string">'2'</span>,<span class="string">'1'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980287131835'</span>,<span class="string">'2'</span>,<span class="string">'1195268474480156673'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980287131836'</span>,<span class="string">'2'</span>,<span class="string">'1195268616021139457'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980287131837'</span>,<span class="string">'2'</span>,<span class="string">'1195269143060602882'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980287131838'</span>,<span class="string">'2'</span>,<span class="string">'1195269295926206466'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980287131839'</span>,<span class="string">'2'</span>,<span class="string">'1195269473479483394'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>),(<span class="string">'1196301980287131840'</span>,<span class="string">'2'</span>,<span class="string">'1195269547269873666'</span>,<span class="number">0</span>,<span class="string">'2018-05-18 13:39:53'</span>,<span class="string">'2018-05-18 13:39:53'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入用户角色数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `acl_user_role` <span class="keyword">VALUES</span> (<span class="string">'1'</span>,<span class="string">'1'</span>,<span class="string">'1'</span>,<span class="number">0</span>,<span class="string">'2018-05-11 13:09:53'</span>,<span class="string">'2018-05-11 13:09:53'</span>),(<span class="string">'2'</span>,<span class="string">'2'</span>,<span class="string">'2'</span>,<span class="number">0</span>,<span class="string">'2018-05-11 13:09:53'</span>,<span class="string">'2018-05-11 13:09:53'</span>);</span><br></pre></td></tr></tbody></table></figure><h4 id="案例代码下载"><a href="#案例代码下载" class="headerlink" title="案例代码下载"></a>案例代码下载</h4><p>完整的案例代码可以直接从 <a target="_blank" rel="external nofollow" href="https://github.com/rqh656418510/spring-cloud-share/tree/main/spring-security/spring-security5-study">GitHub</a> 下载对应章节 <code>spring-security5-10</code>。</p><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes"})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/10cb1122.html" title="Spring Security 5 基础教程之四">https://www.techgrow.cn/posts/10cb1122.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/5c197d3c.html" rel="prev" title="Spring Security 5 基础教程之三"><i class="fa fa-angle-left"></i> Spring Security 5 基础教程之三</a></div><div class="post-nav-item"> <a href="/posts/d297367.html" rel="next" title="Spring Security 5 基础教程之五">Spring Security 5 基础教程之五<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">970k</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">14:42</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤 ICP 备 19024664 号</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035 号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-g2xji1rlE3KsGVClvuxTbcR0Kn2+wtQADSff2Tbb4zA="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-9y71g5Lz/KLsHjB8uXwnkuWDtAMDSzD/HdIbqhJfTAI="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://qiniu.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/app/api/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn:9360","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://qiniu.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/app/api/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/10cb1122.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>