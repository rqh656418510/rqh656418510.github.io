<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="Hexo优化，利用Gulp压缩代码，包括CSS、JS、HTML、图片文件压缩。"><meta property="og:type" content="article"><meta property="og:title" content="Hexo 优化 - 利用 Gulp 压缩代码"><meta property="og:url" content="https://www.techgrow.cn/posts/17b9b7b0.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="Hexo优化，利用Gulp压缩代码，包括CSS、JS、HTML、图片文件压缩。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2019-03-03T02:30:03.000Z"><meta property="article:modified_time" content="2021-08-04T14:25:35.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="静态博客"><meta property="article:tag" content="前端"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.techgrow.cn/posts/17b9b7b0.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/17b9b7b0.html","path":"posts/17b9b7b0.html","title":"Hexo 优化 - 利用 Gulp 压缩代码"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Hexo 优化 - 利用 Gulp 压缩代码 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E5%8E%8B%E7%BC%A9%E4%BB%A3%E7%A0%81"><span class="nav-text">Gulp 压缩代码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E"><span class="nav-text">版本说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-NPM-%E6%A8%A1%E5%9D%97"><span class="nav-text">安装 NPM 模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-Gulp-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">创建 Gulp 配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Gulp-%E6%89%A7%E8%A1%8C%E5%8E%8B%E7%BC%A9%E4%BB%BB%E5%8A%A1"><span class="nav-text">Gulp 执行压缩任务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E4%BD%BF%E7%94%A8%E4%BC%98%E5%8C%96"><span class="nav-text">Gulp 使用优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Gulp-%E5%8F%AA%E5%8E%8B%E7%BC%A9%E4%BF%AE%E6%94%B9%E8%BF%87%E7%9A%84%E6%96%87%E4%BB%B6"><span class="nav-text">Gulp 只压缩修改过的文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Gulp-%E7%9B%B4%E6%8E%A5%E8%B0%83%E7%94%A8-Hexo-Cli-%E5%91%BD%E4%BB%A4"><span class="nav-text">Gulp 直接调用 Hexo-Cli 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%98%BE%E7%A4%BA-Gulp-%E7%9A%84%E8%AF%A6%E7%BB%86%E6%9E%84%E5%BB%BA%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF"><span class="nav-text">显示 Gulp 的详细构建日志信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%98%BE%E7%A4%BA-Gulp-%E6%9E%84%E5%BB%BA%E5%A4%B1%E8%B4%A5%E6%97%B6%E7%9A%84%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF"><span class="nav-text">显示 Gulp 构建失败时的错误日志信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%87%E7%BA%A7-Gulp-%E7%9A%84%E7%89%88%E6%9C%AC"><span class="nav-text">升级 Gulp 的版本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Gulp-%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7"><span class="nav-text">Gulp 版本升级</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Babel-%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7"><span class="nav-text">Babel 版本升级</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Gulp-%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E5%90%8E%E7%9A%84%E4%BB%A3%E7%A0%81%E5%85%BC%E5%AE%B9%E5%A4%84%E7%90%86"><span class="nav-text">Gulp 版本升级后的代码兼容处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Gulp-%E4%B8%8E-Babel-%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E5%90%8E%E7%9A%84%E5%AE%8C%E6%95%B4%E4%BE%9D%E8%B5%96%E9%A1%B9"><span class="nav-text">Gulp 与 Babel 版本升级后的完整依赖项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="nav-text">常见问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%8B%E7%BC%A9%E5%9B%BE%E7%89%87%E5%87%BA%E9%94%99"><span class="nav-text">压缩图片出错</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">725</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/17b9b7b0.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Hexo 优化 - 利用 Gulp 压缩代码 | Clay 的技术空间"><meta itemprop="description" content="Hexo优化，利用Gulp压缩代码，包括CSS、JS、HTML、图片文件压缩。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Hexo 优化 - 利用 Gulp 压缩代码</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-03-03 10:30:03" itemprop="dateCreated datePublished" datetime="2019-03-03T10:30:03+08:00">2019-03-03</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-08-04 22:25:35" itemprop="dateModified" datetime="2021-08-04T22:25:35+08:00">2021-08-04</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/17b9b7b0.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/17b9b7b0.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>1.7k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>2 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="Gulp-压缩代码"><a href="#Gulp-压缩代码" class="headerlink" title="Gulp 压缩代码"></a>Gulp 压缩代码</h2><h3 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h3><p>主要模块的版本号分别为： gulp 3.9.x，gulp-babel 7.x，babel-core 6.x</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">"babel-core": "^6.26.3",</span><br><span class="line">"babel-loader": "^7.1.5",</span><br><span class="line">"babel-preset-env": "^1.7.0",</span><br><span class="line">"babel-preset-es2015": "^6.24.1",</span><br><span class="line">"gulp": "^3.9.1",</span><br><span class="line">"gulp-babel": "^7.0.1",</span><br><span class="line">"gulp-cache": "^1.1.1",</span><br><span class="line">"gulp-changed": "^3.2.0",</span><br><span class="line">"gulp-clean": "^0.4.0",</span><br><span class="line">"gulp-debug": "^4.0.0",</span><br><span class="line">"gulp-htmlclean": "^2.7.22",</span><br><span class="line">"gulp-htmlmin": "^5.0.1",</span><br><span class="line">"gulp-imagemin": "^5.0.3",</span><br><span class="line">"gulp-minify-css": "^1.2.4",</span><br><span class="line">"gulp-uglify": "^3.0.2",</span><br><span class="line">"gulp-util": "^3.0.8",</span><br><span class="line">"imagemin-pngquant": "^7.0.0"</span><br></pre></td></tr></tbody></table></figure><span id="more"></span><h3 id="安装-NPM-模块"><a href="#安装-NPM-模块" class="headerlink" title="安装 NPM 模块"></a>安装 NPM 模块</h3><p><strong>全局安装：</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 全局安装 Gulp 3.9</span><br><span class="line">$ npm install -g gulp@3.9.1</span><br><span class="line"></span><br><span class="line"># 全局查看 Gulp 的版本号</span><br><span class="line">$ gulp --version</span><br></pre></td></tr></tbody></table></figure><p><strong>局部安装：</strong></p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 局部安装 Gulp 3.9.1</span></span><br><span class="line"><span class="keyword">$ npm</span> install gulp@3.9.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 局部安装 Babel 6</span></span><br><span class="line"><span class="keyword">$ npm</span> install gulp-babel@7 babel-core babel-preset-env babel-loader babel-preset-es2015<span class="params"> --save</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 局部安装其他模块</span></span><br><span class="line">1）将上面其他模块的依赖信息添加到博客根目录下的package.json文件中</span><br><span class="line">2）然后在博客的根目录下，执行局部安装命令：npm install</span><br></pre></td></tr></tbody></table></figure><h3 id="创建-Gulp-配置文件"><a href="#创建-Gulp-配置文件" class="headerlink" title="创建 Gulp 配置文件"></a>创建 Gulp 配置文件</h3><p>在 Hexo 博客的根目录下创建 <code>gulpfile.js</code> 配置文件，并写入以下内容：</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> gutil = <span class="built_in">require</span>(<span class="string">'gulp-util'</span>);</span><br><span class="line"><span class="keyword">var</span> clean = <span class="built_in">require</span>(<span class="string">'gulp-clean'</span>);</span><br><span class="line"><span class="keyword">var</span> debug = <span class="built_in">require</span>(<span class="string">'gulp-debug'</span>);</span><br><span class="line"><span class="keyword">var</span> cache = <span class="built_in">require</span>(<span class="string">'gulp-cache'</span>);</span><br><span class="line"><span class="keyword">var</span> babel = <span class="built_in">require</span>(<span class="string">'gulp-babel'</span>);</span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>);</span><br><span class="line"><span class="keyword">var</span> changed = <span class="built_in">require</span>(<span class="string">'gulp-changed'</span>);</span><br><span class="line"><span class="keyword">var</span> htmlmin = <span class="built_in">require</span>(<span class="string">'gulp-htmlmin'</span>);</span><br><span class="line"><span class="keyword">var</span> imagemin = <span class="built_in">require</span>(<span class="string">'gulp-imagemin'</span>);</span><br><span class="line"><span class="keyword">var</span> htmlclean = <span class="built_in">require</span>(<span class="string">'gulp-htmlclean'</span>);</span><br><span class="line"><span class="keyword">var</span> minifycss = <span class="built_in">require</span>(<span class="string">'gulp-minify-css'</span>);</span><br><span class="line"><span class="keyword">var</span> pngquant = <span class="built_in">require</span>(<span class="string">'imagemin-pngquant'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩css文件</span></span><br><span class="line">gulp.task(<span class="string">'minify-css'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./public/css/**/*.css'</span>)</span><br><span class="line">    .pipe(minifycss())</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'./public/css'</span>));</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩js文件，支持将ES6代码转换成ES5代码</span></span><br><span class="line">gulp.task(<span class="string">'minify-js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./public/lib/**/*.js'</span>)</span><br><span class="line">    .pipe(babel({</span><br><span class="line">      <span class="attr">presets</span>: [<span class="string">'es2015'</span>]</span><br><span class="line">    }))</span><br><span class="line">    .pipe(uglify())</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'./public/lib'</span>));</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩html文件</span></span><br><span class="line">gulp.task(<span class="string">'minify-html'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./public/**/*.html'</span>)</span><br><span class="line">    .pipe(htmlclean())</span><br><span class="line">    .pipe(htmlmin({</span><br><span class="line">      <span class="attr">removeComments</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">minifyJS</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">minifyCSS</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">minifyURLs</span>: <span class="literal">true</span>,</span><br><span class="line">    }))</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'./public'</span>));</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩图片(深度压缩)</span></span><br><span class="line">gulp.task(<span class="string">'minify-images'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  gulp.src(<span class="string">'./public/asset/**/*.{png,jpg,gif,ico}'</span>)</span><br><span class="line">    .pipe(cache(imagemin({                   <span class="comment">//启用缓存，只压缩发生变化的图片</span></span><br><span class="line">      <span class="attr">progressive</span>: <span class="literal">true</span>,                     <span class="comment">//是否无损压缩jpg图片</span></span><br><span class="line">      <span class="attr">interlaced</span>: <span class="literal">false</span>,                     <span class="comment">//是否隔行扫描gif进行渲染</span></span><br><span class="line">      <span class="attr">svgoPlugins</span>: [{<span class="attr">removeViewBox</span>: <span class="literal">false</span>}], <span class="comment">//是否移除svg的viewbox属性</span></span><br><span class="line">      <span class="attr">multipass</span>: <span class="literal">false</span>,                      <span class="comment">//是否多次优化svg直到完全优化</span></span><br><span class="line">      <span class="attr">optimizationLevel</span>: <span class="number">5</span>,                   <span class="comment">//优化等级，取值范围：0-7，默认值：3</span></span><br><span class="line">      <span class="attr">use</span>: [pngquant()]                      <span class="comment">//使用pngquant深度压缩png图片的imagemin插件</span></span><br><span class="line">    })))</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'./public/asset'</span>));</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// gulp3的写法</span></span><br><span class="line">gulp.task(<span class="string">'default'</span>, [<span class="string">'minify-css'</span>, <span class="string">'minify-js'</span>, <span class="string">'minify-images'</span>, <span class="string">'minify-html'</span>]);</span><br></pre></td></tr></tbody></table></figure><h3 id="Gulp-执行压缩任务"><a href="#Gulp-执行压缩任务" class="headerlink" title="Gulp 执行压缩任务"></a>Gulp 执行压缩任务</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 进入博客根目录</span><br><span class="line">$ cd /blogroot</span><br><span class="line"></span><br><span class="line"># 执行指定的压缩任务（如压缩CSS）</span><br><span class="line">$ gulp minify-css</span><br><span class="line"></span><br><span class="line"># 执行全部压缩任务</span><br><span class="line">$ gulp</span><br><span class="line">[<span class="number">09</span>:<span class="number">35</span>:<span class="number">19</span>] Using gulpfile /blogroot/gulpfile.js</span><br><span class="line">[<span class="number">09</span>:<span class="number">35</span>:<span class="number">19</span>] Starting <span class="string">'minify-css'</span>...</span><br><span class="line">[<span class="number">09</span>:<span class="number">35</span>:<span class="number">19</span>] Starting <span class="string">'minify-js'</span>...</span><br><span class="line">[<span class="number">09</span>:<span class="number">35</span>:<span class="number">19</span>] Starting <span class="string">'minify-images'</span>...</span><br><span class="line">[<span class="number">09</span>:<span class="number">35</span>:<span class="number">19</span>] Finished <span class="string">'minify-images'</span> after <span class="number">6.59</span> ms</span><br><span class="line">[<span class="number">09</span>:<span class="number">35</span>:<span class="number">19</span>] Starting <span class="string">'minify-html'</span>...</span><br><span class="line">[<span class="number">09</span>:<span class="number">35</span>:<span class="number">20</span>] Finished <span class="string">'minify-css'</span> after <span class="number">739</span> ms</span><br><span class="line">[<span class="number">09</span>:<span class="number">35</span>:<span class="number">27</span>] Finished <span class="string">'minify-js'</span> after <span class="number">7.78</span> s</span><br><span class="line">[<span class="number">09</span>:<span class="number">40</span>:<span class="number">51</span>] Finished <span class="string">'minify-html'</span> after <span class="number">5.52</span> min</span><br><span class="line">[<span class="number">09</span>:<span class="number">40</span>:<span class="number">51</span>] Starting <span class="string">'default'</span>...</span><br><span class="line">[<span class="number">09</span>:<span class="number">40</span>:<span class="number">51</span>] Finished <span class="string">'default'</span> after <span class="number">34</span> μs</span><br><span class="line">[<span class="number">09</span>:<span class="number">40</span>:<span class="number">52</span>] gulp-imagemin: Minified <span class="number">122</span> images</span><br></pre></td></tr></tbody></table></figure><h2 id="Gulp-使用优化"><a href="#Gulp-使用优化" class="headerlink" title="Gulp 使用优化"></a>Gulp 使用优化</h2><h3 id="Gulp-只压缩修改过的文件"><a href="#Gulp-只压缩修改过的文件" class="headerlink" title="Gulp 只压缩修改过的文件"></a>Gulp 只压缩修改过的文件</h3><ul><li>上面的代码，默认会压缩扫描得到的所有文件（除了图片以外），效率和性能都非常低。此时可以安装 <code>gulp-changed</code> 模块，控制 Gulp 只压缩修改过的文件（代码如下）。</li><li>每次运行下面的代码之后，如果接着执行 <code>hexo clean</code> 命令，再执行压缩操作会发现 Gulp 依然会压缩所有文件。建议配合使用 <code>gulp-cache</code> 或者 <code>gulp-cached</code> 模块来解决压缩缓存的问题，也可以自行实现压缩缓存机制（内存缓存 + 磁盘缓存）。</li><li>如果压缩缓存方案依赖文件的 Hash 值，且 Hexo 使用了 <code>Yilia</code> 主题，则必须保证 Hexo 生成的标签（Tag）列表是有顺序的，否则 Hexo 每次执行 <code>clean</code> 与 <code>generate</code> 操作后，HTML 文件的 Hash 值都不一样，最终导致每次都会压缩 HTML 文件；建议修改 Hexo 主题的 JS 代码，使每次生成的标签列表都一样。</li><li>如果安装了第三方插件，可能也会影响文件的 Hash 值，例如：文章加密插件。</li></ul><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> gutil = <span class="built_in">require</span>(<span class="string">'gulp-util'</span>);</span><br><span class="line"><span class="keyword">var</span> clean = <span class="built_in">require</span>(<span class="string">'gulp-clean'</span>);</span><br><span class="line"><span class="keyword">var</span> debug = <span class="built_in">require</span>(<span class="string">'gulp-debug'</span>);</span><br><span class="line"><span class="keyword">var</span> cache = <span class="built_in">require</span>(<span class="string">'gulp-cache'</span>);</span><br><span class="line"><span class="keyword">var</span> babel = <span class="built_in">require</span>(<span class="string">'gulp-babel'</span>);</span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>);</span><br><span class="line"><span class="keyword">var</span> changed = <span class="built_in">require</span>(<span class="string">'gulp-changed'</span>);</span><br><span class="line"><span class="keyword">var</span> htmlmin = <span class="built_in">require</span>(<span class="string">'gulp-htmlmin'</span>);</span><br><span class="line"><span class="keyword">var</span> imagemin = <span class="built_in">require</span>(<span class="string">'gulp-imagemin'</span>);</span><br><span class="line"><span class="keyword">var</span> htmlclean = <span class="built_in">require</span>(<span class="string">'gulp-htmlclean'</span>);</span><br><span class="line"><span class="keyword">var</span> minifycss = <span class="built_in">require</span>(<span class="string">'gulp-minify-css'</span>);</span><br><span class="line"><span class="keyword">var</span> pngquant = <span class="built_in">require</span>(<span class="string">'imagemin-pngquant'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩css源文件(只压缩修改过的源文件)</span></span><br><span class="line">gulp.task(<span class="string">'generate-minify-css'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./public/css/**/*.css'</span>)</span><br><span class="line">    .pipe(changed(<span class="string">'/tmp/blog/css/'</span>, {<span class="attr">extension</span>:<span class="string">'.css'</span>, <span class="attr">hasChanged</span>: changed.compareContents}))</span><br><span class="line">    .pipe(minifycss())</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'/tmp/blog/css/'</span>))</span><br><span class="line">    .pipe(debug({<span class="attr">title</span>: <span class="string">'压缩css源文件:'</span>}));</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拷贝经压缩的css源文件(只拷贝修改过的压缩源文件)</span></span><br><span class="line">gulp.task(<span class="string">'copy-minify-css'</span>, [<span class="string">'generate-minify-css'</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'/tmp/blog/css/**/*.css'</span>)</span><br><span class="line">    .pipe(changed(<span class="string">'./public/css/'</span>, {<span class="attr">extension</span>:<span class="string">'.css'</span>, <span class="attr">hasChanged</span>: changed.compareContents}))</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'./public/css/'</span>))</span><br><span class="line">    .pipe(debug({<span class="attr">title</span>: <span class="string">'拷贝经压缩的css源文件:'</span>}));</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩js源文件(只压缩修改过的源文件),支持将ES6代码转换成ES5代码</span></span><br><span class="line">gulp.task(<span class="string">'generate-minify-js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./public/lib/**/*.js'</span>)</span><br><span class="line">    .pipe(changed(<span class="string">'/tmp/blog/lib/'</span>, {<span class="attr">extension</span>:<span class="string">'.js'</span>, <span class="attr">hasChanged</span>: changed.compareContents}))</span><br><span class="line">    .pipe(babel({<span class="attr">presets</span>: [<span class="string">'es2015'</span>]}))</span><br><span class="line">    .pipe(uglify())</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'/tmp/blog/lib/'</span>))</span><br><span class="line">    .pipe(debug({<span class="attr">title</span>: <span class="string">'压缩js源文件:'</span>}));</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拷贝经压缩的js源文件(只拷贝修改过的压缩源文件)</span></span><br><span class="line">gulp.task(<span class="string">'copy-minify-js'</span>, [<span class="string">'generate-minify-js'</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'/tmp/blog/lib/**/*.js'</span>)</span><br><span class="line">    .pipe(changed(<span class="string">'./public/lib/'</span>, {<span class="attr">extension</span>:<span class="string">'.js'</span>, <span class="attr">hasChanged</span>: changed.compareContents}))</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'./public/lib/'</span>))</span><br><span class="line">    .pipe(debug({<span class="attr">title</span>: <span class="string">'拷贝经压缩的js源文件:'</span>}));</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩html源文件(只压缩修改过的源文件)</span></span><br><span class="line">gulp.task(<span class="string">'generate-minify-html'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./public/**/*.html'</span>)</span><br><span class="line">    .pipe(changed(<span class="string">'/tmp/blog/'</span>, {<span class="attr">extension</span>:<span class="string">'.html'</span>, <span class="attr">hasChanged</span>: changed.compareContents}))</span><br><span class="line">    .pipe(htmlclean())</span><br><span class="line">    .pipe(htmlmin({</span><br><span class="line">      <span class="attr">removeComments</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">minifyJS</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">minifyCSS</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">minifyURLs</span>: <span class="literal">true</span>,</span><br><span class="line">    }))</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'/tmp/blog/'</span>))</span><br><span class="line">    .pipe(debug({<span class="attr">title</span>: <span class="string">'压缩html源文件:'</span>}));</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拷贝经压缩的html源文件(只拷贝修改过的压缩源文件)</span></span><br><span class="line">gulp.task(<span class="string">'copy-minify-html'</span>, [<span class="string">'generate-minify-html'</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'/tmp/blog/**/*.html'</span>)</span><br><span class="line">    .pipe(changed(<span class="string">'./public/'</span>, {<span class="attr">extension</span>:<span class="string">'.html'</span>, <span class="attr">hasChanged</span>: changed.compareContents}))</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'./public/'</span>))</span><br><span class="line">    .pipe(debug({<span class="attr">title</span>: <span class="string">'拷贝经压缩的html源文件:'</span>}));</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩图片（深度压缩）</span></span><br><span class="line">gulp.task(<span class="string">'minify-images'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  gulp.src(<span class="string">'./public/asset/**/*.{png,jpg,gif,ico}'</span>)</span><br><span class="line">    .pipe(cache(imagemin({                   <span class="comment">//启用缓存，只压缩发生变化的图片</span></span><br><span class="line">      <span class="attr">progressive</span>: <span class="literal">true</span>,                     <span class="comment">//是否无损压缩jpg图片</span></span><br><span class="line">      <span class="attr">interlaced</span>: <span class="literal">false</span>,                     <span class="comment">//是否隔行扫描gif进行渲染</span></span><br><span class="line">      <span class="attr">svgoPlugins</span>: [{<span class="attr">removeViewBox</span>: <span class="literal">false</span>}], <span class="comment">//是否移除svg的viewbox属性</span></span><br><span class="line">      <span class="attr">multipass</span>: <span class="literal">false</span>,                      <span class="comment">//是否多次优化svg直到完全优化</span></span><br><span class="line">      <span class="attr">optimizationLevel</span>: <span class="number">5</span>,                  <span class="comment">//优化等级，取值范围：0-7，默认值：3</span></span><br><span class="line">      <span class="attr">use</span>: [pngquant()]                      <span class="comment">//使用pngquant深度压缩png图片的imagemin插件</span></span><br><span class="line">    })))</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'./public/asset'</span>))</span><br><span class="line">    .pipe(debug({<span class="attr">title</span>: <span class="string">'压缩图片:'</span>}));</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// gulp3的写法</span></span><br><span class="line">gulp.task(<span class="string">'minify-js'</span>, [<span class="string">'generate-minify-js'</span>, <span class="string">'copy-minify-js'</span>]);</span><br><span class="line">gulp.task(<span class="string">'minify-css'</span>, [<span class="string">'generate-minify-css'</span>, <span class="string">'copy-minify-css'</span>]);</span><br><span class="line">gulp.task(<span class="string">'minify-html'</span>, [<span class="string">'generate-minify-html'</span>, <span class="string">'copy-minify-html'</span>]);</span><br></pre></td></tr></tbody></table></figure><h3 id="Gulp-直接调用-Hexo-Cli-命令"><a href="#Gulp-直接调用-Hexo-Cli-命令" class="headerlink" title="Gulp 直接调用 Hexo-Cli 命令"></a>Gulp 直接调用 Hexo-Cli 命令</h3><p>如果需要 Gulp 直接调用 Hexo 的命令（hexo-cli），即执行 Hexo 的 clean、generate、server、deploy 等操作，可以参考以下代码：</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Hexo = <span class="built_in">require</span>(<span class="string">'hexo'</span>);</span><br><span class="line"><span class="keyword">var</span> hexo = <span class="keyword">new</span> Hexo(process.cwd(), {});</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'hexo-clean'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> hexo.init().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> hexo.call(<span class="string">'clean'</span>, {</span><br><span class="line">      <span class="attr">watch</span>: <span class="literal">false</span></span><br><span class="line">    }).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">      <span class="keyword">return</span> hexo.exit();</span><br><span class="line">    }).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>{</span><br><span class="line">      <span class="keyword">return</span> hexo.exit(err);</span><br><span class="line">    });</span><br><span class="line">  });</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'hexo-generate'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> hexo.init().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> hexo.call(<span class="string">'generate'</span>, {</span><br><span class="line">      <span class="attr">watch</span>: <span class="literal">false</span></span><br><span class="line">    }).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">      <span class="keyword">return</span> hexo.exit();</span><br><span class="line">    }).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>{</span><br><span class="line">      <span class="keyword">return</span> hexo.exit(err);</span><br><span class="line">    });</span><br><span class="line">  });</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'hexo-server'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> hexo.init().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> hexo.call(<span class="string">'server'</span>, {});</span><br><span class="line">  }).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>{</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  });</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'hexo-deploy'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> hexo.init().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">    <span class="keyword">return</span> hexo.call(<span class="string">'deploy'</span>, {</span><br><span class="line">      <span class="attr">watch</span>: <span class="literal">false</span></span><br><span class="line">    }).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">      <span class="keyword">return</span> hexo.exit();</span><br><span class="line">    }).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>{</span><br><span class="line">      <span class="keyword">return</span> hexo.exit(err);</span><br><span class="line">    });</span><br><span class="line">  });</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><h3 id="显示-Gulp-的详细构建日志信息"><a href="#显示-Gulp-的详细构建日志信息" class="headerlink" title="显示 Gulp 的详细构建日志信息"></a>显示 Gulp 的详细构建日志信息</h3><p>为了方便调试 Gulp 的构建，可以安装 <code>gulp-debug</code> 模块，然后添加 JS 代码将构建日志信息打印出来，示例代码如下：</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> debug = <span class="built_in">require</span>(<span class="string">'gulp-debug'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'minify-js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./lib/*.js'</span>)</span><br><span class="line">    .pipe(babel({</span><br><span class="line">      <span class="attr">presets</span>: [<span class="string">'es2015'</span>]</span><br><span class="line">    }))</span><br><span class="line">    .pipe(uglify())</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'./build'</span>))</span><br><span class="line">    .pipe(debug({<span class="attr">title</span>: <span class="string">'压缩js文件:'</span>}));</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><h3 id="显示-Gulp-构建失败时的错误日志信息"><a href="#显示-Gulp-构建失败时的错误日志信息" class="headerlink" title="显示 Gulp 构建失败时的错误日志信息"></a>显示 Gulp 构建失败时的错误日志信息</h3><p>默认情况下，如果 Gulp 执行构建任务出错，不一定都能显示详细的错误日志信息。为了方便定位问题，可以安装 <code>gulp-util</code> 模块，然后添加 JS 代码将错误日志信息打印出来，示例代码如下：</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gutil = <span class="built_in">require</span>(<span class="string">'gulp-util'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'minify-js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>{</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./lib/*.js'</span>)</span><br><span class="line">    .pipe(babel({</span><br><span class="line">      <span class="attr">presets</span>: [<span class="string">'es2015'</span>]</span><br><span class="line">    }))</span><br><span class="line">    .pipe(uglify())</span><br><span class="line">    .on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>{</span><br><span class="line">        gutil.log(gutil.colors.red(<span class="string">'[Error]'</span>), err.toString());</span><br><span class="line">    })</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'./build'</span>));</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><h2 id="升级-Gulp-的版本"><a href="#升级-Gulp-的版本" class="headerlink" title="升级 Gulp 的版本"></a>升级 Gulp 的版本</h2><h3 id="Gulp-版本升级"><a href="#Gulp-版本升级" class="headerlink" title="Gulp 版本升级"></a>Gulp 版本升级</h3><p>将 Gulp 从版本 <code>3.9.1</code> 升级到 <code>4.0.2</code>，可以使用以下命令：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局安装版本检测、版本升级工具</span></span><br><span class="line"><span class="keyword">$ npm</span> install<span class="params"> -g</span> npm-check</span><br><span class="line"><span class="keyword">$ npm</span> install<span class="params"> -g</span> npm-upgrade</span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入博客的根目录</span></span><br><span class="line"><span class="keyword">$ cd</span> /blog-root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检测Hexo哪些模块可以升级</span></span><br><span class="line"><span class="keyword">$ npm</span>-check</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除package-lock.json</span></span><br><span class="line"><span class="keyword"># rm</span><span class="params"> -rf</span> package-lock.json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新package.json</span></span><br><span class="line"><span class="keyword">$ npm</span>-upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新Hexo的模块</span></span><br><span class="line"><span class="keyword">$ npm</span> update<span class="params"> --save</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 若出现依赖的问题，用以下命令检查一下，然后把报错的统一修复一下即可</span></span><br><span class="line"><span class="keyword">$ npm</span> audix</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者强制更新</span></span><br><span class="line"><span class="keyword">$ npm</span> update<span class="params"> --save</span><span class="params"> --force</span></span><br></pre></td></tr></tbody></table></figure><h3 id="Babel-版本升级"><a href="#Babel-版本升级" class="headerlink" title="Babel 版本升级"></a>Babel 版本升级</h3><p>将 Babel 从版本 <code>6</code> 升级到 <code>7</code>，官方版本升级说明看<a target="_blank" rel="external nofollow" href="https://github.com/babel/gulp-babel">这里</a>。</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 卸载 Babel 6</span></span><br><span class="line"><span class="keyword">$ npm</span> uninstall babel-core babel-loader babel-preset-env babel-preset-es2015<span class="params"> --save</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 Babel 7</span></span><br><span class="line"><span class="keyword">$ npm</span> install gulp-babel @babel/core @babel/preset-env babel-preset-es2015 babel-core@6<span class="params"> --save</span></span><br></pre></td></tr></tbody></table></figure><p>若 Gulp + Babel 执行文件压缩时，提示 <code>[BABEL] Note: The code generator has deoptimised the styling of "xxx/xxx.js" as it exceeds the max of "500KB"</code>，可以添加 <code>compact": false</code> 参数来忽略该提示，示例代码如下：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">'minify-js'</span>, <span class="function"><span class="title">function</span></span>() {</span><br><span class="line">  <span class="built_in">return</span> gulp.src(<span class="string">'./public/lib/**/*.js'</span>)</span><br><span class="line">    .pipe(babel({</span><br><span class="line">      <span class="string">"compact"</span>: <span class="literal">false</span>,</span><br><span class="line">      presets: [<span class="string">'es2015'</span>]</span><br><span class="line">    }))</span><br><span class="line">    .pipe(uglify())</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'./public/lib'</span>));</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure><h3 id="Gulp-版本升级后的代码兼容处理"><a href="#Gulp-版本升级后的代码兼容处理" class="headerlink" title="Gulp 版本升级后的代码兼容处理"></a>Gulp 版本升级后的代码兼容处理</h3><p>当 Gulp 从版本 3 升级到 4 之后，执行 Gulp 命令时若出现 <code>Gulp error: The following tasks did not complete: Did you forget to signal async completion?</code> 错误，则需要参考以下方式更改代码。Gulp 4 最大的变化就是不能像以前那样传递一个依赖任务列表，即不能再用 Gulp3 的方式指定依赖任务，需要配合使用 <code>gulp.series</code> 和 <code>gulp.parallel</code>，因为 Gulp 任务现在只有两个参数。在 Gulp4 中必须明确通知 Gulp 任务已经完成，而在 Gulp3 中，通常不必要这么做，因为如果没有发出异步完成信号，那么当任务返回时，Gulp3 会认为它已经完成。通知 Gulp 任务已完成的另一个常见方法是 Return 一个流或者 Promise，异步任务还可以利用回调函数来通知 Gulp 任务已完成，相关资料可参考<a target="_blank" rel="external nofollow" href="https://stackoverflow.com/questions/36897877/gulp-error-the-following-tasks-did-not-complete-did-you-forget-to-signal-async">这里</a>。下面是使用回调函数来通知 Gulp4 任务已完成的示例代码：</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">'generate-minify-css'</span>, gulp.series(<span class="function"><span class="keyword">function</span>(<span class="params">cb</span>)</span>{</span><br><span class="line">  <span class="comment">// 异步操作</span></span><br><span class="line">  gulp.src(<span class="string">'./public/css/**/*.css'</span>)</span><br><span class="line">    .pipe(changed(<span class="string">'/tmp/blog/css/'</span>, {<span class="attr">extension</span>:<span class="string">'.css'</span>, <span class="attr">hasChanged</span>: changed.compareContents}))</span><br><span class="line">    .pipe(minifycss())</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'/tmp/blog/css/'</span>))</span><br><span class="line">    .pipe(debug({<span class="attr">title</span>: <span class="string">'压缩css源文件:'</span>}));</span><br><span class="line">  cb();</span><br><span class="line">}));</span><br></pre></td></tr></tbody></table></figure><h3 id="Gulp-与-Babel-版本升级后的完整依赖项"><a href="#Gulp-与-Babel-版本升级后的完整依赖项" class="headerlink" title="Gulp 与 Babel 版本升级后的完整依赖项"></a>Gulp 与 Babel 版本升级后的完整依赖项</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">"@babel/core": "^7.14.8",</span><br><span class="line">"@babel/preset-env": "^7.14.9",</span><br><span class="line">"babel-core": "^6.26.3",</span><br><span class="line">"babel-preset-es2015": "^6.24.1",</span><br><span class="line">"gulp": "^4.0.2",</span><br><span class="line">"gulp-babel": "^7.0.1",</span><br><span class="line">"gulp-callback": "0.0.3",</span><br><span class="line">"gulp-changed": "^4.0.2",</span><br><span class="line">"gulp-clean": "^0.4.0",</span><br><span class="line">"gulp-debug": "^4.0.0",</span><br><span class="line">"gulp-htmlclean": "^2.7.22",</span><br><span class="line">"gulp-htmlmin": "^5.0.1",</span><br><span class="line">"gulp-imagemin": "^7.1.0",</span><br><span class="line">"gulp-minify-css": "^1.2.4",</span><br><span class="line">"gulp-uglify": "^3.0.2",</span><br><span class="line">"gulp-util": "^3.0.8",</span><br><span class="line">"imagemin-pngquant": "^9.0.2",</span><br></pre></td></tr></tbody></table></figure><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="压缩图片出错"><a href="#压缩图片出错" class="headerlink" title="压缩图片出错"></a>压缩图片出错</h3><p>执行 <code>gulp generate-minify-images</code> 任务（压缩图片）时，终端输出如下的错误信息：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[13:55:24] Finished 'generate-minify-images' after 1.2 s</span><br><span class="line">(node:3702) UnhandledPromiseRejectionWarning: Error: spawn /usr/local/hexo-blog/node_modules/mozjpeg/vendor/cjpeg ENOENT</span><br><span class="line">    at Process.ChildProcess._handle.onexit (internal/child_process.js:269:19)</span><br><span class="line">    at onErrorNT (internal/child_process.js:465:16)</span><br><span class="line">    at processTicksAndRejections (internal/process/task_queues.js:80:21)</span><br><span class="line">(Use `node --trace-warnings ...` to show where the warning was created)</span><br><span class="line">(node:3702) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). To terminate the node process on unhandled promise rejection, use the CLI flag `--unhandled-rejections=strict` (see https://nodejs.org/api/cli.html#cli_unhandled_rejections_mode). (rejection id: 2)</span><br><span class="line">(node:3702) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated. In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.</span><br></pre></td></tr></tbody></table></figure><p>可以执行以下命令来解决，这里强烈建议在本地连接上 VPN 后，再执行 <code>npm install</code> 命令，这样可以确保所有下载的文件就都是完整的</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件授权</span></span><br><span class="line"><span class="keyword">$ chmod</span> 755<span class="params"> -R</span> ~/.npm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入博客的根目录</span></span><br><span class="line"><span class="keyword">$ cd</span> /blog-root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除所有模块文件</span></span><br><span class="line"><span class="keyword">$ rm</span><span class="params"> -rf</span> node_modules</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重建</span></span><br><span class="line"><span class="keyword">$ npm</span> rebuid</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装模块</span></span><br><span class="line"><span class="keyword">$ npm</span> install</span><br></pre></td></tr></tbody></table></figure><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/17b9b7b0.html" title="Hexo 优化 - 利用 Gulp 压缩代码">https://www.techgrow.cn/posts/17b9b7b0.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/" rel="tag"><i class="fa fa-tag"></i> 静态博客</a><a href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag"><i class="fa fa-tag"></i> 前端</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/15ca8348.html" rel="prev" title="Lombok 使用教程"><i class="fa fa-angle-left"></i> Lombok 使用教程</a></div><div class="post-nav-item"> <a href="/posts/68618d42.html" rel="next" title="NPM 包发布 - Publish">NPM 包发布 - Publish<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">29:50</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/17b9b7b0.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>