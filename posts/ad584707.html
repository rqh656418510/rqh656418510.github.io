<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 Dubbo 的入门教程。"><meta property="og:type" content="article"><meta property="og:title" content="Dubbo 2 入门教程之二"><meta property="og:url" content="https://www.techgrow.cn/posts/ad584707.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 Dubbo 的入门教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/dubbo-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/dubbo-3.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/dubbo-4.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/dubbo-admin-mock.png"><meta property="article:published_time" content="2019-07-08T15:42:35.000Z"><meta property="article:modified_time" content="2019-07-08T15:42:35.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="微服务"><meta property="article:tag" content="分布式"><meta property="article:tag" content="RPC"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2025/01/dubbo-2.png"><link rel="canonical" href="https://www.techgrow.cn/posts/ad584707.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/ad584707.html","path":"posts/ad584707.html","title":"Dubbo 2 入门教程之二"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Dubbo 2 入门教程之二 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90"><span class="nav-text">学习资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="nav-text">Dubbo 核心特性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%B0%E5%9D%80%E7%BC%93%E5%AD%98"><span class="nav-text">地址缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4"><span class="nav-text">超时时间</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E6%80%A7%E8%AF%B4%E6%98%8E"><span class="nav-text">特性说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-text">使用方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">注解配置方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#XML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">XML 配置方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E8%AF%95%E6%AC%A1%E6%95%B0"><span class="nav-text">重试次数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-1"><span class="nav-text">注解配置方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#XML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-1"><span class="nav-text">XML 配置方式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="nav-text">负载均衡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-2"><span class="nav-text">注解配置方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#XML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-2"><span class="nav-text">XML 配置方式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E5%AE%B9%E9%94%99"><span class="nav-text">集群容错</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-3"><span class="nav-text">注解配置方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#XML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-3"><span class="nav-text">XML 配置方式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7%EF%BC%88Mock%EF%BC%89"><span class="nav-text">服务降级（Mock）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%89%B9%E6%80%A7%E8%AF%B4%E6%98%8E-1"><span class="nav-text">特性说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">使用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F-1"><span class="nav-text">使用方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="nav-text">使用案例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-4"><span class="nav-text">注解配置方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#XML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-4"><span class="nav-text">XML 配置方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Dubbo-Admin-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">Dubbo-Admin 配置方式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E5%80%BC%E9%85%8D%E7%BD%AE"><span class="nav-text">默认值配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#YML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">YML 配置方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#XML-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-5"><span class="nav-text">XML 配置方式</span></a></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">741</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/ad584707.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Dubbo 2 入门教程之二 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 Dubbo 的入门教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Dubbo 2 入门教程之二</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-07-08 23:42:35" itemprop="dateCreated datePublished" datetime="2019-07-08T23:42:35+08:00">2019-07-08</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/ad584707.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/ad584707.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>8.6k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>8 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/d484ffa3.html">Dubbo 2 入门教程之一</a>、<a href="/posts/ad584707.html">Dubbo 2 入门教程之二</a>、<a href="/posts/fab9c84c.html">Dubbo 2 入门教程之三</a>、<a href="/posts/b66ba452.html">Dubbo 2 入门教程之四</a></li><li><a href="/posts/ef04d10a.html">Dubbo 2 巩固教程之一</a>、<a href="/posts/b6d5fbb8.html">Dubbo 2 巩固教程之二</a>、<a href="/posts/ea9ce835.html">Dubbo 2 巩固教程之三</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h3><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/incubator-dubbo/">Dubbo 官方项目</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/">Dubbo 官方文档</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-samples">Dubbo 官方案例</a></li></ul><span id="more"></span><h2 id="Dubbo-核心特性"><a href="#Dubbo-核心特性" class="headerlink" title="Dubbo 核心特性"></a>Dubbo 核心特性</h2><div class="admonition note"><p class="admonition-title">代码下载</p><p>本节完整的案例代码可以直接从 <a target="_blank" rel="external nofollow" href="https://github.com/rqh656418510/spring-cloud-share/tree/main/rpc-framework/dubbo-study/dubbo2.x-study">GitHub</a> 下载对应章节 <code>dubbo-lesson-06</code>。</p></div><h3 id="地址缓存"><a href="#地址缓存" class="headerlink" title="地址缓存"></a>地址缓存</h3><p>当注册中心宕机后，Dubbo 服务消费者是否可以正常调用服务提供者的接口？</p><ul><li><p>直连模式（Direct Connection）：</p><ul><li>如果服务消费者配置了直连模式（即直接指定了服务提供者的地址，而不依赖注册中心），那么即使注册中心宕机，服务消费者仍然可以正常调用服务提供者的接口。</li></ul></li><li><p>注册中心模式（Registry Mode）：</p><ul><li>Dubbo 的服务消费者在启动时会从注册中心拉取服务提供者的地址列表，并将其缓存在本地，以后再调用服务时就不需要访问注册中心。当服务提供者的地址发生变化后，注册中心会通知服务消费者更新服务提供者的地址。</li><li>如果注册中心宕机，但服务消费者在注册中心宕机之前已经成功启动并获得了服务提供者的地址列表，那么服务消费者可以直接使用本地缓存的地址列表继续调用服务提供者的接口。</li><li>如果注册中心宕机，且服务消费者在注册中心宕机后才启动，由于无法从注册中心获取服务提供者的地址列表，因此服务消费者将无法正常调用服务提供者的接口。</li></ul></li></ul><p><img data-src="../../../asset/2025/01/dubbo-2.png"></p><div class="admonition note"><p class="admonition-title">Dubbo 的集群容错策略</p><ul><li>Dubbo 提供了<a href="/posts/ad584707.html#%E9%9B%86%E7%BE%A4%E5%AE%B9%E9%94%99">多种集群容错策略</a>，如果在消费者的配置中启用了这些机制，并且本地有多个服务提供者的地址，那么即使某些提供者不可用，服务调用可能仍然成功。</li></ul></div><h3 id="超时时间"><a href="#超时时间" class="headerlink" title="超时时间"></a>超时时间</h3><h4 id="特性说明"><a href="#特性说明" class="headerlink" title="特性说明"></a>特性说明</h4><p><img data-src="../../../asset/2025/01/dubbo-3.png"></p><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>Dubbo 的调用超时时间（默认是 <code>1000</code>，单位是毫秒），支持在服务消费者和服务提供者两边进行配置。</li><li><strong>如果服务消费者和服务提供者都配置了超时时间，那么服务消费者的配置优先级更高。</strong></li><li><strong>由于服务提供者最了解接口的业务逻辑，因此在企业开发中，建议在服务提供者中配置超时时间。</strong></li></ul></div><h4 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h4><h5 id="注解配置方式"><a href="#注解配置方式" class="headerlink" title="注解配置方式"></a>注解配置方式</h5><blockquote><p>接口级别配置超时时间</p></blockquote><ul><li>服务提供者配置超时时间（推荐）</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 暴露 Dubbo 服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DubboService(timeout = 1000)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(Long id)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(id, <span class="string">"Peter"</span>, <span class="number">18</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>服务消费者配置超时时间</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 引用 Dubbo 服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DubboReference(timeout = 1000)</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/getById/{id}")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(<span class="meta">@PathVariable("id")</span> Long id)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> userService.getById(id);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><blockquote><p>方法级别配置超时时间</p></blockquote><ul><li>服务提供者配置超时时间（推荐）</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 暴露 Dubbo 服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DubboService(methods = {@Method(name = "getById", timeout = 3000)})</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(Long id)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(id, <span class="string">"Peter"</span>, <span class="number">18</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>服务消费者配置超时时间</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 引用 Dubbo 服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DubboReference(methods = {@Method(name = "getById", timeout = 3000)})</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/getById/{id}")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(<span class="meta">@PathVariable("id")</span> Long id)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> userService.getById(id);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">版本说明</p><p>Dubbo 从　<code>2.7.7</code> 版本开始提供 <code>@DubboService</code> 和 <code>@DubboReference</code> 注解，目的是为了替代 Dubbo 旧版本的 <code>@Service</code> 和 <code>@Reference</code> 注解。</p></div><h5 id="XML-配置方式"><a href="#XML-配置方式" class="headerlink" title="XML 配置方式"></a>XML 配置方式</h5><blockquote><p>接口级别配置超时时间</p></blockquote><ul><li>服务提供者配置超时时间（推荐）</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 服务实现类 Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">class</span>=<span class="string">"com.clay.dubbo.provider.service.DemoServiceImpl"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 声明要暴露的服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.clay.dubbo.service.DemoService"</span> <span class="attr">ref</span>=<span class="string">"demoService"</span> <span class="attr">timeout</span>=<span class="string">"1000"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>服务消费者配置超时时间</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引用远程服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">interface</span>=<span class="string">"com.clay.dubbo.service.DemoService"</span> <span class="attr">timeout</span>=<span class="string">"1000"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>方法级别配置超时时间</p></blockquote><ul><li>服务提供者配置超时时间（推荐）</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 服务实现类 Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">class</span>=<span class="string">"com.clay.dubbo.provider.service.DemoServiceImpl"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 声明要暴露的服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.clay.dubbo.service.DemoService"</span> <span class="attr">ref</span>=<span class="string">"demoService"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 方法级别单独配置超时时间 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"getById"</span> <span class="attr">timeout</span>=<span class="string">"5000"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>服务消费者配置超时时间</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引用远程服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">interface</span>=<span class="string">"com.clay.dubbo.service.DemoService"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 方法级别单独配置超时时间 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:method</span> <span class="attr">name</span>=<span class="string">"getById"</span> <span class="attr">timeout</span>=<span class="string">"3000"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="重试次数"><a href="#重试次数" class="headerlink" title="重试次数"></a>重试次数</h3><p><img data-src="../../../asset/2025/01/dubbo-4.png"></p><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>Dubbo 的重试次数通常是配合超时时间（或者集群容错策略 FailoverCluster ）一起使用的，当接口调用超时（或者调用出错），就重试 N 次接口调用。</li><li>Dubbo 的重试次数（默认是重试 2 次，加上第一次接口调用，一共会调用 3 次 接口），支持在服务消费者和服务提供者两边进行配置。</li><li><strong>如果服务消费者和服务提供者都配置了重试次数，那么服务消费者的配置优先级更高。</strong></li><li><strong>由于服务提供者最了解接口的业务逻辑，因此在企业开发中，建议在服务提供者中配置重试次数。</strong></li><li><strong>特别注意，只有幂等接口（比如查询、更改、删除接口）才建议设置重试次数，非幂等接口（比如新增接口）不建议设置重试次数，否则会出现数据一致性问题，例如插入重复数据。</strong></li></ul></div><h4 id="注解配置方式-1"><a href="#注解配置方式-1" class="headerlink" title="注解配置方式"></a>注解配置方式</h4><ul><li>服务提供者配置重试次数（推荐）</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 暴露 Dubbo 服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DubboService(timeout = 1000, retries = 3)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(Long id)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(id, <span class="string">"Peter"</span>, <span class="number">18</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>服务消费者配置重试次数</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 引用 Dubbo 服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DubboReference(timeout = 1000, retries = 3)</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/getById/{id}")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(<span class="meta">@PathVariable("id")</span> Long id)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> userService.getById(id);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">版本说明</p><p>Dubbo 从　<code>2.7.7</code> 版本开始提供 <code>@DubboService</code> 和 <code>@DubboReference</code> 注解，目的是为了替代 Dubbo 旧版本的 <code>@Service</code> 和 <code>@Reference</code> 注解。</p></div><h4 id="XML-配置方式-1"><a href="#XML-配置方式-1" class="headerlink" title="XML 配置方式"></a>XML 配置方式</h4><ul><li>服务提供者配置重试次数（推荐）</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 服务实现类 Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">class</span>=<span class="string">"com.clay.dubbo.provider.service.DemoServiceImpl"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 声明要暴露的服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.clay.dubbo.service.DemoService"</span> <span class="attr">ref</span>=<span class="string">"demoService"</span> <span class="attr">timeout</span>=<span class="string">"1000"</span> <span class="attr">retries</span>=<span class="string">"3"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>服务消费者配置重试次数</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引用远程服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">interface</span>=<span class="string">"com.clay.dubbo.service.DemoService"</span> <span class="attr">timeout</span>=<span class="string">"1000"</span> <span class="attr">retries</span>=<span class="string">"3"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><p>Dubbo 提供了五种负载均衡策略，如下所示：</p><table><thead><tr><th>负载均衡策略</th><th>说明</th><th>适用场景</th></tr></thead><tbody><tr><td> RandomLoadBalance</td><td> 随机（默认策略），支持按权重设置随机概率</td><td>适用于请求量分散、服务性能相近的场景，能保证简单有效的负载均衡效果</td></tr><tr><td> RoundRobinLoadBalance</td><td> 轮询，支持按公约后的权重设置轮询比率</td><td>适用于服务节点性能相近、需要保证调用次数均匀的场景</td></tr><tr><td> LeastActiveLoadBalance</td><td> 最少活跃调用数，支持相同活跃数的权重随机</td><td>适用于服务性能差异较大或请求响应时间差异较大的场景，能提高请求分配效率</td></tr><tr><td> ConsistentHashLoadBalance</td><td> 一致性哈希，相同参数的请求总是发送到同一个服务提供者</td><td>适用于需要保证请求一致性的场景，例如：缓存服务或用户会话粘性</td></tr><tr><td> ShortestResponseLoadBalance</td><td> 最短响应时间优先，选择响应时间最短的服务提供者</td><td>适用于请求响应时间差异较大，且希望优先使用低延迟服务节点的场景</td></tr></tbody></table><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>Dubbo 的负载均衡策略支持在服务消费者和服务提供者两边进行配置，但是服务消费者的配置优先级更高，即：</li><li>(1) 如果服务消费者明确配置了负载均衡策略，则会使用服务消费者的策略。</li><li>(2) 如果服务消费者未配置负载均衡策略，则会使用服务提供者通过 <code>@DubboService</code> 注解指定的负载均衡策略。</li><li>(3) 如果服务消费者和服务提供者都未配置负载均衡策略，则会使用 Dubbo 的全局默认负载均衡策略（RandomLoadBalance）。</li></ul></div><div class="admonition note"><p class="admonition-title">提示</p><p>Dubbo 的负载均衡策略都统一实现了 <code>AbstractLoadBalance</code> 接口，比如常见的实现类有：<code>RandomLoadBalance</code>、<code>RoundRobinLoadBalance</code>、<code>LeastActiveLoadBalance</code> 等。</p></div><h4 id="注解配置方式-2"><a href="#注解配置方式-2" class="headerlink" title="注解配置方式"></a>注解配置方式</h4><ul><li>第一步：服务消费者设置负载均衡策略，可选策略包括：<code>random</code>、<code>roundrobin</code>、<code>leastactive</code>、<code>consistenthash</code>、<code>shortestresponse</code></li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 引用 Dubbo 服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DubboReference(loadbalance = "random")</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/getById/{id}")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(<span class="meta">@PathVariable("id")</span> Long id)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> userService.getById(id);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>第二步：若需要设置负载均衡策略的权重，则可以在服务提供者中设置 <code>weight</code> 属性</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 暴露 Dubbo 服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DubboService(weight = 100)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(Long id)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(id, <span class="string">"Peter"</span>, <span class="number">18</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="XML-配置方式-2"><a href="#XML-配置方式-2" class="headerlink" title="XML 配置方式"></a>XML 配置方式</h4><ul><li>第一步：服务消费者设置负载均衡策略，可选策略包括：<code>random</code>、<code>roundrobin</code>、<code>leastactive</code>、<code>consistenthash</code>、<code>shortestresponse</code></li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引用远程服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">interface</span>=<span class="string">"com.clay.dubbo.service.DemoService"</span> <span class="attr">loadbalance</span>=<span class="string">"random"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>第二步：若需要设置负载均衡策略的权重，则需要在服务提供者中设置 <code>weight</code> 属性</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 服务实现类 Bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">class</span>=<span class="string">"com.clay.dubbo.provider.service.DemoServiceImpl"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 声明要暴露的服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.clay.dubbo.service.DemoService"</span> <span class="attr">ref</span>=<span class="string">"demoService"</span> <span class="attr">weight</span>=<span class="string">"100"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="集群容错"><a href="#集群容错" class="headerlink" title="集群容错"></a>集群容错</h3><ul><li>Dubbo 提供了八种集群容错策略，如下所示：</li></ul><table><thead><tr><th>集群容错策略</th><th>策略名称</th><th>策略说明</th><th>适用场景</th></tr></thead><tbody><tr><td> Failover</td><td> 故障转移</td><td>默认策略，当出现服务调用失败，重试调用其它服务器，默认重试 2 次，使用 <code>retries</code> 属性配置重试次数</td><td>通常用于读操作（幂等操作），如查询数据时可以容忍偶尔失败并重试的场景</td></tr><tr><td> Failfast</td><td> 快速失败</td><td>消费者只发起一次调用，若失败则立即抛出异常，类似于 Failover 集群容错策略中重试次数设置为 0 的情况</td><td>通常用于写操作（非幂等操作），如数据插入操作，失败时不应该重试</td></tr><tr><td> Failsafe</td><td> 失败安全</td><td>当消费者调用提供者出现异常时，只会打印异常，而不会抛出异常，即直接忽略本次消费操作，返回一个空结果</td><td>适用于不重要的操作，如日志记录或监控信息上报，出现失败不影响整体业务逻辑</td></tr><tr><td> Failback</td><td> 失败自动恢复</td><td>在消费者调用失败后，返回一个空结果。Dubbo 会在内存中记录下（非持久化）该失败请求，并通过定时任务对失败的调用进行重试，且重试间隔默认是 5 秒（不可配置）</td><td>通常用于消息通知操作，如异步通知，失败后可自动补偿</td></tr><tr><td> Forking</td><td> 并行调用</td><td>消费者对于同一服务会并行调用多个提供者服务器，只要有一个成功就调用结束，并返回结果</td><td>通常用于实时性要求较高的读操作，但需要浪费更多的服务资源，可通过 <code>forks = "2"</code> 来设置最大并行数</td></tr><tr><td> Broadcast</td><td> 广播调用</td><td>通过广播调用所有提供者，逐个调用，任意一个提供者报错则报错</td><td>适用于更新配置或通知所有服务提供者的场景，如缓存更新或者服务健康检查</td></tr><tr><td> ZoneAware</td><td> 区域感知集群</td><td>当部署了多个机房或区域（Zone）时，优先调用同一机房的服务提供者，以降低跨区调用延迟和网络风险</td><td>适用于多区域部署场景，优先减少跨区域网络延迟的情况下实现高效负载均衡</td></tr><tr><td> Mergeable</td><td> 结果合并集群</td><td>调用多个服务提供者，并将多个服务提供者的调用结果进行合并，最终返回合并后的结果</td><td>适用于需要聚合结果的场景，例如分布式查询、汇总统计等操作</td></tr></tbody></table><div class="admonition warning"><p class="admonition-title">特别注意</p><p><strong>Dubbo 的集群容错策略是在服务消费者中配置的</strong>。虽然服务提供者使用的 <code>@DubboService</code> 注解也可以配置 <code>cluster</code> 属性，但该 <code>cluster</code> 属性是用来声明服务的分组行为，通常配合服务分组或路由规则一起使用。简而言之，服务提供者的 <code>@DubboService</code> 注解的 <code>cluster</code> 属性与消费者端的集群容错策略无关，它并不直接控制服务消费者的集群容错策略，而是影响服务的分发和消费方式。</p></div><div class="admonition note"><p class="admonition-title">提示</p><ul><li>Dubbo 的集群容错策略都统一实现了 <code>AbstractCluster</code> 接口，比如常见的实现类有：<code>FailoverCluster</code>、<code>FailfastCluster</code>、<code>FailsafeCluster</code>、<code>FailbackCluster</code> 等。</li></ul></div><ul><li><code>FailbackCluster</code>（失败自动恢复）的使用问题<ul><li>问题描述：<ul><li>调用失败的记录只存储在内存中，应用重启或进程崩溃后，重试记录将会丢失，导致重试机制失效。</li><li>这种重试机制不适用于核心业务，比如支付交易、订单创建、库存扣减、用户积分更新等。</li></ul></li><li>问题解决：<ul><li>第一种方案：<ul><li>Dubbo 调用改为消息驱动，使用 MQ 做调用的缓冲与重试。<ul><li>(1) 生产者不直接调用 Dubbo 服务，而是先将消息写入 MQ 中；</li><li>(2) 由一个消息消费服务订阅 MQ 消息，然后执行 Dubbo RPC 调用（基于 Dubbo 原生 API 实现泛化调用）；</li><li>(3) 如果 Dubbo RPC 调用失败，可以将消息写入到延迟队列中，直到 RPC 调用成功；</li><li>(4) 如果重试调用次数达到最大重试次数，则将消息写入死信队列。</li><li>(5) 为了避免重复调用，需要实现幂等性，比如使用数据库唯一约束（如 <code>requestId</code> 字段）、Redis 缓存（如 <code>SETNX</code>）等。</li></ul></li></ul></li><li>第二种解决方案：<ul><li>(1) 自定义扩展 <code>FailbackCluster</code> 的实现；</li><li>(2) 将失败记录写入外部存储（如 Redis、DB）；</li><li>(3) 创建后台线程，每隔固定时间扫描一次外部存储，尝试重新调用 Dubbo 服务（基于 Dubbo 原生 API 实现泛化调用）；</li><li>(4) 当重试调用成功返回时，将对应的失败记录从外部存储中删除，避免重复调用和数据堆积；</li><li>(5) 应用重启后重新加载未完成的失败记录，并继续由后台线程执行重试逻辑；</li><li>(6) 为了避免重复调用，需要实现幂等性，比如使用数据库唯一约束（如 <code>requestId</code> 字段）、Redis 缓存（如 <code>SETNX</code>）等。</li></ul></li></ul></li><li>方案对比：<table><thead><tr><th>对比维度</th><th> MQ（Kafka / RabbitMQ / RocketMQ）</th><th>Redis / MySQL</th></tr></thead><tbody><tr><td> 数据持久化</td><td>内置持久化到 Broker</td><td> 持久化到外部存储，需要自己实现</td></tr><tr><td>应用重启恢复</td><td>重启后仍可消费未完成消息</td><td>重启后可读取失败记录，依赖自定义逻辑</td></tr><tr><td>重试保障</td><td>原生支持延迟重试和死信队列</td><td>需定时任务扫描和手动实现延迟 / 死信机制</td></tr><tr><td>吞吐能力</td><td>高，支持大规模并发</td><td>中等，定时扫描会成为性能瓶颈</td></tr><tr><td>延迟控制</td><td>原生支持延迟队列</td><td>延迟不可控，依赖扫描频率</td></tr><tr><td>实现复杂度</td><td>中等，需要部署 MQ，但重试逻辑成熟</td><td>低 - 中，不依赖额外中间件，但需自己实现重试和死信机制</td></tr><tr><td>适用场景</td><td>核心业务，如订单、支付、交易</td><td>弱异步业务，如日志、通知、监控埋点等，可容忍一定延迟或失败</td></tr><tr><td>维护成本</td><td>低，MQ 自带可靠机制</td><td>高，定时任务、重试逻辑和死信处理需自行维护</td></tr></tbody></table></li></ul></li></ul><div class="admonition warning"><p class="admonition-title">Dubbo 的泛化调用是什么</p><p>普通的 Dubbo 调用依赖接口类，会进行编译期类型检查，适合直接业务调用。而泛化调用则不依赖接口类，只通过接口名称和方法信息在运行时进行调用，参数类型通过字符串描述，适合消息化、动态调用、异步或重试场景。</p></div><h4 id="注解配置方式-3"><a href="#注解配置方式-3" class="headerlink" title="注解配置方式"></a>注解配置方式</h4><ul><li>服务消费者设置集群容错策略，可选模式包括：<code>failover</code>、<code>failfast</code>、<code>failsafe</code>、<code>failback</code>、<code>forking</code>、<code>broadcast</code>、<code>available</code>、<code>mergeable</code></li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 引用 Dubbo 服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DubboReference(cluster = "failfast")</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/getById/{id}")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(<span class="meta">@PathVariable("id")</span> Long id)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> userService.getById(id);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="XML-配置方式-3"><a href="#XML-配置方式-3" class="headerlink" title="XML 配置方式"></a>XML 配置方式</h4><ul><li>服务消费者设置集群容错策略，可选模式包括：<code>failover</code>、<code>failfast</code>、<code>failsafe</code>、<code>failback</code>、<code>forking</code>、<code>broadcast</code>、<code>available</code>、<code>mergeable</code></li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引用远程服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">interface</span>=<span class="string">"com.clay.dubbo.service.DemoService"</span> <span class="attr">cluster</span>=<span class="string">"failfast"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><h3 id="服务降级（Mock）"><a href="#服务降级（Mock）" class="headerlink" title="服务降级（Mock）"></a>服务降级（Mock）</h3><div class="admonition note"><p class="admonition-title">Dubbo 官方文档</p><p>更多关于 Dubbo Mock 的使用介绍可以看 <a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/framework/more/local-mock/">Dubbo 官方文档 - 服务降级</a>。</p></div><h4 id="特性说明-1"><a href="#特性说明-1" class="headerlink" title="特性说明"></a>特性说明</h4><p>在 Dubbo 中有一种机制可以实现轻量级的服务降级（也叫 “本地伪装”）。Mock 是 Stub 的一个子集，便于服务提供者在客户端执行容错逻辑，因此经常需要在出现 <code>RpcException</code>（比如网络失败，超时等）时进行容错，而在出现业务异常（比如登录用户名 / 密码错误）时不需要容错。如果用 Stub，可能就需要捕获并依赖 <code>RpcException</code> 类，而用 Mock 就可以不依赖 <code>RpcException</code>，因为它的约定就是只有出现 <code>RpcException</code> 时才执行。</p><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li><strong>Dubbo Mock 是一种服务降级机制。它会在 RPC 远程调用失败后，根据配置自动触发，用于服务降级（返回兜底数据）或者进行本地模拟测试。</strong></li><li><strong>Mock 并不是在 "集群容错机制无法处理故障" 时才触发，而是 Dubbo 独立提供的服务降级机制，可与集群容错机制结合使用。</strong></li></ul></div><h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><p>本地伪装常被用于服务降级。比如某鉴权服务，当服务提供者全部挂掉后，假如此时服务消费者发起了一次远程调用，那么本次调用将会失败并抛出一个 <code>RpcException</code> 异常。为了避免出现这种直接抛出异常的情况出现，那么客户端就可以利用本地伪装来提供 Mock 数据返回授权失败。其他使用场景包括：</p><ul><li>某服务或接口负荷超出最大承载能力范围，需要进行降级应急处理，避免系统崩溃。</li><li>调用的某非关键服务或接口暂时不可用时，返回模拟数据或空，业务还能继续可用。</li><li>降级非核心业务的服务或接口，腾出系统资源，尽量保证核心业务的正常运行。</li><li>某上游基础服务超时或不可用时，执行能快速响应的降级预案，避免服务整体雪崩。</li></ul><h4 id="使用方式-1"><a href="#使用方式-1" class="headerlink" title="使用方式"></a>使用方式</h4><p>Dubbo 支持以下几种方式来使用 Mock：</p><ul><li><p>(1) 用 <code>return</code> 来返回一个字符串表示的对象，作为 Mock 的返回值</p><ul><li>比如：<code>&lt;dubbo:reference interface="com.foo.BarService" mock="return null" /&gt;</code>，表示 RPC 调用失败时直接返回 <code>null</code> 给服务消费者</li><li>合法的字符串可以是：<ul><li><code>empty</code>：代表空，返回基本类型的默认值、集合类的空值、自定义实体类的空对象，如果返回值是一个实体类，那么此时返回的将会是一个属性都为默认值的空对象而不是 <code>null</code></li><li><code>null</code>：返回 <code>null</code></li><li><code>true</code>：返回 <code>true</code></li><li><code>false</code>：返回 <code>false</code></li><li>JSON 字符串：返回反序列化 JSON 串后所得到的对象</li></ul></li></ul></li><li><p> (2) 使用 <code>throw</code> 来返回一个 Exception 对象，作为 Mock 的返回值</p><ul><li>当调用出错时，抛出一个默认的 <code>RPCException</code>，比如：<code>&lt;dubbo:reference interface="com.foo.BarService" mock="throw"/&gt;</code></li><li>当调用出错时，抛出指定的 Exception，比如：<code>&lt;dubbo:reference interface="com.foo.BarService" mock="throw com.foo.MockException"/&gt;</code>。特别注意，自定义异常必须拥有一个入参为 <code>String</code> 的构造函数，该构造函数将用于接受异常信息。</li></ul></li><li><p>(3) 使用 <code>force</code> 和 <code>fail</code> 关键字来配置 Mock 的行为</p><ul><li><code>force</code>:<ul><li>代表强制使用 Mock 行为，在这种情况下不会走 RPC 远程调用。</li><li><code>force</code> 和 <code>fail</code> 一样都支持与 <code>throw</code> 或者 <code>return</code> 组合使用。</li><li>比如：<code>mock = "force:return null"</code> 表示服务消费者对该服务的方法调用都直接返回 <code>null</code> 值，不发起远程调用。用于避免在不重要服务不可用时，对服务消费者产生负面。</li></ul></li><li><code>fail</code>:<ul><li> 正常情况下与默认行为一致，只有当 RPC 远程调用发生错误时才会使用 Mock 行为。</li><li>也就是说，配置的时候其实是可以不使用 <code>fail</code> 关键字的，直接使用 <code>throw</code> 或者 <code>return</code> 就可以了。</li><li>比如：<code>mock = "fail:return null"</code> 表示服务消费者对该服务的方法调用出现失败时返回 <code>null</code> 值，不抛出异常。用于容忍不重要服务不稳定时，对服务消费者产生负面影响。最终效果类似使用 FailsafeCluster 集群容错策略。</li></ul></li><li>使用举例：<ul><li>强制返回指定值：<code>&lt;dubbo:reference interface="com.foo.BarService" mock="force:return fake"/&gt;</code></li><li>强制抛出指定异常：<code>&lt;dubbo:reference interface="com.foo.BarService" mock="force:throw com.foo.MockException"/&gt;</code></li><li>调用失败时返回指定值：<code>&lt;dubbo:reference interface="com.foo.BarService" mock="fail:return fake"/&gt;</code>，等价于 <code>mock="return fake"</code></li><li>调用失败时抛出指定异常：<code>&lt;dubbo:reference interface="com.foo.BarService" mock="fail:throw com.foo.MockException"/&gt;</code>，等价于 <code>mock="throw com.foo.MockException"</code></li></ul></li></ul></li><li><p>(4) 在方法级别配置 Mock</p><ul><li>Mock 支持在方法级别上指定，假设 <code>com.foo.BarService</code> 上有好几个方法，可以单独为 <code>sayHello()</code> 方法指定 Mock 行为。</li><li>配置示例如下所示，只要 <code>sayHello()</code> 方法被调用到时，强制返回 “fake”，不走 RPC 远程调用:<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">check</span>=<span class="string">"false"</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:parameter</span> <span class="attr">key</span>=<span class="string">"sayHello.mock"</span> <span class="attr">value</span>=<span class="string">"force:return fake"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li></ul></li><li><p>(5) 自定义 Mock 的行为</p><ul><li>在 Java 接口所在的包下创建一个 Mock 实现类，比如实现 <code>BarService</code> 接口和实现 <code>sayHello()</code> 方法，并且拥有一个无参构造函数，Java 代码和 XML 配置如下所示。</li><li>特别注意，如果没有在 XML 配置文件或者注解中显式指定 Mock 实现类，那么就需要保证 Mock 实现类的全限定类名符合 <code>原接口的全限定名 + Mock</code> 的格式，例如 <code>com.foo.BarServiceMock</code>，否则将会 Mock 失败。</li><li><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BarServiceMock</span> <span class="keyword">implements</span> <span class="title">BarService</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span> </span>{</span><br><span class="line">        <span class="comment">// 自定义服务降级的逻辑，比如可以返回兜底数据，此方法只在出现 RpcException 时才会被执行</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"容错数据"</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 指定 Mock 实现类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">mock</span>=<span class="string">"com.foo.BarServiceMock"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 或者，默认会自动去找 Mock 实现类 com.foo.BarServiceMock --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">interface</span>=<span class="string">"com.foo.BarService"</span> <span class="attr">mock</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure></li></ul></li><li><p>(6) 配合 Dubbo-Admin 使用 Mock，实现 Mock 规则的动态更改，详细的使用介绍请看 <a href="/posts/ad584707.html#Dubbo-Admin-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F">这里</a></p></li></ul><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li><strong>在 Dubbo 中，服务降级是通过 <code>mock</code> 属性来实现，该属性通常是配置在服务消费者中的，不应该配置在服务提供者中。</strong></li><li>服务降级逻辑应该完全由服务消费者端负责的，因为服务消费者需要决定在服务不可用时如何继续处理。</li></ul></div><h4 id="使用案例"><a href="#使用案例" class="headerlink" title="使用案例"></a>使用案例</h4><h5 id="注解配置方式-4"><a href="#注解配置方式-4" class="headerlink" title="注解配置方式"></a>注解配置方式</h5><ul><li>服务消费者配置服务降级</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/user")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 引用 Dubbo 服务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DubboReference(mock = "fail:return null")</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/getById/{id}")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(<span class="meta">@PathVariable("id")</span> Long id)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> userService.getById(id);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h5 id="XML-配置方式-4"><a href="#XML-配置方式-4" class="headerlink" title="XML 配置方式"></a>XML 配置方式</h5><ul><li>服务消费者配置服务降级</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引用远程服务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">interface</span>=<span class="string">"com.clay.dubbo.service.DemoService"</span> <span class="attr">mock</span> = <span class="string">"fail:return null"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><h5 id="Dubbo-Admin-配置方式"><a href="#Dubbo-Admin-配置方式" class="headerlink" title="Dubbo-Admin 配置方式"></a>Dubbo-Admin 配置方式</h5><ul><li><p>概念介绍</p><ul><li>Dubbo-Admin 支持以服务方法的维度设置 Mock 规则，包括设置返回模拟数据、动态启用 / 禁用规则等。</li><li>Dubbo 的服务降级（Mock）支持与 Dubbo-Admin 配合使用，这样就可以通过 Dubbo-Admin 的 UI 界面动态配置 Mock 规则，即达到动态实现服务降级的目的。</li></ul></li><li><p>使用方式</p><ul><li><strong>要求 Dubbo 的版本必须大于等于 <code>3.0.0</code>，否则无法配合 Dubbo-Admin 使用 Mock</strong></li><li> 服务消费者引入 Maven 依赖 <a target="_blank" rel="external nofollow" href="https://mvnrepository.com/artifact/org.apache.dubbo.extensions/dubbo-mock-admin">dubbo-mock-admin</a>，官方文档说明请看<a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-spi-extensions/tree/master/dubbo-mock-extensions">这里</a> 的介绍</li><li>服务消费者启动时必须设置 JVM 参数 <code>-Denable.dubbo.admin.mock=true</code>，目的是启用 Dubbo-Admin Mock 功能</li><li>启动 Dubbo-Admin，在 Web 控制台界面中的 <code>服务 Mock</code> -&gt; <code>规则列表</code> 菜单下添加自定义的 Mock 规则（如下图所示）</li></ul></li><li><p>注意事项</p><ul><li><strong>在 Dubbo 中，服务降级是通过 <code>mock</code> 属性来实现，该属性通常是配置在服务消费者中的，不应该配置在服务提供者中</strong></li><li>在 Dubbo Admin 的 <code>服务 Mock</code> 管理界面里，填写的 <code>规则内容</code> 其实就是 Mock 执行逻辑的正文部分，Dubbo Admin 本身已经在内部为该规则内容指定了 <code>force:return</code> 的处理方式</li><li>如果 <code>规则内容</code> 中包含 <code>force:</code> 前缀，会被当作普通字符串处理，而不会被当作 Mock 指令；因此填写 <code>规则内容</code> 时不需要使用 <code>force:</code> 或者 <code>fail:</code> 前缀，直接填写要返回的数据即可</li></ul></li><li><p>案例代码</p><ul><li>Dubbo-Admin + Mock 配合使用的完整案例代码可以直接从 <a target="_blank" rel="external nofollow" href="https://github.com/rqh656418510/spring-cloud-share/tree/main/rpc-framework/dubbo-study/dubbo2.x-study">GitHub</a> 下载对应章节 <code>dubbo-lesson-10</code> 与 <code>dubbo-lesson-11</code></li></ul></li></ul><p><img data-src="../../../asset/2025/09/dubbo-admin-mock.png"></p><h3 id="默认值配置"><a href="#默认值配置" class="headerlink" title="默认值配置"></a>默认值配置</h3><h4 id="YML-配置方式"><a href="#YML-配置方式" class="headerlink" title="YML 配置方式"></a>YML 配置方式</h4><ul><li>指定全局默认超时时间，对所有服务生效</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="comment"># 统一设置服务提供者的超时时间（单位：毫秒）</span></span><br><span class="line">  <span class="attr">provider:</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">1000</span></span><br><span class="line">  <span class="comment"># 统一设置服务消费者的超时时间（单位：毫秒）</span></span><br><span class="line">  <span class="attr">consumer:</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">1000</span></span><br></pre></td></tr></tbody></table></figure><h4 id="XML-配置方式-5"><a href="#XML-配置方式-5" class="headerlink" title="XML 配置方式"></a>XML 配置方式</h4><ul><li>指定全局默认超时时间，对所有服务生效</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 统一设置服务提供者的超时时间（单位：毫秒） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">timeout</span>=<span class="string">"1000"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 统一设置服务消费者的超时时间（单位：毫秒） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:consumer</span> <span class="attr">timeout</span>=<span class="string">"1000"</span>/&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>基于分组的默认值，对部分服务生效</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 分组设置服务提供者的超时时间（单位：毫秒） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">timeout</span>=<span class="string">"1000"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.clay.api.HelloService"</span> <span class="attr">ref</span>=<span class="string">"helloService"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.clay.api.HelloService2"</span> <span class="attr">ref</span>=<span class="string">"helloService2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:provider</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">timeout</span>=<span class="string">"3000"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.clay.api.DemoService"</span> <span class="attr">ref</span>=<span class="string">"demoService"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.clay.api.DemoService2"</span> <span class="attr">ref</span>=<span class="string">"demoService2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dubbo:provider</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/ad584707.html" title="Dubbo 2 入门教程之二">https://www.techgrow.cn/posts/ad584707.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag"><i class="fa fa-tag"></i> 微服务</a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a><a href="/tags/RPC/" rel="tag"><i class="fa fa-tag"></i> RPC</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/7d8f3d89.html" rel="prev" title="MyBatis-Plus 入门教程之三"><i class="fa fa-angle-left"></i> MyBatis-Plus 入门教程之三</a></div><div class="post-nav-item"> <a href="/posts/a6aa7529.html" rel="next" title="数据库读写分离解决方案介绍">数据库读写分离解决方案介绍<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2.1m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">31:08</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/ad584707.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>