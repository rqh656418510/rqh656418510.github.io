<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 Dubbo 3 如何配合 Protobuf（IDL）使用 Triple 协议，基于 SpringBoot 项目。"><meta property="og:type" content="article"><meta property="og:title" content="Dubbo 3 配合 Protobuf（IDL）使用 Triple 协议"><meta property="og:url" content="https://www.techgrow.cn/posts/435a9cbc.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 Dubbo 3 如何配合 Protobuf（IDL）使用 Triple 协议，基于 SpringBoot 项目。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2024-11-19T15:42:35.000Z"><meta property="article:modified_time" content="2025-05-25T15:42:35.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="微服务"><meta property="article:tag" content="分布式"><meta property="article:tag" content="RPC"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.techgrow.cn/posts/435a9cbc.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/435a9cbc.html","path":"posts/435a9cbc.html","title":"Dubbo 3 配合 Protobuf（IDL）使用 Triple 协议"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Dubbo 3 配合 Protobuf（IDL）使用 Triple 协议 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90"><span class="nav-text">学习资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB"><span class="nav-text">版本对应关系</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Triple-%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D"><span class="nav-text">Triple 协议介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Triple-%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text">Triple 协议的核心概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Triple-%E5%8D%8F%E8%AE%AE%E7%9A%84%E8%AF%9E%E7%94%9F%E8%83%8C%E6%99%AF"><span class="nav-text">Triple 协议的诞生背景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Triple-%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%A0%B8%E5%BF%83%E7%89%B9%E7%82%B9"><span class="nav-text">Triple 协议的核心特点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Triple-%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">Triple 协议的应用场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Triple-%E5%8D%8F%E8%AE%AE%E5%8F%91%E5%B8%83-REST-%E6%9C%8D%E5%8A%A1"><span class="nav-text">Triple 协议发布 REST 服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Triple-%E5%8D%8F%E8%AE%AE%E6%94%AF%E6%8C%81%E7%9A%84%E8%B0%83%E7%94%A8%E6%A8%A1%E5%9E%8B"><span class="nav-text">Triple 协议支持的调用模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Triple-%E4%B8%8E%E7%BB%8F%E5%85%B8-Dubbo-%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-text">Triple 与经典 Dubbo 协议的区别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Triple-%E5%8D%8F%E8%AE%AE%E5%8E%9F%E7%90%86"><span class="nav-text">Triple 协议原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Triple-%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%BA%E5%88%B6"><span class="nav-text">Triple 协议的序列化机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Triple-%E5%8D%8F%E8%AE%AE%E7%9A%84%E4%B8%A4%E7%A7%8D%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-text">Triple 协议的两种调用方式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo-%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="nav-text">Dubbo 使用案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E"><span class="nav-text">版本说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E8%AF%B4%E6%98%8E"><span class="nav-text">模块说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-text">案例代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#API-%E6%A8%A1%E5%9D%97"><span class="nav-text">API 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Proto-%E5%8D%8F%E8%AE%AE%E6%96%87%E4%BB%B6"><span class="nav-text">Proto 协议文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Maven-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">Maven 配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="nav-text">配置文件内容</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="nav-text">配置文件说明</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81"><span class="nav-text">编译生成代码</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B0%E7%9A%84%E6%8F%92%E4%BB%B6"><span class="nav-text">使用新的插件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Provider-%E6%A8%A1%E5%9D%97"><span class="nav-text">Provider 模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Consumer-%E6%A8%A1%E5%9D%97"><span class="nav-text">Consumer 模块</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81"><span class="nav-text">测试代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%A1%88%E4%BE%8B%E4%B8%80"><span class="nav-text">测试案例一</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%A1%88%E4%BE%8B%E4%BA%8C"><span class="nav-text">测试案例二</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E4%BB%A3%E7%A0%81"><span class="nav-text">下载代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%9D%E8%AF%95%E6%94%AF%E6%8C%81-HTTP-JSON-%E8%B0%83%E7%94%A8%E6%9C%8D%E5%8A%A1"><span class="nav-text">尝试支持 HTTP/JSON 调用服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%8F%92%E4%BB%B6%E7%94%9F%E6%88%90-gRPC-%E7%9A%84-Stub-%E4%BB%A3%E7%A0%81"><span class="nav-text">使用插件生成 gRPC 的 Stub 代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%95%99%E7%A8%8B"><span class="nav-text">参考教程</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">708</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/435a9cbc.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Dubbo 3 配合 Protobuf（IDL）使用 Triple 协议 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 Dubbo 3 如何配合 Protobuf（IDL）使用 Triple 协议，基于 SpringBoot 项目。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Dubbo 3 配合 Protobuf（IDL）使用 Triple 协议</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2024-11-19 23:42:35" itemprop="dateCreated datePublished" datetime="2024-11-19T23:42:35+08:00">2024-11-19</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-05-25 23:42:35" itemprop="dateModified" datetime="2025-05-25T23:42:35+08:00">2025-05-25</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/435a9cbc.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/435a9cbc.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>9.6k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>9 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/583e8ddb.html">Dubbo 2 配置使用 gRPC 协议</a></li><li><a href="/posts/53122199.html">Dubbo 3 配合 Java 接口使用 Triple 协议</a></li><li><a href="/posts/435a9cbc.html">Dubbo 3 配合 Protobuf（IDL）使用 Triple 协议</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文将整合 SpringBoot 与 Dubbo 3，并结合 IDL + Protobuf 使用 Triple 协议，使用的注册中心是 Nacos。<strong>值得一提的是，本文实现的 RPC 服务可以与谷歌官方原生的 gRPC 客户端（协议）互相调用，适合开发多编程语言业务。</strong></p><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>由于 gRPC 仅支持 Protobuf 模式（使用 <code>.proto</code> 文件定义服务），因此基于 IDL + Protobuf + Triple 协议实现的 RPC 服务可以与谷歌官方原生的 gRPC 客户端（协议）互相调用，适合开发多编程语言业务。</li><li>基于 IDL + Protobuf + Triple 协议实现的 RPC 服务，默认不可以通过标准的 HTTP 工具（比如 <code>curl</code>）直接调用；若需要通过标准的 HTTP 工具直接调用 RPC 服务，可以改为 <a href="/posts/53122199.html">配合 Java 接口使用 Triple 协议</a>。</li></ul></div><span id="more"></span><h3 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h3><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/incubator-dubbo/">Dubbo 官方项目</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/">Dubbo 官方文档</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-samples">Dubbo 官方案例</a></li></ul><h3 id="版本对应关系"><a href="#版本对应关系" class="headerlink" title="版本对应关系"></a>版本对应关系</h3><p>SpringBoot 与 Dubbo 的版本必须互相匹配，否则不同版本之间可能会存在兼容性问题，最终导致服务无法正常运行。两者的版本对应关系如下：</p><table><thead><tr><th>Dubbo 分支</th><th>最新版本</th><th> JDK</th><th>SpringBoot</th><th> 详细说明</th></tr></thead><tbody><tr><td> 3.3.x</td><td>3.3.0</td><td>8, 17, 21</td><td>2.x、3.x</td><td> 生产可用（推荐，长期维护）！ 最新 Triple 协议升级，内置 Metrics、Tracing、GraalVM 支持等</td></tr><tr><td> 3.2.x</td><td>3.2.10</td><td>8, 17</td><td>2.x、3.x</td><td> 生产可用（长期维护）！</td></tr><tr><td>3.1.x</td><td>3.1.11</td><td>8, 17</td><td>2.x、3.x</td><td> 仅修复安全漏洞！</td></tr><tr><td>3.0.x</td><td>3.0.15</td><td>8</td><td>2.x</td><td> 停止维护！</td></tr><tr><td>2.7.x</td><td>2.7.23</td><td>8</td><td>2.x</td><td> 停止维护！</td></tr><tr><td>2.6.x</td><td>2.6.20</td><td>6, 7</td><td>-</td><td> 停止维护！</td></tr><tr><td>2.5.x</td><td>2.5.10</td><td>6, 7</td><td>-</td><td> 停止维护！</td></tr></tbody></table><p>如果仍然使用版本低于 <code>2.7.0</code> 的旧版 Dubbo，请使用以下 Spring Boot 启动器：</p><table><thead><tr><th>Dubbo Spring Boot Starter</th><th>Dubbo</th><th>Spring Boot</th></tr></thead><tbody><tr><td>0.2.1.RELEASE</td><td>2.6.5+</td><td>2.x</td></tr><tr><td>0.1.2.RELEASE</td><td>2.6.5+</td><td>1.x</td></tr></tbody></table><div class="admonition note"><p class="admonition-title">官方文档</p><ul><li><a target="_blank" rel="external nofollow" href="https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/versions/">Dubbo 官方文档 - 版本说明</a></li><li><a target="_blank" rel="external nofollow" href="https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/reference-manual/upgrades-and-compatibility/">Dubbo 官方文档 - 版本升级和兼容性</a></li></ul></div><h2 id="Triple-协议介绍"><a href="#Triple-协议介绍" class="headerlink" title="Triple 协议介绍"></a>Triple 协议介绍</h2><div class="admonition note"><p class="admonition-title">提示</p><p>从 Dubbo <code>3.2</code> 开始，Dubbo 官方已经废弃原有的 gRPC 协议，使用 Triple 协议进行替代。Triple 协议完全兼容 gRPC 协议，更详细的协议介绍请看 <a href="/posts/8b34128.html">这里</a>。</p></div><h3 id="Triple-协议的核心概念"><a href="#Triple-协议的核心概念" class="headerlink" title="Triple 协议的核心概念"></a>Triple 协议的核心概念</h3><ul><li>Triple 协议是 Dubbo 3 引入的新一代 RPC 通信协议，旨在替代经典 Dubbo 协议（基于 TCP 长连接），支持更加现代化、开放的服务互通标准。</li><li>Triple 协议本质上是基于 gRPC/HTTP/2 规范的 RPC 协议，但是它做了兼容性扩展，支持 Dubbo 的接口声明风格，保留了 Dubbo 的生态优势。</li><li>Triple 协议是一个基于 HTTP 传输层协议的 RPC 协议，它完全兼容 gRPC，可运行在 HTTP/1、HTTP/2 之上，并同时结合了 HTTP/2、Protobuf 和 Dubbo 的能力。</li></ul><h3 id="Triple-协议的诞生背景"><a href="#Triple-协议的诞生背景" class="headerlink" title="Triple 协议的诞生背景"></a>Triple 协议的诞生背景</h3><p>为什么 Dubbo 3 推出 Triple 协议呢？主要原因有以下几个：</p><ul><li>经典 Dubbo 协议是私有的 TCP 协议，无法与多语言、云原生环境很好兼容。</li><li>微服务逐步走向云原生 + 多语言 + Service Mesh + 网关接入。</li><li>gRPC 成为业界事实标准，Dubbo 社区需要更开放的通信协议。</li></ul><h3 id="Triple-协议的核心特点"><a href="#Triple-协议的核心特点" class="headerlink" title="Triple 协议的核心特点"></a>Triple 协议的核心特点</h3><table><thead><tr><th>特点</th><th>说明</th></tr></thead><tbody><tr><td>基于 HTTP/2</td><td> 多路复用、长连接、低延迟</td></tr><tr><td>多语言互操作性</td><td>兼容 gRPC，支持跨语言调用</td></tr><tr><td> IDL 支持灵活</td><td>可选 Protobuf 或 Java 接口定义（兼容 Dubbo 2 的 API 方式）</td></tr><tr><td>支持流式调用</td><td>实现了 gRPC 的流式通信能力</td></tr><tr><td>安全性更好</td><td>支持 HTTP/2 的 TLS/SSL</td></tr><tr><td> 更好的网关兼容性</td><td>能直接被 Envoy、APISIX 等 API 网关代理</td></tr><tr><td>保留 Dubbo 的服务治理</td><td>如注册中心、路由、限流、熔断等</td></tr><tr><td>支持零侵入升级</td><td> Dubbo 2 可以平滑过渡到 Triple</td></tr></tbody></table><h3 id="Triple-协议的应用场景"><a href="#Triple-协议的应用场景" class="headerlink" title="Triple 协议的应用场景"></a>Triple 协议的应用场景</h3><ul><li>多语言 RPC 通信（Java ⇄ Go ⇄ Node）</li><li>云原生环境（与 Envoy Mesh 兼容）</li><li>高并发长连接应用（HTTP/2 多路复用）</li><li>数据流实时传输（流式调用）</li><li>Dubbo 2 平滑升级到 Dubbo 3</li></ul><h3 id="Triple-协议发布-REST-服务"><a href="#Triple-协议发布-REST-服务" class="headerlink" title="Triple 协议发布 REST 服务"></a>Triple 协议发布 REST 服务</h3><p>Dubbo 3 为 Triple 协议发布 REST 风格的服务提供了内置支持，具体使用方式取决于开发者使用的是基于 Protobuf 的服务定义模式，还是基于 Java 接口的服务定义模式：</p><ul><li>(1) <code>Java 接口的服务定义模式</code>：通过直接为 Java 接口增加注解，可以发布 REST 风格的服务，目前支持 Spring Web 注解与 JAX-RS 注解。</li><li>(2) <code>Protobuf 的服务定义模式</code>：通过配合 Protobuf 使用 Triple 协议，使用 IDL 定义服务，并使用 Protobuf 编码业务数据，最后可以选择使用 gRPC-Gateway 发布 REST 风格的服务。</li></ul><p>值得一提的是，Protobuf 与 gRPC-Gateway 的简单介绍如下：</p><ul><li>(1) <code>Protobuf（Protocol Buffers）</code>：Google 开发的一种轻量级、高效的数据序列化协议，常用于跨语言、跨平台的数据交换。它类似于 JSON 或 XML，但具有更高的性能和更小的数据体积，适用于网络通信、配置文件、数据存储等场景。</li><li>(2) <code>gRPC-Gateway</code>：一个基于 Go 语言的开源协议转换工具，它能够将 RESTful 请求（基于 HTTP/JSON）转换为 gRPC 调用（基于 HTTP/2 + Protobuf）。这样，客户端就可以使用普通的 HTTP 请求（如浏览器）来访问 gRPC 服务，而无需专门使用 gRPC 客户端。</li></ul><div class="admonition note"><p class="admonition-title">提示</p><p>若希望 Dubbo 3 使用 Triple 协议 + Java 接口（基于 Spring Web 注解）的服务定义模式来发布 REST 风格的服务，可以看 <a href="/posts/7d8de9f4.html">这里</a> 的教程。</p></div><h3 id="Triple-协议支持的调用模型"><a href="#Triple-协议支持的调用模型" class="headerlink" title="Triple 协议支持的调用模型"></a>Triple 协议支持的调用模型</h3><table><thead><tr><th>RPC 模式</th><th>说明</th></tr></thead><tbody><tr><td> Unary RPC</td><td> 单次请求 - 响应</td></tr><tr><td> Server Streaming</td><td> 服务端流式返回</td></tr><tr><td> Client Streaming</td><td> 客户端流式请求</td></tr><tr><td> Bi-directional Streaming</td><td> 双向流式</td></tr></tbody></table><h3 id="Triple-与经典-Dubbo-协议的区别"><a href="#Triple-与经典-Dubbo-协议的区别" class="headerlink" title="Triple 与经典 Dubbo 协议的区别"></a>Triple 与经典 Dubbo 协议的区别</h3><table><thead><tr><th>特性</th><th> Triple（Dubbo 3）</th><th>Dubbo 协议（Dubbo 2）</th></tr></thead><tbody><tr><td>传输协议</td><td> HTTP/2</td><td> 自定义 TCP 协议（单连接）</td></tr><tr><td>序列化协议</td><td> Protobuf / Hessian2 / JSON</td><td>Hessian2（默认）</td></tr><tr><td>多语言支持</td><td>是，天然支持 gRPC 互通</td><td>较差（主要 Java）</td></tr><tr><td>网关支持</td><td>支持 Envoy、APISIX、Kong</td><td> 不兼容</td></tr><tr><td>流式通信</td><td>支持（Streaming RPC）</td><td>不支持</td></tr><tr><td>扩展性</td><td>兼容 gRPC 插件生态</td><td>自定义扩展（Dubbo Filter）</td></tr><tr><td>可观测性</td><td>标准化 Trace、Metrics</td><td> 自行扩展</td></tr><tr><td>连接复用</td><td> HTTP/2 多路复用</td><td>单连接单请求</td></tr><tr><td>协议标准化程度</td><td>标准协议，开放生态</td><td>私有协议</td></tr></tbody></table><h2 id="Triple-协议原理"><a href="#Triple-协议原理" class="headerlink" title="Triple 协议原理"></a>Triple 协议原理</h2><h3 id="Triple-协议的序列化机制"><a href="#Triple-协议的序列化机制" class="headerlink" title="Triple 协议的序列化机制"></a>Triple 协议的序列化机制</h3><ul><li><p>Triple 协议的本质：</p><ul><li>传输层：HTTP/2</li><li> 编解码：<ul><li>默认支持 <code>application/grpc+proto</code>，完全兼容 gRPC 标准</li><li>兼容 HTTP/JSON 调用（但严格来说，gRPC 标准并没有支持 <code>application/grpc+json</code>，而是 Dubbo 自行扩展了 JSON 兼容功能）</li></ul></li></ul></li><li><p>Triple 接口类型与序列化逻辑：</p><ul><li>如果是 <code>.proto</code> 生成的接口<ul><li>完全走 Protobuf 序列化<ul><li>客户端和服务端都用 <code>.proto</code> 定义的结构进行 Protobuf 编解码</li><li>兼容标准 gRPC 协议</li></ul></li></ul></li><li>如果是 Java 接口（非 <code>.proto</code> 生成）<ul><li>HTTP/JSON 调用（如 <code>curl</code> + <code>application/json</code>）：<ul><li>完全走 Hessian2Json 或 Jackson 等 JSON 序列化</li><li>传输层是 HTTP/1.1</li><li> 不会经过 Protobuf 序列化</li></ul></li></ul></li></ul></li><li><p> Triple 协议为什么这样设计：</p><ul><li>Triple 协议本质上是 gRPC 兼容协议</li><li> gRPC 强制要求底层用 Protobuf 编解码</li><li> Dubbo 为兼容老用户，支持「Java 接口直发」</li><li>如果是 HTTP/JSON 调用，仍保持兼容 JSON（非 Protobuf 序列化）</li></ul></li><li><p>Triple 协议的序列化机制总结</p></li></ul><table><thead><tr><th>调用方式</th><th>序列化</th><th>服务定义模式</th></tr></thead><tbody><tr><td> gRPC 标准调用（HTTP/2 + <code>application/grpc+proto</code>）</td><td>直接走 Protobuf 序列化</td><td>基于 <code>.proto</code> 文件定义服务</td></tr><tr><td> HTTP/JSON 调用（HTTP/1 + <code>application/json</code>）</td><td>直接走 Hessian2Json 或 Jackson 序列化（不经过 Protobuf 序列化）</td><td>基于 Java 接口（纯 POJO 接口）定义服务</td></tr></tbody></table><h3 id="Triple-协议的两种调用方式"><a href="#Triple-协议的两种调用方式" class="headerlink" title="Triple 协议的两种调用方式"></a>Triple 协议的两种调用方式</h3><table><thead><tr><th>服务定义方式</th><th>是否支持 HTTP + JSON 调用</th><th>是否支持 gRPC 客户端（协议）调用</th><th>是否支持跨编程语言调用</th></tr></thead><tbody><tr><td>基于 <code>.proto</code> 文件的服务定义</td><td>❌ 不支持 HTTP + JSON 调用</td><td>✅ 支持 gRPC 客户端（协议）调用，由于必须用 Protobuf 二进制，通常用 gRPC 调用</td><td>✅ 支持跨编程语言调用</td></tr><tr><td>基于 Java 接口的服务定义（纯 POJO 接口）</td><td>✅ 支持 HTTP + JSON 调用，内部直接走 Hessian2Json 或 Jackson 序列化（不经过 Protobuf 序列化）</td><td>❌ 不支持 gRPC 客户端（协议）调用，由于 gRPC 仅支持 Protobuf 模式（使用 <code>.proto</code> 文件定义服务），因此 Java 接口 + Triple 协议的模式无法与谷歌官方原生的 gRPC 客户端（协议）互相调用</td><td>❌ 不支持跨编程语言调用</td></tr></tbody></table><h2 id="Dubbo-使用案例"><a href="#Dubbo-使用案例" class="headerlink" title="Dubbo 使用案例"></a>Dubbo 使用案例</h2><p>本节将整合 SpringBoot 与 Dubbo 3，并配合 IDL + Protobuf 使用 Triple 协议，使用的注册中心是 Nacos，完整的项目目录结构<a href="../../../asset/2025/07/dubbo-triple-protobuf-2.png">如图所示</a>。值得一提的是，本教程的内容也适用于 Spring Cloud 项目。</p><h3 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h3><table><thead><tr><th>组件</th><th>版本</th><th>说明</th></tr></thead><tbody><tr><td> SpringBoot</td><td><code>3.4.2</code></td><td></td></tr><tr><td>Dubbo Spring Boot Starter</td><td><code>3.3.2</code></td><td>依赖 Dubbo <code>3.3.2</code></td></tr><tr><td>Nacos Server</td><td><code>2.5.0</code></td><td>Nacos 服务器，作为服务注册中心</td></tr><tr><td> JDK</td><td><code>17</code></td><td>支持 JDK <code>17</code> 及以上版本</td></tr></tbody></table><h3 id="模块说明"><a href="#模块说明" class="headerlink" title="模块说明"></a>模块说明</h3><ul><li><code>api</code>：抽取出来的公共模块，存放 <code>.proto</code> 文件、公用的实体类和接口</li><li><code>provider</code>：服务提供者，实现 <code>api</code> 模块中的接口</li><li><code>customer</code>：服务消费者，调用服务提供者中的接口</li></ul><h3 id="案例代码"><a href="#案例代码" class="headerlink" title="案例代码"></a>案例代码</h3><h4 id="API-模块"><a href="#API-模块" class="headerlink" title="API 模块"></a>API 模块</h4><div class="admonition note"><p class="admonition-title">提示</p><ul><li>这里不需要在本地操作系统手动安装 Protobuf，因为只要使用 <code>protobuf-maven-plugin</code> 插件，并正确配置了 <code>protocArtifact</code>，Maven 就会自动下载 <code>protoc</code> 编译器，不再需要手动安装。</li><li>通常只有以下场景才需要在本地安装 Protobuf，比如手工使用 <code>protoc</code> 命令编译 <code>.proto</code> 文件、跨语言开发（如生成 C++、Python、Go 代码）、Maven 插件支持不足等。</li></ul></div><h5 id="Proto-协议文件"><a href="#Proto-协议文件" class="headerlink" title="Proto 协议文件"></a>Proto 协议文件</h5><p>这里使用 IDL 定义跨语言服务，而不是直接使用 Java 接口，其中 <code>.proto</code> 文件（比如 <code>UserService.proto</code>）的内容如下:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// 指定 proto 文件的语法版本</span><br><span class="line">syntax = "proto3";</span><br><span class="line"></span><br><span class="line">// 是否将每个 message / service / enum 生成到单独的 Java 文件中</span><br><span class="line">option java_multiple_files = true;</span><br><span class="line"></span><br><span class="line">// 指定生成的 Java 包名</span><br><span class="line">option java_package = "com.clay.dubbo.api";</span><br><span class="line"></span><br><span class="line">// 如果没有开启 java_multiple_files，所有代码会生成在 UserServiceProto.java 文件中</span><br><span class="line">option java_outer_classname = "UserServiceProto";</span><br><span class="line"></span><br><span class="line">// iOS Objective-C 的类名前缀（可选，只有 iOS 需要，防止类名冲突）</span><br><span class="line">option objc_class_prefix = "USERSRV";</span><br><span class="line"></span><br><span class="line">// Proto 的包名（逻辑命名空间，不影响 Java 包）</span><br><span class="line">package userservice;</span><br><span class="line"></span><br><span class="line">// 请求消息体</span><br><span class="line">message HelloRequest {</span><br><span class="line">  string name = 1;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 响应消息体</span><br><span class="line">message HelloReply {</span><br><span class="line">  string message = 1;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// 定义 RPC 服务接口</span><br><span class="line">service UserService {</span><br><span class="line">  // 定义一个 RPC 方法 SayHello</span><br><span class="line">  rpc SayHello (HelloRequest) returns (HelloReply) {}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">特别注意</p><p>为了共用 <code>protoc</code> 根据 <code>.proto</code> 文件自动生成的代码，这里将 <code>.proto</code> 文件存放在 <code>api</code> 模块中（比如存放在 <code>/src/main/proto/</code> 目录），然后其他业务模块可以直接依赖 <code>api</code> 模块，以此实现重用代码的目的。</p></div><h5 id="Maven-配置文件"><a href="#Maven-配置文件" class="headerlink" title="Maven 配置文件"></a>Maven 配置文件</h5><h6 id="配置文件内容"><a href="#配置文件内容" class="headerlink" title="配置文件内容"></a>配置文件内容</h6><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo.version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">dubbo.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">protoc.version</span>&gt;</span>3.25.3<span class="tag">&lt;/<span class="name">protoc.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Dubbo --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${dubbo.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Protobuf --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.protobuf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>protobuf-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 建议和 protoc 版本保持一致 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${protoc.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">extensions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 跨平台支持 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">extension</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>kr.motd.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>os-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.xolstice.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>protobuf-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 是否在代码生成前清空输出目录（可选） --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">clearOutputDirectory</span>&gt;</span>false<span class="tag">&lt;/<span class="name">clearOutputDirectory</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 自定义 .proto 文件所在的路径（可选）--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">protoSourceRoot</span>&gt;</span>${basedir}/src/main/proto<span class="tag">&lt;/<span class="name">protoSourceRoot</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 自定义 protoc 生成 Java 文件的存放目录（可选） --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>${basedir}/build/generated/source/proto/main/java<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- Maven 会自动下载对应平台的 protoc 可执行文件，用于根据 .proto 文件生成 Protobuf 的 Java 类（DTO、Message）代码 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">protocArtifact</span>&gt;</span>com.google.protobuf:protoc:${protoc.version}:exe:${os.detected.classifier}<span class="tag">&lt;/<span class="name">protocArtifact</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 用来给 protoc 添加自定义代码生成插件（比如 Dubbo Triple 的 Stub 代码生成器）--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">protocPlugins</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">protocPlugin</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-compiler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- dubbo-compiler 的版本必须与使用的 dubbo 版本一致 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${dubbo.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>org.apache.dubbo.gen.tri.Dubbo3TripleGenerator<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">protocPlugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">protocPlugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>build-helper-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>generate-sources<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>add-source<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">sources</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!-- 添加 protoc 生成 Java 文件的存放目录 --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">source</span>&gt;</span>${basedir}/build/generated/source/proto/main/java<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">sources</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h6 id="配置文件说明"><a href="#配置文件说明" class="headerlink" title="配置文件说明"></a>配置文件说明</h6><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">protoSourceRoot</span>&gt;</span>${basedir}/src/main/proto<span class="tag">&lt;/<span class="name">protoSourceRoot</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>自定义 <code>.proto</code> 文件所在的路径，默认可以不指定，因为 Protobuf 的 Maven 插件会自动扫描项目中的 <code>.proto</code> 文件。</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>${basedir}/build/generated/source/proto/main/java<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>自定义 protoc 生成 Java 文件的存放目录，默认可以不指定，因为默认会存放在当前模块的 <code>/target/generated-sources/protobuf/</code> 目录中。</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">protocArtifact</span>&gt;</span>com.google.protobuf:protoc:${protoc.version}:exe:${os.detected.classifier}<span class="tag">&lt;/<span class="name">protocArtifact</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>这是用来根据 <code>.proto</code> 文件生成 Protobuf 的 Java 类（DTO、Message）代码的可执行文件，其中 <code>exe</code> 只是 Maven 的打包类型（classifier），并不代表文件扩展名是 <code>.exe</code>，即不代表是 Windows 平台的可执行文件。</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">protocPlugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-compiler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- dubbo-compiler 的版本必须与使用的 dubbo 版本一致 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>${dubbo.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>org.apache.dubbo.gen.tri.Dubbo3TripleGenerator<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">protocPlugin</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>这是用来给 <code>protoc</code> 添加自定义代码生成插件（比如 Dubbo Triple 的 Stub 代码生成器）。也就是说，除了生成 Protobuf 的 Java 类（DTO、Message）、还会生成 Dubbo Triple 协议专用的服务接口（Stub）代码。</li></ul><h6 id="编译生成代码"><a href="#编译生成代码" class="headerlink" title="编译生成代码"></a>编译生成代码</h6><div class="admonition note"><p class="admonition-title">代码生成的位置</p><ul><li>根据 <code>.proto</code> 文件，通过 Protobuf 的 Maven 插件自动生成代码后，相关的代码源文件默认会存放在当前模块的 <code>/target/generated-sources/protobuf/</code> 目录中。</li><li>一般不需要指定 <code>protoc</code> 生成 Java 文件的输出路径，因为 IDEA 会自动将 <code>/target/generated-sources/protobuf/</code> 加入到编译路径（之后可以正常引用生成的代码），Maven 会自动编译这些自动生成的代码，但不会污染 <code>src/main/java</code>。</li><li>如果将 <code>protoc</code> 自动生成的代码指定输出到 <code>src/main/java</code> 目录中，那么生成代码会持久化保存，即使 <code>.proto</code> 文件删除了，旧代码还会残留；而且 <code>mvn clean</code> 不会自动删除 <code>src/main/java</code> 里自动生成的文件，容易积累垃圾代码。</li><li>如果需要指定 <code>protoc</code> 生成 Java 文件的输出路径，那么建议指定为 <code>${basedir}/build/generated/source/proto/main/java</code>，然后再配置 Maven 插件 <code>build-helper-maven-plugin</code> 来添加指定的源码目录路径。</li></ul></div><ul><li>执行以下 Maven 命令，可以根据 <code>.proto</code> 文件编译生成 Protobuf 的 Java 类（DTO、Message）、Dubbo Triple 协议专用的服务接口（Stub）代码</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean compile</span><br></pre></td></tr></tbody></table></figure><ul><li>或者执行以下 Maven 命令</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean protobuf:compile</span><br></pre></td></tr></tbody></table></figure><ul><li>比如，执行 <code>mvn clean compile</code> 命令后，根据 <code>.proto</code> 文件自动生成的代码源文件列表如下：</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">build</span><br><span class="line">└── generated</span><br><span class="line">    └── source</span><br><span class="line">        └── proto</span><br><span class="line">            └── main</span><br><span class="line">                └── java</span><br><span class="line">                    └── com</span><br><span class="line">                        └── clay</span><br><span class="line">                            └── dubbo</span><br><span class="line">                                └── api</span><br><span class="line">                                    ├── DubboUserServiceTriple.java</span><br><span class="line">                                    ├── HelloRequest.java</span><br><span class="line">                                    ├── HelloRequestOrBuilder.java</span><br><span class="line">                                    ├── HelloResponse.java</span><br><span class="line">                                    ├── HelloResponseOrBuilder.java</span><br><span class="line">                                    ├── UserService.java</span><br><span class="line">                                    └── UserServiceProto.java</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">提示</p><p>除了可以使用 Maven 命令根据 <code>.proto</code> 文件自动生成代码，还可以通过 IDEA 的可视化工具来生成代码（<a href="../../../asset/2025/07/dubbo-triple-protobuf-1.png">如图所示</a>），运行效果类似于执行 <code>mvn clean compile</code> 命令，前提是已配置好 Protobuf 的 Maven 插件。</p></div><h6 id="使用新的插件"><a href="#使用新的插件" class="headerlink" title="使用新的插件"></a>使用新的插件</h6><ul><li>Dubbo <code>3.3.0</code> 之前的版本可以使用上面的 Maven 插件 <code>protobuf-maven-plugin</code>（实测 Dubbo <code>3.3.0</code> 之后的版本也可以正常使用），但 Dubbo <code>3.3.0</code> 之后的版本提供了新的 <code>dubbo-maven-plugin</code> 插件，使用起来更方便，如下所示：</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo.version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">dubbo.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">protoc.version</span>&gt;</span>3.25.3<span class="tag">&lt;/<span class="name">protoc.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Dubbo --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${dubbo.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Protobuf --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.protobuf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>protobuf-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 建议和 protoc 版本保持一致 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${protoc.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">extensions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 跨平台支持 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">extension</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>kr.motd.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>os-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 要求 dubbo 必须是 3.3.0 及以上版本 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>${dubbo.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 自定义 protoc 编译器的版本 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">protocVersion</span>&gt;</span>${protoc.version}<span class="tag">&lt;/<span class="name">protocVersion</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 自定义 .proto 文件所在的路径（可选）--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">protoSourceDir</span>&gt;</span>${basedir}/src/main/proto<span class="tag">&lt;/<span class="name">protoSourceDir</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 自定义 protoc 生成 Java 文件的存放目录（可选） --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">outputDir</span>&gt;</span>${basedir}/build/generated/source/proto/main/java<span class="tag">&lt;/<span class="name">outputDir</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- Maven 会自动下载对应平台的 protoc 可执行文件，用于根据 .proto 文件生成 Protobuf 的 Java 类（DTO、Message）代码 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">protocArtifact</span>&gt;</span>com.google.protobuf:protoc:${protoc.version}:exe:${os.detected.classifier}<span class="tag">&lt;/<span class="name">protocArtifact</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 指定代码生成的类型 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dubboGenerateType</span>&gt;</span>tri<span class="tag">&lt;/<span class="name">dubboGenerateType</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>generate-sources<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>build-helper-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>generate-sources<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>add-source<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">sources</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!-- 添加 protoc 生成 Java 文件的存放目录 --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">source</span>&gt;</span>${basedir}/build/generated/source/proto/main/java<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">sources</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>其中 <code>configuration</code> 可配置参数如下表所示：</li></ul><table><thead><tr><th>参数</th><th>必填参数</th><th>默认值</th><th>说明</th><th>备注</th></tr></thead><tbody><tr><td><code>outputDir</code></td><td>否</td><td><code>${project.build.directory}/generated-sources/protobuf/java</code></td><td>生成的 Java 文件存放目录</td><td></td></tr><tr><td><code>protoSourceDir</code></td><td>否</td><td><code>${basedir}/src/main/proto</code></td><td><code>.proto</code> 文所在的目录</td><td></td></tr><tr><td><code>protocArtifact</code></td><td>否</td><td><code>com.google.protobuf:protoc:3.25.0:exe:操作系统名:操作系统架构</code></td><td>protoc 编译器组件</td><td></td></tr><tr><td><code>protocVersion</code></td><td>否</td><td><code>3.25.0</code></td><td>protoc 编译器的版本</td><td></td></tr><tr><td><code>dubboGenerateType</code></td><td>否</td><td><code>tri</code></td><td>代码生成类型</td><td>可填 <code>tri</code> 或者 <code>tri_reactor</code></td></tr></tbody></table><ul><li>执行以下 Maven 命令，可以根据 <code>.proto</code> 文件编译生成 Protobuf 的 Java 类（DTO、Message）、Dubbo Triple 协议专用的服务接口（Stub）代码</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean compile</span><br></pre></td></tr></tbody></table></figure><ul><li>比如，执行 <code>mvn clean compile</code> 命令后，根据 <code>.proto</code> 文件自动生成的代码源文件列表如下：</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">build</span><br><span class="line">└── generated</span><br><span class="line">    └── source</span><br><span class="line">        └── proto</span><br><span class="line">            └── main</span><br><span class="line">                └── java</span><br><span class="line">                    └── com</span><br><span class="line">                        └── clay</span><br><span class="line">                            └── dubbo</span><br><span class="line">                                └── api</span><br><span class="line">                                    ├── DubboUserServiceTriple.java</span><br><span class="line">                                    ├── HelloRequest.java</span><br><span class="line">                                    ├── HelloRequestOrBuilder.java</span><br><span class="line">                                    ├── HelloResponse.java</span><br><span class="line">                                    ├── HelloResponseOrBuilder.java</span><br><span class="line">                                    ├── UserService.java</span><br><span class="line">                                    └── UserServiceProto.java</span><br></pre></td></tr></tbody></table></figure><ul><li>除了可以使用 Maven 命令根据 <code>.proto</code> 文件自动生成代码，还可以通过 IDEA 的可视化工具来生成代码（<a href="../../../asset/2025/07/dubbo-protobuf-triple-3.png">如图所示</a>），前提是已配置好 Dubbo 的 Maven 插件。</li></ul><h4 id="Provider-模块"><a href="#Provider-模块" class="headerlink" title="Provider 模块"></a>Provider 模块</h4><ul><li>引入依赖</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo.version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">dubbo.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- SpringBoot --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>${spring-boot.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.clay.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-lesson-01-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${dubbo.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-registry-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${dubbo.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>接口实现类（继承了由 <code>protoc</code> 根据 <code>.proto</code> 文件自动生成的 <code>DubboUserServiceTriple.UserServiceImplBase</code> 类），<code>@DubboService</code> 注解主要用于暴露服务，使其能够被 Dubbo 框架识别并注册到服务注册中心</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.annotation.DubboService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@DubboService</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title">DubboUserServiceTriple</span>.<span class="title">UserServiceImplBase</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloResponse <span class="title">sayHello</span><span class="params">(HelloRequest request)</span> </span>{</span><br><span class="line">        log.info(<span class="string">"Hello, "</span> + request.getName());</span><br><span class="line">        <span class="keyword">return</span> HelloResponse.newBuilder().setMessage(<span class="string">"Hello, "</span> + request.getName() + <span class="string">"!"</span>).build();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>这里的 <code>UserServiceImpl</code> 继承了由 <code>.proto</code> 文件自动生成的 <code>DubboUserServiceTriple.UserServiceImplBase</code> 类，而不是实现由 <code>.proto</code> 文件自动生成的 <code>UserService</code> 接口。</li><li>如果 <code>UserServiceImpl</code> 直接实现由 <code>.proto</code> 文件自动生成的 <code>UserService</code> 接口，效果相当于使用普通 Java 接口来定义服务，其他 gRPC 客户端（协议）不能直接调用 RPC 服务，即无法实现跨语言调用。</li><li>如果 <code>UserServiceImpl</code> 直接实现由 <code>.proto</code> 文件自动生成的 <code>UserService</code> 接口，其运行效果相当于 <a href="/posts/435a9cbc.html">配合 Java 接口使用 Triple 协议</a>，可以通过标准的 HTTP 工具（比如 <code>curl</code> + <code>application/json</code>）调用 RPC 服务，命令如下所示：<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H "Content-Type: application/json" -d '{"name":"dubbo"}' http://127.0.0.1:50052/com.clay.dubbo.api.UserService/sayHello</span><br></pre></td></tr></tbody></table></figure></li></ul></div><ul><li>主启动类</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProviderApplication</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        SpringApplication.run(ProviderApplication.class);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>配置文件（<code>application.yml</code>）</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9090</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-provider-application</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="comment"># 服务信息</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">${spring.application.name}</span></span><br><span class="line">    <span class="attr">qos-enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">qos-port:</span> <span class="number">22222</span></span><br><span class="line">    <span class="attr">qos-accept-foreign-ip:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 注册中心地址</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">nacos://192.168.2.235:8848</span></span><br><span class="line">  <span class="comment"># 服务提供者的协议</span></span><br><span class="line">  <span class="attr">protocol:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">tri</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">50052</span></span><br><span class="line">    <span class="attr">preferred-protocol:</span> <span class="string">tri</span>  <span class="comment"># 优先使用 Triple 协议，以避免输出 WARN 信息</span></span><br><span class="line">  <span class="comment"># 扫描 Dubbo 相关的注解</span></span><br><span class="line">  <span class="attr">scan:</span></span><br><span class="line">    <span class="attr">base-packages:</span> <span class="string">com.clay.dubbo.provider</span></span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">提示</p><p>若不希望在 YML 配置文件中指定 <code>dubbo.scan.base-packages</code> 参数，那么可以在主启动类上标注 <code>@EnableDubbo(scanBasePackages = "xxx")</code> 注解或者 <code>@DubboComponentScan(basePackages = "xxx")</code> 注解来替代。</p></div><h4 id="Consumer-模块"><a href="#Consumer-模块" class="headerlink" title="Consumer 模块"></a>Consumer 模块</h4><ul><li>引入依赖</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo.version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">dubbo.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- SpringBoot --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>${spring-boot.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.clay.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-lesson-01-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${dubbo.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-registry-nacos<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${dubbo.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>业务测试类，<code>@DubboReference</code> 注解主要用于在服务消费者端引用远程服务提供者的服务</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.annotation.DubboReference;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping("/system")</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SystemController</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 引用 Dubbo 服务</span></span><br><span class="line"><span class="comment">     * &lt;p&gt; 可以指定版本、负载均衡算法、重试次数、超时毫秒等。</span></span><br><span class="line"><span class="comment">     * &lt;p&gt; 负载均衡默认为 random，还可以配置为：roundrobin 、leastactive 、consistenthash</span></span><br><span class="line"><span class="comment">     * &lt;p&gt; 超时毫秒数 timeout 可以统一在 application.yml 进行配置，也可以在具体服务上做个性化配置</span></span><br><span class="line"><span class="comment">     * &lt;p&gt; 重试次数 retries 可以统一在 application.yml 进行配置，也可以在具体服务上做个性化配置，但是对于新增（插入）等非幂等操作，建议不要重试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DubboReference</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping("/sayHello/{name}")</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">(<span class="meta">@PathVariable("name")</span> String name)</span> </span>{</span><br><span class="line">        <span class="comment">// RPC 请求的参数</span></span><br><span class="line">        HelloRequest request = HelloRequest.newBuilder().setName(name).build();</span><br><span class="line">        <span class="comment">// 发起 RPC 请求</span></span><br><span class="line">        HelloResponse response = userService.sayHello(request);</span><br><span class="line">        <span class="comment">// 获取 RPC 请求的结果</span></span><br><span class="line">        log.info(<span class="string">"result: {}"</span>, response.getMessage());</span><br><span class="line">        <span class="keyword">return</span> response.getMessage();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>主启动类</li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerApplication</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        SpringApplication.run(ConsumerApplication.class);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>配置文件（<code>application.yml</code>）</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9095</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-consumer-application</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="comment"># 服务信息</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">${spring.application.name}</span></span><br><span class="line">    <span class="attr">qos-enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">qos-port:</span> <span class="number">22222</span></span><br><span class="line">    <span class="attr">qos-accept-foreign-ip:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 注册中心地址</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">nacos://192.168.2.235:8848</span></span><br><span class="line">  <span class="comment"># 扫描 Dubbo 相关的注解</span></span><br><span class="line">  <span class="attr">scan:</span></span><br><span class="line">    <span class="attr">base-packages:</span> <span class="string">com.clay.dubbo.consumer</span></span><br><span class="line">  <span class="comment"># 消费行为配置</span></span><br><span class="line">  <span class="attr">consumer:</span></span><br><span class="line">    <span class="comment"># 关闭了启动检查，这样消费者启动时，不会到注册中心里面检查服务提供者是否存在</span></span><br><span class="line">    <span class="attr">check:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># 建议统一配置为不重试请求，对于查询等幂等操作来说可以在代码中单独配置重试次数</span></span><br><span class="line">    <span class="attr">retries:</span> <span class="number">0</span></span><br><span class="line">    <span class="comment"># 默认情况下限制请求必须在 1000 毫秒内完成，对于具体服务可以在代码中单独配置</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">1000</span></span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">提示</p><p>若不希望在 YML 配置文件中指定 <code>dubbo.scan.base-packages</code> 参数，那么可以在主启动类上标注 <code>@EnableDubbo(scanBasePackages = "xxx")</code> 注解或者 <code>@DubboComponentScan(basePackages = "xxx")</code> 注解来替代。</p></div><h3 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h3><h4 id="测试案例一"><a href="#测试案例一" class="headerlink" title="测试案例一"></a>测试案例一</h4><ul><li><p>(1) 启动 Nacos 服务器</p></li><li><p>(2) 在 IDEA 开发工具内，分别启动 Provider 和 Consumer 模块</p></li><li><p>(3) 使用 Postman 等工具访问 Consumer 模块的 <code>http://127.0.0.1:9095/system/sayHello/dubbo</code> 接口，若接口可以返回 <code>Hello dubbo</code> 结果，则说明 Dubbo Triple 协议与 Protobuf（IDL） 正常工作</p></li></ul><h4 id="测试案例二"><a href="#测试案例二" class="headerlink" title="测试案例二"></a>测试案例二</h4><div class="admonition note"><p class="admonition-title">提示</p><ul><li>基于 IDL + Protobuf + Triple 协议实现的 RPC 服务，可以通过 gRPC 客户端、Dubbo 的客户端 Stub、<code>grpcurl</code>（命令行 gRPC 测试工具）等直接调用。</li><li>下面将演示如何使用 <code>grpcurl</code>（命令行 gRPC 测试工具）直接调用 IDL + Protobuf + Triple 协议实现的 RPC 服务，<code>grpcurl</code> 工具可以从 <a target="_blank" rel="external nofollow" href="https://github.com/fullstorydev/grpcurl/releases">GitHub</a> 下载得到。</li></ul></div><ul><li><p>(1) 启动 Nacos 服务器</p></li><li><p>(2) 在 IDEA 开发工具内，单独启动 Provider 模块</p></li><li><p>(3) 切换到 <code>.proto</code> 文件所在的目录，执行以下 <code>grpcurl</code> 命令直接调用 Provider 模块提供的 RPC 服务，若可以正常返回 JSON 结果 <code>{"message":"Hello, Dubbo!"}</code>，则说明 Dubbo Triple 协议与 Protobuf（IDL）正常工作</p></li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grpcurl<span class="params"> -plaintext</span> \<span class="params"></span></span><br><span class="line"><span class="params">    -proto</span> ./UserService.proto \<span class="params"></span></span><br><span class="line"><span class="params">    -d</span> <span class="string">'{"name":"Dubbo"}'</span> \</span><br><span class="line">    127.0.0.1:50052 userservice.UserService/SayHello</span><br></pre></td></tr></tbody></table></figure><p><strong>特别注意：为了可以通过 gRPC 客户端（比如 grpcurl 工具）直接调用 RPC 服务，必须注意以下事项</strong></p><ul><li>Dubbo 使用的协议必须指定为 <code>tri</code></li><li>服务必须是由 <code>.proto</code> 文件生成的接口来定义，而不是纯 Java POJO 接口</li><li>参数格式是 JSON 对象，比如 <code>{"name":"Dubbo"}</code></li><li>指定 <code>.proto</code> 文件的路径：比如 <code>-proto ./UserService.proto</code></li><li>指定 gRPC 服务的地址和端口：<code>host:port</code>，端口必须是 Triple 协议占用的端口（比如 <code>50052</code>），而不是 Tomcat 占用的端口</li><li>指定要调用的 gRPC 方法，格式是：<code>&lt;proto包名&gt;.&lt;proto服务名&gt;/&lt;proto方法名&gt;</code>，大小写敏感，比如 <code>userservice.UserService/SayHello</code></li></ul><h3 id="下载代码"><a href="#下载代码" class="headerlink" title="下载代码"></a>下载代码</h3><ul><li>完整的案例代码可以直接从 <a target="_blank" rel="external nofollow" href="https://github.com/rqh656418510/spring-cloud-share/tree/main/rpc-framework/dubbo-study/dubbo3.x-study">GitHub</a> 下载对应章节 <code>dubbo-lesson-05</code>。</li></ul><h2 id="尝试支持-HTTP-JSON-调用服务"><a href="#尝试支持-HTTP-JSON-调用服务" class="headerlink" title="尝试支持 HTTP/JSON 调用服务"></a>尝试支持 HTTP/JSON 调用服务</h2><ul><li>Dubbo 3 基于 IDL + Protobuf + Triple 协议实现的 RPC 服务，默认只能通过 gRPC 客户端、Dubbo 的客户端 Stub 等直接调用。如果希望通过标准的 HTTP 工具调用（比如 <code>curl</code>），可以在前面的 API 模块中额外引入 <code>protobuf-java-util</code> 依赖来实现：</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.protobuf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>protobuf-java-util<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 建议和 protoc 版本保持一致 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>${protoc.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>之后可以尝试通过 <code>curl</code> 命令直接调用 RPC 接口，如下所示：</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl \<span class="params"></span></span><br><span class="line"><span class="params">    --header</span> <span class="string">"Content-Type: application/json"</span> \<span class="params"></span></span><br><span class="line"><span class="params">    --data</span> <span class="string">'{"name":"Dubbo"}'</span> \</span><br><span class="line">    http://127.0.0.1:50052/com.clay.dubbo.api.UserService/SayHello</span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">实测无效</p><p>实测在前面的 API 模块中引入 <code>protobuf-java-util</code> 依赖，同时 <code>UserServiceImpl</code> 类继承了由 <code>.proto</code> 文件自动生成的 <code>DubboUserServiceTriple.UserServiceImplBase</code> 类，发现无法通过 <code>curl</code> + <code>application/json</code> 的方式来调用 RPC 服务，返回错误信息 <code>{"message":"Invoker not found"，"status":"404"}</code>。如果 <code>UserServiceImpl</code> 类实现了由 <code>.proto</code> 文件自动生成的 <code>UserService</code> 接口，相当于基于 <a href="/posts/53122199.html">Java 接口 + Triple 协议提供 RPC 服务</a>，虽然可以通过 <code>curl</code> + <code>application/json</code> 的方式来调用 RPC 服务，但无法通过 gRPC 客户端（协议）调用 RPC 服务，即失去了跨编程语言调用的功能。</p></div><h2 id="使用插件生成-gRPC-的-Stub-代码"><a href="#使用插件生成-gRPC-的-Stub-代码" class="headerlink" title="使用插件生成 gRPC 的 Stub 代码"></a>使用插件生成 gRPC 的 Stub 代码</h2><ul><li>使用 Maven 插件 <code>protobuf-maven-plugin</code> 时，若希望生成 gRPC 的服务接口（Stub）代码，可以参考以下 Maven 配置内容</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>17<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo.version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">dubbo.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">protoc.version</span>&gt;</span>3.25.3<span class="tag">&lt;/<span class="name">protoc.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">grpc.version</span>&gt;</span>1.73.0<span class="tag">&lt;/<span class="name">grpc.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Dubbo --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${dubbo.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Protobuf --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.protobuf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>protobuf-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 建议和 protoc 版本保持一致 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${protoc.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- gRPC Stub 相关 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.grpc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>grpc-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${grpc.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.grpc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>grpc-stub<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${grpc.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.grpc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>grpc-protobuf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${grpc.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 兼容 JDK 8 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.annotation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.annotation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">extensions</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 跨平台支持 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">extension</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>kr.motd.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>os-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.xolstice.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>protobuf-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 是否在代码生成前清空输出目录（可选） --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">clearOutputDirectory</span>&gt;</span>false<span class="tag">&lt;/<span class="name">clearOutputDirectory</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 自定义 .proto 文件所在的路径（可选）--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">protoSourceRoot</span>&gt;</span>${basedir}/src/main/proto<span class="tag">&lt;/<span class="name">protoSourceRoot</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- Maven 会自动下载对应平台的 protoc 可执行文件，用于根据 .proto 文件生成 Protobuf 的 Java 类（DTO、Message）代码 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">protocArtifact</span>&gt;</span>com.google.protobuf:protoc:${protoc.version}:exe:${os.detected.classifier}</span><br><span class="line">                <span class="tag">&lt;/<span class="name">protocArtifact</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- Maven 会自动下载对应平台的 protoc-gen-grpc-java 可执行文件，用于根据 .proto 文件生成 gRPC 的 Stub 代码 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pluginId</span>&gt;</span>grpc-java<span class="tag">&lt;/<span class="name">pluginId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pluginArtifact</span>&gt;</span>io.grpc:protoc-gen-grpc-java:${grpc.version}:exe:${os.detected.classifier}<span class="tag">&lt;/<span class="name">pluginArtifact</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 用来给 protoc 添加自定义代码生成插件（比如 Dubbo Triple 的 Stub 代码生成器）--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">protocPlugins</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">protocPlugin</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-compiler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- dubbo-compiler 的版本必须与使用的 dubbo 版本一致 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${dubbo.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>org.apache.dubbo.gen.tri.Dubbo3TripleGenerator<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">protocPlugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">protocPlugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>test-compile<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>compile-custom<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>test-compile-custom<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>对比前面案例的 Maven 配置文件，可以发现增加了以下依赖组件</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">grpc.version</span>&gt;</span>1.73.0<span class="tag">&lt;/<span class="name">grpc.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- gRPC Stub 相关 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.grpc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>grpc-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${grpc.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.grpc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>grpc-stub<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${grpc.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.grpc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>grpc-protobuf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${grpc.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 兼容 JDK 8 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.annotation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.annotation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>对比前面案例的 Maven 配置文件，可以发现还增加了以下 <code>configuration</code> 配置，并去除了 <code>outputDirectory</code> 配置，不再指定 <code>protoc</code> 生成 Java 文件的存放目录</li></ul><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Maven 会自动下载对应平台的 protoc-gen-grpc-java 可执行文件，用于根据 .proto 文件生成 gRPC 的 Stub 代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pluginId</span>&gt;</span>grpc-java<span class="tag">&lt;/<span class="name">pluginId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pluginArtifact</span>&gt;</span>io.grpc:protoc-gen-grpc-java:${grpc.version}:exe:${os.detected.classifier}<span class="tag">&lt;/<span class="name">pluginArtifact</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><ul><li>最终执行 <code>mvn clean compile</code> 命令后，根据 <code>.proto</code> 文件自动生成的代码源文件列表如下（默认存放在当前模块的 <code>/target/generated-sources/protobuf</code> 目录中）：</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">target/generated-sources</span><br><span class="line">├── annotations</span><br><span class="line">└── protobuf</span><br><span class="line">    ├── grpc-java</span><br><span class="line">    │&nbsp;&nbsp; └── com</span><br><span class="line">    │&nbsp;&nbsp;     └── clay</span><br><span class="line">    │&nbsp;&nbsp;         └── dubbo</span><br><span class="line">    │&nbsp;&nbsp;             └── api</span><br><span class="line">    │&nbsp;&nbsp;                 └── UserServiceGrpc.java</span><br><span class="line">    └── java</span><br><span class="line">        └── com</span><br><span class="line">            └── clay</span><br><span class="line">                └── dubbo</span><br><span class="line">                    └── api</span><br><span class="line">                        ├── DubboUserServiceTriple.java</span><br><span class="line">                        ├── HelloRequest.java</span><br><span class="line">                        ├── HelloRequestOrBuilder.java</span><br><span class="line">                        ├── HelloResponse.java</span><br><span class="line">                        ├── HelloResponseOrBuilder.java</span><br><span class="line">                        ├── UserService.java</span><br><span class="line">                        └── UserServiceProto.java</span><br></pre></td></tr></tbody></table></figure><ul><li>gRPC 的 Stub &amp; Skeleton 代码存放在新生成的 <code>UserServiceGrpc.java</code> 文件中，代码完全不依赖 Dubbo。这个文件是 gRPC 的 Java 桥接文件，它主要起到 gRPC 客户端调用代码（Stub）和服务端注册实现（Skeleton）的作用，其主要包含以下内容：</li></ul><table><thead><tr><th>内容</th><th>作用</th></tr></thead><tbody><tr><td>服务定义 (Service Descriptor)</td><td> 描述 gRPC 服务，供框架底层反射、注册用</td></tr><tr><td> Stub 类（异步 / 阻塞 / 未来模式）</td><td>客户端调用 RPC 接口用</td></tr><tr><td>抽象基类（<code>UserServiceImplBase</code>）</td><td>服务端继承，实现业务逻辑</td></tr></tbody></table><h2 id="参考教程"><a href="#参考教程" class="headerlink" title="参考教程"></a>参考教程</h2><ul><li><a href="/posts/6507d7ec.html">SpringBoot 整合 Dubbo 3 案例</a></li><li><a target="_blank" rel="external nofollow" href="https://liuyushuai.com/translation/q0wYkL506bOz">Java 实现 Protobuf 与 JSON 的无缝转换</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/quick-start/idl/">Dubbo 官方文档 - IDL 定义跨语言服务（旧版教程）</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/mannual/java-sdk/tasks/protocols/triple/idl/">Dubbo 官方文档 - 使用 Protobuf（IDL）开发 Triple 通信服务（新版教程）</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/tasks/triple/idl/">Dubbo 官方文档 - Triple 使用 IDL + Protobuf 跨语言定义服务（旧版教程）</a></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/435a9cbc.html" title="Dubbo 3 配合 Protobuf（IDL）使用 Triple 协议">https://www.techgrow.cn/posts/435a9cbc.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag"><i class="fa fa-tag"></i> 微服务</a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a><a href="/tags/RPC/" rel="tag"><i class="fa fa-tag"></i> RPC</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/70bdcb69.html" rel="prev" title="Linux 生产环境部署 Kafka-Eagle（EFAK）集群"><i class="fa fa-angle-left"></i> Linux 生产环境部署 Kafka-Eagle（EFAK）集群</a></div><div class="post-nav-item"> <a href="/posts/418bd270.html" rel="next" title="C++ 巩固基础之二">C++ 巩固基础之二<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">1.9m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">28:23</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/435a9cbc.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>