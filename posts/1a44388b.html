<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.12.2","exturl":false,"sidebar":{"position":"left","width":300,"display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍Puppeteer的入门使用教程。"><meta property="og:type" content="article"><meta property="og:title" content="Puppeteer 入门使用教程"><meta property="og:url" content="https://www.techgrow.cn/posts/1a44388b.html"><meta property="og:site_name" content="Clay 的技术博客"><meta property="og:description" content="本文主要介绍Puppeteer的入门使用教程。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2020-06-01T15:12:41.000Z"><meta property="article:modified_time" content="2020-06-01T15:12:41.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="前端"><meta property="article:tag" content="爬虫"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.techgrow.cn/posts/1a44388b.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/1a44388b.html","path":"posts/1a44388b.html","title":"Puppeteer 入门使用教程"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Puppeteer 入门使用教程 | Clay 的技术博客</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn:9360"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术博客" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax>!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><script data-ad-client="ca-pub-4014850419768221" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/app/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt></div><div class="headband"></div><main class="main"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术博客</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-openplatform"><a href="https://docs.techgrow.cn/v1/" rel="external nofollow" target="_blank"><i class="fa fa-toolbox fa-fw"></i>开放平台</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn:9360/ui/login?lng=zh-cn" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></div><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Puppeteer-%E4%BB%8B%E7%BB%8D"><span class="nav-text">Puppeteer 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Puppeteer-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-text">Puppeteer 是什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Puppeteer-%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="nav-text">Puppeteer 的功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Puppeteer-VS-Puppeteer-Core"><span class="nav-text">Puppeteer VS Puppeteer-Core</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8C%BA%E5%88%AB"><span class="nav-text">使用区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%BB%BA%E8%AE%AE"><span class="nav-text">使用建议</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Puppeteer-%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E4%B8%8E%E5%AE%89%E8%A3%85"><span class="nav-text">Puppeteer 运行环境与安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Puppeteer-%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83"><span class="nav-text">Puppeteer 运行环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Puppeteer-%E5%AE%89%E8%A3%85"><span class="nav-text">Puppeteer 安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Puppeteer-%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="nav-text">Puppeteer 入门案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="nav-text">入门案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E5%8F%82%E6%95%B0"><span class="nav-text">启动参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Puppeteer-%E5%AE%9E%E6%88%98"><span class="nav-text">Puppeteer 实战</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Puppeteer-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-text">Puppeteer 环境变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Puppeteer-%E7%9A%84%E9%80%89%E6%8B%A9%E5%99%A8"><span class="nav-text">Puppeteer 的选择器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SegmentFault-%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95"><span class="nav-text">SegmentFault 模拟登录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Puppeteer-%E7%BB%93%E5%90%88-Jest-%E4%BD%BF%E7%94%A8"><span class="nav-text">Puppeteer 结合 Jest 使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Puppeteer-%E5%91%A8%E8%BE%B9%E7%9A%84%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE"><span class="nav-text">Puppeteer 周边的开源项目</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap site-overview-item animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">372</span> <span class="site-state-item-name">文章</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags"><span class="site-state-item-count">41</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author site-overview-item animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → &#x2F;sitemap.xml"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside><div class="sidebar-dimmer"></div></header><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="external nofollow" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/1a44388b.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术博客"><meta itemprop="description" content="专注于 Java、前端、移动端、微服务、分布式系统、数据库、系统架构、人工智能、大数据、云计算、物联网、虚拟化学习的技术博客。"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Puppeteer 入门使用教程 | Clay 的技术博客"><meta itemprop="description" content="本文主要介绍Puppeteer的入门使用教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Puppeteer 入门使用教程</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-06-01 23:12:41" itemprop="dateCreated datePublished" datetime="2020-06-01T23:12:41+08:00">2020-06-01</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/1a44388b.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/1a44388b.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>2.9k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>3 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><div id="readmore-container"><h2 id="Puppeteer-介绍"><a href="#Puppeteer-介绍" class="headerlink" title="Puppeteer 介绍"></a>Puppeteer 介绍</h2><h3 id="Puppeteer-是什么"><a href="#Puppeteer-是什么" class="headerlink" title="Puppeteer 是什么"></a>Puppeteer 是什么</h3><p>Puppeteer 是一个 NodeJs 库，它提供了一个高级 API 来通过 DevTools 协议控制 Chromium 或 Chrome。相比较 Selenium 或是 PhantomJs，它最大的特点就是完全可以在内存中模拟 DOM 操作，即在 V8 引擎中处理而不打开浏览器，而且关键的是该项目是 Chrome 团队在维护，会拥有更好的兼容性和前景，更多资料可参考以下站点：<a target="_blank" rel="external nofollow" href="https://github.com/puppeteer/puppeteer">Puppeteer Github</a>、<a target="_blank" rel="external nofollow" href="https://zhaoqize.github.io/puppeteer-api-zh_CN/">Puppeteer 中文文档</a>、<a target="_blank" rel="external nofollow" href="https://chromedevtools.github.io/devtools-protocol/">DevTools Protocol 文档</a>、<a target="_blank" rel="external nofollow" href="https://peter.sh/experiments/chromium-command-line-switches/">Chromium 命令行启动参数</a>。</p><h3 id="Puppeteer-的功能"><a href="#Puppeteer-的功能" class="headerlink" title="Puppeteer 的功能"></a>Puppeteer 的功能</h3><ul><li>生成页面的截图和 PDF</li><li> 自动提交表单，进行 UI 测试，键盘输入等</li><li>捕获网站的时间线跟踪，用来帮助分析性能问题</li><li>抓取 SPA（单页应用），并生成预渲染内容，即 “SSR”（服务器端渲染）</li><li>创建一个最新的自动化测试环境，使用最新的 JavaScript 和浏览器功能，直接在最新版本的 Chrome 中运行测试</li><li>测试浏览器扩展，Chrome / Chromium 扩展当前只能在非无头模式下使用，目前还无法测试扩展弹出窗口或内容脚本</li></ul><span id="more"></span><h3 id="Puppeteer-VS-Puppeteer-Core"><a href="#Puppeteer-VS-Puppeteer-Core" class="headerlink" title="Puppeteer VS Puppeteer-Core"></a>Puppeteer VS Puppeteer-Core</h3><h4 id="使用区别"><a href="#使用区别" class="headerlink" title="使用区别"></a>使用区别</h4><p>自 v1.7.0 以来的 Puppeteer 每个版本都会发布两个包：puppeteer、puppeteer-core，两者的区别如下：</p><ul><li>puppeteer 是浏览器自动化的产品，安装后它会下载一个最新版本的 Chromium，然后使用 puppeteer-core 驱动工作。作为最终用户产品，puppeteer 支持一堆方便的 <code>PUPPETEER_*</code> 环境变量来调整运行行为</li><li> puppeteer-core 是一个库来帮助驱动任何支持 DevTools 协议的东西。puppeteer-core 在安装时不会下载 Chromium，作为一个库，puppeteer-core 完全是通过其编程接口驱动的，并且会忽略所有 <code>PUPPETEER_*</code> 环境变量</li></ul><h4 id="使用建议"><a href="#使用建议" class="headerlink" title="使用建议"></a>使用建议</h4><p>在大多数情况下，可以使用 puppeteer 包，如果是下面这些情况，那可以使用 puppeteer-core：</p><ul><li>正在构建使用 DevTools 协议的另一个最终用户产品或库；例如，可以使用 puppeteer-core 构建 PDF 生成器，并编写下载 <code>headless_shell</code> 的自定义 <code>install.js</code> 脚本，而不是使用 Chromium 来节省磁盘空间</li><li>正在打包 Puppeteer 用在 Chrome 上的扩展应用或者浏览器中以使用 DevTools 协议，因为下载额外的 Chromium 二进制文件不是必须的</li></ul><p>当需要使用 puppeteer-core 时，使用下面这行代码代替原来的引入方式即可：</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">'puppeteer-core'</span>);</span><br></pre></td></tr></tbody></table></figure><h2 id="Puppeteer-运行环境与安装"><a href="#Puppeteer-运行环境与安装" class="headerlink" title="Puppeteer 运行环境与安装"></a>Puppeteer 运行环境与安装</h2><h3 id="Puppeteer-运行环境"><a href="#Puppeteer-运行环境" class="headerlink" title="Puppeteer 运行环境"></a>Puppeteer 运行环境</h3><p>Puppeteer 运行依赖于 NodeJs v6.4.0+，如果要使用 async /await，只有 NodeJs v7.6.0 或更高版本才支持，NodeJs 可以点击<a target="_blank" rel="external nofollow" href="https://nodejs.org/zh-cn/">这里</a>下载。</p><h3 id="Puppeteer-安装"><a href="#Puppeteer-安装" class="headerlink" title="Puppeteer 安装"></a>Puppeteer 安装</h3><p>Puppeteer 安装的过程默认会执行 <code>install.js</code> 脚本来下载最新版本的 Chromium（请自备梯子），可以使用 <code>--ignore-scripts</code> 参数跳过 Chromium 的下载，也可以通过设置环境变量 <code>PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=1</code> 来跳过下载。</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装puppeteer</span></span><br><span class="line"><span class="keyword">$ npm</span> install puppeteer<span class="params"> -g</span><span class="params"> --ignore</span>-scripts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用淘宝镜像源安装puppeteer</span></span><br><span class="line"><span class="keyword">$ npm</span> install puppeteer<span class="params"> -g</span><span class="params"> --ignore</span>-scripts<span class="params"> --registry</span>=https://registry.npm.taobao.org</span><br></pre></td></tr></tbody></table></figure><p>手动下载 Chromium 并解压在本地磁盘，下载可以点击<a target="_blank" rel="external nofollow" href="https://download-chromium.appspot.com/">这里</a>（请自备梯子）：</p><h2 id="Puppeteer-入门案例"><a href="#Puppeteer-入门案例" class="headerlink" title="Puppeteer 入门案例"></a>Puppeteer 入门案例</h2><h3 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a>入门案例</h3><p>初始化项目：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$ npm</span> init</span><br></pre></td></tr></tbody></table></figure><p>创建 <code>index.js</code> 文件，代码如下，<code>executablePath</code> 是 Chromium 或者 Chrome 可执行文件的路径：</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">'puppeteer'</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; {</span><br><span class="line">      <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch({</span><br><span class="line">        <span class="attr">executablePath</span>: <span class="string">'/usr/bin/google-chrome-stable'</span>,</span><br><span class="line">        <span class="attr">headless</span>: <span class="literal">false</span></span><br><span class="line">      });</span><br><span class="line">      <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">      <span class="keyword">await</span> page.goto(<span class="string">'http://www.baidu.com/'</span>);</span><br><span class="line">      <span class="keyword">await</span> page.screenshot({<span class="attr">path</span>: <span class="string">'baidu.png'</span>});</span><br><span class="line">      browser.close();</span><br><span class="line">})();</span><br></pre></td></tr></tbody></table></figure><p>执行 <code>index.js</code> 脚本，运行成功后，会在当前目录下生成网页的截图文件 <code>baidu.png</code>：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$ node</span> index.js</span><br></pre></td></tr></tbody></table></figure><h3 id="启动参数"><a href="#启动参数" class="headerlink" title="启动参数"></a>启动参数</h3><p>Puppeteer Launch 的启动参数如下：</p><ul><li>executablePath：Chromium 或 Chrome 可执行文件的路径</li><li> headless：是否运行在浏览器 <code>headless</code> 模式，true 表示不打开浏览器执行，默认为 true</li><li>timeout：等待浏览器实例启动的最长时间（以毫秒为单位），默认为 30000，当值为 0 时表示禁用超时</li><li> args：传递给浏览器实例的其他参数</li></ul><h2 id="Puppeteer-实战"><a href="#Puppeteer-实战" class="headerlink" title="Puppeteer 实战"></a>Puppeteer 实战</h2><h3 id="Puppeteer-环境变量"><a href="#Puppeteer-环境变量" class="headerlink" title="Puppeteer 环境变量"></a>Puppeteer 环境变量</h3><p>Puppeteer 的环境变量如下，在使用 puppeteer-core 时，下述环境变量中以 <code>PUPPETEER_*</code> 开头的会被忽略：</p><ul><li>HTTP_PROXY、HTTPS_PROXY, NO_PROXY - 定义用于下载和运行 Chromium 的 HTTP 代理设置</li><li> PUPPETEER_SKIP_CHROMIUM_DOWNLOAD - 请勿在安装步骤中下载绑定的 Chromium</li><li>PUPPETEER_DOWNLOAD_HOST - 覆盖用于下载 Chromium 的 URL 的主机部分</li><li> PUPPETEER_CHROMIUM_REVISION - 在安装步骤中指定一个 puppeteer 使用的特定版本的 Chromium</li><li>PUPPETEER_EXECUTABLE_PATH - 指定一个 Chrome 或者 Chromium 可执行文件的路径，会被用于 <code>puppeteer.launch</code></li></ul><h3 id="Puppeteer-的选择器"><a href="#Puppeteer-的选择器" class="headerlink" title="Puppeteer 的选择器"></a>Puppeteer 的选择器</h3><p>Puppeteer 中获取元素的方法和浏览器里面的一样，但是获取元素的属性的办法和浏览器不一样，它有一套 API 用来获取界面中的元素，还有一套 API 用来获取元素的属性。</p><p>获取元素的操作如下：</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Page.$(selector) 获取单个元素，底层是调用的是 document.querySelector()，所以选择器的 selector 格式遵循 CSS 选择器规范</span></span><br><span class="line"><span class="keyword">let</span> inputElement = <span class="keyword">await</span> page.$(<span class="string">'#search'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Page.$$(selector) 获取一组元素，底层调用的是 document.querySelectorAll()，返回 Promise(Array(ElemetHandle)) 元素数组</span></span><br><span class="line"><span class="keyword">const</span> links = <span class="keyword">await</span> page.$$(<span class="string">"a"</span>);</span><br></pre></td></tr></tbody></table></figure><p>获取元素的属性的操作如下：</p><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Puppeteer 获取元素属性跟平时写 JavaScript 的逻辑有点不一样，按照通常的逻辑，应该是现获取元素，然后再获取元素的属性</span></span><br><span class="line"><span class="comment">// Puppeteer 获取元素的 API 最终返回的都是 ElemetHandle 对象，而 ElemetHandle 并没有提供获取元素属性的 API，而 Puppeteer 专门提供了一套获取元素属性的 API，分别是： Page.$eval() 和 Page.$$eval()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> href = <span class="keyword">await</span> page.$eval(<span class="string">'#a'</span>, <span class="function"><span class="params">ele</span> =&gt;</span> ele.href);</span><br><span class="line"><span class="keyword">const</span> content = <span class="keyword">await</span> page.$eval(<span class="string">'.content'</span>, <span class="function"><span class="params">ele</span> =&gt;</span> ele.outerHTML);</span><br><span class="line"><span class="keyword">const</span> value = <span class="keyword">await</span> page.$eval(<span class="string">'input[name=search]'</span>, <span class="function"><span class="params">input</span> =&gt;</span> input.value);</span><br><span class="line"><span class="keyword">const</span> textArray = <span class="keyword">await</span> page.$$eval(<span class="string">'#dom'</span>, <span class="function"><span class="params">els</span> =&gt;</span> <span class="built_in">Array</span>.from(els).map(<span class="function"><span class="params">el</span> =&gt;</span> el.textContent));</span><br></pre></td></tr></tbody></table></figure><p>常用的元素选择器：</p><table><thead><tr><th>选择器</th><th>示例</th><th>示例说明</th></tr></thead><tbody><tr><td> id 选择器</td><td>#id</td><td> 选择匹配 id 的元素，仅存在一个</td></tr><tr><td> class 选择器</td><td>.class</td><td> 同时匹配多个 class 元素</td></tr><tr><td>属性选择器</td><td> div[attr]</td><td> 匹配具有 attr 的属性，不考虑具体的值</td></tr><tr><td>属性选择器</td><td> div[attr=‘122‘]</td><td> 匹配具有 attr 的属性，值为 122</td></tr><tr><td> 后代选择器</td><td> div span</td><td> 后代选择器，匹配所有 div 后面的 span 标签，div 与 span 之间用空格隔开</td></tr><tr><td>子元素选择器</td><td> div &gt; span</td><td> 子元素选择器，匹配 div 后所有的 span</td></tr><tr><td> 匹配父元素下的第 n 个子元素</td><td> div:nth-child(2)</td><td> 匹配父元素下的第 2 个元素</td></tr></tbody></table><h3 id="SegmentFault-模拟登录"><a href="#SegmentFault-模拟登录" class="headerlink" title="SegmentFault 模拟登录"></a>SegmentFault 模拟登录</h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">'puppeteer'</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; {</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.launch({</span><br><span class="line">    <span class="attr">executablePath</span>: <span class="string">'/usr/bin/google-chrome-stable'</span>,</span><br><span class="line">    <span class="attr">headless</span>: <span class="literal">false</span></span><br><span class="line">  });</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.newPage();</span><br><span class="line">  page.setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line">  page.setCacheEnabled(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> page.goto(<span class="string">"https://segmentfault.com/user/login"</span>, {</span><br><span class="line">      <span class="string">"timeout"</span> : <span class="number">30000</span></span><br><span class="line">  });</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 选择登录方式</span></span><br><span class="line">  <span class="keyword">await</span> page.tap(<span class="string">".login-nav &gt; a[data-mode='password']"</span>);</span><br><span class="line">  <span class="comment">// 输入用户名</span></span><br><span class="line">  <span class="keyword">await</span> page.type(<span class="string">"form[class='password-form'] &gt; div &gt; input[name='username']"</span>, <span class="string">'admin'</span>, {<span class="attr">delay</span>:<span class="number">100</span>});</span><br><span class="line">  <span class="comment">// 输入密码</span></span><br><span class="line">  <span class="keyword">await</span> page.type(<span class="string">"form[class='password-form'] &gt; div &gt; input[name='password']"</span>, <span class="string">'123456'</span>, {<span class="attr">delay</span>:<span class="number">100</span>});</span><br><span class="line">  <span class="comment">// 点击登录按钮</span></span><br><span class="line">  <span class="keyword">await</span> page.tap(<span class="string">"form[class='password-form'] &gt; button[type='submit']"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// await page.close();</span></span><br><span class="line">  <span class="comment">// await browser.close();</span></span><br><span class="line">})();</span><br></pre></td></tr></tbody></table></figure><h3 id="Puppeteer-结合-Jest-使用"><a href="#Puppeteer-结合-Jest-使用" class="headerlink" title="Puppeteer 结合 Jest 使用"></a>Puppeteer 结合 Jest 使用</h3><h2 id="Puppeteer-周边的开源项目"><a href="#Puppeteer-周边的开源项目" class="headerlink" title="Puppeteer 周边的开源项目"></a>Puppeteer 周边的开源项目</h2><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/fanyong920/jvppeteer">jvppeteer</a>，Java 版的 Puppeteer</li><li><a target="_blank" rel="external nofollow" href="https://github.com/miyakogi/pyppeteer">pyppeteer</a>，Python 版的 Puppeteer</li><li><a target="_blank" rel="external nofollow" href="https://github.com/transitive-bullshit/awesome-puppeteer">awesome-puppeteer</a>，Puppeteer 相关的开源项目整理</li><li><a target="_blank" rel="external nofollow" href="https://github.com/buildkite/docker-puppeteer">docker-puppeteer</a>，A minimal Docker image for Puppeteer</li><li><a target="_blank" rel="external nofollow" href="https://github.com/thomasdondorf/puppeteer-cluster">puppeteer-cluster</a>，Puppeteer Pool, run a cluster of instances in parallel</li><li><a target="_blank" rel="external nofollow" href="https://github.com/zhentaoo/puppeteer-deep">puppeteer-deep</a>，爬取《es6 标准入门》、自动推文到掘金、站点性能分析；高级爬虫、自动化 UI 测试、性能分析的实践案例</li><li><a target="_blank" rel="external nofollow" href="https://github.com/checkly/puppeteer-recorder">puppeteer-recorder</a>，Puppeteer recorder is a Chrome extension that records your browser interactions and generates a Puppeteer script</li></ul></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script>var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i);if(!isMobile)try{var plugin=new ReadmorePlugin;plugin.init({id:"readmore-container",blogId:"96641-5333172926158-056",name:"全栈技术驿站",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",lockToc:"yes",type:"hexo",random:"0.9",interval:"30",expires:"365",height:"auto"})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>坚持原创技术分享，您的支持将鼓励我继续创作！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/1a44388b.html" title="Puppeteer 入门使用教程">https://www.techgrow.cn/posts/1a44388b.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎加入微信群</span><br> <img src="/img/wx-group-qr-technology.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag"><i class="fa fa-tag"></i> 前端</a><a href="/tags/%E7%88%AC%E8%99%AB/" rel="tag"><i class="fa fa-tag"></i> 爬虫</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/5987f4b4.html" rel="prev" title="ArtiPub 一款开源的一文多发平台"><i class="fa fa-chevron-left"></i> ArtiPub 一款开源的一文多发平台</a></div><div class="post-nav-item"> <a href="/posts/2f77f23a.html" rel="next" title="JVM 内存结构与 GC 算法">JVM 内存结构与 GC 算法<i class="fa fa-chevron-right"></i></a></div></div><div style="text-align:center"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4014850419768221" data-ad-slot="7586134725" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright &copy; 2018 – <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">725k</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">10:59</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="beian"> <span><img src="/img/gonganbeian.png" alt></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备19024664号</a></span></div></div></footer><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-tu9j5pBilBQrWSDePOOajCUdz6hWsid/lBNzK4KgEPM="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-TIYL00Rhw/8WaoUhYTLX9SKIEFdXxg+yMWSLVUbhiLg="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://unpkg.com/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '32px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://unpkg.com/qiniu-js@3.3.1/dist/qiniu.min.js"></script><script>
    var qiniu_domain = "https://qiniu.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/app/api/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn:9360","cssUrl":"https://unpkg.com/@waline/client@2.5.1/dist/waline.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://unpkg.com/@waline/client@2.5.1/dist/waline.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://unpkg.com/@waline/emojis@1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://qiniu.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/app/api/qiniu/token/upload","el":"#waline","comment":true,"path":"/posts/1a44388b.html"}</script><link rel="stylesheet" href="https://unpkg.com/@waline/client@2.5.1/dist/waline.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>