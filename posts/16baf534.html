<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 ZooKeeper 的使用教程。"><meta property="og:type" content="article"><meta property="og:title" content="ZooKeeper 入门教程之四"><meta property="og:url" content="https://www.techgrow.cn/posts/16baf534.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 ZooKeeper 的使用教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/zookeeper-paxos-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/zookeeper-paxos-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/zookeeper-paxos-3.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/zookeeper-paxos-4.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/zookeeper-paxos-5.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/zookeeper-paxos-6.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/zookeeper-zab-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/zookeeper-zab-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/zookeeper-zab-3.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/zookeeper-zab-4.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/01/cap-base.png"><meta property="article:published_time" content="2021-07-04T14:13:45.000Z"><meta property="article:modified_time" content="2021-07-04T14:13:45.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="分布式"><meta property="article:tag" content="大数据"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2025/01/zookeeper-paxos-1.png"><link rel="canonical" href="https://www.techgrow.cn/posts/16baf534.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/16baf534.html","path":"posts/16baf534.html","title":"ZooKeeper 入门教程之四"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>ZooKeeper 入门教程之四 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90"><span class="nav-text">学习资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%B0%86%E5%86%9B%E9%97%AE%E9%A2%98"><span class="nav-text">拜占庭将军问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%85%E4%BA%8B%E8%83%8C%E6%99%AF"><span class="nav-text">故事背景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E9%97%AE%E9%A2%98"><span class="nav-text">核心问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E8%A6%81%E6%8C%91%E6%88%98"><span class="nav-text">主要挑战</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">解决方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">应用场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Paxos-%E7%AE%97%E6%B3%95"><span class="nav-text">Paxos 算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Paxos-%E7%AE%97%E6%B3%95%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-text">Paxos 算法的概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Paxos-%E7%AE%97%E6%B3%95%E7%9A%84%E6%8F%8F%E8%BF%B0"><span class="nav-text">Paxos 算法的描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Paxos-%E7%AE%97%E6%B3%95%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="nav-text">Paxos 算法的流程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-text">工作流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A8%E6%BC%94%E4%B8%BE%E4%BE%8B"><span class="nav-text">推演举例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8E%A8%E6%BC%94%E6%83%85%E5%86%B5%E4%B8%80"><span class="nav-text">推演情况一</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8E%A8%E6%BC%94%E6%83%85%E5%86%B5%E4%BA%8C"><span class="nav-text">推演情况二</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8E%A8%E6%BC%94%E6%83%85%E5%86%B5%E4%B8%89"><span class="nav-text">推演情况三</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ZAB-%E5%8D%8F%E8%AE%AE"><span class="nav-text">ZAB 协议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ZAB-%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-text">ZAB 协议的概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ZAB-%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%86%85%E5%AE%B9"><span class="nav-text">ZAB 协议的内容</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E5%B9%BF%E6%92%AD"><span class="nav-text">消息广播</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B4%A9%E6%BA%83%E6%81%A2%E5%A4%8D"><span class="nav-text">崩溃恢复</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Leader-%E9%80%89%E4%B8%BE"><span class="nav-text">Leader 选举</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D"><span class="nav-text">数据恢复</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CAP-%E7%90%86%E8%AE%BA"><span class="nav-text">CAP 理论</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CAP-%E7%90%86%E8%AE%BA%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-text">CAP 理论的概念</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Base-%E7%90%86%E8%AE%BA"><span class="nav-text">Base 理论</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#BASE-%E7%90%86%E8%AE%BA%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-text">BASE 理论的概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CAP-%E4%B8%8E-BASE-%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-text">CAP 与 BASE 的关系</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">768</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">54</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/16baf534.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="ZooKeeper 入门教程之四 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 ZooKeeper 的使用教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> ZooKeeper 入门教程之四</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-07-04 22:13:45" itemprop="dateCreated datePublished" datetime="2021-07-04T22:13:45+08:00">2021-07-04</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/16baf534.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/16baf534.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>5.8k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>5 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/23b4218e.html">ZooKeeper 入门教程之一</a></li><li><a href="/posts/18340f27.html">ZooKeeper 入门教程之二</a></li><li><a href="/posts/5a68992a.html">ZooKeeper 入门教程之三</a></li><li><a href="/posts/16baf534.html">ZooKeeper 入门教程之四</a></li><li><a href="/posts/b589771.html">ZooKeeper 入门教程之五</a></li><li><a href="/posts/d415f72.html">ZooKeeper 入门教程之六</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h3><ul><li><a href="/posts/ecc33bf4.html">ZooKeeper 学习路线</a></li><li><a target="_blank" rel="external nofollow" href="https://zookeeper.apache.org/documentation.html">ZooKeeper 官方英文文档</a></li><li><a target="_blank" rel="external nofollow" href="https://zookeeper.net.cn/doc/r3.9.2/index.html">ZooKeeper 官方中文文档</a></li></ul><span id="more"></span><h2 id="拜占庭将军问题"><a href="#拜占庭将军问题" class="headerlink" title="拜占庭将军问题"></a>拜占庭将军问题</h2><p>拜占庭将军问题（Byzantine Generals Problem）是计算机科学和分布式系统中的一个经典问题，用于描述在分布式系统中如何在存在不可靠参与者（即恶意节点或故障节点）的情况下，达成一致的决策。</p><h3 id="故事背景"><a href="#故事背景" class="headerlink" title="故事背景"></a>故事背景</h3><p>拜占庭将军问题来源于一个虚构的故事：拜占庭帝国的将军们围攻一个城市，他们需要通过协调一致的行动（例如共同进攻或共同撤退）来成功。但由于将军之间的通信可能会被拦截、篡改或完全失败，以及可能存在叛徒故意传递错误的信息，将军们需要设计一个机制确保忠诚的将军们能够在恶劣的条件下达成一致。</p><h3 id="核心问题"><a href="#核心问题" class="headerlink" title="核心问题"></a>核心问题</h3><ul><li>拜占庭将军问题的核心是：<ul><li>(1) 达成共识：所有忠诚的将军必须就一个共同的行动（如进攻或撤退）达成一致。</li><li>(2) 容错性：即使某些将军是叛徒或发送错误信息，忠诚的将军仍需正确决策。</li></ul></li></ul><h3 id="主要挑战"><a href="#主要挑战" class="headerlink" title="主要挑战"></a>主要挑战</h3><ul><li>拜占庭将军问题中涉及的主要挑战是：<ul><li>(1) 不可靠的通信：消息可能被篡改、丢失或延迟。</li><li>(2) 恶意参与者：部分节点可能尝试通过发送矛盾或虚假的信息来破坏系统的一致性。</li></ul></li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>拜占庭容错问题的研究结果表明：<ul><li>在一个由 <code>n</code> 个节点组成的系统中，若系统中存在最多 <code>f</code> 个恶意节点，必须满足 <code>n ≥ 3f + 1</code> 的条件，才能通过某种算法实现一致性。</li><li>拜占庭容错算法（Byzantine Fault Tolerance，BFT）是应对这一问题的具体解决方案，如：<ul><li>实用拜占庭容错（Practical Byzantine Fault Tolerance，PBFT）</li><li>使用 Raft 和 Paxos 等分布式一致性算法（尽管这些算法并非专门针对拜占庭问题而设计）</li><li>使用区块链技术中的共识算法（如 PoW、PoS 等）</li></ul></li></ul></li></ul><h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul><li>拜占庭将军问题的解决方案广泛应用于以下领域：<ul><li>分布式系统：如分布式数据库和分布式存储。</li><li>区块链：确保交易一致性和防篡改。</li><li>航空航天和军事通信：保证关键系统的可靠性。</li></ul></li></ul><p>通过研究拜占庭将军问题，工程师们能够设计更加可靠、容错的分布式系统，为实际应用提供理论和技术支持。</p><h2 id="Paxos-算法"><a href="#Paxos-算法" class="headerlink" title="Paxos 算法"></a>Paxos 算法</h2><h3 id="Paxos-算法的概念"><a href="#Paxos-算法的概念" class="headerlink" title="Paxos 算法的概念"></a>Paxos 算法的概念</h3><ul><li><p>什么是 Paxos 算法</p><ul><li>一种基于消息传递且具有高度容错特性的一致性算法。</li></ul></li><li><p>Paxos 算法解决的问题</p><ul><li>如何快速正确地在一个分布式系统中对某个数据值达成一致，并且保证不论发生任何异常，都不会破坏整个系统的一致性。</li></ul></li></ul><p><img data-src="../../../asset/2025/01/zookeeper-paxos-1.png"></p><h3 id="Paxos-算法的描述"><a href="#Paxos-算法的描述" class="headerlink" title="Paxos 算法的描述"></a>Paxos 算法的描述</h3><p>在一个 Paxos 系统中，首先将所有节点划分为 Proposer（提议者）、Acceptor（接受者）和 Learner（学习者）。特别注意，每个节点都可以身兼数职。</p><p><img data-src="../../../asset/2025/01/zookeeper-paxos-2.png"></p><p>一个完整的 Paxos 算法流程分为三个阶段:</p><ul><li><p>(1) 准备阶段（Prepare）</p><ul><li>Proposer 向多个 Acceptor 发出 Propose（提议）请求 Promise（承诺）</li><li>Acceptor 针对收到的 Propose（提议）请求进行 Promise（承诺）</li></ul></li><li><p>(2) 接受阶段（Accept）</p><ul><li>Proposer 收到多数 Acceptor 承诺的 Promise 后，向 Acceptor 发出 Propose 请求</li><li> Acceptor 针对收到的 Propose 请求进行 Accept 处理</li></ul></li><li><p> (3) 学习阶段（Learn）</p><ul><li>Proposer 将形成的决议发送给所有 Learners</li></ul></li></ul><h3 id="Paxos-算法的流程"><a href="#Paxos-算法的流程" class="headerlink" title="Paxos 算法的流程"></a>Paxos 算法的流程</h3><h4 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h4><p><img data-src="../../../asset/2025/01/zookeeper-paxos-3.png"></p><ul><li><p>(1) Prepare</p><ul><li>Proposer 生成全局唯一且递增的 Proposal ID，向所有 Acceptor 发送 Propose 请求，这里无需携带提案内容，只携带 Proposal ID 即可。</li></ul></li><li><p>(2) Promise</p><ul><li>Acceptor 收到 Propose 请求后，做出 “两个承诺，一个应答”。<ul><li>不再接受 Proposal ID 小于等于（注意：这里是 <code>&lt;=</code>）当前请求的 Propose 请求。</li><li>不再接受 Proposal ID 小于（注意：这里是 <code>&lt;</code>）当前请求的 Accept 请求。</li><li>不违背以前做出的承诺下，回复已经 Accept 过的提案中 Proposal ID 最大的那个提案的 Value 和 Proposal ID，没有则返回空值。</li></ul></li></ul></li><li><p>(3) Propose</p><ul><li>Proposer 收到多数 Acceptor 的 Promise 应答后，从应答中选择 Proposal ID 最大的提案的 Value 作为本次要发起的提案。</li><li>如果所有应答的提案 Value 均为空值，则可以自己随意决定提案 Value；然后携带当前 Proposal ID，向所有 Acceptor 发送 Propose 请求。</li></ul></li><li><p>(4) Accept</p><ul><li>Acceptor 收到 Propose 请求后，在不违背自己之前做出的承诺下，接受并持久化当前 Proposal ID 和提案 Value。</li></ul></li><li><p>(5) Learn</p><ul><li>Proposer 收到多数 Acceptor 的 Accept 后，决议形成，将形成的决议发送给所有 Learner。</li></ul></li></ul><h4 id="推演举例"><a href="#推演举例" class="headerlink" title="推演举例"></a>推演举例</h4><p>下面针对上述 Paxos 算法的工作流程做三种情况的推演举例，为了简化流程，这里不设置 Learner。</p><h5 id="推演情况一"><a href="#推演情况一" class="headerlink" title="推演情况一"></a>推演情况一</h5><p><img data-src="../../../asset/2025/01/zookeeper-paxos-4.png"></p><ul><li>有 A1、A2、A3、A4、A5 这 5 位议员，就税率问题进行决议</li><li> A1 发起 1 号 Proposal（提案）的 Propose（提议），等待 Promise（承诺）</li><li>A2 ~ A5 回应 Promise</li><li>A1 在收到两份回复时，就会发起税率 10% 的 Proposal</li><li>A2 ~ A5 回应 Accept</li><li> 通过 Proposal，决定税率定为 10%</li></ul><h5 id="推演情况二"><a href="#推演情况二" class="headerlink" title="推演情况二"></a>推演情况二</h5><p><img data-src="../../../asset/2025/01/zookeeper-paxos-5.png"></p><ul><li>现在假设在 A1 提出提案的同时，A5 决定将税率定为 20%</li><li>A1、A5 同时发起 Propose（序号分别为 1、2）</li><li>A2 承诺 A1，A4 承诺 A5，A3 的承诺行为成为关键</li><li>情况一：A3 先收到 A1 消息，承诺 A1</li><li>A1 发起 Proposal（1，10%），A2、A3 接受</li><li>之后 A3 又收到 A5 消息，回复 A1（1，10%），并承诺 A5</li><li>A5 发起 Proposal（2，20%），A3、A4 接受，之后 A1、A5 同时广播决议</li></ul><h5 id="推演情况三"><a href="#推演情况三" class="headerlink" title="推演情况三"></a>推演情况三</h5><p><img data-src="../../../asset/2025/01/zookeeper-paxos-6.png"></p><ul><li>现假设在 A1 提出提案的同时，A5 决定将税率定为 20%</li><li>A1、A5 同时发起 Propose（序号分别为 1、2）</li><li>A2 承诺 A1，A4 承诺 A5，A3 的承诺行为成为关键</li><li>情况二：A3 先收到 A1 消息，承诺 A1；之后立刻收到 A5 消息，承诺 A5</li><li>A1 发起 Proposal（1，10%），无足够响应，A1 重新发起 Propose（序号 3），A3 再次承诺 A1</li><li>A5 发起 Proposal（2，20%），无足够响应，A5 重新发起 Propose (序号 4)，A3 再次承诺 A5</li><li>……（循环往复）</li></ul><p>造成上述循环往复情况的原因是系统中有一个以上的 Proposer（提议者），多个 Proposers（提案人）相互争夺 Acceptor，造成迟迟无法达成一致的情况。<strong>针对这种情况，一种改进的 Paxos 算法被提出：从系统中选出一个节点作为 Leader，只有 Leader 能够发起提案。</strong>这样就可以保证，一次 Paxos 流程中只有一个 Proposer，不会出现活锁的情况，此时只会出现例子中第一种情况。</p><div class="admonition note"><p class="admonition-title">Paxos 算法的缺陷</p><p>在网络复杂的情况下，一个使用 Paxos 算法的分布式系统，可能很久无法收敛，甚至陷入活锁的情况。</p></div><h2 id="ZAB-协议"><a href="#ZAB-协议" class="headerlink" title="ZAB 协议"></a>ZAB 协议</h2><h3 id="ZAB-协议的概念"><a href="#ZAB-协议的概念" class="headerlink" title="ZAB 协议的概念"></a>ZAB 协议的概念</h3><p>ZAB 借鉴了 Paxos 算法，是特别为 Zookeeper 设计的支持崩溃恢复的原子广播协议。基于 ZAB 协议，Zookeeper 被设计为只有一个节点（Leader）负责处理外部的写事务请求，然后 Leader 节点将数据同步到其他 Follower 节点。即 Zookeeper 只有一个 Leader 节点可以发起提案。</p><h3 id="ZAB-协议的内容"><a href="#ZAB-协议的内容" class="headerlink" title="ZAB 协议的内容"></a>ZAB 协议的内容</h3><p>ZAB 协议包括两种基本模式：消息广播、崩溃恢复。</p><h4 id="消息广播"><a href="#消息广播" class="headerlink" title="消息广播"></a>消息广播</h4><p><img data-src="../../../asset/2025/01/zookeeper-zab-1.png"></p><ul><li>(1) 客户端发起一个写操作请求</li><li> (2) Leader 节点将客户端的请求转化为事务 Proposal（提案），同时为每个 Proposal 分配一个全局的 ID（即 <code>zxid</code>）。</li><li>(3) Leader 节点为每个 Follower 节点分配一个单独的队列，然后将需要广播的 Proposal 依次放到队列中去，并且根据 FIFO 策略进行消息发送。</li><li>(4) Follower 接收到 Proposal 后，会首先将其以事务日志的方式写入本地磁盘中，写入成功后向 Leader 反馈一个 ACK 响应消息。</li><li>(5) Leader 接收到超过半数以上 Follower 的 ACK 响应消息后，即认为消息发送成功，可以发送 Commit 消息了。</li><li>(6) Leader 向所有 Follower 广播 Commit 消息，同时自身也会完成事务提交。Follower 接收到 Commit 消息后，会将上一条事务提交。</li><li>(7) Zookeeper 采用 ZAB 协议的核心，就是只要有一台节点提交了 Proposal，就要确保所有的节点最终都能正确提交 Proposal。</li></ul><h4 id="崩溃恢复"><a href="#崩溃恢复" class="headerlink" title="崩溃恢复"></a>崩溃恢复</h4><p>一旦 Leader 节点出现崩溃或者由于网络原因，导致 Leader 节点失去了与过半 Follower 的联系，那么就会进入崩溃恢复模式。<strong>崩溃恢复主要包括两部分：Leader 选举和数据恢复。</strong></p><p><img data-src="../../../asset/2025/01/zookeeper-zab-2.png"></p><ul><li><p>假设有以下两种服务器异常情况：</p><ul><li>(1) 假设一个事务在 Leader 提出之后，Leader 宕机了。</li><li>(2) 一个事务在 Leader 上提交了，并且过半的 Follower 都响应 ACK 了，但是 Leader 在 Commit 消息发出之前宕机了。</li></ul></li><li><p>ZAB 协议崩溃恢复要求满足以下两个要求：</p><ul><li>(1) 确保已经被 Leader 提交的提案 Proposal，必须最终被所有的 Follower 节点提交（<strong>已经产生的提案，Follower 必须执行</strong>）。</li><li>(2) 确保丢弃已经被 Leader 提出的，但是没有被提交的 Proposal（<strong>丢弃胎死腹中的提案</strong>）。</li></ul></li></ul><h5 id="Leader-选举"><a href="#Leader-选举" class="headerlink" title="Leader 选举"></a>Leader 选举</h5><p><img data-src="../../../asset/2025/01/zookeeper-zab-3.png"></p><p>根据上述要求，ZAB 协议需要保证选举出来的新 Leader 满足以下条件：</p><ul><li>(1) 新选举出来的 Leader 不能包含未提交的 Proposal，<strong>即新 Leader 必须都是已经提交了 Proposal 的 Follower 节点。</strong></li><li>(2) <strong>新选举的 Leader 节点中必须含有最大的 <code>zxid</code>，</strong>这样做的好处是可以避免 Leader 节点检查 Proposal 的提交和丢弃工作。</li></ul><h5 id="数据恢复"><a href="#数据恢复" class="headerlink" title="数据恢复"></a>数据恢复</h5><p><img data-src="../../../asset/2025/01/zookeeper-zab-4.png"></p><p>ZAB 是如何执行数据同步的：</p><ul><li><p>(1) Leader 选举完成后，在正式开始工作之前（接收事务请求，然后提出新的 Proposal），<strong>Leader 节点会首先确认事务日志中的所有的 Proposal 是否已经被集群中过半的服务器 Commit。</strong></p></li><li><p>(2) Leader 节点需要确保所有的 Follower 节点能够接收到每一条事务的 Proposal，并且能将所有已经提交的事务 Proposal 应用到内存数据中。<strong>等到 Follower 将所有尚未同步的事务 Proposal 都从 Leader 节点上同步过来，并且应用到内存数据中以后，Leader 才会把该 Follower 加入到真正可用的 Follower 列表中。</strong></p></li></ul><h2 id="CAP-理论"><a href="#CAP-理论" class="headerlink" title="CAP 理论"></a>CAP 理论</h2><h3 id="CAP-理论的概念"><a href="#CAP-理论的概念" class="headerlink" title="CAP 理论的概念"></a>CAP 理论的概念</h3><p>CAP 理论是指一个分布式系统不可能同时满足以下三个条件：</p><ul><li><p><strong>一致性（Consistency）</strong></p><ul><li>在分布式环境中，一致性是指数据在多个副本之间是否能够保持数据一致的特性。</li><li>在一致性的需求下，当一个系统在数据一致的状态下执行更新操作后，应该保证系统的数据仍然处于一致的状态。</li></ul></li><li><p><strong>可用性（Available）</strong></p><ul><li>可用性是指系统提供的服务必须一直处于可用的状态，对于用户的每一个操作请求总是能够在有限的时间内返回结果。</li></ul></li><li><p><strong>分区容错性（Partition Tolerance）</strong></p><ul><li>分布式系统在遇到任何网络分区故障的时候，仍然需要能够保证对外提供满足一致性和可用性的服务，除非是整个网络环境都发生了故障。</li></ul></li></ul><p>这三个基本条件，最多只能同时满足其中的两个，因为分区容错性是必须要满足的，因此往往选择就在 CP 或者 AP 之间。值得一提的是，<strong>ZooKeeper 保证的是 CP。</strong></p><ul><li>(1) ZooKeeper 不能保证每次服务请求的可用性。在极端环境下，ZooKeeper 可能会丢弃一些请求，客户端需要重新发送请求才能获得结果。所以说，ZooKeeper 不能保证服务可用性。</li><li>(2) ZooKeeper 集群进行 Leader 选举时，整个集群都是不可用，往往需要几十秒甚至一两分钟才能恢复过来。</li></ul><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>Eureka 保证的是 AP。</li><li>ZooKeeper 保证的是 CP。</li><li>Nacos 保证的是 AP 或者 CP（可以通过配置来选择），默认是保证 AP。在 Nacos 中，AP 是基于 Distro 协议实现，CP 是基于 Raft 协议实现。</li></ul></div><h2 id="Base-理论"><a href="#Base-理论" class="headerlink" title="Base 理论"></a>Base 理论</h2><h3 id="BASE-理论的概念"><a href="#BASE-理论的概念" class="headerlink" title="BASE 理论的概念"></a>BASE 理论的概念</h3><p>eBay 的架构师 Dan Pritchett 源于对大规模分布式系统的实践总结，在 ACM 上发表文章提出 BASE 理论。BASE 理论是对 CAP 理论的延伸，核心思想是即使无法做到强一致性（Strong Consistency，CAP 的一致性就是强一致性），但应用可以采用适合的方式达到最终一致性（Eventual Consitency）。BASE 是以下三个原则的缩写：</p><ul><li><p><strong>Basically Available（基本可用）</strong></p><ul><li>系统保证基本可用性，即系统在大部分时间内是可用的，但不一定保证在所有情况下都能正常处理所有请求。例如，在部分系统节点发生故障时，系统仍然能够提供服务，但可能会有部分功能受限或性能下降。</li></ul></li><li><p><strong>Soft State（软状态）</strong></p><ul><li>软状态也称为弱状态，和硬状态相对，是指允许系统中的数据存在中间状态，并认为该中间状态的存在不会影响系统的整体可用性，即允许系统在不同节点的数据副本之间进行数据同步的过程存在延时。</li></ul></li><li><p><strong>Eventually Consistent（最终一致性）</strong></p><ul><li>系统保证在没有新的更新操作后，经过一段时间后，所有数据副本最终会达到一致状态。这与 ACID 中的强一致性（即在事务完成后，所有数据立即一致）不同，最终一致性允许在短期内存在不一致，但最终会达到一致。</li></ul></li></ul><div class="admonition note"><p class="admonition-title">总结</p><p>BASE 理论常用于 NoSQL 数据库和大规模分布式系统中，如 Cassandra、Amazon DynamoDB 等。这些系统通过放松一致性要求，以换取更高的可用性和分区容忍度，适应大规模、分布式环境中的高并发和高性能需求。总的来说，BASE 理论在分布式系统中强调的是可用性和扩展性，通过接受短期的不一致性来实现系统的高可用性和高性能。</p></div><h3 id="CAP-与-BASE-的关系"><a href="#CAP-与-BASE-的关系" class="headerlink" title="CAP 与 BASE 的关系"></a>CAP 与 BASE 的关系</h3><p>BASE 是对 CAP 中一致性和可用性权衡的结果，其来源于对大规模互联网系统分布式实践的结论，是基于 CAP 定理逐步演化而来的，其核心思想是即使无法做到强一致性（Strong consistency），更具体地说，是对 CAP 中 AP 方案的一个补充。其基本思路就是：通过业务，牺牲强一致性而获得可用性，并允许数据在一段时间内是不一致的，但是最终达到一致性状态。</p><p><img data-src="../../../asset/2025/01/cap-base.png"></p><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/16baf534.html" title="ZooKeeper 入门教程之四">https://www.techgrow.cn/posts/16baf534.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag"><i class="fa fa-tag"></i> 大数据</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/ac3bb7d5.html" rel="prev" title="RabbitMQ 入门教程之十一"><i class="fa fa-angle-left"></i> RabbitMQ 入门教程之十一</a></div><div class="post-nav-item"> <a href="/posts/b589771.html" rel="next" title="ZooKeeper 入门教程之五">ZooKeeper 入门教程之五<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2.2m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">34:04</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/16baf534.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>