<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 Dubbo 的入门教程。"><meta property="og:type" content="article"><meta property="og:title" content="Dubbo2 巩固教程之五"><meta property="og:url" content="https://www.techgrow.cn/posts/bbace66e.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 Dubbo 的入门教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-principle-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-principle-2.png"><meta property="article:published_time" content="2019-09-25T15:42:35.000Z"><meta property="article:modified_time" content="2025-09-25T15:42:35.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="微服务"><meta property="article:tag" content="分布式"><meta property="article:tag" content="RPC"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2025/11/dubbo-principle-1.png"><link rel="canonical" href="https://www.techgrow.cn/posts/bbace66e.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/bbace66e.html","path":"posts/bbace66e.html","title":"Dubbo2 巩固教程之五"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Dubbo2 巩固教程之五 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90"><span class="nav-text">学习资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo-%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="nav-text">Dubbo 设计原则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Dubbo-%E7%9A%84%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="nav-text">Dubbo 的整体架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dubbo-%E7%9A%84%E5%8A%9F%E8%83%BD%E6%80%A7%E9%9C%80%E6%B1%82"><span class="nav-text">Dubbo 的功能性需求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dubbo-%E7%9A%84%E9%9D%9E%E5%8A%9F%E8%83%BD%E6%80%A7%E9%9C%80%E6%B1%82"><span class="nav-text">Dubbo 的非功能性需求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dubbo-%E7%9A%84%E5%BE%AE%E6%A0%B8%E5%BF%83%E6%8F%92%E4%BB%B6%E5%BC%8F%E8%AE%BE%E8%AE%A1"><span class="nav-text">Dubbo 的微核心插件式设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A9%E5%85%85%E5%BC%8F%E6%89%A9%E5%B1%95%E4%B8%8E%E5%A2%9E%E9%87%8F%E5%BC%8F%E6%89%A9%E5%B1%95"><span class="nav-text">扩充式扩展与增量式扩展</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%9B%E5%8C%96%E5%BC%8F%E6%89%A9%E5%B1%95%E4%B8%8E%E7%BB%84%E5%90%88%E5%BC%8F%E6%89%A9%E5%B1%95"><span class="nav-text">泛化式扩展与组合式扩展</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-text">Dubbo 性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8C%96-Connections-%E5%8F%82%E6%95%B0"><span class="nav-text">优化 Connections 参数</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">756</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">54</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/bbace66e.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Dubbo2 巩固教程之五 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 Dubbo 的入门教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Dubbo2 巩固教程之五</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-09-25 23:42:35" itemprop="dateCreated datePublished" datetime="2019-09-25T23:42:35+08:00">2019-09-25</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-09-25 23:42:35" itemprop="dateModified" datetime="2025-09-25T23:42:35+08:00">2025-09-25</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/bbace66e.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/bbace66e.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>5.6k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>5 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/ef04d10a.html">Dubbo 2 巩固教程之一</a>、<a href="/posts/b6d5fbb8.html">Dubbo 2 巩固教程之二</a>、<a href="/posts/ea9ce835.html">Dubbo 2 巩固教程之三</a></li><li><a href="/posts/a64e842b.html">Dubbo 2 巩固教程之四</a>、<a href="/posts/bbace66e.html">Dubbo 2 巩固教程之五</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h3><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/incubator-dubbo/">Dubbo 官方项目（GitHub）</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/dubbo-samples">Dubbo 官方案例（GitHub）</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docsv2.7/">Dubbo 官方文档（2.7 版本）</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/docs/">Dubbo 官方文档（快照版本）</a></li><li><a target="_blank" rel="external nofollow" href="https://dubbo.apache.org/zh-cn/overview/">Dubbo 官方文档（最新版本）</a></li></ul><span id="more"></span><h2 id="Dubbo-设计原则"><a href="#Dubbo-设计原则" class="headerlink" title="Dubbo 设计原则"></a>Dubbo 设计原则</h2><h3 id="Dubbo-的整体架构"><a href="#Dubbo-的整体架构" class="headerlink" title="Dubbo 的整体架构"></a>Dubbo 的整体架构</h3><p><img data-src="../../../asset/2025/11/dubbo-principle-1.png"></p><h3 id="Dubbo-的功能性需求"><a href="#Dubbo-的功能性需求" class="headerlink" title="Dubbo 的功能性需求"></a>Dubbo 的功能性需求</h3><p><img data-src="../../../asset/2025/11/dubbo-principle-2.png"></p><h3 id="Dubbo-的非功能性需求"><a href="#Dubbo-的非功能性需求" class="headerlink" title="Dubbo 的非功能性需求"></a>Dubbo 的非功能性需求</h3><ul><li><p>Dubbo 发展之初遇到的问题</p><ul><li>随着 Dubbo 在阿里内部使用越来越火热，堆积的需求也越来越多，Dubbo 项目组人手不足。</li><li>Dubbo 项目外的人员希望也能加入进来丰富 Dubbo 生态，进行功能扩展开放，开闭原则（OCP）应声而出。</li></ul></li><li><p>Dubbo 的非功能性需求：开放扩展</p><ul><li>Dubbo 需要留一些扩展点，让项目参与者尽量黑盒扩展，而不是白盒的修改代码，否则分支、质量、合并、冲突都会很难管理。</li></ul></li></ul><h3 id="Dubbo-的微核心插件式设计"><a href="#Dubbo-的微核心插件式设计" class="headerlink" title="Dubbo 的微核心插件式设计"></a>Dubbo 的微核心插件式设计</h3><ul><li>Dubbo 是如何做到优雅的开放扩展<ul><li>微核心 + 插件式，平等对待第三方<ul><li>由一个插件生命周期管理容器构成微核心，核心不包括任何功能，这样可以确保所有功能都能被替换。</li><li>框架作者能做到的功能，扩展者也一定要能做到，以保证平等对待第三方。</li><li>因此，框架自身的功能也要用插件的方式实现，不能有任何硬编码。</li></ul></li><li>首先需要做的是统一扩展点的加载方式</li><li>然后考虑采用什么样的扩展点加载方式<ul><li>采用微核心 + 插件式架构。通常微核心会采用 Factory、IoC、OSGi 等方式管理插件生命周期。</li><li>Dubbo 最初曾考虑使用 Spring IoC 或自己实现一个 IoC 容器，但最终选择了采用 Factory 方式管理插件，并曾经使用 JDK 的 SPI 机制来实现 Factory。</li><li>因此，Dubbo 中曾有一个已被废弃的 <code>@Extension</code> 注解，最终被自己实现的 SPI 机制取代，也就是现在使用的 <code>@SPI</code> 注解。</li></ul></li></ul></li></ul><h3 id="扩充式扩展与增量式扩展"><a href="#扩充式扩展与增量式扩展" class="headerlink" title="扩充式扩展与增量式扩展"></a>扩充式扩展与增量式扩展</h3><p>在对一个原有的功能设计扩展方案时，常见有两类扩展方式：</p><ul><li><p>扩充式扩展：</p><ul><li>在原有实现上做增强，让新旧功能共用同一套代码路径。</li><li>新功能通过在原逻辑内 “兼容” 方式实现。</li><li>旧功能也会受到新逻辑影响，即使不需要，也会额外承担开销。</li></ul></li><li><p>增量式扩展：</p><ul><li>原功能保持简单、保持原有代码路径不变。</li><li>新功能以独立实现新增，不入侵旧逻辑。</li><li>使用者按需选择使用旧实现或新实现，互不干扰。</li></ul></li><li><p>举例，扩展一个 OSGI 序列化功能，要求功能明确，把流转成对象，对象转成流。</p><ul><li>扩充式扩展的做法：<ul><li>在原有序列化逻辑内部增加对 OSGi 序列化的支持。</li><li>无论是否需要 OSGi，都要先把 Stream 转成 <code>byte[]</code>，才能满足新逻辑的处理流程。</li><li>最终结果：<ul><li>新功能很容易实现，因为复用了旧逻辑。</li><li>但旧场景本来不需要额外的 <code>byte[]</code> 中间转换，却被迫付出了额外成本（性能损耗、内存占用增加等）。</li></ul></li><li>存在问题：<ul><li>旧功能为新功能背负了不必要的成本。</li></ul></li></ul></li><li>增量式扩展的做法：<ul><li>保留非 OSGi 的序列化代码，不改动、不增加额外中间步骤。</li><li>单独新增一个 OSGi 序列化实现，内部按 OSGi 规范自行处理。</li><li>若使用 OSGi 场景，则直接注入 / 依赖此实现即可。</li><li>实现好处：<ul><li>旧功能不变，成本不变，新功能独立，互不影响。</li></ul></li></ul></li></ul></li></ul><table><thead><tr><th>扩展方式</th><th>特点</th><th>代价</th><th>适用场景</th></tr></thead><tbody><tr><td>扩充式扩展</td><td>在原逻辑内兼容新功能，新旧走同一代码路径</td><td>旧功能被连带影响，性能可能下降</td><td>新功能非常轻量、对旧逻辑影响极小</td></tr><tr><td>增量式扩展</td><td>新旧逻辑独立实现，互不影响</td><td>需要维护多套实现</td><td>新功能对旧功能影响较大、开销较大，或不想污染旧逻辑</td></tr></tbody></table><h3 id="泛化式扩展与组合式扩展"><a href="#泛化式扩展与组合式扩展" class="headerlink" title="泛化式扩展与组合式扩展"></a>泛化式扩展与组合式扩展</h3><p>在设计一个可扩展系统时，常见有两类扩展思路：</p><ul><li><p>泛化式扩展</p><ul><li>定义：<ul><li>扩展点不断抽象化、泛化，将不同功能的要求都往同一个概念里塞。</li><li>本质是取所有功能的并集：新功能加入时，需要扩充原有抽象，使其能容纳更多概念。</li></ul></li><li>缺点：<ul><li>容易让扩展点逐渐臃肿。</li><li>新功能侵入原有核心模型，使系统越来越复杂。</li><li>许多 “非核心功能” 会被迫纳入核心抽象。</li></ul></li></ul></li><li><p>组合式扩展</p><ul><li>定义：<ul><li>将功能按职责正交拆分。</li><li>本质是取所有功能的交集，扩展点保持最小交集（最小必要抽象）。</li><li>新功能总是基于旧功能之上实现，通过组合、包装、链式调用等方式叠加，而不是修改核心抽象。</li></ul></li><li>优点：<ul><li>核心模型保持简洁稳定。</li><li>扩展功能彼此独立、可插拔。</li><li>系统不会因为扩展点膨胀而复杂化。</li></ul></li></ul></li></ul><table><thead><tr><th>扩展方式</th><th>特点</th><th>问题 / 优点</th></tr></thead><tbody><tr><td>泛化式扩展</td><td>抽象不断膨胀，取所有功能并集</td><td>模型臃肿，核心功能被污染</td></tr><tr><td>组合式扩展</td><td>抽象保持极简，通过包装 / 组合扩展</td><td>稳定、高内聚、可插拔、清晰分层</td></tr></tbody></table><ul><li>泛化式扩展存在的问题（以 Dubbo 为例）<ul><li>在 Dubbo 中，如果选择泛化式扩展的做法，就会尝试把各种周边能力都塞进一个 “核心模型” 里，例如：<ul><li>路由器（Router）</li><li>集群容错（Cluster）</li><li>负载均衡（LoadBalance）</li><li>服务发布者（Exporter）</li><li>服务订阅者（Directory）</li></ul></li><li>一旦把它们都视为 “核心功能”，结果就是：<ul><li>核心抽象过度膨胀</li><li>层次不清晰</li><li>新功能必须入侵原核心框架</li></ul></li><li> Dubbo 的正确做法：核心极简 + 分层组合<ul><li> Dubbo 的真正核心抽象并不包括上述能力</li><li> Dubbo 的核心包括三部分：<ul><li>Invoker<ul><li> 代表一个可调用体</li><li>是 Dubbo 的最小执行单元</li><li>类似 “函数指针”，统一抽象了调用逻辑</li></ul></li><li> Protocol<ul><li> 负责远程通信的协议栈</li><li>决定如何导出服务、如何引用服务</li></ul></li><li> Exporter<ul><li><code>Protocol.export()</code> 的结果</li><li>表示一个已经发布出去的、可被消费的服务</li></ul></li></ul></li><li>由此 Dubbo 形成两个主要层次：<ul><li>协议层（Protocol Layer）<ul><li>负责通信协议、序列化、网络传输等</li><li>核心抽象非常稳定：<code>Protocol + Invoker + Exporter</code></li></ul></li><li>路由层（Router Layer）<ul><li>在协议层之上进行组合式增强</li><li>路由、负载均衡、集群容错等都属于这一层</li><li>非核心能力都通过组合 Invoker 的方式增强，例如：<ul><li>Router → 过滤或选择部分 Invoker</li><li>LoadBalance → 根据负载均衡策略选择一个 Invoker</li><li>Cluster → 封装多 Invoker 提供集群容错能力</li><li> Filter → 链式增强一个 Invoker</li></ul></li><li> 因此，这些（路由、负载均衡、集群容错等）都不是 Dubbo 的核心，而是路由层的扩展能力</li></ul></li></ul></li></ul></li></ul></li></ul><div class="admonition note"><p class="admonition-title">总结</p><p>Dubbo 的设计哲学是典型的组合式扩展：核心最小化（<code>Protocol + Invoker + Exporter</code>），其他能力通过分层与组合的方式添加。</p></div><h2 id="Dubbo-性能优化"><a href="#Dubbo-性能优化" class="headerlink" title="Dubbo 性能优化"></a>Dubbo 性能优化</h2><h3 id="优化-Connections-参数"><a href="#优化-Connections-参数" class="headerlink" title="优化 Connections 参数"></a>优化 Connections 参数</h3><p><code>@DubboReference</code> 注解中的 <code>connections</code> 参数用于限制服务消费者对同一个服务提供者实例建立的长连接（TCP）数量，主要解决高并发场景下连接复用与网络资源占用的平衡问题。<strong>值得注意的是，<code>connections</code> 参数的默认值是 <code>0</code>，表示对于同一个 Provider JVM 实例，同一个服务接口的所有 Consumer 引用（如 <code>@DubboReference</code>）共享一个单一的长连接，而不同服务接口之间的 Consumer 引用（如 <code>@DubboReference</code>）会各自独立创建一个单一的长连接。</strong></p><div class="admonition warning"><p class="admonition-title">特别注意</p><p><strong>本节所提到的服务消费者（Consumer）通常不是指 JVM 进程级别的应用，而是指 Consumer 引用（如 <code>@DubboReference</code>），两者是一对多关系。参数 <code>connections</code> 的底层实现使用了 TCP 连接池，而 Dubbo 的 TCP 连接池是按服务接口维度进行隔离的，其唯一标识是 <code>serviceKey</code>（组成公式：<code>serviceKey = interface + version + group + protocol</code>），而不是按 Provider JVM 实例来隔离。举个例子，如果一个 Provider 暴露了 50 个接口，并且在 Consumer 引用（<code>@DubboReference</code>）中为每个服务接口都配置了 <code>connections = 1</code>，那么 Consumer 与这个 Provider 实例之间将建立 50 条物理 TCP 连接。</strong></p></div><ul><li><p><strong><code>connections</code> 参数的作用</strong></p><ul><li>在 Dubbo 中，服务消费者（Consumer）和服务提供者（Provider）之间使用长连接（TCP）进行通信。</li><li>默认情况下：<ul><li>对于消费者来说，同一个 Provider 实例只会建立一个 TCP 长连接，所有请求都复用这条连接，资源占用小，适用于业务流量不大的场景。</li><li>如果 <code>connections &gt; 0</code>，表示消费者会和每个 Provider 实例建立多个 TCP 长连接，并在请求时通过轮询或其他负载均衡算法选择具体的连接，适用于高并发或单连接成为性能瓶颈的场景。</li></ul></li><li>配置方式一（单独配置）：<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DubboReference(connections = 3)</span></span><br><span class="line"><span class="keyword">private</span> DemoService demoService;</span><br></pre></td></tr></tbody></table></figure></li><li>配置方式二（全局配置）：<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">consumer:</span></span><br><span class="line">    <span class="attr">connections:</span> <span class="number">3</span></span><br></pre></td></tr></tbody></table></figure></li></ul></li><li><p><strong><code>connections</code> 参数的使用场景</strong></p><ul><li>单连接足够的场景，不需要配置 <code>connections</code> 参数<ul><li>普通的业务接口调用，每次请求数据量不大，QPS 不高。</li><li>复用同一条 TCP 长连接，可以减少系统资源开销：<ul><li>文件描述符（FD）数量低</li><li>内核 TCP 连接管理压力小</li><li>减少 TCP 连接的心跳、握手等开销</li></ul></li><li>例子：<ul><li>每秒只有几百个请求，QPS 不高，单连接带宽也够用，就不需要配置 <code>connections</code> 参数。</li></ul></li></ul></li><li>多连接的场景，以下几种情况建议配置 <code>connections &gt; 1</code><ul><li>(1) 单连接带宽瓶颈<ul><li>如果请求数据量非常大，例如每次响应数据都在 1 MB 以上，那么单条连接可能会填满 TCP 窗口，阻塞后续请求。</li><li>表现症状：<ul><li>Dubbo 的 RPC 调用延迟突然增大</li><li>网络监控到单条 TCP 连接的带宽被打满，但 CPU 却空闲</li></ul></li><li>通过配置 <code>connections = 2 ~ 4</code>，可以分散流量，避免单连接成为性能瓶颈。</li></ul></li><li>(2) 串行化阻塞的问题<ul><li> Dubbo 的网络层默认基于 Netty 的 NIO，同一条连接上的请求是无序并发的，但如果：<ul><li>Provider 端是单线程处理请求，或者 Consumer 端串行发送请求；</li><li>可能出现请求阻塞队头（Head-of-line Blocking）。</li></ul></li><li>通过多个连接让请求分散处理，可以提升并发度。</li></ul></li><li>(3) Provider 实例数量少，但请求量大<ul><li>假设只有 2 个 Provider 实例，但 Consumer 的 QPS 很高，单个 TCP 连接无法支撑。</li><li>例子：<ul><li>Consumer 的总请求量达到 1 万 QPS；</li><li>如果每个 Provider 实例只有 2 个连接，实际单连接需要支持 5000 QPS，这很容易成为性能瓶颈。</li></ul></li></ul></li></ul></li></ul></li><li><p><strong><code>connections</code> 参数的调优建议</strong></p><ul><li>不随便更改配置<ul><li><code>connections</code> 参数的默认值是 <code>0</code>，表示对于同一个 Provider 实例，Consumer 只会建立一个 TCP 长连接。</li><li>不随便更改 <code>connections</code> 参数的值，先进行性能压测。</li></ul></li><li>如果发现：<ul><li>单连接的 RTT（往返时间）过高</li><li> TCP 窗口打满</li><li>请求阻塞</li><li> Provider 实例数量少且流量大<br>→ 可以逐步调高 <code>connections</code> 参数的值。</li></ul></li><li>监控 <code>ESTABLISHED</code> 状态的 TCP 连接数和文件描述符（FD）使用率，避免触发操作系统的 <code>ulimit</code> 限制。</li></ul></li><li><p><strong><code>connections</code> 参数的注意事项</strong></p><ul><li>连接池隔离机制<ul><li> Dubbo 的 TCP 连接池是按服务接口维度进行隔离的，其唯一标识是 <code>serviceKey</code>（组成公式：<code>serviceKey = interface + version + group + protocol</code>），而不是按 Provider JVM 实例来隔离。</li><li>对于每一个不同的 <code>serviceKey</code>，Consumer 端都会创建一个独立的客户端实例（如 NettyClient）来管理其连接，每个客户端实例会维护一个到对端服务提供者（Provider）的独立连接池。</li><li>即使两个服务接口由同一个 Provider 服务器提供，在 Consumer 端也会被视为两个不同的逻辑服务，并建立两套物理连接。</li><li>这样做的好处是不同接口可以独立配置连接数、超时等参数，避免接口间相互干扰，例如一个接口阻塞不会影响其他接口。</li></ul></li><li>连接池与物理连接的关系<ul><li>每个 <code>serviceKey</code> 对应的客户端实例（如 NettyClient）都会独立维护一个到对端 Provider 的连接池。</li><li>在默认配置 (<code>connections = 0</code>) 下，每个 <code>serviceKey</code> 的连接池内与同一个 Provider 地址之间会建立一条物理 TCP 长连接。</li></ul></li><li>配置的作用域与影响<ul><li><code>connections</code> 参数的作用范围是每个 <code>serviceKey</code> 到单个 Provider 地址。因此，即使是同一个 Provider 实例，其不同服务接口（不同 <code>serviceKey</code>）也不会共享 <code>connections</code> 配置所限定的连接。</li><li>举个例子：如果一个 Provider 暴露了 50 个接口，并且在 Consumer 引用（<code>@DubboReference</code>）中为每个服务接口都配置了 <code>connections = 1</code>，那么 Consumer 与这个 Provider 实例之间将建立 50 条物理 TCP 连接。</li></ul></li><li>潜在风险与配置建议<ul><li>这种设计带来了配置独立性和故障隔离的好处，但也意味着物理连接数会随着引用接口数量的增加而线性增长。</li><li>如果需要配置 <code>connections</code> 参数，建议配置 <code>connections = 2 ~ 4</code>，这样可以分散流量，避免单连接成为性能瓶颈。</li><li>如果为大量接口配置 <code>connections &gt; 1</code>，或者在高接口数的应用中，会快速消耗 Consumer 和 Provider 双方的系统资源（如文件描述符、内存、线程等），需要在高并发或大规模微服务架构中格外关注。</li></ul></li></ul></li><li><p><strong><code>connections</code> 参数的使用总结</strong></p></li></ul><table><thead><tr><th>项目</th><th>说明</th></tr></thead><tbody><tr><td>默认行为</td><td>对于 Consumer，同一个 Provider 实例只建立 1 条 TCP 长连接</td></tr><tr><td>设置 <code>connections &gt; 0</code></td><td>对于 Consumer，同一个 Provider 实例建立 N 条 TCP 长连接，缓解单连接的性能瓶颈</td></tr><tr><td>主要解决的问题</td><td>单连接带宽不足、请求阻塞、并发度不足的问题</td></tr><tr><td>底层网络实现</td><td>底层基于 Netty，多条 TCP 连接对应多个 <code>Channel</code>，通过 <code>ChannelPool</code> 轮询选择 TCP 连接</td></tr><tr><td>建议配置值</td><td><code>connections</code> 参数的值一般设置 2 ~ 4 已经够用，因此不要盲目设置太大，否则会浪费资源</td></tr><tr><td>连接建立的时机</td><td> Provider 的 TCP 连接是在 Consumer 启动、从注册中心获取到服务列表之后就会立即建立，不是在第一次发起 RPC 调用时才建立连接，这属于 “预热连接” 机制</td></tr></tbody></table><div class="admonition note"><p class="admonition-title">扩展阅读</p><ul><li><a href="/posts/b66ba452.html#%E8%BF%9E%E6%8E%A5%E6%8E%A7%E5%88%B6">Dubbo 连接控制的配置</a></li></ul></div><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/bbace66e.html" title="Dubbo2 巩固教程之五">https://www.techgrow.cn/posts/bbace66e.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag"><i class="fa fa-tag"></i> 微服务</a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a><a href="/tags/RPC/" rel="tag"><i class="fa fa-tag"></i> RPC</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/61c6d2c8s.html" rel="prev" title="Centos7 下 Flatpak 的安装与使用"><i class="fa fa-angle-left"></i> Centos7 下 Flatpak 的安装与使用</a></div><div class="post-nav-item"> <a href="/posts/5bd408ba.html" rel="next" title="Fedora30 构建 Flatpak 应用">Fedora30 构建 Flatpak 应用<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2.2m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">33:17</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/bbace66e.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>