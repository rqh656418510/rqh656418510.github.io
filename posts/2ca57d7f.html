<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 Kubernetes 的入门使用教程。"><meta property="og:type" content="article"><meta property="og:title" content="Kubernetes 入门教程之七"><meta property="og:url" content="https://www.techgrow.cn/posts/2ca57d7f.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 Kubernetes 的入门使用教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/k8s-helm-1.png"><meta property="article:published_time" content="2025-09-13T13:12:19.000Z"><meta property="article:modified_time" content="2025-09-13T13:12:19.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="容器化"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2025/09/k8s-helm-1.png"><link rel="canonical" href="https://www.techgrow.cn/posts/2ca57d7f.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/2ca57d7f.html","path":"posts/2ca57d7f.html","title":"Kubernetes 入门教程之七"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Kubernetes 入门教程之七 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kubernetes-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF"><span class="nav-text">Kubernetes 核心技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Helm"><span class="nav-text">Helm</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Helm-%E7%9A%84%E5%BC%95%E5%85%A5"><span class="nav-text">Helm 的引入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Helm-%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-text">Helm 的概念</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Helm-%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%98%E5%8C%96"><span class="nav-text">Helm 的版本变化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Helm-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%89%E8%A3%85"><span class="nav-text">Helm 客户端安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Helm-%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-text">Helm 的常用命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Helm-%E7%9A%84%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="nav-text">Helm 的使用案例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%AE%A1%E7%90%86%E5%91%98%E7%94%A8%E6%88%B7"><span class="nav-text">创建管理员用户</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%80%9A%E8%BF%87-Chart-%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8"><span class="nav-text">通过 Chart 部署应用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-Chart-%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="nav-text">自定义 Chart 配置信息</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Helm-%E6%9E%84%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84-Chart"><span class="nav-text">Helm 构建自定义的 Chart</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%89%E5%A4%A7%E6%A0%B8%E5%BF%83%E6%9E%84%E5%BB%BA%E6%AD%A5%E9%AA%A4"><span class="nav-text">三大核心构建步骤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Chart-%E7%9A%84%E6%9E%84%E5%BB%BA%E5%AE%89%E8%A3%85"><span class="nav-text">Chart 的构建安装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Chart-%E7%9A%84%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7"><span class="nav-text">Chart 的版本升级</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Chart-%E7%9A%84%E7%89%88%E6%9C%AC%E5%9B%9E%E6%BB%9A"><span class="nav-text">Chart 的版本回滚</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Helm-%E4%B8%AD-Chart-%E6%A8%A1%E6%9D%BF%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">Helm 中 Chart 模板的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Chart-%E6%A8%A1%E6%9D%BF%E7%9A%84%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D"><span class="nav-text">Chart 模板的简单介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Chart-%E6%A8%A1%E6%9D%BF%E7%9A%84%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="nav-text">Chart 模板的使用案例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Chart-%E6%A8%A1%E6%9D%BF%E7%9A%84%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7"><span class="nav-text">Chart 模板的调试技巧</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Chart-%E6%A8%A1%E6%9D%BF%E7%9A%84%E5%86%85%E7%BD%AE%E5%AF%B9%E8%B1%A1"><span class="nav-text">Chart 模板的内置对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Chart-%E6%A8%A1%E6%9D%BF%E7%9A%84-Values-%E5%AF%B9%E8%B1%A1"><span class="nav-text">Chart 模板的 Values 对象</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Chart-%E6%A8%A1%E6%9D%BF%E7%9A%84%E7%AE%A1%E9%81%93%E4%B8%8E%E5%87%BD%E6%95%B0"><span class="nav-text">Chart 模板的管道与函数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Chart-%E6%A8%A1%E6%9D%BF%E7%9A%84%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5"><span class="nav-text">Chart 模板的流程控制语句</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">744</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/2ca57d7f.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Kubernetes 入门教程之七 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 Kubernetes 的入门使用教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Kubernetes 入门教程之七</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-09-13 21:12:19" itemprop="dateCreated datePublished" datetime="2025-09-13T21:12:19+08:00">2025-09-13</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/2ca57d7f.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/2ca57d7f.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>7.5k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>7 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/99bf51b3.html">Kubernetes 入门教程之一</a>、<a href="/posts/c57e8370.html">Kubernetes 入门教程之二</a>、<a href="/posts/2722157d.html">Kubernetes 入门教程之三</a></li><li><a href="/posts/37a21b7b.html">Kubernetes 入门教程之四</a>、<a href="/posts/6bf07963.html">Kubernetes 入门教程之五</a>、<a href="/posts/76121b26.html">Kubernetes 入门教程之六</a></li><li><a href="/posts/2ca57d7f.html">Kubernetes 入门教程之七</a>、<a href="/posts/723af70c.html">Kubernetes 入门教程之八</a>、<a href="/posts/cfb1715d.html">Kubernetes 入门教程之九</a></li><li><a href="/posts/6158b4d2.html">Kubernetes 入门教程之十</a></li></ul><h2 id="Kubernetes-核心技术"><a href="#Kubernetes-核心技术" class="headerlink" title="Kubernetes 核心技术"></a>Kubernetes 核心技术</h2><h3 id="Helm"><a href="#Helm" class="headerlink" title="Helm"></a>Helm</h3><h4 id="Helm-的引入"><a href="#Helm-的引入" class="headerlink" title="Helm 的引入"></a>Helm 的引入</h4><p>在 Kubernetes 中，应用由特定的资源对象组成，如 Deployment、Service、Ingress 等。通常，这些资源的配置会分别保存在多个独立的 YAML 资源文件中，或集中写入一个 YAML 资源文件中，然后通过 <code>kubectl apply -f</code> 命令进行部署。对于只包含一个或少数几个服务的简单应用，这种方式已经足够。但对于复杂应用（例如微服务架构的系统），往往由十几个甚至数十个服务组成。如果需要更新或回滚应用，就必须修改和维护大量的 YAML 资源文件，这种分散式的管理方式显得十分低效。此外，由于缺乏对应用整体的版本管理与控制，Kubernetes 在应用的维护与更新方面面临以下主要问题：</p><ul><li>(1) YAML 资源文件难以实现高效复用；</li><li>(2) YAML 资源文件不支持应用级别的版本管理与回滚；</li><li>(3) 难以将多个服务作为一个整体进行统一管理。</li></ul><p>为此，Kubernetes 提供了 Helm 来解决上述问题。</p><h4 id="Helm-的概念"><a href="#Helm-的概念" class="headerlink" title="Helm 的概念"></a>Helm 的概念</h4><p>Helm 是 Kubernetes 的包管理工具，类似于 Linux 下的包管理器（如 <code>yum</code> 或 <code>apt</code>），可以方便地将预先打包好的 YAML 资源文件部署到 Kubernetes 集群中。Helm 主要包含以下三个核心概念：</p><ul><li>(1) <code>Helm</code>：命令行客户端工具，用于创建、打包、发布和管理 Kubernetes 应用的 Chart。</li><li>(2) <code>Chart</code>：应用的描述包，由一组用于定义 Kubernetes 资源的 YAML 资源文件组成。</li><li>(3) <code>Release</code>：基于 Chart 的部署实体。每当通过 Helm 部署一个 Chart 时，都会在 Kubernetes 集群中自动生成一个对应的 Release，用于表示实际运行的资源对象。</li></ul><h4 id="Helm-的版本变化"><a href="#Helm-的版本变化" class="headerlink" title="Helm 的版本变化"></a>Helm 的版本变化</h4><p>2019 年 11 月 13 日，Helm 团队发布 Helm <code>v3</code> 的第一个稳定版本。该版本的主要变化如下：</p><ul><li>(1) 最明显的变化是 Tiller 的删除</li><li> (2) Release 名称可以在不同命名空间中重用</li><li> (3) 支持将 Chart 推送至 Docker 镜像仓库中</li><li> (4) 使用 JSONSchema 验证 Chart Values</li><li>(5) 其他变化</li></ul><p>Helm <code>v2</code> 与 <code>v3</code> 版本的整体架构对比如下图所示：</p><p><img data-src="../../../asset/2025/09/k8s-helm-1.png"></p><h4 id="Helm-客户端安装"><a href="#Helm-客户端安装" class="headerlink" title="Helm 客户端安装"></a>Helm 客户端安装</h4><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>Helm 不同版本的客户端可以从 <a target="_blank" rel="external nofollow" href="https://github.com/helm/helm/releases">GitHub Releases</a> 下载得到。</li><li><strong>通常只需要在 Kubernetes 集群的 Master 节点上安装 Helm，其他 Worker 节点不需要安装 Helm。</strong></li></ul></div><blockquote><p>Helm 客户端的安装</p></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载压缩包</span></span><br><span class="line">wget https://get.helm.sh/helm-v3.2.1-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压压缩包</span></span><br><span class="line">tar<span class="params"> -zxvf</span> helm-v3.2.1-linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移动文件</span></span><br><span class="line">sudo mv linux-amd64/helm /usr/bin/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看版本</span></span><br><span class="line">helm version</span><br></pre></td></tr></tbody></table></figure><blockquote><p>Helm 客户端配置国内 Chart 仓库（存储库）</p></blockquote><ul><li><p>微软仓库：</p><ul><li>仓库地址：<code>http://mirror.azure.cn/kubernetes/charts</code></li><li>这个 Chart 仓库推荐使用，基本上 Kubernetes 官方仓库有的 Chart 它都有。</li></ul></li><li><p>阿里云仓库：</p><ul><li>仓库地址：<code>https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</code></li><li>这个 Chart 仓库国内可以正常访问。</li></ul></li><li><p>官方仓库：</p><ul><li>仓库地址：<code>https://hub.kubeapps.com/charts/incubator</code></li><li>Kubernetes 官方的 Chart 仓库，国内可能无法正常访问。</li></ul></li></ul><hr><ul><li>添加新的仓库</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加微软仓库</span></span><br><span class="line">helm repo add stable http://mirror.azure.cn/kubernetes/charts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加阿里云仓库</span></span><br><span class="line">helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新本地仓库索引</span></span><br><span class="line">helm repo update</span><br></pre></td></tr></tbody></table></figure><ul><li>查看已有的存储库</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看已添加的仓库列表</span></span><br><span class="line">helm repo list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在本地仓库中搜索名称包含 stable 的 Chart</span></span><br><span class="line">helm search repo stable</span><br></pre></td></tr></tbody></table></figure><ul><li>删除已有的存储库</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除名称为 aliyun 的仓库  </span></span><br><span class="line">helm repo remove aliyun</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新本地仓库索引</span></span><br><span class="line">helm repo update</span><br></pre></td></tr></tbody></table></figure><h4 id="Helm-的常用命令"><a href="#Helm-的常用命令" class="headerlink" title="Helm 的常用命令"></a>Helm 的常用命令</h4><blockquote><p>Chart 的三个核心命令</p></blockquote><ul><li><code>chart install</code>：安装一个新的 Chart，并在集群中创建对应的应用实例。</li><li><code>chart upgrade</code>：升级已安装的 Chart 到新版本或更新其配置。</li><li><code>chart rollback</code>：将已部署的 Chart 回滚到指定的历史版本。</li></ul><blockquote><p>Chart 的常用命令列表</p></blockquote><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td><code>create</code></td><td>创建一个 Chart 并指定名称</td></tr><tr><td><code>dependency</code></td><td>管理 Chart 依赖</td></tr><tr><td><code>get</code></td><td>下载一个 Release，可用于命令：<code>all</code>、<code>hooks</code>、<code>manifest</code>、<code>notes</code>、<code>values</code></td></tr><tr><td><code>history</code></td><td>获取 Release 历史</td></tr><tr><td><code>install</code></td><td>安装一个 Chart</td></tr><tr><td><code>list</code></td><td>列出 Release</td></tr><tr><td><code>package</code></td><td>将 Chart 目录打包到 Chart 存档文件中</td></tr><tr><td><code>pull</code></td><td>从远程仓库中下载 Chart 并解压到本地</td></tr><tr><td><code>repo</code></td><td>添加、列出、移除、更新和索引 Chart 仓库，可用于命令：<code>add</code>、<code>index</code>、<code>list</code>、<code>remove</code>、<code>update</code></td></tr><tr><td><code>rollback</code></td><td>从之前版本回滚</td></tr><tr><td><code>search</code></td><td>根据关键字搜索 Chart，可用于命令：<code>hub</code>、<code>repo</code></td></tr><tr><td><code>show</code></td><td>查看 Chart 的详细信息，可用于命令：<code>all</code>、<code>chart</code>、<code>readme</code>、<code>values</code></td></tr><tr><td><code>status</code></td><td>显示已命名版本的状态</td></tr><tr><td><code>template</code></td><td>本地呈现模板</td></tr><tr><td><code>uninstall</code></td><td>卸载一个 Release</td></tr><tr><td><code>upgrade</code></td><td>更新一个 Release</td></tr><tr><td><code>version</code></td><td>查看 Helm 客户端的版本</td></tr></tbody></table><h4 id="Helm-的使用案例"><a href="#Helm-的使用案例" class="headerlink" title="Helm 的使用案例"></a>Helm 的使用案例</h4><h5 id="创建管理员用户"><a href="#创建管理员用户" class="headerlink" title="创建管理员用户"></a>创建管理员用户</h5><div class="admonition note"><p class="admonition-title">提示</p><p>本节将演示如何在 Kubernetes 集群中创建管理员用户，否则在后续使用 Helm 时，可能无法正常访问 Kubernetes 资源，比如执行 <code>helm install</code> 命令会出现错误：<code>Error: Kubernetes cluster unreachable</code>。</p></div><ul><li>通过 YAML 文件（比如 <code>admin-user-sa.yaml</code>）创建管理员用户 <code>admin-user</code></li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply<span class="params"> -f</span> admin-user-sa.yaml</span><br></pre></td></tr></tbody></table></figure><ul><li>通过 YAML 文件（比如 <code>admin-user-rolebinding.yaml</code>）给管理员用户 <code>admin-user</code> 授权</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user-binding</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cluster-admin</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply<span class="params"> -f</span> admin-user-rolebinding.yaml</span><br></pre></td></tr></tbody></table></figure><ul><li>获取管理员用户 <code>admin-user</code> 的 Token</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SECRET_NAME=$(kubectl get sa admin-user<span class="params"> -n</span> kube-system<span class="params"> -o</span> jsonpath=<span class="string">"{.secrets[0].name}"</span>)</span><br><span class="line"></span><br><span class="line">kubectl get secret <span class="variable">$SECRET_NAME</span><span class="params"> -n</span> kube-system<span class="params"> -o</span> jsonpath=<span class="string">"{.data.token}"</span> | base64<span class="params"> --decode</span></span><br></pre></td></tr></tbody></table></figure><ul><li>获取 Kubernetes 集群 CA 证书的 Base64 编码（<strong>请自行更改 CA 证书的路径</strong>）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /opt/kubernetes/ssl/ca.pem | base64<span class="params"> -w</span> 0</span><br></pre></td></tr></tbody></table></figure><ul><li>创建一个 kubeconfig 文件（比如 <code>admin-user.kubeconfig</code>）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建配置目录（可自定义）</span></span><br><span class="line">mkdir<span class="params"> -p</span> /opt/kubernetes/cfg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建并编辑文件，写入以下 YAML 配置内容</span></span><br><span class="line">vim /opt/kubernetes/cfg/admin-user.kubeconfig</span><br></pre></td></tr></tbody></table></figure><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Config</span></span><br><span class="line"><span class="attr">clusters:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">cluster:</span></span><br><span class="line">    <span class="attr">server:</span> <span class="string">https://&lt;IP&gt;:6443</span>                       <span class="comment">#  填写 API Server 的 IP 地址和端口</span></span><br><span class="line">    <span class="attr">certificate-authority-data:</span> <span class="string">&lt;CA_CERT_BASE64&gt;</span>    <span class="comment">#  填写 K8s 集群 CA 证书的 Base64 编码</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kubernetes</span></span><br><span class="line"><span class="attr">contexts:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">context:</span></span><br><span class="line">    <span class="attr">cluster:</span> <span class="string">kubernetes</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">admin-user</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">admin-context</span></span><br><span class="line"><span class="attr">current-context:</span> <span class="string">admin-context</span></span><br><span class="line"><span class="attr">users:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">admin-user</span></span><br><span class="line">  <span class="attr">user:</span></span><br><span class="line">    <span class="attr">token:</span> <span class="string">&lt;TOKEN&gt;</span>      <span class="comment"># 填写管理员用户的 Token</span></span><br></pre></td></tr></tbody></table></figure><ul><li>验证 kubeconfig 文件（比如 <code>admin-user.kubeconfig</code>）是否可以正常使用</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc<span class="params"> --kubeconfig</span>=/opt/kubernetes/cfg/admin-user.kubeconfig</span><br></pre></td></tr></tbody></table></figure><ul><li>添加系统环境变量 <code>KUBECONFIG</code>（可选步骤）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加系统环境变量</span></span><br><span class="line"><span class="built_in">export</span> KUBECONFIG=/opt/kubernetes/cfg/admin-user.kubeconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># 之后就可以直接访问 K8s 资源了，不再需要通过 "--kubeconfig" 参数指定 kubeconfig 文件</span></span><br><span class="line">kubectl get svc</span><br></pre></td></tr></tbody></table></figure><h5 id="通过-Chart-部署应用"><a href="#通过-Chart-部署应用" class="headerlink" title="通过 Chart 部署应用"></a>通过 Chart 部署应用</h5><div class="admonition note"><p class="admonition-title">提示</p><ul><li>本节将演示如何使用 Chart 快速部署应用（比如 Weave，这是 Kubernetes 集群可视化与监控工具）。</li></ul></div><div class="admonition warning"><p class="admonition-title">注意</p><ul><li>如果 <code>helm</code> 命令执行失败，并提示错误信息 <code>Error: Kubernetes cluster unreachable</code>，可以参考以下任意一种方案来解决：</li><li>(1) 尝试往 <code>helm</code> 命令的末尾添加参数 <code>--kubeconfig=/opt/kubernetes/cfg/admin-user.kubeconfig</code>。</li><li>(2) 通过 <code>export KUBECONFIG=/opt/kubernetes/cfg/admin-user.kubeconfig</code> 命令添加对应的环境变量。</li></ul></div><ul><li>搜索指定的 Chart</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm search repo weave</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NAME              	CHART VERSION	APP VERSION	DESCRIPTION                                       </span><br><span class="line">aliyun/weave-cloud	0.1.2        	           	Weave Cloud is a add-on to Kubernetes which pro...</span><br><span class="line">aliyun/weave-scope	0.9.2        	1.6.5      	A Helm chart for the Weave Scope cluster visual...</span><br><span class="line">stable/weave-cloud	0.3.9        	1.4.0      	DEPRECATED - Weave Cloud is a add-on to Kuberne...</span><br><span class="line">stable/weave-scope	1.1.12       	1.12.0     	DEPRECATED - A Helm chart for the Weave Scope c...</span><br></pre></td></tr></tbody></table></figure><ul><li>查看指定 Chart 的详细信息</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm show chart stable/weave-scope</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">appVersion: 1.12.0</span><br><span class="line">deprecated: true</span><br><span class="line">description: DEPRECATED - A Helm chart for the Weave Scope cluster visualizer.</span><br><span class="line">home: https://www.weave.works/oss/scope/</span><br><span class="line">icon: https://avatars1.githubusercontent.com/u/9976052?s=64</span><br><span class="line">keywords:</span><br><span class="line">- containers</span><br><span class="line">- dashboard</span><br><span class="line">- monitoring</span><br><span class="line">name: weave-scope</span><br><span class="line">sources:</span><br><span class="line">- https://github.com/weaveworks/scope</span><br><span class="line">version: 1.1.12</span><br></pre></td></tr></tbody></table></figure><ul><li>安装指定的 Chart</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install ui stable/weave-scope</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">NAME: ui</span><br><span class="line">LAST DEPLOYED: Tue Oct 28 20:17:33 2025</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">NOTES:</span><br><span class="line">You should now be able to access the Scope frontend in your web browser, by</span><br><span class="line">using kubectl port-forward:</span><br><span class="line"></span><br><span class="line">kubectl -n default port-forward $(kubectl -n default get endpoints \</span><br><span class="line">ui-weave-scope -o jsonpath='{.subsets[0].addresses[0].targetRef.name}') 8080:4040</span><br><span class="line"></span><br><span class="line">then browsing to http://localhost:8080/.</span><br><span class="line">For more details on using Weave Scope, see the Weave Scope documentation:</span><br><span class="line"></span><br><span class="line">https://www.weave.works/docs/scope/latest/introducing/</span><br></pre></td></tr></tbody></table></figure><ul><li>查看发布（Release）的列表</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm list</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME	NAMESPACE	REVISION	UPDATED                                	STATUS  	CHART             	APP VERSION</span><br><span class="line">ui  	default  	1       	2025-10-28 20:17:33.899483553 +0800 CST	deployed	weave-scope-1.1.12	1.12.0  </span><br></pre></td></tr></tbody></table></figure><ul><li>查看指定发布（Release）的详细信息</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm status ui</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">NAME: ui</span><br><span class="line">LAST DEPLOYED: Tue Oct 28 20:17:33 2025</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">NOTES:</span><br><span class="line">You should now be able to access the Scope frontend in your web browser, by</span><br><span class="line">using kubectl port-forward:</span><br><span class="line"></span><br><span class="line">kubectl -n default port-forward $(kubectl -n default get endpoints \</span><br><span class="line">ui-weave-scope -o jsonpath='{.subsets[0].addresses[0].targetRef.name}') 8080:4040</span><br><span class="line"></span><br><span class="line">then browsing to http://localhost:8080/.</span><br><span class="line">For more details on using Weave Scope, see the Weave Scope documentation:</span><br><span class="line"></span><br><span class="line">https://www.weave.works/docs/scope/latest/introducing/</span><br></pre></td></tr></tbody></table></figure><ul><li>查看所有 Pod 的运行状态</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">NAME                                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">weave-scope-agent-ui-lw2lf                      1/1     Running   0          35s</span><br><span class="line">weave-scope-agent-ui-nn4vs                      1/1     Running   0          35s</span><br><span class="line">weave-scope-agent-ui-pzqgk                      1/1     Running   0          35s</span><br><span class="line">weave-scope-agent-ui-qbcvm                      1/1     Running   0          35s</span><br><span class="line">weave-scope-cluster-agent-ui-5cbc84db49-4wvvt   1/1     Running   0          35s</span><br><span class="line">weave-scope-frontend-ui-6698fd5545-4lpl9        1/1     Running   0          35s</span><br></pre></td></tr></tbody></table></figure><ul><li>查看所有 Service</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NAME             TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubernetes       ClusterIP   10.0.0.1     &lt;none&gt;        443/TCP   86d</span><br><span class="line">ui-weave-scope   ClusterIP   10.0.0.64    &lt;none&gt;        80/TCP    78s</span><br></pre></td></tr></tbody></table></figure><ul><li>若希望在 Kubernetes 集群外部访问 Weave，可以更改 Service 的类型</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑 Service 的配置，更改 type 参数，保存退出后自动生效</span></span><br><span class="line">kubectl edit svc ui-weave-scope</span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  clusterIP: 10.0.0.64</span><br><span class="line">  ports:</span><br><span class="line">  - name: http</span><br><span class="line">    port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: http</span><br><span class="line">  selector:</span><br><span class="line">    app: weave-scope</span><br><span class="line">    component: frontend</span><br><span class="line">    release: ui</span><br><span class="line">  sessionAffinity: None</span><br><span class="line">  <span class="built_in">type</span>: NodePort      <span class="comment"># 将 Service 的类型更改为 NodePort</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看所有 Service，获取节点暴露的端口</span></span><br><span class="line">kubectl get svc</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NAME             TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">kubernetes       ClusterIP   10.0.0.1     &lt;none&gt;        443/TCP        86d</span><br><span class="line">ui-weave-scope   NodePort    10.0.0.64    &lt;none&gt;        80:31764/TCP   6m4s</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">最后通过任意一个集群节点的 IP 与 Service 对外暴露的端口（比如 `http://192.168.2.191:31764`），就可以在 Kubernetes 集群外部通过浏览器访问 Weave 的 Web 控制台页面</span><br></pre></td></tr></tbody></table></figure><ul><li>若希望卸载前面所安装的 Chart，可以执行以下命令</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接删除 Chart，默认不会删除关联的 PVC（数据卷）</span></span><br><span class="line">helm uninstall ui</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果需要删除 Chart 关联的 PVC（数据卷），可以执行以下命令</span></span><br><span class="line">kubectl delete pvc<span class="params"> -l</span> release=ui</span><br></pre></td></tr></tbody></table></figure><h5 id="自定义-Chart-配置信息"><a href="#自定义-Chart-配置信息" class="headerlink" title="自定义 Chart 配置信息"></a>自定义 Chart 配置信息</h5><div class="admonition note"><p class="admonition-title">提示</p><p>本节将演示如何在安装 Chart 之前，自定义 Chart 的配置信息，目的是覆盖 Chart 的默认配置信息。</p></div><div class="admonition warning"><p class="admonition-title">注意</p><ul><li>如果 <code>helm</code> 命令执行失败，并提示错误信息 <code>Error: Kubernetes cluster unreachable</code>，可以参考以下任意一种方案来解决：</li><li>(1) 尝试往 <code>helm</code> 命令的末尾添加参数 <code>--kubeconfig=/opt/kubernetes/cfg/admin-user.kubeconfig</code>。</li><li>(2) 通过 <code>export KUBECONFIG=/opt/kubernetes/cfg/admin-user.kubeconfig</code> 命令添加对应的环境变量。</li></ul></div><p>自定义 Chart 配置信息的原因在于，Chart 仓库中并非所有 Chart 都能在默认配置下成功运行，有时需要根据环境提供额外依赖，例如 <code>PVC</code>（数据卷）。因此，需要在安装 Chart 前自定义配置信息，主要有以下两种配置信息传递方式：</p><ul><li><p><code>--values</code> 或 <code>-f</code></p><ul><li>指定一个包含覆盖配置信息的 YAML 文件。</li><li>可以指定多个 YAML 文件，右边的 YAML 文件优先级更高。</li></ul></li><li><p><code>--set</code></p><ul><li>直接在命令行中指定覆盖配置信息。</li><li>当同时使用 <code>--values</code> 与 <code>--set</code> 时，<code>--set</code> 的优先级更高。</li><li>YAML 与 <code>--set</code> 配置格式的对比请看 <a href="../../../asset/2025/09/k8s-helm-2.png">这里</a>。</li></ul></li></ul><hr><ul><li>查看指定 Chart 的默认配置信息</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm show values stable/mysql</span><br></pre></td></tr></tbody></table></figure><ul><li>创建 YAML 配置文件，用于覆盖 Chart 的默认配置信息</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim mysql-server-config.yaml</span><br></pre></td></tr></tbody></table></figure><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">persistence:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span>                          <span class="comment"># 关闭持久化存储</span></span><br><span class="line"><span class="attr">mysqlUser:</span> <span class="string">"k8s"</span>                          <span class="comment"># 自定义 MySQL 用户名</span></span><br><span class="line"><span class="attr">mysqlPassword:</span> <span class="string">"123456"</span>                   <span class="comment"># 自定义 MySQL 密码</span></span><br><span class="line"><span class="attr">mysqlDatabase:</span> <span class="string">"k8s"</span>                      <span class="comment"># 自定义创建的数据库名称</span></span><br></pre></td></tr></tbody></table></figure><ul><li>安装指定的 Chart，并覆盖默认配置</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm install mysql-server<span class="params"> -f</span> mysql-server-config.yaml stable/mysql</span><br></pre></td></tr></tbody></table></figure><ul><li>查看所有 Pod 的运行状态</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME                           READY   STATUS    RESTARTS   AGE</span><br><span class="line">mysql-server-9c7558dc8-rb89z   0/1     Running   0          15s</span><br></pre></td></tr></tbody></table></figure><ul><li>查看所有 Service</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc</span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NAME           TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">kubernetes     ClusterIP   10.0.0.1     &lt;none&gt;        443/TCP    86d</span><br><span class="line">mysql-server   ClusterIP   10.0.0.4     &lt;none&gt;        3306/TCP   88s</span><br></pre></td></tr></tbody></table></figure><ul><li>验证 Chart 的安装</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动一个临时容器并连接进去，--rm 参数表示退出后会自动销毁容器</span></span><br><span class="line">kubectl run<span class="params"> -it</span> mysql-client<span class="params"> --rm</span><span class="params"> --restart</span>=Never<span class="params"> --image</span>=mysql:5.7 -- bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在临时容器的内部登录 MySQL（可以通过 Service 的名称直接访问 MySQL Server，前提是在同一个命名空间，且安装了 CoreDNS）</span></span><br><span class="line">mysql<span class="params"> -hmysql</span>-server<span class="params"> -uk8s</span><span class="params"> -p123456</span></span><br></pre></td></tr></tbody></table></figure><h4 id="Helm-构建自定义的-Chart"><a href="#Helm-构建自定义的-Chart" class="headerlink" title="Helm 构建自定义的 Chart"></a>Helm 构建自定义的 Chart</h4><div class="admonition note"><p class="admonition-title">提示</p><p>本节将演示如何构建一个自己的 Chart（比如，用于部署 Nginx 的 Chart），并将其安装和打包。</p></div><h5 id="三大核心构建步骤"><a href="#三大核心构建步骤" class="headerlink" title="三大核心构建步骤"></a>三大核心构建步骤</h5><p>Kubernetes 支持用户构建（开发）自己的 Chart，核心的构建步骤如下：</p><ul><li><p>(1) 创建 Chart 基础模板</p><ul><li>使用 <code>helm create &lt;chart-name&gt;</code> 命令创建基础模板。</li></ul></li><li><p>(2) 更改 Chart 配置文件</p><ul><li>编辑 <code>Chart.yaml</code> 文件，填写应用名称、版本、描述等信息。</li><li>编辑 <code>values.yaml</code> 文件，添加常用变量和默认值，用于自定义配置。</li></ul></li><li><p>(3) 创建 Chart 模板文件</p><ul><li>在自动生成的 <code>templates</code> 目录下，创建或编辑部署应用所需的 YAML 文件（如 Deployment、Service、Ingress 等）。</li><li>在 YAML 文件中，可以使用变量引用经常变化的字段，支持从 <code>values.yaml</code> 文件中获取动态值，比如 <code>replicas: {{ .Values.replicas }}</code>。</li></ul></li></ul><h5 id="Chart-的构建安装"><a href="#Chart-的构建安装" class="headerlink" title="Chart 的构建安装"></a>Chart 的构建安装</h5><blockquote><p>(1) 构建自定义的 Chart</p></blockquote><ul><li>创建一个 Chart，自动生成 Chart 的模板文件（YAML 配置文件）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm create nginx</span><br></pre></td></tr></tbody></table></figure><ul><li>查看自动生成的目录结构</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tree nginx/</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">nginx/</span><br><span class="line">├── charts</span><br><span class="line">├── Chart.yaml</span><br><span class="line">├── templates</span><br><span class="line">│&nbsp;&nbsp; ├── deployment.yaml</span><br><span class="line">│&nbsp;&nbsp; ├── _helpers.tpl</span><br><span class="line">│&nbsp;&nbsp; ├── hpa.yaml</span><br><span class="line">│&nbsp;&nbsp; ├── ingress.yaml</span><br><span class="line">│&nbsp;&nbsp; ├── NOTES.txt</span><br><span class="line">│&nbsp;&nbsp; ├── serviceaccount.yaml</span><br><span class="line">│&nbsp;&nbsp; ├── service.yaml</span><br><span class="line">│&nbsp;&nbsp; └── tests</span><br><span class="line">│&nbsp;&nbsp;     └── test-connection.yaml</span><br><span class="line">└── values.yaml</span><br></pre></td></tr></tbody></table></figure><table><thead><tr><th>文件 / 目录名</th><th>类型</th><th>描述</th><th>主要作用</th></tr></thead><tbody><tr><td><code>charts/</code></td><td>目录</td><td>存放 Chart 依赖的所有子 Chart</td><td> 管理当前 Chart 所依赖的其他 Chart，支持复杂的应用依赖关系</td></tr><tr><td><code>Chart.yaml</code></td><td>文件</td><td>描述 Chart 的基本信息</td><td>定义 Chart 的名称、描述、版本、依赖关系等元数据</td></tr><tr><td><code>values.yaml</code></td><td>文件</td><td>存储模板文件中使用的变量值</td><td>提供用户可配置的参数默认值，支持部署时的自定义配置</td></tr><tr><td><code>templates/</code></td><td>目录</td><td>存放所有 YAML 模板文件</td><td>包含 Kubernetes 资源清单模板，如 Deployment、Service、ConfigMap 等</td></tr><tr><td><code>NOTES.txt</code></td><td>文件</td><td>介绍 Chart 的帮助信息</td><td>在 <code>helm install</code> 部署后展示给用户，包含使用指南和默认设置说明</td></tr><tr><td><code>_helpers.tpl</code></td><td>文件</td><td>放置模板助手的地方</td><td>定义可以在整个 Chart 中重复使用的模板片段或函数，提高模板代码的复用性和可维护性</td></tr></tbody></table><ul><li>删除自动生成的 Chart 模板文件（可选步骤）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm<span class="params"> -rf</span> nginx/templates/*</span><br></pre></td></tr></tbody></table></figure><ul><li>编辑 Chart 的 <code>Chart.yaml</code> 文件，定义 Chart 的名称、描述、版本等信息</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nginx/Chart.yaml</span><br></pre></td></tr></tbody></table></figure><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v2</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">A</span> <span class="string">custom</span> <span class="string">Helm</span> <span class="string">chart</span> <span class="string">for</span> <span class="string">nginx</span> <span class="string">application</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">application</span></span><br><span class="line"><span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">appVersion:</span> <span class="number">1.15</span></span><br></pre></td></tr></tbody></table></figure><ul><li>创建或编辑 Chart 的模板文件 <code>deployment.yaml</code>，定义要创建的 Deployment</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nginx/templates/deployment.yaml</span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deploy</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx-pod</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx-pod</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - name: nginx</span><br><span class="line">          image: nginx:1.15</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 80</span><br></pre></td></tr></tbody></table></figure><ul><li>创建或编辑 Chart 的模板文件 <code>service.yaml</code>，定义要创建的 Service</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nginx/templates/service.yaml</span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx-pod</span><br><span class="line">  name: nginx-svc</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 80</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx-pod</span><br><span class="line">  <span class="built_in">type</span>: NodePort</span><br></pre></td></tr></tbody></table></figure><blockquote><p>(2) 安装自定义的 Chart</p></blockquote><ul><li>安装自定义的 Chart</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里的 web 是 Release 的名称</span></span><br><span class="line">helm install web nginx/</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NAME: web</span><br><span class="line">LAST DEPLOYED: Wed Oct 13 21:10:20 2025</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br></pre></td></tr></tbody></table></figure><ul><li>还可以将自定义的 Chart 打包成 <code>.tgz</code> 压缩包，共享给别人使用</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm package nginx/</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx-1.0.0.tgz</span><br></pre></td></tr></tbody></table></figure><ul><li>查看实际的 Chart 模板被渲染过后的 YAML 资源文件</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里的 web 是 Release 的名称</span></span><br><span class="line">helm get manifest web</span><br></pre></td></tr></tbody></table></figure><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx/templates/service.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-svc</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx/templates/deployment.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deploy</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx:1.15</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>(3) 验证自定义的 Chart</p></blockquote><ul><li>查看发布（Release）的列表</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm list</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME	NAMESPACE	REVISION	UPDATED                                	STATUS  	CHART      	APP VERSION</span><br><span class="line">web 	default  	1       	2025-10-13 21:10:20.593922287 +0800 CST	deployed	nginx-1.0.0	1.15      </span><br></pre></td></tr></tbody></table></figure><ul><li>查看所有 Pod 的运行状态</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-deploy-85b7dd6b6d-2dswj   1/1     Running   0          104s</span><br></pre></td></tr></tbody></table></figure><ul><li>查看所有 Service</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">kubernetes   ClusterIP   10.0.0.1     &lt;none&gt;        443/TCP        86d</span><br><span class="line">nginx-svc    NodePort    10.0.0.150   &lt;none&gt;        80:32377/TCP   2m20s</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">最后通过任意一个集群节点的 IP 与 Service 对外暴露的端口（比如 `http://192.168.2.191:32377`），就可以在 Kubernetes 集群外部通过浏览器访问 Nginx 的首页面</span><br></pre></td></tr></tbody></table></figure><h5 id="Chart-的版本升级"><a href="#Chart-的版本升级" class="headerlink" title="Chart 的版本升级"></a>Chart 的版本升级</h5><ul><li>在 Chart 安装（发布）后，如果 Chart 的模板文件发生了变更，可以执行以下命令对已部署的应用进行升级</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里 web 是 Release 的名称</span></span><br><span class="line">helm upgrade web nginx/</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Release "web" has been upgraded. Happy Helming!</span><br><span class="line">NAME: web</span><br><span class="line">LAST DEPLOYED: Wed Oct 13 21:37:23 2025</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 2</span><br><span class="line">TEST SUITE: None</span><br></pre></td></tr></tbody></table></figure><ul><li>或者使用 <code>-</code> 参数进行升级（指定包含覆盖配置信息的 YAML 文件）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里 web 是 Release 的名称</span></span><br><span class="line">helm upgrade<span class="params"> -f</span> values.yaml web nginx/</span><br></pre></td></tr></tbody></table></figure><ul><li>或者使用 <code>--set</code> 参数进行升级（直接传入参数值）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里 web 是 Release 的名称</span></span><br><span class="line">helm upgrade<span class="params"> --set</span> imageTag=1.17 web nginx/</span><br></pre></td></tr></tbody></table></figure><h5 id="Chart-的版本回滚"><a href="#Chart-的版本回滚" class="headerlink" title="Chart 的版本回滚"></a>Chart 的版本回滚</h5><div class="admonition note"><p class="admonition-title">提示</p><p>在 Chart 安装（发布）后，如果没有达到预期的效果，则可以使用 <code>helm rollback</code> 将 Release 回滚到之前的版本。</p></div><ul><li>查看 Release 的列表</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm list</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME	NAMESPACE	REVISION	UPDATED                                	STATUS  	CHART      	APP VERSION</span><br><span class="line">web 	default  	1       	2025-10-13 21:10:20.593922287 +0800 CST	deployed	nginx-1.0.0	1.15      </span><br></pre></td></tr></tbody></table></figure><ul><li>查看指定 Release 的历史版本</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里的 web 是 Release 的名称</span></span><br><span class="line">helm <span class="built_in">history</span> web</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REVISION	UPDATED                 	STATUS    	CHART      	APP VERSION	DESCRIPTION     </span><br><span class="line">1       	Wed Oct 13 21:10:20 2025	superseded	nginx-1.0.0	1.15       	Install complete</span><br><span class="line">2       	Wed Oct 13 21:23:26 2025	deployed  	nginx-1.0.0	1.15       	Upgrade complete</span><br></pre></td></tr></tbody></table></figure><ul><li>将 Release 回滚到指定的历史版本</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里的 web 是 Release 的名称，1 是要 Release 回滚到的历史版本号</span></span><br><span class="line">helm rollback web 1</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 Release 的版本是否成功回滚</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里的 web 是 Release 的名称</span></span><br><span class="line">helm status web</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NAME: web</span><br><span class="line">LAST DEPLOYED: Wed Oct 13 21:31:56 2025</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 3</span><br><span class="line">TEST SUITE: None</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">推送 Chart 到仓库</p><p>对于自定义的 Chart，除了可以打包成 <code>.tgz</code> 压缩包，还可以将其推送到 Chart 仓库（如 Harbor、ChartMuseum 等），详细的推送步骤可以参考网上的资料，这里不再累述。</p></div><h4 id="Helm-中-Chart-模板的使用"><a href="#Helm-中-Chart-模板的使用" class="headerlink" title="Helm 中 Chart 模板的使用"></a>Helm 中 Chart 模板的使用</h4><h5 id="Chart-模板的简单介绍"><a href="#Chart-模板的简单介绍" class="headerlink" title="Chart 模板的简单介绍"></a>Chart 模板的简单介绍</h5><p>Helm 的核心在于模板化的 Kubernetes Manifests 文件，这些模板本质上是基于 Go Template 的模板文件。在原生 Go 模板语法的基础上，Helm 还扩展了许多功能，例如：</p><ul><li>自定义的元数据定义（如 <code>Chart.yaml</code>）</li><li>内置函数库和模板函数</li><li>类似编程语言的控制语句（如条件判断、循环、管道等）</li></ul><p>这些扩展使模板具备了强大的灵活性和复用性。为了将用户的具体配置与模板结合，Helm 使用 <code>values.yaml</code> 文件来提供参数化的配置数据。</p><div class="admonition note"><p class="admonition-title">提示</p><p>模板文件与 <code>values</code> 文件的结合，这就是 Helm Chart 的核心机制 —— 通过模板化 + 参数化的方式，实现 Kubernetes 应用的灵活部署与管理。</p></div><h5 id="Chart-模板的使用案例"><a href="#Chart-模板的使用案例" class="headerlink" title="Chart 模板的使用案例"></a>Chart 模板的使用案例</h5><blockquote><p>(1) 构建自定义的 Chart</p></blockquote><ul><li>创建一个 Chart，自动生成 Chart 的模板文件（YAML 配置文件）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm create nginx</span><br></pre></td></tr></tbody></table></figure><ul><li>查看自动生成的目录结构</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tree nginx/</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">nginx/</span><br><span class="line">├── charts</span><br><span class="line">├── Chart.yaml</span><br><span class="line">├── templates</span><br><span class="line">│&nbsp;&nbsp; ├── deployment.yaml</span><br><span class="line">│&nbsp;&nbsp; ├── _helpers.tpl</span><br><span class="line">│&nbsp;&nbsp; ├── hpa.yaml</span><br><span class="line">│&nbsp;&nbsp; ├── ingress.yaml</span><br><span class="line">│&nbsp;&nbsp; ├── NOTES.txt</span><br><span class="line">│&nbsp;&nbsp; ├── serviceaccount.yaml</span><br><span class="line">│&nbsp;&nbsp; ├── service.yaml</span><br><span class="line">│&nbsp;&nbsp; └── tests</span><br><span class="line">│&nbsp;&nbsp;     └── test-connection.yaml</span><br><span class="line">└── values.yaml</span><br></pre></td></tr></tbody></table></figure><table><thead><tr><th>文件 / 目录名</th><th>类型</th><th>描述</th><th>主要作用</th></tr></thead><tbody><tr><td><code>charts/</code></td><td>目录</td><td>存放 Chart 依赖的所有子 Chart</td><td> 管理当前 Chart 所依赖的其他 Chart，支持复杂的应用依赖关系</td></tr><tr><td><code>Chart.yaml</code></td><td>文件</td><td>描述 Chart 的基本信息</td><td>定义 Chart 的名称、描述、版本、依赖关系等元数据</td></tr><tr><td><code>values.yaml</code></td><td>文件</td><td>存储模板文件中使用的变量值</td><td>提供用户可配置的参数默认值，支持部署时的自定义配置</td></tr><tr><td><code>templates/</code></td><td>目录</td><td>存放所有 YAML 模板文件</td><td>包含 Kubernetes 资源清单模板，如 Deployment、Service、ConfigMap 等</td></tr><tr><td><code>NOTES.txt</code></td><td>文件</td><td>介绍 Chart 的帮助信息</td><td>在 <code>helm install</code> 部署后展示给用户，包含使用指南和默认设置说明</td></tr><tr><td><code>_helpers.tpl</code></td><td>文件</td><td>放置模板助手的地方</td><td>定义可以在整个 Chart 中重复使用的模板片段或函数，提高模板代码的复用性和可维护性</td></tr></tbody></table><ul><li>删除自动生成的 Chart 模板文件（可选步骤）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm<span class="params"> -rf</span> nginx/templates/*</span><br></pre></td></tr></tbody></table></figure><ul><li>编辑 Chart 的 <code>Chart.yaml</code> 文件，定义 Chart 的名称、描述、版本等信息</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nginx/Chart.yaml</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v2</span><br><span class="line">name: nginx</span><br><span class="line">description: A Helm chart for Nginx</span><br><span class="line">type: application</span><br><span class="line">version: 0.1.0</span><br><span class="line">appVersion: 1.15</span><br></pre></td></tr></tbody></table></figure><ul><li>编辑 Chart 的 <code>values.yaml</code> 文件，定义全局的变量值</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nginx/values.yaml</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">image: nginx</span><br><span class="line">tag: 1.15</span><br><span class="line">replicas: 3</span><br><span class="line">serviceport: 80</span><br><span class="line">targetport: 80</span><br><span class="line">containerPort: 80</span><br><span class="line">label: nginx-app</span><br></pre></td></tr></tbody></table></figure><ul><li>创建或编辑 Chart 的模板文件 <code>NOTES.txt</code>，定义 Chart 的帮助信息（使用指南）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nginx/templates/NOTES.txt</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Get service expose port: `kubectl get svc`</span><br><span class="line">Access nginx by: `http://&lt;node_ip&gt;:&lt;service_port&gt;`</span><br></pre></td></tr></tbody></table></figure><ul><li>创建或编辑 Chart 的模板文件 <code>deployment.yaml</code>，定义要创建的 Deployment</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nginx/templates/deployment.yaml</span><br></pre></td></tr></tbody></table></figure><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> {{ <span class="string">.Release.Name</span> }}</span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> {{ <span class="string">.Values.label</span> }}</span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> {{ <span class="string">.Values.replicas</span> }}</span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> {{ <span class="string">.Values.label</span> }}</span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> {{ <span class="string">.Values.label</span> }}</span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">          <span class="attr">image:</span> {{ <span class="string">.Values.image</span> }}<span class="string">:{{</span> <span class="string">.Values.tag</span> <span class="string">}}</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> {{ <span class="string">.Values.containerPort</span> }}</span><br></pre></td></tr></tbody></table></figure><ul><li>创建或编辑 Chart 的模板文件 <code>service.yaml</code>，定义要创建的 Service</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nginx/templates/service.yaml</span><br></pre></td></tr></tbody></table></figure><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> {{ <span class="string">.Release.Name</span> }}</span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> {{ <span class="string">.Values.label</span> }}</span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> {{ <span class="string">.Values.label</span> }}</span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> {{ <span class="string">.Values.serviceport</span> }}</span><br><span class="line">      <span class="attr">targetPort:</span> {{ <span class="string">.Values.targetport</span> }}</span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>(2) 安装自定义的 Chart</p></blockquote><ul><li>安装自定义的 Chart</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里的 web 是 Release 的名称</span></span><br><span class="line">helm install web nginx/</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">NAME: web</span><br><span class="line">LAST DEPLOYED: Wed Oct 13 17:39:32 2025</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">Get service expose port: `kubectl get svc`</span><br><span class="line">Access nginx by: `http://&lt;node_ip&gt;:&lt;service_port&gt;`</span><br></pre></td></tr></tbody></table></figure><ul><li>查看实际的 Chart 模板被渲染过后的 YAML 资源文件</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里的 web 是 Release 的名称</span></span><br><span class="line">helm get manifest web</span><br></pre></td></tr></tbody></table></figure><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx/templates/service.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-app</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx/templates/deployment.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx:1.15</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>(3) 验证自定义的 Chart</p></blockquote><ul><li>查看发布（Release）的列表</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helm list</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME	NAMESPACE	REVISION	UPDATED                                	STATUS  	CHART      	APP VERSION</span><br><span class="line">web 	default  	1       	2025-10-29 17:39:32.267654796 +0800 CST	deployed	nginx-0.1.0	1.15  </span><br></pre></td></tr></tbody></table></figure><ul><li>查看所有 Pod 的运行状态</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NAME                   READY   STATUS    RESTARTS   AGE</span><br><span class="line">web-766795cc8b-6knwm   1/1     Running   0          100s</span><br><span class="line">web-766795cc8b-7nlr4   1/1     Running   0          100s</span><br><span class="line">web-766795cc8b-q4h8q   1/1     Running   0          100s</span><br></pre></td></tr></tbody></table></figure><ul><li>查看所有 Service</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get svc</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">kubernetes   ClusterIP   10.0.0.1     &lt;none&gt;        443/TCP        86d</span><br><span class="line">web          NodePort    10.0.0.197   &lt;none&gt;        80:30654/TCP   2m13s</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">最后通过任意一个集群节点的 IP 与 Service 对外暴露的端口（比如 `http://192.168.2.191:30654`），就可以在 Kubernetes 集群外部通过浏览器访问 Nginx 的首页面</span><br></pre></td></tr></tbody></table></figure><h5 id="Chart-模板的调试技巧"><a href="#Chart-模板的调试技巧" class="headerlink" title="Chart 模板的调试技巧"></a>Chart 模板的调试技巧</h5><ul><li>Helm 提供了 <code>--dry-run</code> 和 <code>--debug</code> 调试参数，可用于在执行 <code>helm install</code> 命令之前，验证 Chart 模板文件的正确性。</li><li>当 <code>helm install</code> 命令加上这两个参数后，Helm 会将模板文件与对应的 <code>values.yaml</code> 文件进行渲染，并打印出生成的 YAML 资源清单，而不会实际部署任何 Release。</li><li>比如，调试 <a href="/posts/2ca57d7f.html#Chart-%E6%A8%A1%E6%9D%BF%E7%9A%84%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B">上面案例</a> 中自定义的 Chart 包，可以使用以下命令：</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里的 web 是 Release 的名称</span></span><br><span class="line">helm install web<span class="params"> --dry</span>-run nginx/</span><br></pre></td></tr></tbody></table></figure><h5 id="Chart-模板的内置对象"><a href="#Chart-模板的内置对象" class="headerlink" title="Chart 模板的内置对象"></a>Chart 模板的内置对象</h5><p>上面使用 <code>{{.Release.Name}}</code> 将 Release 的名称插入到 Chart 模板中。这里的 <code>Release</code> 就是 Helm 的内置对象，下面是一些常用的内置对象：</p><table><thead><tr><th>Helm 内置对象</th><th>描述</th></tr></thead><tbody><tr><td><code>Release.Name</code></td><td>Release 名称</td></tr><tr><td><code>Release.Namespace</code></td><td>Release 命名空间</td></tr><tr><td><code>Release.Service</code></td><td>Release 服务的名称</td></tr><tr><td><code>Release.Revision</code></td><td>Release 修订版本号，从 1 开始累加</td></tr></tbody></table><h5 id="Chart-模板的-Values-对象"><a href="#Chart-模板的-Values-对象" class="headerlink" title="Chart 模板的 Values 对象"></a>Chart 模板的 Values 对象</h5><p>Values 对象用于为 Chart 模板文件提供参数值，其来源主要有以下四个：</p><ul><li>(1) Chart 包中的 <code>values.yaml</code> 文件</li><li> (2) 父 Chart 包中的 <code>values.yaml</code> 文件</li><li> (3) 通过 <code>helm install</code> 或 <code>helm upgrade</code> 命令使用 <code>-f</code> 或 <code>--values</code> 参数传入的自定义 YAML 配置文件</li><li> (4) 通过 <code>helm install</code> 或 <code>helm upgrade</code> 命令使用 <code>--set</code> 参数直接传入的值</li></ul><div class="admonition warning"><p class="admonition-title">参数值不同来源的优先级关系</p><p>Chart 参数值的优先级遵循一定的覆盖顺序（优先级）：<code>Chart 包中的 values.yaml 文件</code> &lt; <code>用户通过 -f 参数自定义的 YAML 配置文件</code> &lt; <code>用户通过 --set 参数传入的值</code>。</p></div><ul><li>举个例子，通过 <code>--set</code> 参数更新 Chart（比如，Pod 的副本数量）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里的 web 是 Release 的名称</span></span><br><span class="line">helm upgrade web<span class="params"> --set</span> replicas=5 nginx/</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Release "web" has been upgraded. Happy Helming!</span><br><span class="line">NAME: web</span><br><span class="line">LAST DEPLOYED: Wed Oct 13 18:04:34 2025</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 2</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">Get service expose port: `kubectl get svc`</span><br><span class="line">Access nginx by: `http://&lt;node_ip&gt;:&lt;service_port&gt;`</span><br></pre></td></tr></tbody></table></figure><ul><li>查看指定 Release 的历史版本</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里的 web 是 Release 的名称</span></span><br><span class="line">helm <span class="built_in">history</span> web</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REVISION	UPDATED                 	STATUS    	CHART      	APP VERSION	DESCRIPTION     </span><br><span class="line">1       	Wed Oct 13 17:39:32 2025	superseded	nginx-0.1.0	1.15       	Install complete</span><br><span class="line">2       	Wed Oct 13 18:04:34 2025	deployed  	nginx-0.1.0	1.15       	Upgrade complete</span><br></pre></td></tr></tbody></table></figure><ul><li>查看所有 Pod 的运行状态</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NAME                   READY   STATUS    RESTARTS   AGE</span><br><span class="line">web-766795cc8b-6knwm   1/1     Running   0          28m</span><br><span class="line">web-766795cc8b-7nlr4   1/1     Running   0          28m</span><br><span class="line">web-766795cc8b-lpr27   1/1     Running   0          3m57s</span><br><span class="line">web-766795cc8b-q4h8q   1/1     Running   0          28m</span><br><span class="line">web-766795cc8b-vpdh4   1/1     Running   0          3m57s</span><br></pre></td></tr></tbody></table></figure><h5 id="Chart-模板的管道与函数"><a href="#Chart-模板的管道与函数" class="headerlink" title="Chart 模板的管道与函数"></a>Chart 模板的管道与函数</h5><p>前面讲的内容，其实就是将参数值传给 Go 模板引擎进行渲染，模板引擎还支持通过管道和模板函数对拿到数据（参数值）进行二次处理。Chart 支持的常用管道和模板函数有以下几个：</p><ul><li><p><code>quote</code> 模板函数</p><ul><li>模板函数的调用语法：<code>functionName arg1 arg2 ...</code>；</li><li>比如，<code>app: {{quote .Values.label}}</code>，会将后面的 <code>.Values.label</code> 参数值作为参数传递给 <code>quote</code> 模板函数。</li></ul></li><li><p><code>default</code> 管道</p><ul><li>比如，<code>name: {{ .Values.name | default "nginx" }}</code>，当 <code>.Values.name</code> 参数值不存在时，会使用 <code>default</code> 管道指定的默认值。</li></ul></li><li><p>其他模板函数</p><ul><li>大写：<code>{{ upper .Values.resources }}</code></li><li>首字母大写：<code>{{ title .Values.resources }}</code></li></ul></li><li><p>其他管道</p><ul><li>缩进：<code>{{ .Values.resources | indent 12 }}</code></li></ul></li></ul><blockquote><p>模板函数 quote 的使用案例</p></blockquote><ul><li>在 <a href="/posts/2ca57d7f.html#Chart-%E6%A8%A1%E6%9D%BF%E7%9A%84%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B">上面案例</a> 的基础上，将从 <code>.Values</code> 中读取到的参数值转换成字符串</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim nginx/templates/deployment.yaml</span><br></pre></td></tr></tbody></table></figure><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> {{ <span class="string">.Release.Name</span> }}</span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> {{ <span class="string">quote</span> <span class="string">.Values.label</span> }}</span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> {{ <span class="string">.Values.replicas</span> }}</span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> {{ <span class="string">quote</span> <span class="string">.Values.label</span> }}</span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> {{ <span class="string">quote</span> <span class="string">.Values.label</span> }}</span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">          <span class="attr">image:</span> {{ <span class="string">.Values.image</span> }}<span class="string">:{{</span> <span class="string">.Values.tag</span> <span class="string">}}</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> {{ <span class="string">.Values.containerPort</span> }}</span><br></pre></td></tr></tbody></table></figure><ul><li>将模板文件与对应的 <code>values.yaml</code> 文件进行渲染，并打印出生成的 YAML 资源清单，不会实际部署任何 Release</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里的 web 是 Release 的名称</span></span><br><span class="line">helm install web<span class="params"> --dry</span>-run nginx/</span><br></pre></td></tr></tbody></table></figure><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...（省略）</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">"nginx-app"</span>    <span class="comment"># 参数值已经被 quote 模板函数转换为字符串</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">"nginx-app"</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">"nginx-app"</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">nginx:1.15</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></tbody></table></figure><h5 id="Chart-模板的流程控制语句"><a href="#Chart-模板的流程控制语句" class="headerlink" title="Chart 模板的流程控制语句"></a>Chart 模板的流程控制语句</h5><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/2ca57d7f.html" title="Kubernetes 入门教程之七">https://www.techgrow.cn/posts/2ca57d7f.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%AE%B9%E5%99%A8%E5%8C%96/" rel="tag"><i class="fa fa-tag"></i> 容器化</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/d806b69a.html" rel="prev" title="Spring Cloud Gateway 实现动态路由和灰度发布"><i class="fa fa-angle-left"></i> Spring Cloud Gateway 实现动态路由和灰度发布</a></div><div class="post-nav-item"> <a href="/posts/6158b4d2.html" rel="next" title="Kubernetes 入门教程之十">Kubernetes 入门教程之十<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2.1m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">31:40</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/2ca57d7f.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>