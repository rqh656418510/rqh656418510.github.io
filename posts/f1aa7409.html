<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 ShardingSphere-Proxy 的入门教程。"><meta property="og:type" content="article"><meta property="og:title" content="ShardingSphere-Proxy 入门教程之一"><meta property="og:url" content="https://www.techgrow.cn/posts/f1aa7409.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 ShardingSphere-Proxy 的入门教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/12/sharding-sphere-32.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/12/sharding-sphere-33.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/12/sharding-sphere-27.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/12/sharding-sphere-26.png"><meta property="article:published_time" content="2022-10-02T15:12:41.000Z"><meta property="article:modified_time" content="2022-10-02T15:12:41.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="微服务"><meta property="article:tag" content="分布式"><meta property="article:tag" content="ORM"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2025/12/sharding-sphere-32.png"><link rel="canonical" href="https://www.techgrow.cn/posts/f1aa7409.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/f1aa7409.html","path":"posts/f1aa7409.html","title":"ShardingSphere-Proxy 入门教程之一"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>ShardingSphere-Proxy 入门教程之一 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script>
// 防止 Pjax 重复绑定事件
if (!window.__moonMenuCodeExpandBound) {
  window.__moonMenuCodeExpandBound = true;

  // 设置所有按钮的标题
  (function bindMoonMenuTitles() {
    const items = [
      {
        selector: '#moon-menu-item-code',
        title: '展开 / 折叠代码块'
      },
      {
        selector: '#moon-menu-item-back2top',
        title: '回到页面顶部'
      },
      {
        selector: '#moon-menu-item-back2bottom',
        title: '回到页面底部'
      }
    ];

    let allReady = true;

    items.forEach(item => {
      const el = document.querySelector(item.selector);
      if (!el) {
        allReady = false;
        return;
      }
      el.setAttribute('title', item.title);
    });

    // 如果有任何一个按钮还没出现，继续等待
    if (!allReady) {
      setTimeout(bindMoonMenuTitles, 100);
    }
  })();

  // 绑定按钮事件
  document.addEventListener('click', function (e) {
    const codeMenu = e.target.closest('#moon-menu-item-code');
    if (codeMenu) {
      // 折叠或展开所有代码块
      toggleAllCodeBlocks();
    }
  });

  // 折叠或展开所有代码块
  function toggleAllCodeBlocks() {
    const containers = document.querySelectorAll('.code-container');
    if (!containers.length) {
      return;
    }

    // 只要存在折叠的代码块，就认为当前是折叠状态
    const hasFolded = Array.from(containers).some(
      c => c.classList.contains('highlight-fold')
    );

    containers.forEach(container => {
      if (hasFolded) {
        // 展开代码块
        container.classList.remove('highlight-fold');
      } else {
        // 折叠代码块
        container.classList.add('highlight-fold');
      }
    });
  }

}
</script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90"><span class="nav-text">学习资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ShardingSphere-Proxy-%E5%AE%89%E8%A3%85"><span class="nav-text">ShardingSphere-Proxy 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F"><span class="nav-text">安装方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="nav-text">安装步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ShardingSphere-Proxy-%E9%85%8D%E7%BD%AE"><span class="nav-text">ShardingSphere-Proxy 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%A4%E7%A7%8D%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-text">两种配置方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DistSQL-%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="nav-text">DistSQL 的介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DistSQL-%E7%9A%84%E4%B8%89%E5%A4%A7%E8%AF%AD%E6%B3%95"><span class="nav-text">DistSQL 的三大语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DistSQL-%E5%AF%B9%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="nav-text">DistSQL 对系统的影响</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DistSQL-%E4%B8%8E-YAML-%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-text">DistSQL 与 YAML 的关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DistSQL-%E4%B8%8E%E6%99%AE%E9%80%9A-SQL-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-text">DistSQL 与普通 SQL 的区别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ShardingSphere-Proxy-%E4%BD%BF%E7%94%A8"><span class="nav-text">ShardingSphere-Proxy 使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="nav-text">读写分离使用案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-text">准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E8%AF%B4%E6%98%8E"><span class="nav-text">版本说明</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A7%84%E5%88%92"><span class="nav-text">数据库规划</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-text">数据库初始化</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ShardingSphere-Proxy-%E9%85%8D%E7%BD%AE-1"><span class="nav-text">ShardingSphere-Proxy 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E9%85%8D%E7%BD%AE"><span class="nav-text">读写分离配置</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#YAML-%E6%A8%A1%E5%BC%8F"><span class="nav-text">YAML 模式</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#DistSQL-%E6%A8%A1%E5%BC%8F"><span class="nav-text">DistSQL 模式</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF"><span class="nav-text">查看日志信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE%E6%B5%8B%E8%AF%95"><span class="nav-text">远程访问测试</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SpringBoot-%E5%AE%9E%E6%88%98%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="nav-text">SpringBoot 实战使用案例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E4%BB%A3%E7%A0%81"><span class="nav-text">案例代码</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="nav-text">添加依赖</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="nav-text">创建实体类</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-Mapper"><span class="nav-text">创建 Mapper</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="nav-text">配置数据源</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81"><span class="nav-text">测试代码</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%B5%8B%E8%AF%95"><span class="nav-text">读写分离测试</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E4%B8%80%E8%87%B4%E6%80%A7%E6%B5%8B%E8%AF%95"><span class="nav-text">事务一致性测试</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%B5%8B%E8%AF%95"><span class="nav-text">负载均衡测试</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">786</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">54</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/f1aa7409.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="ShardingSphere-Proxy 入门教程之一 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 ShardingSphere-Proxy 的入门教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> ShardingSphere-Proxy 入门教程之一</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-10-02 23:12:41" itemprop="dateCreated datePublished" datetime="2022-10-02T23:12:41+08:00">2022-10-02</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/f1aa7409.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/f1aa7409.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>5.2k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>5 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/f1aa7409.html">ShardingSphere-Proxy 入门教程之一</a>、<a href="/posts/d1af7n03.html">ShardingSphere-Proxy 入门教程之二</a>、<a href="/posts/dc701860.html">ShardingSphere-Proxy 入门教程之三</a></li><li><a href="/posts/90a2747e.html">ShardingSphere-Proxy 入门教程之四</a>、<a href="/posts/8d40163b.html">ShardingSphere-Proxy 入门教程之五</a>、<a href="/posts/8b59de38.html">ShardingSphere-Proxy 入门教程之六</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h3><ul><li><a target="_blank" rel="external nofollow" href="https://github.com/apache/shardingsphere">ShardingSphere 官方项目（GitHub）</a></li><li><a target="_blank" rel="external nofollow" href="https://shardingsphere.apache.org/index_zh.html">ShardingSphere 官方网站（中文站点）</a></li><li><a target="_blank" rel="external nofollow" href="https://shardingsphere.apache.org/document/current/cn/overview/">ShardingSphere 官方文档（最新版本）</a></li><li><a target="_blank" rel="external nofollow" href="https://shardingsphere.apache.org/document/5.1.1/cn/overview/">ShardingSphere 官方文档（5.1.1 版本）</a></li></ul><span id="more"></span><h2 id="ShardingSphere-Proxy-安装"><a href="#ShardingSphere-Proxy-安装" class="headerlink" title="ShardingSphere-Proxy 安装"></a>ShardingSphere-Proxy 安装</h2><h3 id="安装方式"><a href="#安装方式" class="headerlink" title="安装方式"></a>安装方式</h3><p>目前 ShardingSphere-Proxy 官方提供了三种安装方式：</p><ul><li>Docker</li><li>Helm（K8s）</li><li>二进制发布包</li></ul><h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><ul><li><a href="/posts/7b59b61a.html">Docker 安装 ShardingSphere-Proxy</a></li><li><a href="/posts/e1f0a509.html">Linux 使用二进制包安装 ShardingSphere-Proxy</a></li></ul><h2 id="ShardingSphere-Proxy-配置"><a href="#ShardingSphere-Proxy-配置" class="headerlink" title="ShardingSphere-Proxy 配置"></a>ShardingSphere-Proxy 配置</h2><h3 id="两种配置方式"><a href="#两种配置方式" class="headerlink" title="两种配置方式"></a>两种配置方式</h3><ul><li>ShardingSphere-Proxy 支持两种规则配置与治理方式：<ul><li>YAML 配置文件，适用于启动期静态配置。</li><li>DistSQL（Distributed SQL），适用于运行期动态治理。</li></ul></li></ul><div class="admonition warning"><p class="admonition-title">特别注意</p><p>DistSQL 只能用于 ShardingSphere-Proxy，而 ShardingSphere-JDBC 暂不提供支持。无论 ShardingSphere-Proxy 是使用 YAML 配置 还是 DistSQL 配置，都必须注意 ShardingSphere-Proxy 的版本差异。不同版本之间支持的 DistSQL 命令、YAML 配置语法以及参数格式可能存在较大差异，同一份配置在不同版本下可能无法直接执行或行为不一致，因此在编写和迁移配置时必须结合 ShardingSphere-Proxy 具体版本进行验证。</p></div><h3 id="DistSQL-的介绍"><a href="#DistSQL-的介绍" class="headerlink" title="DistSQL 的介绍"></a>DistSQL 的介绍</h3><div class="admonition note"><p class="admonition-title">官方文档</p><ul><li><a target="_blank" rel="external nofollow" href="https://shardingsphere.apache.org/document/5.1.1/cn/user-manual/shardingsphere-proxy/distsql/">官方文档（5.1.1 版本）- DistSQL</a></li></ul></div><ul><li><p>DistSQL 的基本定位</p><ul><li>DistSQL（Distributed SQL） 是 ShardingSphere 提供的一套分布式数据库治理语言。</li><li>DistSQL 用于在线管理和调整 ShardingSphere-Proxy 的规则、资源及算法配置，并非用于查询或操作业务数据。</li><li>当 ShardingSphere-Proxy 识别到 DistSQL 时：<ul><li>不会将该 SQL 转发给后端 MySQL</li><li> 而是由 ShardingSphere-Proxy 自身解析并执行</li><li>执行结果存储在 ShardingSphere 的元数据 / 治理上下文中</li></ul></li></ul></li><li><p> DistSQL 出现之前的配置模式（静态配置时代）</p><ul><li>在没有 DistSQL 的情况下，ShardingSphere-Proxy 的配置方式具有明显限制：<ul><li>修改规则（如分片、读写分离）<br> → 必须修改 YAML 配置文件</li><li>调整负载均衡策略<br> → 必须修改 YAML 配置文件</li><li>配置变更后，需要重启 ShardingSphere-Proxy</li><li> 重启 ShardingSphere-Proxy 会导致：<ul><li>客户端连接全部断开</li><li>在生产环境中存在明显风险</li></ul></li></ul></li><li>配置调整与服务可用性强耦合</li></ul></li><li><p> DistSQL 引入后的变化（在线治理能力）</p><ul><li>DistSQL 的引入，使 ShardingSphere-Proxy 具备了运行期动态治理能力：<ul><li>新增或修改数据源<br> → 不需要重启 ShardingSphere-Proxy</li><li> 创建、修改读写分离规则<br> → 不需要重启 ShardingSphere-Proxy</li><li> 配置或切换负载均衡算法<br> → 不需要重启 ShardingSphere-Proxy</li><li> 动态调整从库权重等参数<br> → 不需要重启 ShardingSphere-Proxy</li></ul></li><li> 配置变更即时生效，业务连接无感知</li></ul></li></ul><h3 id="DistSQL-的三大语法"><a href="#DistSQL-的三大语法" class="headerlink" title="DistSQL 的三大语法"></a>DistSQL 的三大语法</h3><ul><li><p>RDL（Resource Definition Language，资源定义语法）</p><ul><li>作用：<ul><li>定义、修改和管理数据库资源</li></ul></li><li>特点：<ul><li>面向 ShardingSphere-Proxy 运行时的资源管理</li><li>对应 YAML 中的 <code>dataSources</code> 配置</li><li>可在线添加、修改、删除资源，无需重启 ShardingSphere-Proxy</li></ul></li><li> 用途：<ul><li>创建 / 删除数据源</li><li>修改数据源属性（如连接池大小）</li><li>创建 / 修改分片规则或读写分离规则</li></ul></li></ul></li><li><p> RQL（Resource Query Language，资源查询语法）</p><ul><li>作用：<ul><li>查询 ShardingSphere-Proxy 内部资源、规则和状态信息</li></ul></li><li>特点：<ul><li>类似 SQL 查询语法，但不操作业务数据</li><li>返回 ShardingSphere-Proxy 内部元数据</li><li>用于监控和验证配置是否生效</li></ul></li><li>用途：<ul><li>查询已配置的数据源</li><li>查询读写分离规则</li><li>查询分片规则</li><li>查看负载均衡算法</li></ul></li></ul></li><li><p> RAL（Resource Administration Language，资源管理语法）</p><ul><li>作用：<ul><li>管理 ShardingSphere-Proxy 运行时状态和执行操作</li></ul></li><li>特点：<ul><li>类似运维命令</li><li>可动态调整 ShardingSphere-Proxy 规则和资源</li><li>不影响业务 SQL 执行，不访问后端数据</li></ul></li><li>用途：<ul><li>启用 / 禁用数据源</li><li>刷新表或分片规则元数据</li><li>修改读写分离规则的负载均衡算法</li><li>在线调整分片表规则</li></ul></li></ul></li></ul><table><thead><tr><th>语法</th><th>作用</th><th>核心命令示例</th><th>对应 YAML 配置</th></tr></thead><tbody><tr><td> RDL 语法</td><td>定义 / 修改资源（数据源、分片表、规则）</td><td><code>ADD RESOURCE</code> / <code>CREATE SHARDING TABLE RULE</code></td><td><code>dataSources</code> / <code>rules</code></td></tr><tr><td>RQL 语法</td><td>查询资源 / 规则状态</td><td><code>SHOW RESOURCES</code> / <code>SHOW READWRITE_SPLITTING RULES</code></td><td>无直接 YAML 对应，用于验证</td></tr><tr><td> RAL 语法</td><td>管理运行时状态</td><td><code>ENABLE / DISABLE RESOURCE</code> / <code>REFRESH TABLE METADATA</code></td><td>对应 YAML 中规则的动态修改</td></tr></tbody></table><h3 id="DistSQL-对系统的影响"><a href="#DistSQL-对系统的影响" class="headerlink" title="DistSQL 对系统的影响"></a>DistSQL 对系统的影响</h3><p>在拥有 DistSQL 以前，用户一边使用 SQL 语句操作数据，一边使用 YAML 文件来管理 ShardingSphere-Proxy 的配置，如下图：</p><p><img data-src="../../../asset/2025/12/sharding-sphere-32.png"></p><p>这时用户不得不面对以下几个问题：</p><ul><li>需要通过不同类型的客户端来操作数据和管理 ShardingSphere-Proxy 规则；</li><li>多个逻辑库需要多个 YAML 文件；</li><li>修改 YAML 需要文件的编辑权限；</li><li>修改 YAML 后需要重启 ShardingSphere-Proxy。</li></ul><hr><p>随着 DistSQL 的出现，对 ShardingSphere-Proxy 的操作方式也得到了改变，如下图：</p><p><img data-src="../../../asset/2025/12/sharding-sphere-33.png"></p><p>现在，用户的使用体验得到了巨大改善：</p><ul><li>使用相同的客户端来管理数据和 ShardingSphere-Proxy 配置；</li><li>不再额外创建 YAML 文件，通过 DistSQL 管理逻辑库；</li><li>不再需要文件的编辑权限，通过 DistSQL 来管理配置；</li><li>配置的变更实时生效，无需重启 ShardingSphere-Proxy。</li></ul><h3 id="DistSQL-与-YAML-的关系"><a href="#DistSQL-与-YAML-的关系" class="headerlink" title="DistSQL 与 YAML 的关系"></a>DistSQL 与 YAML 的关系</h3><ul><li><p>DistSQL 与 YAML 的职责划分</p><ul><li>YAML 配置<ul><li>适合定义：<ul><li>数据源基础信息</li><li>初始规则结构</li></ul></li><li>在 ShardingSphere-Proxy 启动时加载</li></ul></li><li> DistSQL<ul><li> 适合运行期治理：<ul><li>规则变更</li><li>算法切换</li><li>权重调整</li><li>状态查看</li></ul></li><li>支持不停机操作</li></ul></li></ul></li><li><p> DistSQL 与 YAML 不是对立的，而是分工明确。</p></li></ul><table><thead><tr><th>场景</th><th>推荐方式</th></tr></thead><tbody><tr><td>初始启动</td><td> YAML</td></tr><tr><td> 运行期调整</td><td> DistSQL</td></tr><tr><td> 生产环境</td><td> YAML + DistSQL</td></tr><tr><td> 动态治理</td><td> DistSQL</td></tr></tbody></table><h3 id="DistSQL-与普通-SQL-的区别"><a href="#DistSQL-与普通-SQL-的区别" class="headerlink" title="DistSQL 与普通 SQL 的区别"></a>DistSQL 与普通 SQL 的区别</h3><table><thead><tr><th>对比项</th><th>普通 SQL</th><th>DistSQL</th></tr></thead><tbody><tr><td> 操作对象</td><td>表 / 行</td><td>规则 / 数据源 / 算法</td></tr><tr><td>执行位置</td><td>数据库</td><td> ShardingSphere-Proxy 内部</td></tr><tr><td>是否影响业务数据</td><td>不影响</td><td>不影响</td></tr><tr><td>是否持久化</td><td>数据表</td><td> ShardingSphere-Proxy 元数据</td></tr><tr><td>是否需要重启</td><td>不需要重启</td><td>不需要重启</td></tr></tbody></table><h2 id="ShardingSphere-Proxy-使用"><a href="#ShardingSphere-Proxy-使用" class="headerlink" title="ShardingSphere-Proxy 使用"></a>ShardingSphere-Proxy 使用</h2><h3 id="读写分离使用案例"><a href="#读写分离使用案例" class="headerlink" title="读写分离使用案例"></a>读写分离使用案例</h3><div class="admonition note"><p class="admonition-title">提示</p><p>本节将演示 SpringBoot + MyBatis Plus 如何基于 ShardingSphere-Proxy 实现 <a href="/posts/8bb72991.html#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%9E%B6%E6%9E%84">读写分离</a>，整体架构如下图所示。完整的案例代码可以直接从 <a target="_blank" rel="external nofollow" href="https://github.com/rqh656418510/spring-cloud-share/tree/main/distributed-database/shardingsphere-study/shardingsphere-proxy-study">GitHub</a> 下载对应章节 <code>shardingsphere-proxy-lesson-01</code>。</p></div><p><img data-src="../../../asset/2025/12/sharding-sphere-27.png"></p><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><h5 id="版本说明"><a href="#版本说明" class="headerlink" title="版本说明"></a>版本说明</h5><p>本案例所使用的组件版本如下表所示：</p><table><thead><tr><th>组件</th><th>版本说明</th></tr></thead><tbody><tr><td> JDK</td><td><code>11</code></td></tr><tr><td>MySQL</td><td><code>8.0.29</code></td></tr><tr><td>SpringBoot</td><td><code>2.7.18</code></td></tr><tr><td>MyBatis-Plus</td><td><code>3.3.1</code></td></tr><tr><td>ShardingSphere-Proxy</td><td><code>5.1.1</code></td></tr></tbody></table><h5 id="数据库规划"><a href="#数据库规划" class="headerlink" title="数据库规划"></a>数据库规划</h5><p>本案例是在 MySQL 一主二从的架构（请自行搭建 MySQL 主从复制环境）上实现的，数据库的规划如下图所示：</p><p><img data-src="../../../asset/2025/12/sharding-sphere-26.png"></p><table><thead><tr><th>数据库服务器</th><th>主从角色</th><th> IP</th><th> 端口</th><th>库的名称</th><th>表的名称</th></tr></thead><tbody><tr><td>主服务器</td><td>主库（<code>master</code>）</td><td>192.168.2.191</td><td>3306</td><td><code>db_user</code></td><td><code>t_user</code></td></tr><tr><td>从服务器一</td><td>从库（<code>slave1</code>）</td><td>192.168.2.191</td><td>3307</td><td><code>db_user</code></td><td><code>t_user</code></td></tr><tr><td>从服务器二</td><td>从库（<code>slave2</code>）</td><td>192.168.2.191</td><td>3308</td><td><code>db_user</code></td><td><code>t_user</code></td></tr><tr><td>ShardingSphere-Proxy 服务器</td><td></td><td> 192.168.2.191</td><td>3309</td><td><code>readwrite_splitting_db</code>（逻辑库）</td><td><code>t_user</code>（逻辑表）</td></tr></tbody></table><div class="admonition note"><p class="admonition-title">MySQL 主从同步环境搭建</p><p>MySQL 基于日志点实现主从复制的教程可以看 <a href="/posts/7de9021f.html">这里</a>。</p></div><h5 id="数据库初始化"><a href="#数据库初始化" class="headerlink" title="数据库初始化"></a>数据库初始化</h5><ul><li>在 MySQL 主库（<code>master</code>）中，执行以下 SQL 语句：</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE db_user;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 切换数据库</span></span><br><span class="line">USE db_user;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_user (</span><br><span class="line"> id <span class="type">BIGINT</span> AUTO_INCREMENT,</span><br><span class="line"> uname <span class="type">VARCHAR</span>(<span class="number">30</span>),</span><br><span class="line"> <span class="keyword">PRIMARY</span> KEY (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入表数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user(uname) <span class="keyword">VALUES</span>(<span class="string">'zhang3'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user(uname) <span class="keyword">VALUES</span>(@<span class="variable">@hostname</span>);</span><br></pre></td></tr></tbody></table></figure><h4 id="ShardingSphere-Proxy-配置-1"><a href="#ShardingSphere-Proxy-配置-1" class="headerlink" title="ShardingSphere-Proxy 配置"></a>ShardingSphere-Proxy 配置</h4><h5 id="读写分离配置"><a href="#读写分离配置" class="headerlink" title="读写分离配置"></a>读写分离配置</h5><p>ShardingSphere-Proxy 支持两种配置模式，包括 YAML 和 DistSQL，任意选择一种即可。</p><div class="admonition warning"><p class="admonition-title">特别注意</p><p>无论 ShardingSphere-Proxy 是使用 YAML 配置 还是 DistSQL 配置，都必须注意 ShardingSphere-Proxy 的版本差异。不同版本之间支持的 DistSQL 命令、YAML 配置语法以及参数格式可能存在较大差异，同一份配置在不同版本下可能无法直接执行或行为不一致，因此在编写和迁移配置时必须结合 ShardingSphere-Proxy 具体版本进行验证。</p></div><h6 id="YAML-模式"><a href="#YAML-模式" class="headerlink" title="YAML 模式"></a>YAML 模式</h6><ul><li>创建或编辑 ShardingSphere-Proxy 的 <code>conf/config-readwrite-splitting.yaml</code> 配置文件，添加以下读写分离的配置内容：</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 逻辑数据库（Schema）的名称</span></span><br><span class="line"><span class="attr">schemaName:</span> <span class="string">readwrite_splitting_db</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置数据源</span></span><br><span class="line"><span class="attr">dataSources:</span></span><br><span class="line">  <span class="comment"># 配置第一个数据源（用于写）</span></span><br><span class="line">  <span class="attr">write_ds:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.2.191:3306/db_user?serverTimezone=UTC&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">connectionTimeoutMilliseconds:</span> <span class="number">30000</span></span><br><span class="line">    <span class="attr">idleTimeoutMilliseconds:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">maxLifetimeMilliseconds:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">maxPoolSize:</span> <span class="number">50</span></span><br><span class="line">    <span class="attr">minPoolSize:</span> <span class="number">1</span></span><br><span class="line">  <span class="comment"># 配置第二个数据源（用于读）</span></span><br><span class="line">  <span class="attr">read_ds_0:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.2.191:3307/db_user?serverTimezone=UTC&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">connectionTimeoutMilliseconds:</span> <span class="number">30000</span></span><br><span class="line">    <span class="attr">idleTimeoutMilliseconds:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">maxLifetimeMilliseconds:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">maxPoolSize:</span> <span class="number">50</span></span><br><span class="line">    <span class="attr">minPoolSize:</span> <span class="number">1</span></span><br><span class="line">  <span class="comment"># 配置第三个数据源（用于读）</span></span><br><span class="line">  <span class="attr">read_ds_1:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.2.191:3308/db_user?serverTimezone=UTC&amp;useSSL=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">connectionTimeoutMilliseconds:</span> <span class="number">30000</span></span><br><span class="line">    <span class="attr">idleTimeoutMilliseconds:</span> <span class="number">60000</span></span><br><span class="line">    <span class="attr">maxLifetimeMilliseconds:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">maxPoolSize:</span> <span class="number">50</span></span><br><span class="line">    <span class="attr">minPoolSize:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置读写分离规则</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="type">!READWRITE_SPLITTING</span></span><br><span class="line">  <span class="attr">dataSources:</span></span><br><span class="line">    <span class="attr">readwrite_ds:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">Static</span></span><br><span class="line">      <span class="attr">props:</span></span><br><span class="line">        <span class="attr">write-data-source-name:</span> <span class="string">write_ds</span></span><br><span class="line">        <span class="attr">read-data-source-names:</span> <span class="string">read_ds_0,read_ds_1</span></span><br></pre></td></tr></tbody></table></figure><ul><li>ShardingSphere-Proxy 读写分离的配置内容添加完成后，需要重启 ShardingSphere-Proxy 服务（假设这里是通过 Docker 部署 ShardingSphere-Proxy 服务），否则配置不会生效</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重启 Docker 容器</span></span><br><span class="line">docker restart server-proxy</span><br></pre></td></tr></tbody></table></figure><ul><li>验证 ShardingSphere-Proxy 中的配置规则是否生效（ShardingSphere-Proxy 启动时会从 YAML 配置文件中加载规则）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 远程连接 ShardingSphere-Proxy</span></span><br><span class="line">mysql<span class="params"> -h192</span>.168.2.191<span class="params"> -P3309</span><span class="params"> -uroot</span><span class="params"> -p</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 切换到逻辑数据库（Schema）</span></span><br><span class="line">USE readwrite_splitting_db;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询所有数据源</span></span><br><span class="line"><span class="keyword">SHOW</span> SCHEMA RESOURCES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询所有读写分离规则</span></span><br><span class="line"><span class="keyword">SHOW</span> READWRITE_SPLITTING RULES;</span><br></pre></td></tr></tbody></table></figure><h6 id="DistSQL-模式"><a href="#DistSQL-模式" class="headerlink" title="DistSQL 模式"></a>DistSQL 模式</h6><div class="admonition note"><p class="admonition-title">官方文档</p><ul><li><a target="_blank" rel="external nofollow" href="https://shardingsphere.apache.org/document/5.1.1/cn/user-manual/shardingsphere-proxy/distsql/syntax/rdl/rule-definition/sharding/">官方文档（5.1.1 版本）- 数据分片配置</a>，<a href="../../../asset/2025/12/shardingsphere-docs-16.png">附文档截图</a></li><li><a target="_blank" rel="external nofollow" href="https://shardingsphere.apache.org/document/5.1.1/cn/features/sharding/concept/inline-expression/">官方文档（5.1.1 版本）- 行表达式介绍</a>，<a href="../../../asset/2025/12/shardingsphere-docs-7.png">附文档截图</a></li></ul></div><ul><li>远程连接 ShardingSphere-Proxy</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="params"> -h192</span>.168.2.191<span class="params"> -P3309</span><span class="params"> -uroot</span><span class="params"> -p</span></span><br></pre></td></tr></tbody></table></figure><ul><li>创建逻辑数据库（Schema）</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建逻辑数据库（Schema）</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE readwrite_splitting_db;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 切换到逻辑数据库（Schema）</span></span><br><span class="line">USE readwrite_splitting_db;</span><br></pre></td></tr></tbody></table></figure><ul><li>添加数据源</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 添加写数据源</span></span><br><span class="line"><span class="keyword">ADD</span> RESOURCE write_ds (</span><br><span class="line">  URL<span class="operator">=</span>"jdbc:mysql://192.168.2.191:3306/db_user?serverTimezone=UTC&amp;useSSL=false",</span><br><span class="line">  <span class="keyword">USER</span><span class="operator">=</span>root,</span><br><span class="line">  PASSWORD<span class="operator">=</span><span class="number">123456</span>,</span><br><span class="line">  PROPERTIES(</span><br><span class="line">    "connectionTimeoutMilliseconds"<span class="operator">=</span>"30000",</span><br><span class="line">    "idleTimeoutMilliseconds"<span class="operator">=</span>"60000",</span><br><span class="line">    "maxLifetimeMilliseconds"<span class="operator">=</span>"1800000",</span><br><span class="line">    "maxPoolSize"<span class="operator">=</span>"50",</span><br><span class="line">    "minPoolSize"<span class="operator">=</span>"1"</span><br><span class="line">  )</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 添加读数据源一</span></span><br><span class="line"><span class="keyword">ADD</span> RESOURCE read_ds_0 (</span><br><span class="line">  URL<span class="operator">=</span>"jdbc:mysql://192.168.2.191:3307/db_user?serverTimezone=UTC&amp;useSSL=false",</span><br><span class="line">  <span class="keyword">USER</span><span class="operator">=</span>root,</span><br><span class="line">  PASSWORD<span class="operator">=</span><span class="number">123456</span>,</span><br><span class="line">  PROPERTIES(</span><br><span class="line">    "connectionTimeoutMilliseconds"<span class="operator">=</span>"30000",</span><br><span class="line">    "idleTimeoutMilliseconds"<span class="operator">=</span>"60000",</span><br><span class="line">    "maxLifetimeMilliseconds"<span class="operator">=</span>"1800000",</span><br><span class="line">    "maxPoolSize"<span class="operator">=</span>"50",</span><br><span class="line">    "minPoolSize"<span class="operator">=</span>"1"</span><br><span class="line">  )</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 添加读数据源二</span></span><br><span class="line"><span class="keyword">ADD</span> RESOURCE read_ds_1 (</span><br><span class="line">  URL<span class="operator">=</span>"jdbc:mysql://192.168.2.191:3308/db_user?serverTimezone=UTC&amp;useSSL=false",</span><br><span class="line">  <span class="keyword">USER</span><span class="operator">=</span>root,</span><br><span class="line">  PASSWORD<span class="operator">=</span><span class="number">123456</span>,</span><br><span class="line">  PROPERTIES(</span><br><span class="line">    "connectionTimeoutMilliseconds"<span class="operator">=</span>"30000",</span><br><span class="line">    "idleTimeoutMilliseconds"<span class="operator">=</span>"60000",</span><br><span class="line">    "maxLifetimeMilliseconds"<span class="operator">=</span>"1800000",</span><br><span class="line">    "maxPoolSize"<span class="operator">=</span>"50",</span><br><span class="line">    "minPoolSize"<span class="operator">=</span>"1"</span><br><span class="line">  )</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><ul><li>创建读写分离规则（<code>TYPE</code> 用于指定负载均衡算法，可选：<code>random</code>、<code>round_robin</code>、<code>weight</code>）</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> READWRITE_SPLITTING RULE readwrite_ds (</span><br><span class="line">  WRITE_RESOURCE<span class="operator">=</span>write_ds,</span><br><span class="line">  READ_RESOURCES(read_ds_0, read_ds_1),</span><br><span class="line">  TYPE(NAME<span class="operator">=</span>random)</span><br><span class="line">);</span><br></pre></td></tr></tbody></table></figure><ul><li>验证配置规则是否生效（使用 DistSQL 定义数据源和读写分离规则后，不需要重启 ShardingSphere-Proxy 服务，默认会自动生效）</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询所有数据库</span></span><br><span class="line"><span class="keyword">SHOW</span> DATABASES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询所有数据源</span></span><br><span class="line"><span class="keyword">SHOW</span> SCHEMA RESOURCES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询所有读写分离规则</span></span><br><span class="line"><span class="keyword">SHOW</span> READWRITE_SPLITTING RULES;</span><br></pre></td></tr></tbody></table></figure><h5 id="查看日志信息"><a href="#查看日志信息" class="headerlink" title="查看日志信息"></a>查看日志信息</h5><ul><li>查看 ShardingSphere-Proxy 运行的实时日志信息</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入容器内，其中环境变量 "env LANG=C.UTF-8" 用于避免容器内显示中文乱码的问题</span></span><br><span class="line">docker <span class="built_in">exec</span><span class="params"> -it</span> server-proxy env LANG=C.UTF-8 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看日志信息</span></span><br><span class="line">tail<span class="params"> -f</span> /opt/shardingsphere-proxy/logs/stdout.<span class="built_in">log</span></span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">特别注意</p><p>在开发或者测试环境中，若希望 ShardingSphere-Proxy 输出详细的日志信息，需要在其 <code>conf/server.yml</code> 配置文件中添加 <code>sql-show: true</code> 配置项。</p></div><h5 id="远程访问测试"><a href="#远程访问测试" class="headerlink" title="远程访问测试"></a>远程访问测试</h5><ul><li>远程连接 ShardingSphere-Proxy</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="params"> -h192</span>.168.2.191<span class="params"> -P3309</span><span class="params"> -uroot</span><span class="params"> -p</span></span><br></pre></td></tr></tbody></table></figure><ul><li>查看所有数据库</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> databases;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------+</span></span><br><span class="line"><span class="operator">|</span> schema_name            <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------+</span></span><br><span class="line"><span class="operator">|</span> readwrite_splitting_db <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql                  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> information_schema     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> performance_schema     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sys                    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></tbody></table></figure><ul><li>切换数据库</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> use readwrite_splitting_db;</span><br></pre></td></tr></tbody></table></figure><ul><li>查看所有表</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+----------------------------------+------------+</span><br><span class="line">| Tables_in_readwrite_splitting_db | Table_type |</span><br><span class="line">+----------------------------------+------------+</span><br><span class="line">| t_user                           | BASE TABLE |</span><br><span class="line">+----------------------------------+------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></tbody></table></figure><ul><li>插入数据</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> t_user(uname) <span class="keyword">values</span>(<span class="string">'wang5'</span>);</span><br></pre></td></tr></tbody></table></figure><ul><li>查询数据（第一次）</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user;</span><br></pre></td></tr></tbody></table></figure><ul><li>查询数据（第二次）</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user;</span><br></pre></td></tr></tbody></table></figure><div class="admonition note"><p class="admonition-title">提示</p><p>执行完上述 <code>insert</code>、<code>select</code> 操作后，可以在 ShardingSphere-Proxy 的日志信息中，查看对应的逻辑 SQL 和真实 SQL，以此判断读写分离是否生效。</p></div><h4 id="SpringBoot-实战使用案例"><a href="#SpringBoot-实战使用案例" class="headerlink" title="SpringBoot 实战使用案例"></a>SpringBoot 实战使用案例</h4><h5 id="案例代码"><a href="#案例代码" class="headerlink" title="案例代码"></a>案例代码</h5><h6 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h6><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.7.18<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql-connector.version</span>&gt;</span>8.2.0<span class="tag">&lt;/<span class="name">mysql-connector.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-plus.version</span>&gt;</span>3.3.1<span class="tag">&lt;/<span class="name">mybatis-plus.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- SpringBoot --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>${spring-boot.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Web --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MySQL --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${mysql-connector.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MyBatis Plus --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${mybatis-plus.version}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Lombok --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Test --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><h6 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h6><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@TableName("t_user")</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String uname;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h6 id="创建-Mapper"><a href="#创建-Mapper" class="headerlink" title="创建 Mapper"></a>创建 Mapper</h6><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line"><span class="keyword">import</span> com.clay.shardingjdbc.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h6 id="配置数据源"><a href="#配置数据源" class="headerlink" title="配置数据源"></a>配置数据源</h6><ul><li>创建配置文件（<code>application.properties</code>），配置数据源</li></ul><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 应用名称</span></span><br><span class="line"><span class="meta">spring.application.name</span>=<span class="string">sharding-proxy-demo</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 配置数据源（这里连接的是 ShardingSphere-Proxy，而不是 MySQL）</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://192.168.2.191:3309/readwrite_splitting_db?serverTimezone=GMT%2B8&amp;useSSL=false</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">root</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 打印 MyBatis-Plus 日志</span></span><br><span class="line"><span class="meta">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></tbody></table></figure><h5 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h5><h6 id="读写分离测试"><a href="#读写分离测试" class="headerlink" title="读写分离测试"></a>读写分离测试</h6><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadWriteTest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读写分离测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span> </span>{</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setUname(<span class="string">"张三丰"</span>);</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; list = userMapper.selectList(<span class="keyword">null</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>测试代码运行后，ShardingSphere-Proxy 运行输出的日志信息如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">16:00:07.139 [ShardingSphere-Command-17] INFO ShardingSphere-SQL - Logic SQL: INSERT INTO t_user  ( uname )  VALUES  ( '张三丰' )</span><br><span class="line">16:00:07.139 [ShardingSphere-Command-17] INFO ShardingSphere-SQL - SQLStatement: MySQLInsertStatement(setAssignment=Optional.empty, onDuplicateKeyColumns=Optional.empty)</span><br><span class="line">16:00:07.139 [ShardingSphere-Command-17] INFO ShardingSphere-SQL - Actual SQL: write_ds ::: INSERT INTO t_user  ( uname )  VALUES  ( '张三丰' )</span><br><span class="line"></span><br><span class="line">16:00:07.903 [ShardingSphere-Command-10] INFO ShardingSphere-SQL - Logic SQL: SELECT  id,uname  FROM t_user</span><br><span class="line">16:00:07.903 [ShardingSphere-Command-10] INFO ShardingSphere-SQL - SQLStatement: MySQLSelectStatement(table=Optional.empty, limit=Optional.empty, lock=Optional.empty, window=Optional.empty)</span><br><span class="line">16:00:07.903 [ShardingSphere-Command-10] INFO ShardingSphere-SQL - Actual SQL: read_ds_0 ::: SELECT  id,uname  FROM t_user</span><br></pre></td></tr></tbody></table></figure><h6 id="事务一致性测试"><a href="#事务一致性测试" class="headerlink" title="事务一致性测试"></a>事务一致性测试</h6><p>为了保证主从库间的事务一致性，避免跨库的分布式事务， <code>在 ShardingSphere-Proxy 的主从模型中，事务内的数据读写均使用主库</code>。</p><ul><li>不添加 <code>@Transactional</code> 注解时：<code>insert</code> 语句对主库操作，<code>select</code> 语句对从库操作</li><li>添加 <code>@Transactional</code> 注解时：<code>insert</code> 语句和 <code>select</code> 语句均对主库操作</li><li><strong>注意：</strong> 在 JUnit 环境下使用 <code>@Transactional</code> 注解，默认情况下会对事务进行回滚（即使在没有使用 <code>@Rollback</code> 注解的情况下，也会对事务进行回滚）；如果不希望回滚事务，可以额外使用 <code>@Rollback(false)</code></li></ul><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadWriteTest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 事务一致性测试 &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 当使用 <span class="doctag">@Transactional</span> 事务注解后，事务内的所有 SQL 语句（包括读和写）都是在主库（master）执行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTransaction</span><span class="params">()</span> </span>{</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setUname(<span class="string">"李思思"</span>);</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; list = userMapper.selectList(<span class="keyword">null</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>测试代码运行后，ShardingSphere-Proxy 运行输出的日志信息如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">15:57:23.174 [ShardingSphere-Command-3] INFO ShardingSphere-SQL - Logic SQL: INSERT INTO t_user  ( uname )  VALUES  ( '李思思' )</span><br><span class="line">15:57:23.174 [ShardingSphere-Command-3] INFO ShardingSphere-SQL - SQLStatement: MySQLInsertStatement(setAssignment=Optional.empty, onDuplicateKeyColumns=Optional.empty)</span><br><span class="line">15:57:23.175 [ShardingSphere-Command-3] INFO ShardingSphere-SQL - Actual SQL: write_ds ::: INSERT INTO t_user  ( uname )  VALUES  ( '李思思' )</span><br><span class="line"></span><br><span class="line">15:57:23.217 [ShardingSphere-Command-3] INFO ShardingSphere-SQL - Logic SQL: SELECT  id,uname  FROM t_user</span><br><span class="line">15:57:23.217 [ShardingSphere-Command-3] INFO ShardingSphere-SQL - SQLStatement: MySQLSelectStatement(table=Optional.empty, limit=Optional.empty, lock=Optional.empty, window=Optional.empty)</span><br><span class="line">15:57:23.217 [ShardingSphere-Command-3] INFO ShardingSphere-SQL - Actual SQL: write_ds ::: SELECT  id,uname  FROM t_user</span><br></pre></td></tr></tbody></table></figure><h6 id="负载均衡测试"><a href="#负载均衡测试" class="headerlink" title="负载均衡测试"></a>负载均衡测试</h6><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadWriteTest</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 负载均衡测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLoadBalance</span><span class="params">()</span> </span>{</span><br><span class="line">        List&lt;User&gt; users1 = userMapper.selectList(<span class="keyword">null</span>); <span class="comment">// 默认采用轮询负载均衡算法，执行第一次查询会路由到 slave1 库</span></span><br><span class="line">        List&lt;User&gt; users2 = userMapper.selectList(<span class="keyword">null</span>); <span class="comment">// 默认采用轮询负载均衡算法，执行第二次查询会路由到 slave2 库</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>测试代码运行后，ShardingSphere-Proxy 运行输出的日志信息如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">16:48:01.373 [ShardingSphere-Command-2] INFO ShardingSphere-SQL - Logic SQL: SELECT  id,uname  FROM t_user</span><br><span class="line">16:48:01.374 [ShardingSphere-Command-2] INFO ShardingSphere-SQL - SQLStatement: MySQLSelectStatement(table=Optional.empty, limit=Optional.empty, lock=Optional.empty, window=Optional.empty)</span><br><span class="line">16:48:01.374 [ShardingSphere-Command-2] INFO ShardingSphere-SQL - Actual SQL: read_ds_0 ::: SELECT  id,uname  FROM t_user</span><br><span class="line"></span><br><span class="line">16:48:01.448 [ShardingSphere-Command-3] INFO ShardingSphere-SQL - Logic SQL: SELECT  id,uname  FROM t_user</span><br><span class="line">16:48:01.449 [ShardingSphere-Command-3] INFO ShardingSphere-SQL - SQLStatement: MySQLSelectStatement(table=Optional.empty, limit=Optional.empty, lock=Optional.empty, window=Optional.empty)</span><br><span class="line">16:48:01.449 [ShardingSphere-Command-3] INFO ShardingSphere-SQL - Actual SQL: read_ds_1 ::: SELECT  id,uname  FROM t_user</span><br></pre></td></tr></tbody></table></figure><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/f1aa7409.html" title="ShardingSphere-Proxy 入门教程之一">https://www.techgrow.cn/posts/f1aa7409.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" rel="tag"><i class="fa fa-tag"></i> 微服务</a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a><a href="/tags/ORM/" rel="tag"><i class="fa fa-tag"></i> ORM</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/17b5887e.html" rel="prev" title="Dubbo 3 入门教程之一"><i class="fa fa-angle-left"></i> Dubbo 3 入门教程之一</a></div><div class="post-nav-item"> <a href="/posts/d1af7n03.html" rel="next" title="ShardingSphere-Proxy 入门教程之二">ShardingSphere-Proxy 入门教程之二<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2.3m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">35:01</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/f1aa7409.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div><div id="moon-menu-item-code" class="moon-menu-item"><i class="fa-solid fa-code"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>