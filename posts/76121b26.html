<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 Kubernetes 的入门使用教程。"><meta property="og:type" content="article"><meta property="og:title" content="Kubernetes 入门教程之六"><meta property="og:url" content="https://www.techgrow.cn/posts/76121b26.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 Kubernetes 的入门使用教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2025/09/k8s-scheduler-1.png"><meta property="article:published_time" content="2025-09-17T13:12:19.000Z"><meta property="article:modified_time" content="2025-09-17T13:12:19.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="容器化"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2025/09/k8s-scheduler-1.png"><link rel="canonical" href="https://www.techgrow.cn/posts/76121b26.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/76121b26.html","path":"posts/76121b26.html","title":"Kubernetes 入门教程之六"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Kubernetes 入门教程之六 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kubernetes-%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF"><span class="nav-text">Kubernetes 核心技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E5%BA%A6%E5%99%A8"><span class="nav-text">调度器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E5%BA%A6%E5%99%A8%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="nav-text">调度器的概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#K8s-%E7%9A%84%E8%B5%84%E6%BA%90%E5%88%86%E7%B1%BB"><span class="nav-text">K8s 的资源分类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#K8s-%E8%B0%83%E5%BA%A6%E5%99%A8%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="nav-text">K8s 调度器的概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#K8s-%E8%B0%83%E5%BA%A6%E5%99%A8%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-text">K8s 调度器的工作流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#K8s-%E8%B0%83%E5%BA%A6%E5%99%A8%E7%9A%84%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="nav-text">K8s 调度器的核心特性</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8A%82%E7%82%B9%E4%BA%B2%E5%92%8C%E6%80%A7%E8%B0%83%E5%BA%A6"><span class="nav-text">节点亲和性调度</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Pod-%E4%BA%B2%E5%92%8C%E6%80%A7%E8%B0%83%E5%BA%A6"><span class="nav-text">Pod 亲和性调度</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Pod-%E5%8F%8D%E4%BA%B2%E5%92%8C%E6%80%A7%E8%B0%83%E5%BA%A6"><span class="nav-text">Pod 反亲和性调度</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B1%A1%E7%82%B9%E5%92%8C%E5%AE%B9%E5%BF%8D%E5%BA%A6"><span class="nav-text">污点和容忍度</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Pod-%E4%BC%98%E5%85%88%E7%BA%A7%E4%B8%8E%E6%8A%A2%E5%8D%A0%E5%BC%8F%E8%B0%83%E5%BA%A6"><span class="nav-text">Pod 优先级与抢占式调度</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86"><span class="nav-text">配置管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Secret"><span class="nav-text">Secret</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Secret-%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="nav-text">Secret 的介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Secret-%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-text">Secret 的创建</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Secret-%E7%9A%84%E6%9F%A5%E7%9C%8B"><span class="nav-text">Secret 的查看</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Secret-%E7%9A%84%E6%9B%B4%E6%94%B9"><span class="nav-text">Secret 的更改</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Secret-%E7%9A%84%E5%88%A0%E9%99%A4"><span class="nav-text">Secret 的删除</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%A8-Pod-%E4%B8%AD%E4%BD%BF%E7%94%A8-Secret"><span class="nav-text">在 Pod 中使用 Secret</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Secret-%E7%9A%84%E5%AE%8C%E6%95%B4%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="nav-text">Secret 的完整使用案例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ConfigMap"><span class="nav-text">ConfigMap</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ConfigMap-%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="nav-text">ConfigMap 的介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ConfigMap-%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-text">ConfigMap 的创建</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ConfigMap-%E7%9A%84%E6%9F%A5%E7%9C%8B"><span class="nav-text">ConfigMap 的查看</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ConfigMap-%E7%9A%84%E6%9B%B4%E6%94%B9"><span class="nav-text">ConfigMap 的更改</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ConfigMap-%E7%9A%84%E5%88%A0%E9%99%A4"><span class="nav-text">ConfigMap 的删除</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%A8-Pod-%E4%B8%AD%E4%BD%BF%E7%94%A8-ConfigMap"><span class="nav-text">在 Pod 中使用 ConfigMap</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ConfigMap-%E7%9A%84%E5%AE%8C%E6%95%B4%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="nav-text">ConfigMap 的完整使用案例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ConfigMap-%E5%AE%9E%E7%8E%B0-Nginx-%E8%87%AA%E5%8A%A8%E7%83%AD%E6%9B%B4%E6%96%B0"><span class="nav-text">ConfigMap 实现 Nginx 自动热更新</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">742</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/76121b26.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Kubernetes 入门教程之六 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 Kubernetes 的入门使用教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Kubernetes 入门教程之六</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2025-09-17 21:12:19" itemprop="dateCreated datePublished" datetime="2025-09-17T21:12:19+08:00">2025-09-17</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/76121b26.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/76121b26.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>11k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>10 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/99bf51b3.html">Kubernetes 入门教程之一</a>、<a href="/posts/c57e8370.html">Kubernetes 入门教程之二</a>、<a href="/posts/2722157d.html">Kubernetes 入门教程之三</a></li><li><a href="/posts/37a21b7b.html">Kubernetes 入门教程之四</a>、<a href="/posts/6bf07963.html">Kubernetes 入门教程之五</a>、<a href="/posts/76121b26.html">Kubernetes 入门教程之六</a></li><li><a href="/posts/2ca57d7f.html">Kubernetes 入门教程之七</a>、<a href="/posts/723af70c.html">Kubernetes 入门教程之八</a></li></ul><h2 id="Kubernetes-核心技术"><a href="#Kubernetes-核心技术" class="headerlink" title="Kubernetes 核心技术"></a>Kubernetes 核心技术</h2><span id="more"></span><h3 id="调度器"><a href="#调度器" class="headerlink" title="调度器"></a>调度器</h3><h4 id="调度器的概述"><a href="#调度器的概述" class="headerlink" title="调度器的概述"></a>调度器的概述</h4><p>一个容器平台的核心功能是为容器分配运行所需的计算、存储和网络资源。其中，容器调度系统负责在最合适的主机上启动容器，并将相关容器进行关联。它必须能够自动处理容器故障，并在应用访问量增加时，自动在更多主机上启动容器以应对扩展需求。目前，主流的三大容器平台 Swarm、Mesos 和 Kubernetes 各自拥有不同的调度系统：</p><ul><li>Swarm：直接调度 Docker 容器，并提供与标准 Docker API 一致的接口，使用起来较为简单。</li><li>Mesos：采用多框架并行的调度模型，不同运行框架拥有相对独立的调度系统。其中，Marathon 框架对 Docker 容器提供了原生支持。</li><li>Kubernetes：引入 Pod 和 Label 的概念，将一组有依赖关系的容器组合成一个逻辑单元 Pod，并以 Pod 为基本单位进行部署和调度。同时，多个 Pod 可以通过 Service 形成一个完整的服务。</li></ul><p>Kubernetes 通过这种抽象，简化了集群范围内相关容器的共同调度和管理复杂度。从另一个角度看，这种设计使得 Kubernetes 更容易实现功能更强大、逻辑更复杂的容器调度算法，这也是其与 Swarm 和 Mesos 的主要区别所在。</p><h4 id="K8s-的资源分类"><a href="#K8s-的资源分类" class="headerlink" title="K8s 的资源分类"></a>K8s 的资源分类</h4><p>Kubernetes 调度器作为整个集群的 “大脑”，在提升集群资源利用率和保障服务稳定运行方面起着至关重要的作用，其重要性也会随着集群规模和复杂度的提升而不断增加。在 Kubernetes 中，资源可分为两类：</p><ul><li><p>可压缩资源（Compressible Resources）</p><ul><li>这类资源可以被限制或回收，例如 CPU 周期、磁盘 I/O 带宽等。</li><li>当 Pod 资源不足时，Kubernetes 可以通过降低资源分配的方式来限制 Pod 对这些资源的使用，而无需直接杀掉 Pod。</li></ul></li><li><p>不可压缩资源（Incompressible Resources）</p><ul><li>这类资源一旦被 Pod 占用，除非终止 Pod，否则无法回收，例如内存、硬盘空间等。</li><li>当 Pod 占用不可压缩资源过多且无法满足需求时，Kubernetes 只能通过驱逐（Eviction）或杀掉 Pod 来释放资源。</li></ul></li></ul><p>未来，Kubernetes 还将支持更多类型的资源，如网络带宽、存储 IOPS 等，使得调度和资源管理更加精细化和智能化。</p><h4 id="K8s-调度器的概述"><a href="#K8s-调度器的概述" class="headerlink" title="K8s 调度器的概述"></a>K8s 调度器的概述</h4><p><code>kube-scheduler</code> 是 Kubernetes 系统的核心组件之一，主要负责整个集群的资源调度工作。它通过特定的调度算法和调度策略，将 Pod 调度到最合适的 Node（工作节点） 上，从而更高效、更合理地利用集群资源。这也是企业选择 Kubernetes 的一个重要原因：如果一项新技术不能帮助企业节约成本、提升效率，那么它将很难被真正落地和推广。</p><h4 id="K8s-调度器的工作流程"><a href="#K8s-调度器的工作流程" class="headerlink" title="K8s 调度器的工作流程"></a>K8s 调度器的工作流程</h4><blockquote><p>K8s 调度器的简介</p></blockquote><p><code>kube-scheduler</code> 是一个独立的二进制程序，启动后会持续监听 API Server，获取所有 <code>PodSpec.NodeName</code> 为空的 Pod，并为其执行调度。每个成功调度的 Pod，调度器都会生成一个 Binding 对象 并存入 Etcd，随后目标节点上的 Kubelet 会根据调度结果创建 Pod。在默认情况下，<code>kube-scheduler</code> 内置的默认调度器已经能够满足大多数场景的需求。例如，默认策略可以保证 Pod 被分配到资源充足的节点上运行。但在实际生产环境中，企业往往对业务需求和应用特性有更深入的了解，因此需要更灵活、可控的调度策略，例如：</p><ul><li>限制某些 Pod 只能运行在特定节点上；</li><li>某些节点只允许运行特定类型的应用；</li><li>针对资源隔离、安全性或性能优化进行特殊调度。</li></ul><div class="admonition note"><p class="admonition-title">Pod 的创建流程</p><p>更多关于 Pod 的创建流程的介绍，可以看 <a href="/posts/c57e8370.html#Pod-%E7%9A%84%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B">这里</a>。</p></div><blockquote><p>K8s 调度器的工作流程</p></blockquote><p>K8s 调度器的工作流程主要分为以下四个阶段：</p><ul><li><p>(1) 预选阶段（Predicates）— 节点过滤</p><ul><li>在该阶段，K8s 调度器会根据一系列规则过滤掉不符合要求的节点，形成候选节点列表。</li><li>例如，当 Pod 设置了资源 <code>requests</code>，如果某节点的可用资源不足，则该节点会被过滤掉。</li><li>常见的 Predicates 过滤算法：<table><thead><tr><th>算法名称</th><th>说明</th></tr></thead><tbody><tr><td><code>PodFitsResources</code></td><td>节点剩余资源是否满足 Pod 的资源请求（CPU / 内存等）。</td></tr><tr><td><code>PodFitsHost</code></td><td>如果 Pod 指定了 <code>NodeName</code>，检查节点名称是否匹配。</td></tr><tr><td><code>PodFitsHostPorts</code></td><td>节点上已使用的端口是否与 Pod 申请的端口冲突。</td></tr><tr><td><code>PodSelectorMatches</code></td><td>节点的标签是否与 Pod 指定的 <code>labelSelector</code> 匹配。</td></tr><tr><td><code>NoDiskConflict</code></td><td>检查 Pod 所需的 Volume 是否与节点上已挂载的 Volume 冲突（只读 Volume 除外）。</td></tr><tr><td><code>CheckNodeDiskPressure</code></td><td>节点磁盘压力是否过大，是否满足调度要求。</td></tr><tr><td><code>CheckNodeMemoryPressure</code></td><td>节点内存压力是否过大，是否满足调度要求。</td></tr></tbody></table></li></ul></li><li><p>(2) 优选阶段（Priorities）— 节点打分</p><ul><li>在该阶段，K8s 调度器会对通过预选阶段的节点进行打分，分数越高，表示该节点越适合部署该 Pod。</li><li>打分规则是由一组键值对组成的：<ul><li>键：优先级策略的名称</li><li>值：该策略的权重</li></ul></li><li>常见的 Priorities 优先级策略：<table><thead><tr><th>优先级策略</th><th>说明</th></tr></thead><tbody><tr><td><code>LeastRequestedPriority</code></td><td>根据 CPU 和内存使用率计算权重，使用率越低，权重越高，从而优先选择负载较低的节点。</td></tr><tr><td><code>SelectorSpreadPriority</code></td><td>为了实现高可用，将同一个 Deployment / Replica Set 下的多个 Pod 尽量分散到不同节点上。运行该类型 Pod 数量较少的节点权重更高。</td></tr><tr><td><code>ImageLocalityPriority</code></td><td>如果某节点已经存在 Pod 需要的镜像，且镜像总大小越大，则该节点权重越高，从而减少镜像拉取时间。</td></tr><tr><td><code>NodeAffinityPriority</code></td><td>根据 Node Affinity（节点亲和性）规则计算权重，优先调度到符合亲和性条件的节点上。</td></tr></tbody></table></li></ul></li><li><p>(3) 绑定阶段（Binding）</p><ul><li>K8s 调度器会从打分结果中选择分数最高的节点，将该 Pod 与该 Node（工作节点）进行绑定（Binding）。</li><li>绑定结果会被写入 Etcd，供集群其他组件使用。</li></ul></li><li><p>(4) Kubelet 执行</p><ul><li>最终被选定的 Node（工作节点）对应的 Kubelet 会接收到绑定信息，随后拉取容器镜像并创建 Pod。</li></ul></li></ul><blockquote><p>K8s 调度器的工作流程图</p></blockquote><p><img data-src="../../../asset/2025/09/k8s-scheduler-1.png"></p><div class="admonition note"><p class="admonition-title">提示</p><p>K8s 调度器除了有上面介绍的 Predicates 过滤算法之外，还有一些其他的算法，更多更详细的过滤算法可以查看源码文件：<code>k8s.io/kubernetes/pkg/scheduler/algorithm/predicates/predicates.go</code>。</p></div><h4 id="K8s-调度器的核心特性"><a href="#K8s-调度器的核心特性" class="headerlink" title="K8s 调度器的核心特性"></a>K8s 调度器的核心特性</h4><div class="admonition note"><p class="admonition-title">提示</p><p>更多关于影响 Pod 调度的因素可以看<a href="/posts/c57e8370.html#%E5%BD%B1%E5%93%8D-Pod-%E8%B0%83%E5%BA%A6%E7%9A%84%E5%9B%A0%E7%B4%A0">这里</a>。</p></div><h5 id="节点亲和性调度"><a href="#节点亲和性调度" class="headerlink" title="节点亲和性调度"></a>节点亲和性调度</h5><ul><li><p>概述：</p><ul><li>K8s 节点亲和性（Node Affinity）规则有两种：硬亲和性（<code>required</code>）、软亲和性（<code>preferred</code>）。</li></ul></li><li><p>特性：</p><ul><li>比 <code>nodeSelector</code> 字段更灵活的规则。</li><li>支持硬亲和性（约束条件必须满足）和软亲和性（尝试满足约束条件，但不保证满足）。</li><li>支持常用操作：<code>In</code>、<code>NotIn</code>、<code>Exists</code>、<code>Gt</code>、<code>Lt</code>、<code>DoesNotExist</code>。</li></ul></li><li><p>配置示例一：</p></li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myapp-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">nodeAffinity:</span></span><br><span class="line">          <span class="comment"># 节点软亲和性：Pod 优先调度到符合条件的节点，但不是强制要求</span></span><br><span class="line">          <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">60</span></span><br><span class="line">              <span class="attr">preference:</span></span><br><span class="line">                <span class="attr">matchExpressions:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">zone</span></span><br><span class="line">                    <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                    <span class="attr">values:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">foo</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">30</span></span><br><span class="line">              <span class="attr">preference:</span></span><br><span class="line">                <span class="attr">matchExpressions:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">ssd</span></span><br><span class="line">                    <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">ikubernetes/myapp:v1</span></span><br></pre></td></tr></tbody></table></figure><ul><li>配置示例二：</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myapp-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">nodeAffinity:</span></span><br><span class="line">          <span class="comment"># 节点硬亲和性：Pod 只能调度到满足条件的节点</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">            <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">matchExpressions:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">env_role</span></span><br><span class="line">                    <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                    <span class="attr">values:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">dev</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line">          <span class="comment"># 节点软亲和性：Pod 优先调度到符合条件的节点，但不是强制要求</span></span><br><span class="line">          <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">1</span></span><br><span class="line">              <span class="attr">preference:</span></span><br><span class="line">                <span class="attr">matchExpressions:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">group</span></span><br><span class="line">                    <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                    <span class="attr">values:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">otherprod</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">ikubernetes/myapp:v1</span></span><br></pre></td></tr></tbody></table></figure><h5 id="Pod-亲和性调度"><a href="#Pod-亲和性调度" class="headerlink" title="Pod 亲和性调度"></a>Pod 亲和性调度</h5><p>K8s 的 Pod 亲和性（Pod Affinity）用于控制 Pod 倾向于与指定 Pod 调度到同一拓扑域，常用于需要紧密协作或低延迟通信的场景。</p><ul><li>可用于将相互依赖的 Pod 部署在同一机架（Rack）或同一可用区（Zone），以降低网络延迟、提升性能。</li><li>例如：<ul><li><code>topologyKey: kubernetes.io/hostname</code>：倾向于将 Pod 调度到同一 Node（工作节点）。</li><li><code>topologyKey: zone</code>：倾向于将 Pod 调度到同一可用区。</li></ul></li></ul><p>Pod 亲和性调度的配置示例：</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">busybox-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">busybox</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="comment"># Pod 亲和性调度</span></span><br><span class="line">        <span class="attr">podAffinity:</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">labelSelector:</span></span><br><span class="line">                <span class="attr">matchExpressions:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app</span></span><br><span class="line">                    <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                    <span class="attr">values:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">myapp</span></span><br><span class="line">              <span class="attr">topologyKey:</span> <span class="string">zone</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">busybox:latest</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">command:</span> [<span class="string">"/bin/sh"</span>, <span class="string">"-c"</span>, <span class="string">"sleep 3600"</span>]</span><br></pre></td></tr></tbody></table></figure><ul><li><p>配置说明：</p><ul><li>Kubernetes 调度器会强制保证，Pod 调度到与匹配 <code>labelSelector</code> 条件的 Pod 所在的同一 <code>zone</code> 中。</li><li>如果集群中所有 <code>zone</code> 都没有匹配的 Pod，则新 Pod 会一直处于 <code>Pending</code> 状态。</li></ul></li><li><p>配置参数：</p></li></ul><table><thead><tr><th>字段</th><th>作用</th></tr></thead><tbody><tr><td><code>requiredDuringSchedulingIgnoredDuringExecution</code></td><td>硬亲和性约束：必须满足条件，否则 Pod 无法被调度。</td></tr><tr><td><code>labelSelector.matchExpressions</code></td><td>指定匹配条件，比如匹配拥有 <code>app=myapp</code> 标签的 Pod。</td></tr><tr><td><code>topologyKey</code></td><td>定义拓扑域的维度，如 <code>zone</code>、<code>kubernetes.io/hostname</code> 等。</td></tr></tbody></table><h5 id="Pod-反亲和性调度"><a href="#Pod-反亲和性调度" class="headerlink" title="Pod 反亲和性调度"></a>Pod 反亲和性调度</h5><p>K8s 的 Pod 反亲和性（Pod AntiAffinity）用于控制 Pod 不与指定 Pod 调度到同一拓扑域，常用于高可用场景。</p><ul><li>可用于将 Pod 副本分布到不同机架（Rack）或可用区（Zone） 中，避免单点故障。</li><li>例如：<ul><li><code>topologyKey: kubernetes.io/hostname</code>：避免 Pod 调度到同一 Node（工作节点）。</li><li><code>topologyKey: zone</code>：避免 Pod 调度到同一可用区。</li></ul></li></ul><p>Pod 反亲和性调度的配置示例：</p><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">busybox-deployment</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">busybox</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">busybox:latest</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">          <span class="attr">command:</span> [<span class="string">"/bin/sh"</span>, <span class="string">"-c"</span>, <span class="string">"sleep 3600"</span>]</span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="comment"># Pod 反亲和性调度</span></span><br><span class="line">        <span class="attr">podAntiAffinity:</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">labelSelector:</span></span><br><span class="line">                <span class="attr">matchExpressions:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app</span></span><br><span class="line">                    <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                    <span class="attr">values:</span></span><br><span class="line">                      <span class="bullet">-</span> <span class="string">myapp</span></span><br><span class="line">              <span class="attr">topologyKey:</span> <span class="string">zone</span></span><br></pre></td></tr></tbody></table></figure><ul><li><p>配置说明：</p><ul><li>Kubernetes 调度器会强制保证，同一 <code>zone</code> 下，不会与匹配 <code>labelSelector</code> 条件的 Pod 同时调度运行。</li><li>如果所有 <code>zone</code> 都有匹配的 Pod，则新 Pod 会一直处于 <code>Pending</code> 状态。</li></ul></li><li><p>配置参数：</p></li></ul><table><thead><tr><th>字段</th><th>作用</th></tr></thead><tbody><tr><td><code>requiredDuringSchedulingIgnoredDuringExecution</code></td><td>硬亲和性约束：必须满足条件，否则 Pod 无法被调度。</td></tr><tr><td><code>labelSelector.matchExpressions</code></td><td>指定匹配条件，比如匹配拥有 <code>app=myapp</code> 标签的 Pod。</td></tr><tr><td><code>topologyKey</code></td><td>定义拓扑域的维度，如 <code>zone</code>、<code>kubernetes.io/hostname</code> 等。</td></tr></tbody></table><h5 id="污点和容忍度"><a href="#污点和容忍度" class="headerlink" title="污点和容忍度"></a>污点和容忍度</h5><blockquote><p>污点（Taints）</p></blockquote><ul><li><p>污点的定义：</p><ul><li>定义在节点（Node）上的键值型属性数据。</li><li>即 <code>nodes.spec.taints</code>，语法是 <code>key=value:effect</code>。</li></ul></li><li><p>污点的作用：</p><ul><li>让节点拒绝调度 Pod 到其上，除非 Pod 显式声明可以容忍该污点。</li></ul></li><li><p>污点的适用场景：</p><ul><li>专用节点隔离：保留节点给特定 Pod（如 GPU 节点只运行 AI 任务）</li><li>节点维护：标记节点为不可调度（如 <code>NoSchedule）</code>，避免新 Pod 被分配到正在维护的节点</li><li>特殊硬件限制：防止普通 Pod 调度到带特殊硬件（如 FPGA）的节点</li></ul></li><li><p>污点的类型：</p></li></ul><table><thead><tr><th>污点类型（Effect）</th><th>作用</th><th>对已运行 Pod 的影响</th><th>典型场景</th></tr></thead><tbody><tr><td> NoSchedule</td><td> 新的 Pod 无法调度到该节点，除非 Pod 明确声明容忍该污点</td><td>不容忍此污点的 Pod 不会被驱逐</td><td>保留节点给特定用途（如 GPU 节点、生产环境专用节点）</td></tr><tr><td>PreferNoSchedule</td><td> 调度器尽量避免将 Pod 调度到该节点，但若无其他节点可选，仍可被调度</td><td>不容忍此污点的 Pod 不会被驱逐</td><td>软性隔离，如临时维护节点但不强制拒绝调度</td></tr><tr><td> NoExecute</td><td> 新的 Pod 无法调度到该节点（与 NoSchedule 相同）</td><td>不容忍此污点的 Pod 会被驱逐（Evict）</td><td>节点故障或紧急隔离，如磁盘损坏需立即迁移所有 Pod</td></tr></tbody></table><ul><li> 节点的污点操作示例：</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 给节点打污点</span></span><br><span class="line">kubectl taint nodes &lt;node-name&gt; &lt;key&gt;=&lt;value&gt;:NoSchedule</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看节点的污点</span></span><br><span class="line">kubectl describe node &lt;node-name&gt; | grep Taint</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除节点的单个污点（末尾的 "-" 符号表示删除）</span></span><br><span class="line">kubectl taint nodes &lt;node-name&gt; &lt;key&gt;:NoSchedule-</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除节点的指定键的所有污点（末尾的 "-" 符号表示删除）</span></span><br><span class="line">kubectl taint nodes &lt;node-name&gt; &lt;key&gt;-</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除节点的所有污点</span></span><br><span class="line">kubectl patch nodes &lt;node-name&gt;<span class="params"> -p</span> <span class="string">'{"spec":{"taints":[]}}'</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p>容忍度（Tolerations）</p></blockquote><ul><li><p>容忍度的定义：</p><ul><li>定义在 Pod 上的键值型属性数据。</li><li>即 <code>pods.spec.tolerations</code>，语法是 <code>key=value:effect</code>。</li></ul></li><li><p>容忍度的作用：</p><ul><li>声明 Pod 可以容忍哪些污点，允许其被调度到具有这些污点的节点上。</li></ul></li><li><p>容忍度的调度规则：</p><ul><li>Pod 优先调度到没有污点的节点。</li><li>如果目标节点有污点，则 Pod 必须显式声明容忍该污点，否则无法被调度过去。</li></ul></li><li><p>容忍度的适用场景：</p><ul><li>特权 Pod 调度：允许关键 Pod（如日志收集组件）无视污点，调度到任意节点</li><li>故障恢复：容忍 <code>NoExecute</code> 污点，使 Pod 在节点故障时不被驱逐（如数据库 Pod）</li><li>共享特殊节点：让普通 Pod 通过容忍临时使用专用节点（如容忍 GPU 节点污点）</li></ul></li><li><p>容忍度的类型：</p></li></ul><table><thead><tr><th>容忍度类型（Effect）</th><th>作用</th><th>典型场景</th></tr></thead><tbody><tr><td> NoSchedule</td><td> 允许 Pod 调度到带有 <code>NoSchedule</code> 污点的节点，无视节点的硬性隔离规则</td><td>关键 Pod，如存储服务、核心系统组件</td></tr><tr><td> PreferNoSchedule</td><td> 允许 Pod 调度到带有 <code>PreferNoSchedule</code> 污点的节点，但调度器仍会优先选择其他节点</td><td>非关键 Pod 在资源不足时，仍可使用软隔离节点</td></tr><tr><td> NoExecute</td><td>1. 允许 Pod 调度到带有 <code>NoExecute</code> 污点的节点<br>2. 豁免驱逐：即使节点新增 NoExecute 污点，Pod 也不会被驱逐</td><td>守护进程（如日志收集器、监控代理）需长期运行，无视节点维护状态</td></tr><tr><td>空值（未指定 Effect）</td><td>容忍所有类型的污点，包括未来新增的类型</td><td>超级特权 Pod，如集群管理组件、CNI/CSI 插件等需在所有节点运行</td></tr></tbody></table><ul><li> Pod 的容忍度配置示例：</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">tolerations:</span></span><br><span class="line"><span class="comment"># 仅容忍 NoSchedule 污点</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">key:</span> <span class="string">"dedicated"</span></span><br><span class="line">  <span class="attr">operator:</span> <span class="string">"Equal"</span></span><br><span class="line">  <span class="attr">value:</span> <span class="string">"gpu"</span></span><br><span class="line">  <span class="attr">effect:</span> <span class="string">"NoSchedule"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 容忍 NoExecute 污点（并豁免驱逐）</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">key:</span> <span class="string">"node.kubernetes.io/unreachable"</span></span><br><span class="line">  <span class="attr">operator:</span> <span class="string">"Exists"</span></span><br><span class="line">  <span class="attr">effect:</span> <span class="string">"NoExecute"</span></span><br><span class="line">  <span class="attr">tolerationSeconds:</span> <span class="number">600</span>  <span class="comment"># 延迟 600 秒后驱逐（可选）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 容忍所有污点（危险！慎用！）</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">operator:</span> <span class="string">"Exists"</span></span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>污点提供了让节点（Node）排斥运行特定 Pod 对象的能力。</li><li>节点亲和性（Node Affinity）调度使得 Pod 对象被吸引运行到一类特定的节点上。</li></ul></div><h5 id="Pod-优先级与抢占式调度"><a href="#Pod-优先级与抢占式调度" class="headerlink" title="Pod 优先级与抢占式调度"></a>Pod 优先级与抢占式调度</h5><p>在 Pod 上定义容忍度时，Pod 的优先级与抢占式调度机制如下：</p><ul><li><p>优先级（Pod Priority）</p><ul><li>表示 Pod 对象的重要程度。</li><li>作用：<ul><li>影响调度顺序：高优先级 Pod 会优先被调度。</li><li>影响驱逐次序：节点资源不足时，低优先级 Pod 会先被驱逐。</li></ul></li></ul></li><li><p>抢占机制（Preemption）</p><ul><li>当一个 Pod 无法被调度时，调度器会尝试驱逐节点上优先级更低的 Pod，为当前高优先级 Pod 腾出资源。</li><li>适合关键业务 Pod 需要资源保障的场景。</li></ul></li><li><p>默认状态</p><ul><li>Pod 优先级与抢占式调度机制默认处于禁用状态，需要手动开启。</li></ul></li><li><p>启用方法</p><ul><li>在以下组件的启动参数中增加 <code>--feature-gates=PodPriority=true</code>：<ul><li><code>kube-apiserver</code></li><li><code>kube-scheduler</code></li><li><code>kubelet</code></li></ul></li></ul></li><li><p>使用步骤</p><ul><li><p>(1) 创建优先级类别（<code>PriorityClass</code>）</p><ul><li>定义不同的优先级，如关键业务、高优先级、低优先级等。</li><li>配置示例：<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">scheduling.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PriorityClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">high-priority</span>                               <span class="comment"># 优先级类别名称</span></span><br><span class="line"><span class="attr">value:</span> <span class="number">1000</span>                                         <span class="comment"># 优先级值，数值越大优先级越高</span></span><br><span class="line"><span class="attr">globalDefault:</span> <span class="literal">false</span>                                <span class="comment"># 是否为默认优先级类别</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">"用于关键业务 Pod，例如存储、网络组件"</span>      <span class="comment"># 优先级的描述信息</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">scheduling.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PriorityClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">low-priority</span>                                <span class="comment"># 优先级类别名称</span></span><br><span class="line"><span class="attr">value:</span> <span class="number">100</span>                                          <span class="comment"># 优先级值，数值越大优先级越高</span></span><br><span class="line"><span class="attr">globalDefault:</span> <span class="literal">false</span>                                <span class="comment"># 是否为默认优先级类别</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">"用于低优先级 Pod，例如测试或批处理任务"</span>     <span class="comment"># 优先级的描述信息</span></span><br></pre></td></tr></tbody></table></figure></li></ul></li><li><p>(2) 在 Pod 中指定优先级</p><ul><li>创建 Pod 时，通过 <code>priorityClassName</code> 属性绑定到对应的优先级类别。</li><li>配置示例：<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">critical-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">priorityClassName:</span> <span class="string">high-priority</span>    <span class="comment"># Pod 绑定高优先级类别</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">critical-container</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx</span></span><br></pre></td></tr></tbody></table></figure></li></ul></li></ul></li></ul><div class="admonition note"><p class="admonition-title">Pod 的优先级与抢占式调度总结</p><p>高优先级 Pod 无法被调度 → 调度器检查目标节点 → 驱逐低优先级 Pod → 为高优先级 Pod 腾出资源 → 高优先级 Pod 调度成功。</p></div><h3 id="配置管理"><a href="#配置管理" class="headerlink" title="配置管理"></a>配置管理</h3><h4 id="Secret"><a href="#Secret" class="headerlink" title="Secret"></a>Secret</h4><h5 id="Secret-的介绍"><a href="#Secret-的介绍" class="headerlink" title="Secret 的介绍"></a>Secret 的介绍</h5><ul><li><p>Secret 的概述</p><ul><li>Secret 是 Kubernetes 中一种用于存储敏感数据的对象类型。</li><li>Secret 会将敏感数据存储在 Etcd 里面，让 Pod 容器以环境变量或者挂载 Volume（卷）的方式进行访问。</li><li>Secret 的主要设计目标是：避免将敏感信息直接写入 Pod 的镜像或配置文件（如 Deployment、ConfigMap）中。</li><li>这些敏感数据包括（不限于）：<ul><li>数据库的用户名和密码</li><li> API Token 或访问密钥</li><li> SSL/TLS 私钥和证书</li><li> SSH 密钥</li></ul></li></ul></li><li><p> Secret 的作用</p></li></ul><table><thead><tr><th>作用</th><th>说明</th></tr></thead><tbody><tr><td>保护敏感信息</td><td>通过 Base64 编码的形式保存机密数据，防止在 YAML 文件中明文出现。</td></tr><tr><td>与 Pod 解耦</td><td>应用不直接携带凭证，Secret 可独立管理、更新和分发。</td></tr><tr><td>灵活挂载</td><td>可作为环境变量或 Volume（卷）文件挂载到容器中。</td></tr><tr><td>与 ServiceAccount 结合使用</td><td>可用于保存访问 API Server 的 Token 等认证信息。</td></tr><tr><td>支持自动轮换和更新</td><td>可结合控制器或外部系统（如 Vault）可实现密钥动态更新。</td></tr></tbody></table><ul><li>Secret 的类型</li></ul><table><thead><tr><th> Secret 类型</th><th>用途说明</th></tr></thead><tbody><tr><td> Opaque</td><td> 默认类型，用于存放任意用户定义的键值对。</td></tr><tr><td>kubernetes.io/dockerconfigjson</td><td> 存放 Docker Registry 的认证信息，用于拉取私有镜像。</td></tr><tr><td>kubernetes.io/service-account-token</td><td> 系统自动创建，用于 ServiceAccount 与 API Server 通信。</td></tr><tr><td>kubernetes.io/tls</td><td> 存放 TLS 证书与私钥，用于 HTTPS、Ingress 等场景。</td></tr><tr><td>bootstrap.kubernetes.io/token</td><td> 集群引导时 Kubelet 注册节点所用的临时令牌。</td></tr></tbody></table><ul><li>Secret 的使用场景</li></ul><table><thead><tr><th>使用场景</th><th>使用说明</th></tr></thead><tbody><tr><td>应用访问数据库</td><td>存放数据库的账号密码，通过环境变量注入。</td></tr><tr><td>拉取私有镜像</td><td>创建 Docker Registry Secret 供 <code>imagePullSecrets</code> 使用。</td></tr><tr><td>HTTPS 服务</td><td>存放 TLS 证书，用于 Ingress 或自签服务。</td></tr><tr><td>外部 API 调用</td><td>存放第三方服务的 API Token。</td></tr><tr><td>集群内部通信认证</td><td> ServiceAccount Token 类型 Secret。</td></tr></tbody></table><ul><li>Secret 的注意事项<ul><li>虽然 Secret 可以用于保护敏感信息，但它并非绝对安全：<ul><li>默认仅使用 Base64 编码，并未将信息加密存储；</li><li>通常需要启用 Kubernetes Encryption at Rest，确保在 Etcd 中加密存储；</li><li>合理配置集群安全机制（RBAC），限制访问 Secret 的权限；</li><li>避免将 Secret 信息直接输出到日志文件或终端；</li><li>建议结合外部安全系统（如 HashiCorp Vault、Sealed Secrets、External Secrets Operator）进行管理。</li></ul></li><li>Secret 以 Volume（卷）的方式挂载时支持热更新<ul><li> <strong>Secret 更新后，不会自动更新 Pod 容器内的环境变量，也不会触发容器重启；</strong></li><li><strong>但是，如果 Secret 是以 Volume（卷）的方式挂载，并且该挂载未使用 <code>subPath</code>，则 Pod 容器内的文件内容会在 60 秒内自动更新（热更新）；</strong></li><li>另外，应用程序需要在运行时重新读取这些文件（例如通过文件监听或定时重新加载配置）才能真正实现热更新。</li></ul></li><li>通过控制器（如 Deployment）触发 Pod 重启可以实现 Secret 更新生效<ul><li>更改 Secret 后，可以手动触发 Deployment 滚动重启（比如执行 <code>kubectl rollout restart deployment &lt;name&gt;</code>）；</li><li>Deployment 滚动重启时，Kubernetes 会让该 Deployment 下的所有 Pod 重新创建，但不会更改镜像版本；</li><li>当 Pod 重启后，容器启动时会重新加载 Secret，从而使最新的机密配置生效。</li></ul></li></ul></li></ul><div class="admonition note"><p class="admonition-title">subPath 的作用</p><ul><li><code>subPath</code> 是 Kubernetes 在 Volume 挂载中的一个重要机制，用于只挂载卷里的单个文件或者子目录，而不是整个目录。</li><li><code>subPath</code> 不支持热更新，即使底层 Volume（如 ConfigMap 或 Secret）更新后，挂载到 <code>subPath</code> 的文件也不会自动刷新（热更新）。</li><li><code>subPath</code> 不能用于挂载整个目录时的热更新场景，如果需要实时更新配置（比如热更新 Nginx 配置），不可以使用 <code>subPath</code>。</li></ul></div><h5 id="Secret-的创建"><a href="#Secret-的创建" class="headerlink" title="Secret 的创建"></a>Secret 的创建</h5><p>Secret 的创建通常有以下三种方式：</p><ul><li>通过命令行创建 Secret</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 手动创建 Secret</span></span><br><span class="line">kubectl create secret generic my-secret<span class="params"> --from</span>-literal=username=admin<span class="params"> --from</span>-literal=password=123456</span><br></pre></td></tr></tbody></table></figure><ul><li>通过文件创建 Secret</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret generic db-secret<span class="params"> --from</span>-file=username.txt<span class="params"> --from</span>-file=password.txt</span><br></pre></td></tr></tbody></table></figure><ul><li>通过 YAML 文件（比如 <code>my-secret.yaml</code>）创建 Secret</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-secret</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">YWRtaW4=</span>      <span class="comment"># Base64(admin)</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">MTIzNDU2</span>      <span class="comment"># Base64(123456)</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建或更新 YAML 文件中定义的 Secret 对象</span></span><br><span class="line">kubectl apply<span class="params"> -f</span> my-secret.yaml</span><br></pre></td></tr></tbody></table></figure><h5 id="Secret-的查看"><a href="#Secret-的查看" class="headerlink" title="Secret 的查看"></a>Secret 的查看</h5><ul><li>查看 Secret 的详情</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe secret my-secret</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 Secret 的完整内容</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 Secret 的内容（注意：内容经过 Base64 编码）</span></span><br><span class="line">kubectl get secret my-secret<span class="params"> -o</span> yaml</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 Secret 列表</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看默认命名空间下的所有 Secret</span></span><br><span class="line">kubectl get secrets</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看特定命名空间下的所有 Secret</span></span><br><span class="line">kubectl get secrets<span class="params"> -n</span> dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有命名空间下的 Secret</span></span><br><span class="line">kubectl get secrets<span class="params"> --all</span>-namespaces</span><br></pre></td></tr></tbody></table></figure><h5 id="Secret-的更改"><a href="#Secret-的更改" class="headerlink" title="Secret 的更改"></a>Secret 的更改</h5><p>Secret 的更改有以下几种方式：</p><ul><li>使用 <code>kubectl edit secret</code>（最常用）直接编辑 Secret，默认会打开一个临时编辑器（比如 <code>vi</code> 或 <code>nano</code>），编辑后保存退出即可，保存后会自动更新 Secret。这种方式需要手动对配置内容进行 Base64 编码，比如 <code>echo -n 'newuser' | base64</code>。</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit secret my-secret</span><br></pre></td></tr></tbody></table></figure><ul><li>使用 <code>kubectl apply</code>（声明式更新），如果有一个用于定义 Secret 的 YAML 文件（例如 <code>my-secret.yaml</code>），可以执行以下命令更新 Secret。这种方式可以直接在 YAML 文件中使用未经过 Base64 编码的配置内容，K8s 会自动将其转换成 Base64 编码。</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply<span class="params"> -f</span> my-secret.yaml</span><br></pre></td></tr></tbody></table></figure><ul><li>使用 <code>kubectl patch secret</code>（部分字段更新），只更新指定的字段（无需编辑整个 YAML）。这种方式 K8s 会自动将配置内容转换成 Base64 编码再存入 Etcd 中，不需要手动处理 Base64 编码。</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新单个字段（Key）</span></span><br><span class="line">kubectl patch secret my-secret<span class="params"> -p</span> <span class="string">'{"stringData":{"password":"123456"}}'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同时改两个字段（Key）</span></span><br><span class="line">kubectl patch secret my-secret<span class="params"> -p</span> <span class="string">'{"stringData":{"username":"root","password":"123456"}}'</span></span><br></pre></td></tr></tbody></table></figure><ul><li>直接重新创建 Secret（简单粗暴），也就是先删除旧的 Secret，然后创建新的 Secret。这种方式 K8s 会自动将配置内容转换成 Base64 编码再存入 Etcd 中，不需要手动处理 Base64 编码。</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret generic my-secret<span class="params"> --from</span>-literal=username=root<span class="params"> --from</span>-literal=password=123456<span class="params"> --dry</span>-run=client<span class="params"> -o</span> yaml | kubectl apply<span class="params"> -f</span> -</span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">Secret 热更新说明</p><ul><li>Secret 更新后，不会自动更新 Pod 容器内的环境变量，也不会触发容器重启。</li><li>但是，如果 Secret 是以 Volume（卷）的方式挂载，并且该挂载未使用 <code>subPath</code>，则 Pod 容器内的文件内容会在 60 秒内自动刷新（热更新）。</li></ul></div><h5 id="Secret-的删除"><a href="#Secret-的删除" class="headerlink" title="Secret 的删除"></a>Secret 的删除</h5><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除默认命名空间下的单个 Secret</span></span><br><span class="line">kubectl delete secret my-secret</span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除默认命名空间下的多个 Secret</span></span><br><span class="line">kubectl delete secret my-secret db-secret api-token</span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除默认命名空间下的所有 Secret（慎用），系统自动生成的 ServiceAccount Token Secret 也会被删掉，从而影响 K8s 集群的正常运行</span></span><br><span class="line">kubectl delete secret<span class="params"> --all</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除特定命名空间下的单个 Secret</span></span><br><span class="line">kubectl delete secret my-secret<span class="params"> -n</span> dev</span><br></pre></td></tr></tbody></table></figure><h5 id="在-Pod-中使用-Secret"><a href="#在-Pod-中使用-Secret" class="headerlink" title="在 Pod 中使用 Secret"></a>在 Pod 中使用 Secret</h5><p>Secret 创建后，可以通过以下两种方式供 Pod 容器使用：</p><ul><li>挂载为环境变量，K8s 会将 Secret 中的键值对映射为系统环境变量</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">secret-env-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">demo</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"echo $DB_USER $DB_PASS; tail -f /dev/null"</span>]</span><br><span class="line">    <span class="attr">env:</span>                      <span class="comment"># 定义环境变量</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DB_USER</span>           <span class="comment"># 环境变量名</span></span><br><span class="line">      <span class="attr">valueFrom:</span>              <span class="comment"># 值来源于外部引用</span></span><br><span class="line">        <span class="attr">secretKeyRef:</span>         <span class="comment"># 引用类型为 Secret</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">my-secret</span>     <span class="comment"># Secret 的名称（需事先创建）</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">username</span>       <span class="comment"># Secret 中对应的键</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DB_PASS</span></span><br><span class="line">      <span class="attr">valueFrom:</span></span><br><span class="line">        <span class="attr">secretKeyRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">my-secret</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">password</span></span><br></pre></td></tr></tbody></table></figure><ul><li>挂载为 Volume（卷），K8s 会自动将 Secret 中每个键映射为文件名（最终会自动创建多个文件），文件内容为键对应的值</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">secret-volume-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">demo</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"cat /etc/secret-data/username; tail -f /dev/null"</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span>                     <span class="comment"># 定义容器内要挂载的卷</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">secret-volume</span>             <span class="comment"># 对应下面 volumes 中的卷名称（必须一致）</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/etc/secret-data</span>     <span class="comment"># 将 Secret 内容挂载到容器内的该目录下</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span>                  <span class="comment"># 设置为只读（推荐），防止容器内误修改</span></span><br><span class="line">  <span class="attr">volumes:</span>                            <span class="comment"># 在 Pod 层定义卷（Volume）</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">secret-volume</span>               <span class="comment"># 指定卷的名称</span></span><br><span class="line">    <span class="attr">secret:</span>                           <span class="comment"># 指定卷的类型为 Secret</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">my-secret</span>           <span class="comment"># 指定引用的 Secret 名称（需事先创建）</span></span><br></pre></td></tr></tbody></table></figure><h5 id="Secret-的完整使用案例"><a href="#Secret-的完整使用案例" class="headerlink" title="Secret 的完整使用案例"></a>Secret 的完整使用案例</h5><ul><li>通过 YAML 文件（比如 <code>secret-env-demo.yaml</code>）定义 Secret 和 Pod，并使用环境变量的方式引用 Secret</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义 Secret</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-secret</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">YWRtaW4=</span>      <span class="comment"># Base64(admin)</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">MTIzNDU2</span>      <span class="comment"># Base64(123456)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="comment"># 定义 Pod</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">secret-env-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">demo</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"echo $DB_USER $DB_PASS; tail -f /dev/null"</span>]</span><br><span class="line">    <span class="attr">env:</span>                      <span class="comment"># 定义环境变量</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DB_USER</span>           <span class="comment"># 环境变量名</span></span><br><span class="line">      <span class="attr">valueFrom:</span>              <span class="comment"># 值来源于外部引用</span></span><br><span class="line">        <span class="attr">secretKeyRef:</span>         <span class="comment"># 引用类型为 Secret</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">my-secret</span>     <span class="comment"># Secret 的名称（需事先创建）</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">username</span>       <span class="comment"># Secret 中对应的键</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DB_PASS</span></span><br><span class="line">      <span class="attr">valueFrom:</span></span><br><span class="line">        <span class="attr">secretKeyRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">my-secret</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">password</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建或更新 YAML 文件中定义的 Secret 和 Pod 对象</span></span><br><span class="line">kubectl apply<span class="params"> -f</span> secret-env-demo.yaml</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 Pod 的运行状态</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods<span class="params"> -o</span> wide</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME              READY   STATUS    RESTARTS   AGE    IP            NODE        NOMINATED NODE   READINESS GATES</span><br><span class="line">secret-env-demo   1/1     Running   0          2m4s   10.244.2.46   k8s-node3   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 Pod 的日志信息</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs secret-env-demo</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin 123456</span><br></pre></td></tr></tbody></table></figure><h4 id="ConfigMap"><a href="#ConfigMap" class="headerlink" title="ConfigMap"></a>ConfigMap</h4><p>在 Kubernetes 中，ConfigMap（配置映射）是一种非常重要的配置管理对象，用于将配置数据与应用程序代码分离。它的设计初衷是：应用程序镜像保持通用性，而不同环境下的配置信息（如开发、测试、生产）通过 ConfigMap 动态注入。</p><h5 id="ConfigMap-的介绍"><a href="#ConfigMap-的介绍" class="headerlink" title="ConfigMap 的介绍"></a>ConfigMap 的介绍</h5><ul><li><p>ConfigMap 的概述</p><ul><li>ConfigMap 是一种用于存储非敏感配置信息的键值对集合的 Kubernetes 资源对象。</li><li>ConfigMap 会将非敏感数据存储在 Etcd 里面，让 Pod 容器以环境变量和挂载 Volume（卷）的方式进行访问。</li><li>ConfigMap 的核心思想是：配置应该与镜像解耦，应用部署时再注入配置，换句话说：<ul><li>用户可以在不修改镜像的前提下更改配置；</li><li>用户可以让相同的容器镜像在不同环境中以不同的方式运行。</li></ul></li></ul></li><li><p>ConfigMap 的作用</p><ul><li>配置解耦<ul><li>应用程序不再依赖镜像内置的配置，而是从外部（ConfigMap）加载配置。</li></ul></li><li>集中化管理配置<ul><li>所有 Pod 的环境变量、配置文件都可以统一由 ConfigMap 管理。</li></ul></li><li>灵活的注入方式<ul><li> ConfigMap 可通过以下方式注入到 Pod 容器中：<ul><li>作为环境变量；</li><li>以卷（Volume）挂载的方式出现在容器文件系统中。</li></ul></li></ul></li></ul></li><li><p>ConfigMap 的注意事项</p><ul><li>ConfigMap 不适合存储敏感信息<ul><li>因为信息是明文保存的，敏感信息应该使用 Secret 进行存储。</li></ul></li><li>ConfigMap 以 Volume（卷）的方式挂载时支持热更新<ul><li> <strong>ConfigMap 更新后，不会自动更新 Pod 容器内的环境变量，也不会触发容器重启；</strong></li><li><strong>但是，如果 ConfigMap 是以 Volume（卷）的方式挂载，并且该挂载未使用 <code>subPath</code>，则 Pod 容器内的文件内容会在 60 秒内自动更新（热更新）；</strong></li><li>另外，应用程序需要在运行时重新读取这些文件（例如通过文件监听或定时重新加载配置）才能真正实现热更新。</li></ul></li><li>通过控制器（如 Deployment）触发 Pod 重启可以实现 ConfigMap 更新生效<ul><li>更改 ConfigMap 后，手动触发 Deployment 滚动重启（比如执行 <code>kubectl rollout restart deployment &lt;name&gt;</code>）；</li><li>Deployment 滚动重启时，K8s 会让 Deployment 下的 Pod 全部重新创建，但不会改变镜像版本；</li><li>当 Pod 重启后，容器启动时会重新加载 ConfigMap，从而使最新的配置生效。</li></ul></li><li>配置信息的大小限制<ul><li>单个 ConfigMap 的大小不能超过 1MB。</li></ul></li></ul></li><li><p>ConfigMap 的使用场景</p></li></ul><table><thead><tr><th>使用场景</th><th>示例</th></tr></thead><tbody><tr><td>多环境配置</td><td>开发、测试、生产等环境使用不同的 ConfigMap</td></tr><tr><td> 应用启动参数</td><td>通过环境变量动态配置应用的启动参数</td></tr><tr><td>配置文件注入</td><td>将配置文件挂载进容器内部，如 Nginx、Tomcat 的配置文件</td></tr><tr><td>滚动更新配置</td><td>更改 ConfigMap 后，可以通过 Deployment 滚动重启 Pod，动态加载新的配置</td></tr><tr><td>与 Secret 搭配使用</td><td> ConfigMap 负责管理非敏感配置信息，Secret 负责管理敏感配置信息（如密码、Token）</td></tr></tbody></table><ul><li>ConfigMap 的最佳实践</li></ul><table><thead><tr><th>使用场景</th><th>推荐方案</th></tr></thead><tbody><tr><td>应用支持热更新（如 Nginx、Envoy）</td><td>挂载 ConfigMap 文件，监控文件变更，感知配置更新</td></tr><tr><td>应用不支持热更新（如 Java Spring Boot）</td><td>更改 ConfigMap 后，触发 Deployment 滚动重启（<code>kubectl rollout restart deployment &lt;name&gt;</code>），不会改变镜像版本</td></tr><tr><td>同时包含敏感与非敏感配置</td><td>使用 Secret + ConfigMap 分开挂载</td></tr></tbody></table><ul><li> ConfigMap 与 Secret 对比</li></ul><table><thead><tr><th>对比项</th><th> ConfigMap</th><th>Secret</th></tr></thead><tbody><tr><td> 内容</td><td>非敏感配置信息</td><td>敏感配置信息（如密码、证书）</td></tr><tr><td>编码</td><td>明文</td><td> Base64 编码</td></tr><tr><td>用途</td><td>普通配置文件、应用启动参数</td><td>密钥、Token、证书</td></tr><tr><td>安全性</td><td>低</td><td>高</td></tr><tr><td>存储方式</td><td> Etcd 明文存储</td><td> Etcd 加密存储（需要额外配置）</td></tr></tbody></table><div class="admonition note"><p class="admonition-title">subPath 的作用</p><ul><li><code>subPath</code> 是 Kubernetes 在 Volume 挂载中的一个重要机制，用于只挂载卷里的单个文件或者子目录，而不是整个目录。</li><li><code>subPath</code> 不支持热更新，即使底层 Volume（如 ConfigMap 或 Secret）更新后，挂载到 <code>subPath</code> 的文件也不会自动刷新（热更新）。</li><li><code>subPath</code> 不能用于挂载整个目录时的热更新场景，如果需要实时更新配置（比如热更新 Nginx 配置），不可以使用 <code>subPath</code>。</li></ul></div><h5 id="ConfigMap-的创建"><a href="#ConfigMap-的创建" class="headerlink" title="ConfigMap 的创建"></a>ConfigMap 的创建</h5><p>ConfigMap 的创建通常有以下几种方式：</p><ul><li>通过命令行创建 ConfigMap</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap app-config<span class="params"> --from</span>-literal=app_mode=production<span class="params"> --from</span>-literal=app_debug=<span class="literal">false</span></span><br></pre></td></tr></tbody></table></figure><ul><li>通过文件创建 ConfigMap</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap app-config<span class="params"> --from</span>-file=app.properties</span><br></pre></td></tr></tbody></table></figure><ul><li>通过目录创建 ConfigMap</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap app-config<span class="params"> --from</span>-file=./config/</span><br></pre></td></tr></tbody></table></figure><ul><li>通过 YAML 文件（比如 <code>app-config.yaml</code>）创建 ConfigMap</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: app-config</span><br><span class="line">data:</span><br><span class="line">  app_mode: <span class="string">"production"</span></span><br><span class="line">  app_debug: <span class="string">"false"</span></span><br><span class="line">  database.conf: |</span><br><span class="line">    host=127.0.0.1</span><br><span class="line">    port=3306</span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建或更新 YAML 文件中定义的 ConfigMap 对象</span></span><br><span class="line">kubectl apply<span class="params"> -f</span> app-config.yaml</span><br></pre></td></tr></tbody></table></figure><h5 id="ConfigMap-的查看"><a href="#ConfigMap-的查看" class="headerlink" title="ConfigMap 的查看"></a>ConfigMap 的查看</h5><ul><li>查看 ConfigMap 的详情</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe configmap app-config</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 ConfigMap 的完整内容</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get configmap app-config<span class="params"> -o</span> yaml</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 ConfigMap 列表</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看默认命名空间下的所有 ConfigMap</span></span><br><span class="line">kubectl get configmaps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看特定命名空间下的所有 ConfigMap</span></span><br><span class="line">kubectl get configmaps<span class="params"> -n</span> dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看所有命名空间下的 ConfigMap</span></span><br><span class="line">kubectl get configmaps<span class="params"> --all</span>-namespaces</span><br></pre></td></tr></tbody></table></figure><h5 id="ConfigMap-的更改"><a href="#ConfigMap-的更改" class="headerlink" title="ConfigMap 的更改"></a>ConfigMap 的更改</h5><p>ConfigMap 的更改有以下几种方式：</p><ul><li>使用 <code>kubectl edit configmap</code>（最常用）直接编辑 ConfigMap，默认会打开一个临时编辑器（比如 <code>vi</code> 或 <code>nano</code>），编辑后保存退出即可，保存后会自动更新 ConfigMap</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit configmap app-config</span><br></pre></td></tr></tbody></table></figure><ul><li>使用 <code>kubectl apply</code>（声明式更新），如果有一个用于定义 ConfigMap 的 YAML 文件（例如 <code>app-config.yaml</code>），可以执行以下命令更新 ConfigMap</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply<span class="params"> -f</span> app-config.yaml</span><br></pre></td></tr></tbody></table></figure><ul><li>使用 <code>kubectl patch configmap</code>（部分字段更新），只更新指定的字段（无需编辑整个 YAML）</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新单个字段（Key）</span></span><br><span class="line">kubectl patch configmap app-config<span class="params"> -p</span> <span class="string">'{"data":{"app_mode":"development"}}'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同时改两个字段（Key）</span></span><br><span class="line">kubectl patch configmap app-config<span class="params"> -p</span> <span class="string">'{"data":{"app_mode":"development","app_debug":"true"}}'</span></span><br></pre></td></tr></tbody></table></figure><ul><li>直接重新创建 ConfigMap（简单粗暴），也就是先删除旧的 ConfigMap，然后创建新的 ConfigMap</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap app-config<span class="params"> --from</span>-literal=app_mode=development<span class="params"> --from</span>-literal=app_debug=<span class="literal">true</span><span class="params"> --dry</span>-run=client<span class="params"> -o</span> yaml | kubectl apply<span class="params"> -f</span> -</span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">ConfigMap 热更新说明</p><ul><li>ConfigMap 更新后，不会自动更新 Pod 容器内的环境变量，也不会触发容器重启。</li><li>但是，如果 ConfigMap 是以 Volume（卷）的方式挂载，并且该挂载未使用 <code>subPath</code>，则 Pod 容器内的文件内容会在 60 秒内自动刷新（热更新）。</li></ul></div><h5 id="ConfigMap-的删除"><a href="#ConfigMap-的删除" class="headerlink" title="ConfigMap 的删除"></a>ConfigMap 的删除</h5><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除默认命名空间下的单个 ConfigMap</span></span><br><span class="line">kubectl delete configmap app-config</span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除默认命名空间下的多个 ConfigMap</span></span><br><span class="line">kubectl delete configmap cm1 cm2 cm3</span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除默认命名空间下的所有 ConfigMap（慎用），系统自动生成的 ConfigMap 也会被删掉，从而影响 K8s 集群的正常运行</span></span><br><span class="line">kubectl delete configmap<span class="params"> --all</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除特定命名空间下的单个 ConfigMap</span></span><br><span class="line">kubectl delete configmap nginx-config<span class="params"> -n</span> dev</span><br></pre></td></tr></tbody></table></figure><div class="admonition warning"><p class="admonition-title">特别注意</p><ul><li>删除 ConfigMap 不会立即影响已运行的 Pod，除非该 ConfigMap 是以挂载卷（Volume）或环境变量形式注入，并且 Pod 被重新启动或重新加载。</li><li>如果在 Deployment、DaemonSet 或 StatefulSet 中使用了 ConfigMap，可以手动更新 ConfigMap，然后执行 <code>kubectl rollout restart deployment &lt;name&gt;</code> 命令进行滚动更新，这样 ConfigMap 的更新就会生效。</li></ul></div><h5 id="在-Pod-中使用-ConfigMap"><a href="#在-Pod-中使用-ConfigMap" class="headerlink" title="在 Pod 中使用 ConfigMap"></a>在 Pod 中使用 ConfigMap</h5><p>ConfigMap 创建后，可以通过以下两种方式供 Pod 容器使用：</p><ul><li>挂载为环境变量：K8s 会将 ConfigMap 中的键值对映射为系统环境变量</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">configmap-env-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">demo</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"echo $APP_MODE $APP_DEBUG; tail -f /dev/null"</span>]</span><br><span class="line">    <span class="attr">env:</span>                       <span class="comment"># 定义环境变量</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">APP_MODE</span>           <span class="comment"># 环境变量名</span></span><br><span class="line">      <span class="attr">valueFrom:</span>               <span class="comment"># 值来源于外部引用</span></span><br><span class="line">        <span class="attr">configMapKeyRef:</span>       <span class="comment"># 引用类型为 ConfigMap</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">app-config</span>     <span class="comment"># ConfigMap 的名称（需事先创建）</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">app_mode</span>        <span class="comment"># ConfigMap 中对应的键</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">APP_DEBUG</span></span><br><span class="line">      <span class="attr">valueFrom:</span></span><br><span class="line">        <span class="attr">configMapKeyRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">app_debug</span></span><br></pre></td></tr></tbody></table></figure><ul><li>挂载为 Volume（卷）：K8s 会自动将 ConfigMap 中每个键映射为文件名（最终会自动创建多个文件），文件内容为键对应的值</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: configmap-volume-demo</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: demo</span><br><span class="line">    image: busybox</span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"cat /etc/config-data/app_mode; tail -f /dev/null"</span>]</span><br><span class="line">    volumeMounts:                     <span class="comment"># 定义容器内要挂载的卷</span></span><br><span class="line">    - name: config-volume             <span class="comment"># 对应下面 volumes 中的卷名称（必须一致）</span></span><br><span class="line">      mountPath: /etc/config-data     <span class="comment"># 将 ConfigMap 内容挂载到容器内的该目录下</span></span><br><span class="line">      readOnly: <span class="literal">true</span>                  <span class="comment"># 设置为只读（推荐），防止容器内误修改</span></span><br><span class="line">  volumes:                            <span class="comment"># 在 Pod 层定义卷（Volume）</span></span><br><span class="line">  - name: config-volume               <span class="comment"># 指定卷的名称</span></span><br><span class="line">    configMap:                        <span class="comment"># 指定卷的类型为 ConfigMap</span></span><br><span class="line">      name: app-config                <span class="comment"># 指定引用的 ConfigMap 名称（需事先创建）</span></span><br></pre></td></tr></tbody></table></figure><h5 id="ConfigMap-的完整使用案例"><a href="#ConfigMap-的完整使用案例" class="headerlink" title="ConfigMap 的完整使用案例"></a>ConfigMap 的完整使用案例</h5><ul><li>通过 YAML 文件（比如 <code>configmap-env-demo.yaml</code>）定义 ConfigMap 和 Pod，并使用环境变量的方式引用 ConfigMap</li></ul><figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义 ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">app_mode:</span> <span class="string">"production"</span></span><br><span class="line">  <span class="attr">app_debug:</span> <span class="string">"false"</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="comment"># 定义 Pod</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">configmap-env-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">demo</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"echo $APP_MODE $APP_DEBUG; tail -f /dev/null"</span>]</span><br><span class="line">    <span class="attr">env:</span>                       <span class="comment"># 定义环境变量</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">APP_MODE</span>           <span class="comment"># 环境变量名</span></span><br><span class="line">      <span class="attr">valueFrom:</span>               <span class="comment"># 值来源于外部引用</span></span><br><span class="line">        <span class="attr">configMapKeyRef:</span>       <span class="comment"># 引用类型为 ConfigMap</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">app-config</span>     <span class="comment"># ConfigMap 的名称（需事先创建）</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">app_mode</span>        <span class="comment"># ConfigMap 中对应的键</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">APP_DEBUG</span></span><br><span class="line">      <span class="attr">valueFrom:</span></span><br><span class="line">        <span class="attr">configMapKeyRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">app_debug</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建或更新 YAML 文件中定义的 ConfigMap 和 Pod 对象</span></span><br><span class="line">kubectl apply<span class="params"> -f</span> configmap-env-demo.yaml</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 Pod 的运行状态</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods<span class="params"> -o</span> wide</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME                 READY   STATUS    RESTARTS   AGE   IP            NODE        NOMINATED NODE   READINESS GATES</span><br><span class="line">configmap-env-demo   1/1     Running   0          14s   10.244.3.26   k8s-node2   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></tbody></table></figure><ul><li>查看 Pod 的日志信息</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl logs configmap-env-demo</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">production false</span><br></pre></td></tr></tbody></table></figure><h5 id="ConfigMap-实现-Nginx-自动热更新"><a href="#ConfigMap-实现-Nginx-自动热更新" class="headerlink" title="ConfigMap 实现 Nginx 自动热更新"></a>ConfigMap 实现 Nginx 自动热更新</h5><ul><li><a href="/posts/8639f08c.html">Kubernetes 中实现 Nginx 配置自动热更新</a></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/76121b26.html" title="Kubernetes 入门教程之六">https://www.techgrow.cn/posts/76121b26.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%AE%B9%E5%99%A8%E5%8C%96/" rel="tag"><i class="fa fa-tag"></i> 容器化</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/2ca57d7f.html" rel="prev" title="Kubernetes 入门教程之七"><i class="fa fa-angle-left"></i> Kubernetes 入门教程之七</a></div><div class="post-nav-item"> <a href="/posts/8639f08c.html" rel="next" title="Kubernetes 中实现 Nginx 配置自动热加载">Kubernetes 中实现 Nginx 配置自动热加载<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">2.1m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">31:20</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/76121b26.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>