<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 CMake 的单元测试如何使用，包括创建简单的带单元测试的项目，同时整合 GoogleTest 测试框架。"><meta property="og:type" content="article"><meta property="og:title" content="CMake 基于 GoogleTest 实现单元测试"><meta property="og:url" content="https://www.techgrow.cn/posts/52f22f9b.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 CMake 的单元测试如何使用，包括创建简单的带单元测试的项目，同时整合 GoogleTest 测试框架。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2022-01-09T14:25:49.000Z"><meta property="article:modified_time" content="2022-01-09T14:25:49.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="Linux系统编程"><meta property="article:tag" content="C语言"><meta property="article:tag" content="C++"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.techgrow.cn/posts/52f22f9b.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/52f22f9b.html","path":"posts/52f22f9b.html","title":"CMake 基于 GoogleTest 实现单元测试"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>CMake 基于 GoogleTest 实现单元测试 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%AE%80%E5%8D%95%E7%9A%84%E5%B8%A6%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E7%9A%84%E9%A1%B9%E7%9B%AE"><span class="nav-text">创建简单的带单元测试的项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%B7%A5%E7%A8%8B"><span class="nav-text">创建项目工程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81"><span class="nav-text">编写项目代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">创建配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%BC%96%E8%AF%91%E9%A1%B9%E7%9B%AE"><span class="nav-text">命令行编译项目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CMake-%E4%BD%BF%E7%94%A8-GoogleTest-%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6"><span class="nav-text">CMake 使用 GoogleTest 测试框架</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#GoogleTest-%E7%9A%84%E5%AE%89%E8%A3%85"><span class="nav-text">GoogleTest 的安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#GoogleTest-%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85"><span class="nav-text">GoogleTest 编译安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GoogleTest-%E9%AA%8C%E8%AF%81%E5%AE%89%E8%A3%85"><span class="nav-text">GoogleTest 验证安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Google-Test-%E7%9A%84%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B"><span class="nav-text">Google Test 的使用案例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%B7%A5%E7%A8%8B-1"><span class="nav-text">创建项目工程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81-1"><span class="nav-text">编写项目代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CMake-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">CMake 配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%BC%96%E8%AF%91%E9%A1%B9%E7%9B%AE-1"><span class="nav-text">命令行编译项目</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GoogleTest-%E4%BD%BF%E7%94%A8%E6%89%A9%E5%B1%95%E8%AF%B4%E6%98%8E"><span class="nav-text">GoogleTest 使用扩展说明</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E5%8D%9A%E5%AE%A2"><span class="nav-text">参考博客</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">689</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/52f22f9b.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="CMake 基于 GoogleTest 实现单元测试 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 CMake 的单元测试如何使用，包括创建简单的带单元测试的项目，同时整合 GoogleTest 测试框架。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> CMake 基于 GoogleTest 实现单元测试</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-01-09 22:25:49" itemprop="dateCreated datePublished" datetime="2022-01-09T22:25:49+08:00">2022-01-09</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/52f22f9b.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/52f22f9b.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>1.9k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>2 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>CMake 是一个跨平台的 C/C++ 项目组织管理工具，虽然许多 IDE 都有私有的项目管理工具，但是在现在各大 IDE 基本都支持使用 CMake 管理项目，所以如果有跨平台的需求，使用 CMake 管理是最方便的。值得一提的是，CMake 支持 <a target="_blank" rel="external nofollow" href="https://github.com/google/googletest">gtest</a>、<code>cppunit</code> 等单元测试框架，当然也可以使用断言自定义单元测试。</p><span id="more"></span><h2 id="创建简单的带单元测试的项目"><a href="#创建简单的带单元测试的项目" class="headerlink" title="创建简单的带单元测试的项目"></a>创建简单的带单元测试的项目</h2><h3 id="创建项目工程"><a href="#创建项目工程" class="headerlink" title="创建项目工程"></a>创建项目工程</h3><div class="admonition note"><p class="admonition-title">下载代码</p><p><a href="/downloads/2022/01/minder-test.zip">点击下载</a> 完整的案例代码，项目的目录结构如下：</p></div><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">minder-test</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">├── include</span><br><span class="line">│   └── datetime.h</span><br><span class="line">├── src</span><br><span class="line">│   ├── datetime.cpp</span><br><span class="line">│   └── main.cpp</span><br><span class="line">└── test</span><br><span class="line">    ├── CMakeLists.txt</span><br><span class="line">    ├── include</span><br><span class="line">    │   └── strUtil.h</span><br><span class="line">    └── src</span><br><span class="line">        └── main.cpp</span><br></pre></td></tr></tbody></table></figure><h3 id="编写项目代码"><a href="#编写项目代码" class="headerlink" title="编写项目代码"></a>编写项目代码</h3><ul><li>include/datetime.h</li></ul><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 日期工具类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DateUtil</span> {</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> string <span class="title">formatCurrentTime</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> string <span class="title">formatCurrentTime</span><span class="params">(string format)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">dayOfWeek</span><span class="params">(<span class="keyword">const</span> string &amp;date)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">isWeekendDays</span><span class="params">(<span class="keyword">const</span> string &amp;date)</span></span>;</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure><ul><li>src/datetime.cpp</li></ul><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"datetime.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 格式化当前时间</span></span><br><span class="line"><span class="comment">// 默认格式是: 2020-06-07 23:46:53</span></span><br><span class="line"><span class="function">string <span class="title">DateUtil::formatCurrentTime</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">time_t</span> rawtime;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> *<span class="title">info</span>;</span></span><br><span class="line">    <span class="keyword">char</span> buffer[<span class="number">80</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">time</span>(&amp;rawtime);</span><br><span class="line">    info = <span class="built_in">localtime</span>(&amp;rawtime);</span><br><span class="line">    <span class="built_in">strftime</span>(buffer, <span class="number">80</span>, <span class="string">"%Y-%m-%d %H:%M:%S"</span>, info);</span><br><span class="line">    <span class="function">string <span class="title">str</span><span class="params">(buffer)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 格式化当前时间</span></span><br><span class="line"><span class="comment">// format: 格式字符串，例如 %Y-%m-%d %H:%M:%S</span></span><br><span class="line"><span class="function">string <span class="title">DateUtil::formatCurrentTime</span><span class="params">(string format)</span> </span>{</span><br><span class="line">    <span class="keyword">time_t</span> rawtime;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> *<span class="title">info</span>;</span></span><br><span class="line">    <span class="keyword">char</span> buffer[<span class="number">80</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">time</span>(&amp;rawtime);</span><br><span class="line">    info = <span class="built_in">localtime</span>(&amp;rawtime);</span><br><span class="line">    <span class="built_in">strftime</span>(buffer, <span class="number">80</span>, format.<span class="built_in">c_str</span>(), info);</span><br><span class="line">    <span class="function">string <span class="title">str</span><span class="params">(buffer)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据给定的日期，计算它是星期几</span></span><br><span class="line"><span class="comment">// date: 日期字符串，格式是: 2021-12-01</span></span><br><span class="line"><span class="comment">// 返回值：1, 2, 3, 4, 5, 6, 0, 其中 0 表示星期日</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">DateUtil::dayOfWeek</span><span class="params">(<span class="keyword">const</span> string &amp;date)</span> </span>{</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line">    <span class="keyword">int</span> y, m, d;</span><br><span class="line">    <span class="built_in">stringstream</span>(date) &gt;&gt; y &gt;&gt; c &gt;&gt; m &gt;&gt; c &gt;&gt; d;</span><br><span class="line">    tm t = {<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, d, m - <span class="number">1</span>, y - <span class="number">1900</span>};</span><br><span class="line">    <span class="built_in">mktime</span>(&amp;t);</span><br><span class="line">    <span class="keyword">return</span> t.tm_wday;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据给定的日期，判断是否为周末</span></span><br><span class="line"><span class="comment">// date: 日期字符串，格式是: 2021-12-01</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">DateUtil::isWeekendDays</span><span class="params">(<span class="keyword">const</span> string &amp;date)</span> </span>{</span><br><span class="line">    <span class="keyword">int</span> wday = <span class="built_in">dayOfWeek</span>(date);</span><br><span class="line">    <span class="keyword">if</span> (wday == <span class="number">6</span> || wday == <span class="number">0</span>) {</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>src/main.cpp</li></ul><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"datetime.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    cout &lt;&lt; DateUtil::formatCurrentTime() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; DateUtil::formatCurrentTime(<span class="string">"%Y-%m-%d"</span>) &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>test/include/strUtil.h</li></ul><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 去除字符串两边的空格</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">trim</span><span class="params">(string &amp;str)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (str.<span class="built_in">empty</span>()) {</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    }</span><br><span class="line">    str.<span class="built_in">erase</span>(<span class="number">0</span>, str.<span class="built_in">find_first_not_of</span>(<span class="string">" "</span>));</span><br><span class="line">    str.<span class="built_in">erase</span>(str.<span class="built_in">find_last_not_of</span>(<span class="string">" "</span>) + <span class="number">1</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>test/src/main.cpp</li></ul><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"strUtil.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"datetime.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// 去除字符串两边的空格</span></span><br><span class="line">    string str = <span class="string">" Hello World ! "</span>;</span><br><span class="line">    <span class="built_in">trim</span>(str);</span><br><span class="line">    cout &lt;&lt; str &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据给定的日期，计算它是星期几</span></span><br><span class="line">    cout &lt;&lt; <span class="string">"wday = "</span> &lt;&lt; DateUtil::<span class="built_in">dayOfWeek</span>(<span class="string">"2022-01-11"</span>) &lt;&lt; <span class="string">", "</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">"isWeekendDays = "</span> &lt;&lt; (DateUtil::<span class="built_in">isWeekendDays</span>(<span class="string">"2022-01-11"</span>) ? <span class="string">"true"</span> : <span class="string">"false"</span>) &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>其中 <code>test</code> 目录可以视作为子项目，和主目录分开编译。为了模拟更真实的企业项目开发场景，这里的 <code>test/src/main.cpp</code> 同时引入了 <code>datetime.h</code> 和 <code>strUtil.h</code> 头文件。</p><h3 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h3><ul><li>主目录的 <code>CMakeLists.txt</code></li></ul><figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.15</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目信息</span></span><br><span class="line"><span class="keyword">project</span>(minder)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义C++的版本</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出调试信息</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">"-g"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启所有警告</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">"-Wall"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定构建输出的目录</span></span><br><span class="line"><span class="keyword">set</span>(PROJECT_BINARY_DIR <span class="variable">${PROJECT_SOURCE_DIR}</span>/build)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 引入主项目的头文件</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">${PROJECT_SOURCE_DIR}</span>/<span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索主项目的源文件</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(<span class="variable">${PROJECT_SOURCE_DIR}</span>/src MAIN_SOURCES)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定可执行文件的名称和主项目的所有源文件</span></span><br><span class="line"><span class="keyword">add_executable</span>(<span class="variable">${PROJECT_NAME}</span> <span class="variable">${MAIN_SOURCES}</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用项目测试</span></span><br><span class="line"><span class="keyword">enable_testing</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加子目录（测试项目）</span></span><br><span class="line"><span class="keyword">add_subdirectory</span>(<span class="keyword">test</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加测试项目的可执行文件</span></span><br><span class="line"><span class="keyword">add_test</span>(minder_test <span class="variable">${PROJECT_SOURCE_DIR}</span>/<span class="keyword">test</span>/build/minder_test)</span><br></pre></td></tr></tbody></table></figure><p>特别说明：</p><ul><li><code>set(CMAKE_CXX_FLAGS "-xxx")</code>：指定编译参数，细化的还有 <code>CMAKE_CXX_FLAGS_DEBUG</code> 和 <code>CMAKE_CXX_FLAGS_RELEASE</code></li><li><code>add_subdirectory(xxx)</code>：添加子目录（子项目），要求子目录里必须有单独的 <code>CMakeLists.txt</code>，该文件包含了子目录的编译配置信息</li><li><code>add_test(xxx ${PROJECT_SOURCE_DIR}/test/build/xxx)</code>：第一个参数是某个单元测试的名称，第二个参数是该单元测试的可执行文件的路径</li></ul><hr><ul><li><code>test</code> 目录的 <code>CMakeLists.txt</code></li></ul><figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.15</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目信息</span></span><br><span class="line"><span class="keyword">project</span>(minder_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义C++的版本</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索父目录（父项目）的头文件</span></span><br><span class="line"><span class="keyword">include_directories</span>(../<span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索父目录（父项目）的源文件</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(../src MAIN_SOURCES)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 排除父目录（父项目）的入口源文件</span></span><br><span class="line"><span class="keyword">list</span>(FILTER MAIN_SOURCES EXCLUDE REGEX <span class="string">"main.cpp"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 引入子项目的头文件</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">${PROJECT_SOURCE_DIR}</span>/<span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索子项目里的源文件</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(<span class="variable">${PROJECT_SOURCE_DIR}</span>/src TEST_SOURCES)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定构建输出的目录</span></span><br><span class="line"><span class="keyword">set</span>(PROJECT_BINARY_DIR <span class="variable">${PROJECT_SOURCE_DIR}</span>/build)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定可执行文件的名称和单元测试的所有源文件</span></span><br><span class="line"><span class="keyword">add_executable</span>(<span class="variable">${PROJECT_NAME}</span> <span class="variable">${MAIN_SOURCES}</span> <span class="variable">${TEST_SOURCES}</span>)</span><br></pre></td></tr></tbody></table></figure><p>这里的 <code>test</code> 作为子项目，主要要生成单元测试的可执行文件。</p><h3 id="命令行编译项目"><a href="#命令行编译项目" class="headerlink" title="命令行编译项目"></a>命令行编译项目</h3><ul><li>编译 <code>test</code> 子项目</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入子项目的目录</span></span><br><span class="line"><span class="keyword">$ cd</span> minder-<span class="built_in">test</span>/<span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建子项目的构建目录</span></span><br><span class="line"><span class="keyword">$ mkdir</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入子项目的构建目录</span></span><br><span class="line"><span class="keyword">$ cd</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建子项目</span></span><br><span class="line"><span class="keyword">$ cmake</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译子项目</span></span><br><span class="line"><span class="keyword">$ make</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行可执行文件</span></span><br><span class="line">$ ./minder_test</span><br></pre></td></tr></tbody></table></figure><ul><li>编译主项目</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入主项目的目录</span></span><br><span class="line"><span class="keyword">$ cd</span> minder-<span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建主项目的构建目录</span></span><br><span class="line"><span class="keyword">$ mkdir</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入主项目的构建目录</span></span><br><span class="line"><span class="keyword">$ cd</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建主项目</span></span><br><span class="line"><span class="keyword">$ cmake</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译主项目</span></span><br><span class="line"><span class="keyword">$ make</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行项目测试</span></span><br><span class="line"><span class="keyword">$ make</span> <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行可执行文件</span></span><br><span class="line">$ ./minder</span><br></pre></td></tr></tbody></table></figure><h2 id="CMake-使用-GoogleTest-测试框架"><a href="#CMake-使用-GoogleTest-测试框架" class="headerlink" title="CMake 使用 GoogleTest 测试框架"></a>CMake 使用 GoogleTest 测试框架</h2><div class="admonition note"><p class="admonition-title">相关站点</p><ul><li><a target="_blank" rel="external nofollow" href="https://google.github.io/googletest/">GoogleTest 官方文档</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/google/googletest">GoogleTest GitHub 仓库</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/google/googletest/releases">GoogleTest 官方下载页面</a></li></ul></div><h3 id="GoogleTest-的安装"><a href="#GoogleTest-的安装" class="headerlink" title="GoogleTest 的安装"></a>GoogleTest 的安装</h3><h4 id="GoogleTest-编译安装"><a href="#GoogleTest-编译安装" class="headerlink" title="GoogleTest 编译安装"></a>GoogleTest 编译安装</h4><div class="admonition warning"><p class="admonition-title">注意事项</p><ol><li>GoogleTest 最新版（<code>1.11.0</code>）要求使用 GCC <code>5.0+</code> 和 Clang <code>5.0+</code>，若 GCC 的版本比较低，建议安装 GoogleTest <code>1.10.0</code> 或者 <code>1.8.1</code> 版本</li><li>实测 GCC <code>4.8.5</code> 可以正常使用 GoogleTest 的 <code>1.10.0</code> 版本，不兼容 <code>1.11.0</code> 版本</li></ol></div><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载文件</span></span><br><span class="line"><span class="keyword">$ wget</span> https://github.com/google/googletest/archive/refs/tags/release-1.11.0.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压文件</span></span><br><span class="line"><span class="keyword">$ tar</span><span class="params"> -xvf</span> release-1.11.0.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入解压目录</span></span><br><span class="line"><span class="keyword">$ cd</span> googletest-release-1.11.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建构建目录</span></span><br><span class="line"><span class="keyword">$ mkdir</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入构建目录</span></span><br><span class="line"><span class="keyword">$ cd</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成makefile，如果需要构建得到动态链接库，则必须添加参数 "-DBUILD_SHARED_LIBS=ON"，否则默认只会得到静态库（.a）</span></span><br><span class="line"><span class="keyword">$ cmake</span><span class="params"> -DBUILD_SHARED_LIBS</span>=ON<span class="params"> -Dgtest_build_samples</span>=ON ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译</span></span><br><span class="line"><span class="keyword">$ make</span><span class="params"> -j4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line"><span class="keyword">$ make</span> install</span><br></pre></td></tr></tbody></table></figure><p>值得一提的是，安装命令执行完成后，会自动将 <code>libgmock_main.so</code> 、<code>libgmock.so</code>、<code>libgtest_main.so</code>、<code>libgtest.so</code> 库文件拷贝到 <code>/usr/local/lib64/</code> 目录下。GoogleTest 的头文件则会安装在 <code>/usr/local/include/gmock</code> 和 <code>/usr/local/include/gtest/</code> 目录。</p><h4 id="GoogleTest-验证安装"><a href="#GoogleTest-验证安装" class="headerlink" title="GoogleTest 验证安装"></a>GoogleTest 验证安装</h4><ul><li>创建 C++ 源文件 <code>test.cpp</code></li></ul><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtest/gtest.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">TEST</span>( COutputPopLimitStrategyTest, PositiveNos )</span><br><span class="line">{</span><br><span class="line">	<span class="built_in">EXPECT_EQ</span>(<span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[] )</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">	::testing::<span class="built_in">InitGoogleTest</span>( &amp;argc, argv );</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span>(<span class="built_in">RUN_ALL_TESTS</span>() );</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><ul><li>使用 G++ 命令编译 C++ 源文件</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编译源文件</span></span><br><span class="line"><span class="keyword">$ g</span>++<span class="params"> -std</span>=c++11 <span class="built_in">test</span>.cpp<span class="params"> -lpthread</span> /usr/<span class="built_in">local</span>/lib64/libgtest.so<span class="params"> -o</span> <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行可执行文件，若输出以下的日志信息，则说明GoogleTest安装成功</span></span><br><span class="line">$ ./<span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">[==========] Running 1 <span class="built_in">test</span> from 1 <span class="built_in">test</span> suite.</span><br><span class="line">[----------] Global <span class="built_in">test</span> environment <span class="built_in">set</span>-up.</span><br><span class="line">[----------] 1 <span class="built_in">test</span> from COutputPopLimitStrategyTest</span><br><span class="line">[ RUN      ] COutputPopLimitStrategyTest.PositiveNos</span><br><span class="line">[       OK ] COutputPopLimitStrategyTest.PositiveNos (0 ms)</span><br><span class="line">[----------] 1 <span class="built_in">test</span> from COutputPopLimitStrategyTest (1 ms total)</span><br><span class="line"></span><br><span class="line">[----------] Global <span class="built_in">test</span> environment tear-down</span><br><span class="line">[==========] 1 <span class="built_in">test</span> from 1 <span class="built_in">test</span> suite ran. (1 ms total)</span><br><span class="line">[  PASSED  ] 1 <span class="built_in">test</span>.</span><br></pre></td></tr></tbody></table></figure><p>G++ 编译参数说明：</p><ul><li><code>-std=c++11</code>：指定 C++ 的版本</li><li><code>/usr/local/lib64/libgtest.so</code>：链接 GoogleTest 的动态链接库</li><li><code>-lpthread</code>：由于 GoogleTest 的内部使用了多线程，因此需要链接 <code>pthread</code> 库</li></ul><h3 id="Google-Test-的使用案例"><a href="#Google-Test-的使用案例" class="headerlink" title="Google Test 的使用案例"></a>Google Test 的使用案例</h3><h4 id="创建项目工程-1"><a href="#创建项目工程-1" class="headerlink" title="创建项目工程"></a>创建项目工程</h4><div class="admonition note"><p class="admonition-title">下载代码</p><p><a href="/downloads/2022/01/minder-gtest.zip">点击下载</a> 完整的案例代码，项目的目录结构如下：</p></div><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">minder-gtest</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">├── include</span><br><span class="line">│   └── datetime.h</span><br><span class="line">├── src</span><br><span class="line">│   ├── datetime.cpp</span><br><span class="line">│   └── main.cpp</span><br><span class="line">└── test</span><br><span class="line">    ├── CMakeLists.txt</span><br><span class="line">    ├── include</span><br><span class="line">    │   └── strUtil.h</span><br><span class="line">    └── src</span><br><span class="line">        └── main.cpp</span><br></pre></td></tr></tbody></table></figure><h4 id="编写项目代码-1"><a href="#编写项目代码-1" class="headerlink" title="编写项目代码"></a>编写项目代码</h4><div class="admonition note"><p class="admonition-title">下载代码</p><p>这里的 C++ 代码，除了 <code>main.cpp</code> 的代码不一样之外，其他代码与上面的案例代码完全一致，不再累述。</p></div><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"strUtil.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"datetime.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtest/gtest.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 去除字符串两边的空格</span></span><br><span class="line"><span class="built_in">TEST</span>(TestCase, test1) {</span><br><span class="line">    string str = <span class="string">" Hello World ! "</span>;</span><br><span class="line">    <span class="built_in">trim</span>(str);</span><br><span class="line">    <span class="built_in">ASSERT_EQ</span>(<span class="string">"Hello World !"</span>, str);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据给定的日期，计算它是星期几</span></span><br><span class="line"><span class="built_in">TEST</span>(TestCase, test2) {</span><br><span class="line">    <span class="built_in">ASSERT_EQ</span>(<span class="literal">true</span>, DateUtil::<span class="built_in">isWeekendDays</span>(<span class="string">"2022-01-09"</span>));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>{</span><br><span class="line">    testing::<span class="built_in">InitGoogleTest</span>(&amp;argc, argv);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">RUN_ALL_TESTS</span>();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h4 id="CMake-配置文件"><a href="#CMake-配置文件" class="headerlink" title="CMake 配置文件"></a>CMake 配置文件</h4><ul><li>主目录的 <code>CMakeLists.txt</code>，这里的配置内容与上面的案例没有任何区别</li></ul><figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.15</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目信息</span></span><br><span class="line"><span class="keyword">project</span>(minder)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义C++的版本</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出调试信息</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">"-g"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启所有警告</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">"-Wall"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定构建输出的目录</span></span><br><span class="line"><span class="keyword">set</span>(PROJECT_BINARY_DIR <span class="variable">${PROJECT_SOURCE_DIR}</span>/build)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 引入主项目的头文件</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">${PROJECT_SOURCE_DIR}</span>/<span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索主项目的源文件</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(<span class="variable">${PROJECT_SOURCE_DIR}</span>/src MAIN_SOURCES)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定可执行文件的名称和主项目的所有源文件</span></span><br><span class="line"><span class="keyword">add_executable</span>(<span class="variable">${PROJECT_NAME}</span> <span class="variable">${MAIN_SOURCES}</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用单元测试</span></span><br><span class="line"><span class="keyword">enable_testing</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加子目录（子项目）</span></span><br><span class="line"><span class="keyword">add_subdirectory</span>(<span class="keyword">test</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加单元测试的可执行文件</span></span><br><span class="line"><span class="keyword">add_test</span>(minder_test <span class="variable">${PROJECT_SOURCE_DIR}</span>/<span class="keyword">test</span>/build/minder_test)</span><br></pre></td></tr></tbody></table></figure><ul><li><code>test</code> 目录的 <code>CMakeLists.txt</code>，这里的配置内容新增了 GoogleTest 库</li></ul><figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.15</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目信息</span></span><br><span class="line"><span class="keyword">project</span>(minder_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义C++的版本</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找 GoogleTest 库</span></span><br><span class="line"><span class="keyword">find_package</span>(GTest REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示 GoogleTest 库的路径</span></span><br><span class="line"><span class="keyword">MESSAGE</span>(STATUS <span class="string">"GTEST_INCLUDE_DIRS : "</span> <span class="variable">${GTEST_INCLUDE_DIRS}</span>)</span><br><span class="line"><span class="keyword">MESSAGE</span>(STATUS <span class="string">"GTEST_BOTH_LIBRARIES : "</span> <span class="variable">${GTEST_BOTH_LIBRARIES}</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索父目录（父项目）的头文件</span></span><br><span class="line"><span class="keyword">include_directories</span>(../<span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索父目录（父项目）的源文件</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(../src MAIN_SOURCES)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 排除父目录（父项目）的入口源文件</span></span><br><span class="line"><span class="keyword">list</span>(FILTER MAIN_SOURCES EXCLUDE REGEX <span class="string">"main.cpp"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 引入子项目的头文件</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">${PROJECT_SOURCE_DIR}</span>/<span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索子项目里的源文件</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(<span class="variable">${PROJECT_SOURCE_DIR}</span>/src TEST_SOURCES)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 引入 GoogleTest 的头文件</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">${GTEST_INCLUDE_DIRS}</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定构建输出的目录</span></span><br><span class="line"><span class="keyword">set</span>(PROJECT_BINARY_DIR <span class="variable">${PROJECT_SOURCE_DIR}</span>/build)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定可执行文件的名称和单元测试的所有源文件</span></span><br><span class="line"><span class="keyword">add_executable</span>(<span class="variable">${PROJECT_NAME}</span> <span class="variable">${MAIN_SOURCES}</span> <span class="variable">${TEST_SOURCES}</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 链接 GoogleTest 与 pthread 库（请特别注意声明的顺序）</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(<span class="variable">${PROJECT_NAME}</span> <span class="variable">${GTEST_BOTH_LIBRARIES}</span> pthread)</span><br></pre></td></tr></tbody></table></figure><h4 id="命令行编译项目-1"><a href="#命令行编译项目-1" class="headerlink" title="命令行编译项目"></a>命令行编译项目</h4><ul><li>编译 <code>test</code> 子项目</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入子项目的目录</span></span><br><span class="line"><span class="keyword">$ cd</span> minder-gtest/<span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建子项目的构建目录</span></span><br><span class="line"><span class="keyword">$ mkdir</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入子项目的构建目录</span></span><br><span class="line"><span class="keyword">$ cd</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建子项目</span></span><br><span class="line"><span class="keyword">$ cmake</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译子项目</span></span><br><span class="line"><span class="keyword">$ make</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行可执行文件</span></span><br><span class="line">$ ./minder_test</span><br></pre></td></tr></tbody></table></figure><p>运行可执行文件后，输出的日志信息如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[==========] Running 2 tests from 1 test suite.</span><br><span class="line">[----------] Global test environment set-up.</span><br><span class="line">[----------] 2 tests from TestCase</span><br><span class="line">[ RUN      ] TestCase.test1</span><br><span class="line">[       OK ] TestCase.test1 (0 ms)</span><br><span class="line">[ RUN      ] TestCase.test2</span><br><span class="line">[       OK ] TestCase.test2 (0 ms)</span><br><span class="line">[----------] 2 tests from TestCase (0 ms total)</span><br><span class="line"></span><br><span class="line">[----------] Global test environment tear-down</span><br><span class="line">[==========] 2 tests from 1 test suite ran. (2 ms total)</span><br><span class="line">[  PASSED  ] 2 tests.</span><br></pre></td></tr></tbody></table></figure><ul><li>编译主项目</li></ul><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入主项目的目录</span></span><br><span class="line"><span class="keyword">$ cd</span> minder-gtest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建主项目的构建目录</span></span><br><span class="line"><span class="keyword">$ mkdir</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入主项目的构建目录</span></span><br><span class="line"><span class="keyword">$ cd</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建主项目</span></span><br><span class="line"><span class="keyword">$ cmake</span> ..</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译主项目</span></span><br><span class="line"><span class="keyword">$ make</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行项目测试</span></span><br><span class="line"><span class="keyword">$ make</span> <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行可执行文件</span></span><br><span class="line">$ ./minder</span><br></pre></td></tr></tbody></table></figure><h3 id="GoogleTest-使用扩展说明"><a href="#GoogleTest-使用扩展说明" class="headerlink" title="GoogleTest 使用扩展说明"></a>GoogleTest 使用扩展说明</h3><p>在上面的案例中，GoogleTest 是使用源码编译的方式安装到 Linux 系统上的，这在迁移操作系统的时候，需要重复执行同样的安装步骤。此时为了方便日后迁移操作系统，可以将 GoogleTest 的头文件、动态链接都复制一份到项目中，这样就可以不依赖外部的系统环境了。</p><div class="admonition note"><p class="admonition-title">提示</p><p><a href="/downloads/2022/01/minder-gtest-plus.zip">点击下载</a> 完整的案例代码，项目的目录结构如下：</p></div><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">minder-gtest-plus</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">├── include</span><br><span class="line">│   └── datetime.h</span><br><span class="line">├── src</span><br><span class="line">│   ├── datetime.cpp</span><br><span class="line">│   └── main.cpp</span><br><span class="line">├── test</span><br><span class="line">│   ├── CMakeLists.txt</span><br><span class="line">│   ├── include</span><br><span class="line">│   │   └── strUtil.h</span><br><span class="line">│   └── src</span><br><span class="line">│       └── main.cpp</span><br><span class="line">└── thirdparty</span><br><span class="line">    └── googletest</span><br><span class="line">        ├── gmock</span><br><span class="line">        │   ├── include</span><br><span class="line">        │   │   └── gmock</span><br><span class="line">        │   │       ├── gmock-actions.h</span><br><span class="line">        │   │       ├── gmock-cardinalities.h</span><br><span class="line">        │   │       ├── gmock-function-mocker.h</span><br><span class="line">        │   │       ├── gmock-generated-actions.h</span><br><span class="line">        │   │       ├── gmock-generated-actions.h.pump</span><br><span class="line">        │   │       ├── gmock-generated-function-mockers.h</span><br><span class="line">        │   │       ├── gmock-generated-function-mockers.h.pump</span><br><span class="line">        │   │       ├── gmock-generated-matchers.h</span><br><span class="line">        │   │       ├── gmock-generated-matchers.h.pump</span><br><span class="line">        │   │       ├── gmock.h</span><br><span class="line">        │   │       ├── gmock-matchers.h</span><br><span class="line">        │   │       ├── gmock-more-actions.h</span><br><span class="line">        │   │       ├── gmock-more-matchers.h</span><br><span class="line">        │   │       ├── gmock-nice-strict.h</span><br><span class="line">        │   │       ├── gmock-spec-builders.h</span><br><span class="line">        │   │       └── internal</span><br><span class="line">        │   │           ├── custom</span><br><span class="line">        │   │           │   ├── gmock-generated-actions.h</span><br><span class="line">        │   │           │   ├── gmock-generated-actions.h.pump</span><br><span class="line">        │   │           │   ├── gmock-matchers.h</span><br><span class="line">        │   │           │   ├── gmock-port.h</span><br><span class="line">        │   │           │   └── README.md</span><br><span class="line">        │   │           ├── gmock-internal-utils.h</span><br><span class="line">        │   │           ├── gmock-port.h</span><br><span class="line">        │   │           └── gmock-pp.h</span><br><span class="line">        │   └── lib</span><br><span class="line">        │       ├── libgmock_main.so</span><br><span class="line">        │       └── libgmock.so</span><br><span class="line">        └── gtest</span><br><span class="line">            ├── include</span><br><span class="line">            │   └── gtest</span><br><span class="line">            │       ├── gtest-death-test.h</span><br><span class="line">            │       ├── gtest.h</span><br><span class="line">            │       ├── gtest-matchers.h</span><br><span class="line">            │       ├── gtest-message.h</span><br><span class="line">            │       ├── gtest-param-test.h</span><br><span class="line">            │       ├── gtest_pred_impl.h</span><br><span class="line">            │       ├── gtest-printers.h</span><br><span class="line">            │       ├── gtest_prod.h</span><br><span class="line">            │       ├── gtest-spi.h</span><br><span class="line">            │       ├── gtest-test-part.h</span><br><span class="line">            │       ├── gtest-typed-test.h</span><br><span class="line">            │       └── internal</span><br><span class="line">            │           ├── custom</span><br><span class="line">            │           │   ├── gtest.h</span><br><span class="line">            │           │   ├── gtest-port.h</span><br><span class="line">            │           │   ├── gtest-printers.h</span><br><span class="line">            │           │   └── README.md</span><br><span class="line">            │           ├── gtest-death-test-internal.h</span><br><span class="line">            │           ├── gtest-filepath.h</span><br><span class="line">            │           ├── gtest-internal.h</span><br><span class="line">            │           ├── gtest-param-util.h</span><br><span class="line">            │           ├── gtest-port-arch.h</span><br><span class="line">            │           ├── gtest-port.h</span><br><span class="line">            │           ├── gtest-string.h</span><br><span class="line">            │           ├── gtest-type-util.h</span><br><span class="line">            │           └── gtest-type-util.h.pump</span><br><span class="line">            └── lib</span><br><span class="line">                ├── libgtest_main.so</span><br><span class="line">                └── libgtest.so</span><br></pre></td></tr></tbody></table></figure><ul><li><code>test</code> 目录的 <code>CMakeLists.txt</code>，这里的配置内容使用了项目里的 GoogleTest 库</li></ul><figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.15</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 GoogleTest 库的目录路径</span></span><br><span class="line"><span class="keyword">set</span>(PATH_TO_GOOGLE_TEST ../thirdparty/googletest/gtest)</span><br><span class="line"><span class="keyword">set</span>(PATH_TO_GOOGLE_MOCK ../thirdparty/googletest/gmock)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目信息</span></span><br><span class="line"><span class="keyword">project</span>(minder_test)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义C++的版本</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索父目录（父项目）的头文件</span></span><br><span class="line"><span class="keyword">include_directories</span>(../<span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索父目录（父项目）的源文件</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(../src MAIN_SOURCES)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 排除父目录（父项目）的入口源文件</span></span><br><span class="line"><span class="keyword">list</span>(FILTER MAIN_SOURCES EXCLUDE REGEX <span class="string">"main.cpp"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 引入子项目的头文件</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">${PROJECT_SOURCE_DIR}</span>/<span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索子项目里的源文件</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(<span class="variable">${PROJECT_SOURCE_DIR}</span>/src TEST_SOURCES)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 引入 GoogleTest 库的头文件</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">${PATH_TO_GOOGLE_TEST}</span>/<span class="keyword">include</span> <span class="variable">${PATH_TO_GOOGLE_MOCK}</span>/<span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定 GoogleTest 动态链接库所在的目录</span></span><br><span class="line"><span class="keyword">link_directories</span>(<span class="variable">${PATH_TO_GOOGLE_TEST}</span>/lib <span class="variable">${PATH_TO_GOOGLE_MOCK}</span>/lib)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定构建输出的目录</span></span><br><span class="line"><span class="keyword">set</span>(PROJECT_BINARY_DIR <span class="variable">${PROJECT_SOURCE_DIR}</span>/build)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定可执行文件的名称和单元测试的所有源文件</span></span><br><span class="line"><span class="keyword">add_executable</span>(<span class="variable">${PROJECT_NAME}</span> <span class="variable">${MAIN_SOURCES}</span> <span class="variable">${TEST_SOURCES}</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 链接 GoogleTest 与 pthread 库（请特别注意声明的顺序）</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(<span class="variable">${PROJECT_NAME}</span> gtest_main.so gtest.so gmock_main.so gmock.so pthread)</span><br></pre></td></tr></tbody></table></figure><ul><li><code>main.cpp</code> 的 C++ 代码，与上面的案例代码完全一致</li></ul><figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"strUtil.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"datetime.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gtest/gtest.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 去除字符串两边的空格</span></span><br><span class="line"><span class="built_in">TEST</span>(TestCase, test1) {</span><br><span class="line">    string str = <span class="string">" Hello World ! "</span>;</span><br><span class="line">    <span class="built_in">trim</span>(str);</span><br><span class="line">    <span class="built_in">ASSERT_EQ</span>(<span class="string">"Hello World !"</span>, str);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据给定的日期，计算它是星期几</span></span><br><span class="line"><span class="built_in">TEST</span>(TestCase, test2) {</span><br><span class="line">    <span class="built_in">ASSERT_EQ</span>(<span class="literal">true</span>, DateUtil::<span class="built_in">isWeekendDays</span>(<span class="string">"2022-01-09"</span>));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>{</span><br><span class="line">    testing::<span class="built_in">InitGoogleTest</span>(&amp;argc, argv);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">RUN_ALL_TESTS</span>();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="参考博客"><a href="#参考博客" class="headerlink" title="参考博客"></a>参考博客</h2><ul><li><a target="_blank" rel="external nofollow" href="https://www.dazhuanlan.com/zhangxiaofan/topics/1169035">建立简单的带单元测试的 CMake 项目</a></li><li><a target="_blank" rel="external nofollow" href="https://blog.csdn.net/joelcat/article/details/90766192">CMake + GoogleTest 之一入门</a></li><li><a target="_blank" rel="external nofollow" href="https://blog.csdn.net/yangxuan0261/article/details/104358123">CMake 使用 GoogleTest 进行单元测试</a></li><li><a target="_blank" rel="external nofollow" href="https://blog.csdn.net/weixin_43778179/article/details/104943810">Centos7 C++ 安装使用 GoogleTest 进行单元测试</a></li></ul><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/52f22f9b.html" title="CMake 基于 GoogleTest 实现单元测试">https://www.techgrow.cn/posts/52f22f9b.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/" rel="tag"><i class="fa fa-tag"></i> Linux系统编程</a><a href="/tags/C%E8%AF%AD%E8%A8%80/" rel="tag"><i class="fa fa-tag"></i> C语言</a><a href="/tags/C/" rel="tag"><i class="fa fa-tag"></i> C++</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/7df04100.html" rel="prev" title="Debian 安装 GCC、G++、GDB"><i class="fa fa-angle-left"></i> Debian 安装 GCC、G++、GDB</a></div><div class="post-nav-item"> <a href="/posts/8285186a.html" rel="next" title="Docker 构建 Frp 镜像">Docker 构建 Frp 镜像<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">1.8m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">26:57</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/52f22f9b.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>