<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="详细介绍如何搭建私有仓库管理系统Harbor，包括Https的配置教程。"><meta property="og:type" content="article"><meta property="og:title" content="Docker 之十六搭建私有仓库管理系统 Harbor"><meta property="og:url" content="https://www.techgrow.cn/posts/99d575a6.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="详细介绍如何搭建私有仓库管理系统Harbor，包括Https的配置教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2019/01/docker-harbor-architecture.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2019/01/harbor-web-ui.png"><meta property="article:published_time" content="2019-01-27T14:49:20.000Z"><meta property="article:modified_time" content="2020-03-11T13:23:43.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="容器化"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2019/01/docker-harbor-architecture.png"><link rel="canonical" href="https://www.techgrow.cn/posts/99d575a6.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/99d575a6.html","path":"posts/99d575a6.html","title":"Docker 之十六搭建私有仓库管理系统 Harbor"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>Docker 之十六搭建私有仓库管理系统 Harbor | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/app/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-overview-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">603</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">52</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/99d575a6.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="Docker 之十六搭建私有仓库管理系统 Harbor | Clay 的技术空间"><meta itemprop="description" content="详细介绍如何搭建私有仓库管理系统Harbor，包括Https的配置教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> Docker 之十六搭建私有仓库管理系统 Harbor</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-01-27 22:49:20" itemprop="dateCreated datePublished" datetime="2019-01-27T22:49:20+08:00">2019-01-27</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-03-11 21:23:43" itemprop="dateModified" datetime="2020-03-11T21:23:43+08:00">2020-03-11</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/99d575a6.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/99d575a6.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>2.5k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>2 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><blockquote><p><strong>相关站点</strong></p></blockquote><ul><li><a target="_blank" rel="external nofollow" href="https://goharbor.io/">Harbor 官网</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/goharbor/harbor/tree/master/docs">Harbor Docs</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/goharbor/harbor">Harbor Github</a></li><li><a target="_blank" rel="external nofollow" href="https://github.com/goharbor/harbor/releases">Harbor Releases</a></li></ul><blockquote><p><strong>Harbor 介绍</strong></p></blockquote><p>Harbor 是 VMware 公司开源的一个用于存储和分发 Docker 镜像的企业级 Registry 服务器，以 Docker 开源的 Registry 为基础，通过添加一些企业必需的功能特性，例如安全、标识和管理等，扩展了开源 Docker Distribution。作为一个企业级私有 Registry 服务器，Harbor 提供了更好的性能和安全，提升用户使用 Registry 构建和运行环境传输镜像的效率。Harbor 支持安装在多个 Registry 节点的镜像资源复制，镜像全部保存在私有 Registry 中，确保数据和知识产权在公司内部网络中管控。另外，Harbor 也提供了高级的安全特性，诸如用户管理，访问控制和活动审计等。</p><blockquote><p><strong>Harbor 特性</strong></p></blockquote><ul><li>基于角色的访问控制（Role Based Access Control）</li><li>基于策略的镜像复制（Policy based image replication）</li><li>镜像的漏洞扫描（Vulnerability Scanning）</li><li>AD/LDAP 集成（LDAP/AD support）</li><li>镜像的删除和空间清理（Image deletion &amp; garbage collection）</li><li>友好的管理 UI（Graphical user portal）</li><li>审计日志（Audit logging）</li><li>RESTful API</li><li> 部署简单（Easy deployment）<span id="more"></span></li></ul><blockquote><p><strong>Harbor 组件</strong></p></blockquote><ul><li><p>依赖的外部组件:</p><ol><li>Nginx（Proxy）: Harbor 的 Registry、UI、Token 等服务，通过一个前置的反向代理统一接收浏览器、Docker 客户端的请求，并将请求转发给后端不同的服务。</li><li>Registry v2: Docker 官方镜像仓库，负责储存 Docker 镜像，并处理 Docker Push/Pull 命令。由于我们要对用户进行访问控制，即不同用户对 Docker 镜像有不同的读写权限，Registry 会指向一个 Token 服务，强制用户的每次 Docker Push/Pull 请求都要携带一个合法的 Token, Registry 会通过公钥对 Token 进行解密验证。</li><li>Database（MySQL/Postgresql）：为 Core Services 提供数据库服务，负责储存用户权限、审计日志、Docker 镜像分组信息等数据。</li></ol></li><li><p>Harbor 自己的组件:</p><ol><li>Core Services（Admin Server）: 这是 Harbor 的核心功能，主要提供以下服务：<ul><li>API：提供 Harbor RESTful API</li><li>UI：提供图形化界面，帮助用户管理 Registry 上的镜像，并对用户进行授权。</li><li>Webhook：为了及时获取 Registry 上镜像状态变化的情况，在 Registry 上配置 Webhook，把状态变化传递给 UI 模块。</li><li>Auth 服务：负责根据用户权限给每个 Docker Push/Pull 命令签发 Token。Docker 客户端向 Registry 服务发起的请求，如果不包含 Token，会被重定向到这里，获得 Token 后再重新向 Registry 进行请求。</li></ul></li><li>Replication Job Service：提供多个 Harbor 实例之间的镜像同步功能。</li><li>Log Collector：为了帮助监控 Harbor 运行，负责收集其他组件的日志，供日后进行分析。</li></ol></li></ul><blockquote><p><strong>Harbor 架构图</strong></p></blockquote><p><img data-src="../../../asset/2019/01/docker-harbor-architecture.png" alt="docker-harbor-architecture"></p><blockquote><p><strong>Harbor 安裝方式</strong></p></blockquote><p>不建议使用 Kubernetes 来安裝，原因是镜像仓库非常重要，尽量保证安裝和维护的简洁性，因此这里直接使用 Docker Compose 的方式进行安裝。事实上 Harbor 的每个组件都是以 Docker 容器的形式构建，官方也是使用 Docker Compose 来对它进行安裝。Harbor 官方提供以下三种安裝方式:</p><ul><li>在线安装：从 Docker Hub 下载 Harbor 的镜像来安装，由于 Docker Hub 比较慢，建议 Docker 配置好加速器。</li><li>离线安装：这种方式应对与安裝主机没联网的情况使用，需要提前下载离线安装包到本地。</li><li>OVA 安装：这个主要用 vCentor 环境时使用。</li></ul><blockquote><p><strong>Harbor 安装环境说明</strong></p></blockquote><p>Harbor 以容器的形式进行安装，因此可以被安装到任何支持 Docker 的 Linux 发行版，本教程的安装环境如下：</p><table><thead><tr><th>环境名称</th><th>版本</th></tr></thead><tbody><tr><td> linux 发行版</td><td> CentOS Linux release 7.6.1810 (Core)</td></tr><tr><td>docker-ce</td><td>18.09.0</td></tr><tr><td>docker-compose</td><td>1.24.0-rc1</td></tr><tr><td>harbor</td><td>1.7.1</td></tr><tr><td>harbor 安装方式</td><td>在线安装</td></tr><tr><td> harbor 安装位置</td><td> /usr/local/harbor</td></tr></tbody></table><blockquote><p><strong>安装 Docker</strong></p></blockquote><p>站内教程：<a href="/posts/57bca56f.html">Docker 之一 Docker 介绍与安装</a></p><blockquote><p><strong>安装 Docker-Compose</strong></p></blockquote><p>站内教程：<a href="/posts/b31f4d18.html">Docker 之十七 Docker-Compose 安装与使用</a></p><blockquote><p><strong>安装 Harbor</strong></p></blockquote><p>Harbor 的在线或者离线安装程序下载地址可以从<a target="_blank" rel="external nofollow" href="https://github.com/goharbor/harbor/releases">这里</a>获取，如果下载失败，请自备梯子。</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装方式分为在线安装和离线安装两种方式，这里采用在线安装方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载在线安装程序</span></span><br><span class="line"><span class="keyword"># wget</span><span class="params"> -P</span> /usr/<span class="built_in">local</span> https://storage.googleapis.com/harbor-releases/release-1.7.0/harbor-online-installer-v1.7.1.tgz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压下载文件</span></span><br><span class="line"><span class="keyword"># tar</span> zxf /usr/<span class="built_in">local</span>/harbor-online-installer-v1.7.1.tgz<span class="params"> -C</span> /usr/<span class="built_in">local</span>/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改配置文件，根据自己的需求进行修改</span></span><br><span class="line"><span class="keyword"># vim</span> /usr/<span class="built_in">local</span>/harbor/harbor.cfg</span><br><span class="line"><span class="comment"># 本机IP或者域名，不能是127.0.0.1或者localhost</span></span><br><span class="line">hostname = 192.168.1.130</span><br><span class="line"><span class="comment"># 系统Harbor管理员的密码</span></span><br><span class="line">harbor_admin_password = Harbor12345</span><br><span class="line"><span class="comment"># 禁止用户注册</span></span><br><span class="line">self_registration = off</span><br><span class="line"><span class="comment"># 设置只有管理员可以创建项目</span></span><br><span class="line">project_creation_restriction = adminonly</span><br><span class="line"></span><br><span class="line"><span class="comment"># 由于Harbor的Nginx组件默认会监听宿主机的80、443、4443端口，如果需要更改Nginx的端口映射，可以修改以下配置文件</span></span><br><span class="line"><span class="keyword"># vim</span> /usr/<span class="built_in">local</span>/harbor/docker-compose.yml</span><br><span class="line"> ports:</span><br><span class="line">      - 8082:80</span><br><span class="line">      - 443:443</span><br><span class="line">      - 4443:4443</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果上面更改了Nginx的80端口映射，此时还需要编辑Harbor的配置文件，修改hostname加上指定的端口号</span></span><br><span class="line"><span class="keyword"># vim</span> harbor.cfg</span><br><span class="line">hostname = 192.168.1.130:8082</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行安装脚本</span></span><br><span class="line"><span class="comment"># /usr/local/harbor/install.sh</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword"># Harbar</span>的日志目录是：/var/<span class="built_in">log</span>/harbor</span><br><span class="line"><span class="keyword"># Harbar</span>相关数据卷的挂载目录默认是宿主机的/data目录，如果重新安装Harbar并在配置文件里更改了数据库密码，则需要删除/data目录，否则Harbor部分组件会启动失败</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>安装 Harbor 的日志信息</strong></p></blockquote><details><summary>★查看详细日志信息★</summary><code><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">[Step 0]: checking installation environment ...</span><br><span class="line"></span><br><span class="line">Note: docker version: 18.09.0</span><br><span class="line"></span><br><span class="line">Note: docker-compose version: 1.24.0</span><br><span class="line"></span><br><span class="line">[Step 1]: preparing environment ...</span><br><span class="line">Generated and saved secret to file: /data/secretkey</span><br><span class="line">Generated configuration file: ./common/config/nginx/nginx.conf</span><br><span class="line">Generated configuration file: ./common/config/adminserver/env</span><br><span class="line">Generated configuration file: ./common/config/core/env</span><br><span class="line">Generated configuration file: ./common/config/registry/config.yml</span><br><span class="line">Generated configuration file: ./common/config/db/env</span><br><span class="line">Generated configuration file: ./common/config/jobservice/env</span><br><span class="line">Generated configuration file: ./common/config/jobservice/config.yml</span><br><span class="line">Generated configuration file: ./common/config/log/logrotate.conf</span><br><span class="line">Generated configuration file: ./common/config/registryctl/env</span><br><span class="line">Generated configuration file: ./common/config/core/app.conf</span><br><span class="line">Generated certificate, key file: ./common/config/core/private_key.pem, cert file: ./common/config/registry/root.crt</span><br><span class="line">The configuration files are ready, please use docker-compose to start the service.</span><br><span class="line"></span><br><span class="line">[Step 2]: checking existing instance of Harbor ...</span><br><span class="line"></span><br><span class="line">[Step 3]: starting Harbor ...</span><br><span class="line">Creating network "harbor_harbor" with the default driver</span><br><span class="line">Pulling log (goharbor/harbor-log:v1.7.1)...</span><br><span class="line">v1.7.1: Pulling from goharbor/harbor-log</span><br><span class="line">321a8da5ee1f: Pull complete</span><br><span class="line">e58cb02d4a79: Pull complete</span><br><span class="line">b1addcae27cf: Pull complete</span><br><span class="line">0add5fe71c61: Pull complete</span><br><span class="line">701d7cb4751e: Pull complete</span><br><span class="line">ae052802ba8f: Pull complete</span><br><span class="line">474572a6c946: Pull complete</span><br><span class="line">Digest: sha256:1465ec82b77534eb4687093fff91c752ac655d4ed1fb7e7b23bb6e3905a1ef18</span><br><span class="line">Status: Downloaded newer image for goharbor/harbor-log:v1.7.1</span><br><span class="line">Pulling registry (goharbor/registry-photon:v2.6.2-v1.7.1)...</span><br><span class="line">v2.6.2-v1.7.1: Pulling from goharbor/registry-photon</span><br><span class="line">321a8da5ee1f: Already exists</span><br><span class="line">427e471dc5bb: Pull complete</span><br><span class="line">79d644c380a9: Pull complete</span><br><span class="line">d1ee69ba441f: Pull complete</span><br><span class="line">13ee399ae5e6: Pull complete</span><br><span class="line">52da6cf3d71f: Pull complete</span><br><span class="line">e6dfe8d3336d: Pull complete</span><br><span class="line">2261e5dd4591: Pull complete</span><br><span class="line">Digest: sha256:dccc66572458001ed3b8f8ead0f0a89f0455747992528bafb857ed031bae07dc</span><br><span class="line">Status: Downloaded newer image for goharbor/registry-photon:v2.6.2-v1.7.1</span><br><span class="line">Pulling registryctl (goharbor/harbor-registryctl:v1.7.1)...</span><br><span class="line">v1.7.1: Pulling from goharbor/harbor-registryctl</span><br><span class="line">321a8da5ee1f: Already exists</span><br><span class="line">60ab2a220157: Pull complete</span><br><span class="line">685cb36a4aa6: Pull complete</span><br><span class="line">6ab9cbb7c05b: Pull complete</span><br><span class="line">d66f51b51c32: Pull complete</span><br><span class="line">152d893b8817: Pull complete</span><br><span class="line">Digest: sha256:de4b9c6684b7005379df6c48c05d2884c6b3cced0c98f8814c4506d71f781b9c</span><br><span class="line">Status: Downloaded newer image for goharbor/harbor-registryctl:v1.7.1</span><br><span class="line">Pulling postgresql (goharbor/harbor-db:v1.7.1)...</span><br><span class="line">v1.7.1: Pulling from goharbor/harbor-db</span><br><span class="line">321a8da5ee1f: Already exists</span><br><span class="line">3b62caa7690c: Pull complete</span><br><span class="line">0c0b8f8af809: Pull complete</span><br><span class="line">68db7c777555: Pull complete</span><br><span class="line">810390407c8c: Pull complete</span><br><span class="line">d99f5e0b551e: Pull complete</span><br><span class="line">0dedd5da1f5d: Pull complete</span><br><span class="line">5e156cfb841f: Pull complete</span><br><span class="line">0433d5b9e1ad: Pull complete</span><br><span class="line">Digest: sha256:6031b1ed9337c3af78e627ecd45351e0e0d630b83cf45e1c924cb3e5b006cb44</span><br><span class="line">Status: Downloaded newer image for goharbor/harbor-db:v1.7.1</span><br><span class="line">Pulling adminserver (goharbor/harbor-adminserver:v1.7.1)...</span><br><span class="line">v1.7.1: Pulling from goharbor/harbor-adminserver</span><br><span class="line">321a8da5ee1f: Already exists</span><br><span class="line">3235adc5dfba: Pull complete</span><br><span class="line">36df358268ae: Pull complete</span><br><span class="line">f07cf44733c3: Pull complete</span><br><span class="line">153223fc88f2: Pull complete</span><br><span class="line">Digest: sha256:5a539a2c733ca9efcd62d4561b36ea93d55436c5a86825b8e43ce8303a7a0752</span><br><span class="line">Status: Downloaded newer image for goharbor/harbor-adminserver:v1.7.1</span><br><span class="line">Pulling core (goharbor/harbor-core:v1.7.1)...</span><br><span class="line">v1.7.1: Pulling from goharbor/harbor-core</span><br><span class="line">321a8da5ee1f: Already exists</span><br><span class="line">95d433145bab: Pull complete</span><br><span class="line">49d3e2a9635a: Pull complete</span><br><span class="line">6a4cbc768efe: Pull complete</span><br><span class="line">7e7d30cebeb5: Pull complete</span><br><span class="line">Digest: sha256:2791572f21aeaa7e62d3ee90b5b7ced3903633d9809d19fa32d3a524d580fc12</span><br><span class="line">Status: Downloaded newer image for goharbor/harbor-core:v1.7.1</span><br><span class="line">Pulling portal (goharbor/harbor-portal:v1.7.1)...</span><br><span class="line">v1.7.1: Pulling from goharbor/harbor-portal</span><br><span class="line">321a8da5ee1f: Already exists</span><br><span class="line">0c2edbea17ee: Pull complete</span><br><span class="line">35f0e6ee2803: Pull complete</span><br><span class="line">815b36cabaa4: Pull complete</span><br><span class="line">Digest: sha256:37a16e2ab4dc1499b25ce4a3f42c34a3c524fcfcd31f7433a459a738d4cec3b6</span><br><span class="line">Status: Downloaded newer image for goharbor/harbor-portal:v1.7.1</span><br><span class="line">Pulling redis (goharbor/redis-photon:v1.7.1)...</span><br><span class="line">v1.7.1: Pulling from goharbor/redis-photon</span><br><span class="line">321a8da5ee1f: Already exists</span><br><span class="line">e37a237fdce1: Pull complete</span><br><span class="line">a533db83c439: Pull complete</span><br><span class="line">60f1956f70fa: Pull complete</span><br><span class="line">c7eecf8b746b: Pull complete</span><br><span class="line">Digest: sha256:9a10e8d0c3640c0207d94409fc61783643a2f5d866d4e1136c0718b3a5ac3015</span><br><span class="line">Status: Downloaded newer image for goharbor/redis-photon:v1.7.1</span><br><span class="line">Pulling jobservice (goharbor/harbor-jobservice:v1.7.1)...</span><br><span class="line">v1.7.1: Pulling from goharbor/harbor-jobservice</span><br><span class="line">321a8da5ee1f: Already exists</span><br><span class="line">4809bd624b7e: Pull complete</span><br><span class="line">889c696c8f56: Pull complete</span><br><span class="line">72d181b0302b: Pull complete</span><br><span class="line">Digest: sha256:c6706d51a3476235d8e801806141aa8e7279608268fca8be8ccd2e74987db093</span><br><span class="line">Status: Downloaded newer image for goharbor/harbor-jobservice:v1.7.1</span><br><span class="line">Pulling proxy (goharbor/nginx-photon:v1.7.1)...</span><br><span class="line">v1.7.1: Pulling from goharbor/nginx-photon</span><br><span class="line">321a8da5ee1f: Already exists</span><br><span class="line">044755eb163c: Pull complete</span><br><span class="line">Digest: sha256:c941c386eb99613b4c7481b9e433372bfac07beddb52a4e73dd7356ac8373189</span><br><span class="line">Status: Downloaded newer image for goharbor/nginx-photon:v1.7.1</span><br><span class="line">Creating harbor-log ... done</span><br><span class="line">Creating harbor-adminserver ... done</span><br><span class="line">Creating registryctl        ... done</span><br><span class="line">Creating harbor-db          ... done</span><br><span class="line">Creating registry           ... done</span><br><span class="line">Creating redis              ... done</span><br><span class="line">Creating harbor-core        ... done</span><br><span class="line">Creating harbor-portal      ... done</span><br><span class="line">Creating harbor-jobservice  ... done</span><br><span class="line">Creating nginx              ... done</span><br><span class="line"></span><br><span class="line">✔ ----Harbor has been installed and started successfully.----</span><br><span class="line"></span><br><span class="line">Now you should be able to visit the admin portal at http://192.168.1.130.</span><br><span class="line">For more details, please visit https://github.com/goharbor/harbor .</span><br></pre></td></tr></tbody></table></figure><code></code></code></details><code><code><blockquote><p><strong>Harbor启动/停止/重启</strong></p></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果某个Harbor组件启动失败，可以在日志目录/var/log/harbor下查看具体的日志信息，进一步定位启动失败的原因</span></span><br><span class="line"><span class="comment"># 启动时Harbor默认会监听宿主机的80、443、4443端口，启动Harbor之前必须确保宿主机的80、443、4443端口不被占用，否则Harbor相关组件会启动失败。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Harbor容器的运行状态</span></span><br><span class="line"><span class="keyword"># docker</span> ps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者通过docker-compose查看，此时需要进入Harbor安装脚本所在的目录里执行相关命令</span></span><br><span class="line"><span class="keyword"># cd</span> /usr/<span class="built_in">local</span>/harbor</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Harbor容器的运行状态</span></span><br><span class="line"><span class="keyword"># docker</span>-compose ps</span><br><span class="line">       Name                     Command                  State                                    Ports</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">harbor-adminserver   /harbor/start.sh                 Up (healthy)</span><br><span class="line">harbor-core          /harbor/start.sh                 Up (healthy)</span><br><span class="line">harbor-db            /entrypoint.sh postgres          Up (healthy)   5432/tcp</span><br><span class="line">harbor-jobservice    /harbor/start.sh                 Up</span><br><span class="line">harbor-<span class="built_in">log</span>           /bin/sh<span class="params"> -c</span> /usr/<span class="built_in">local</span>/bin/ ...   Up (healthy)   127.0.0.1:1514-&gt;10514/tcp</span><br><span class="line">harbor-portal        nginx<span class="params"> -g</span> daemon off;             Up (healthy)   80/tcp</span><br><span class="line">nginx                nginx<span class="params"> -g</span> daemon off;             Up (healthy)   0.0.0.0:443-&gt;443/tcp, 0.0.0.0:4443-&gt;4443/tcp, 0.0.0.0:80-&gt;80/tcp</span><br><span class="line">redis                docker-entrypoint.sh redis ...   Up             6379/tcp</span><br><span class="line">registry             /entrypoint.sh /etc/regist ...   Up (healthy)   5000/tcp</span><br><span class="line">registryctl          /harbor/start.sh                 Up (healthy)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动Harbor容器</span></span><br><span class="line"><span class="keyword"># docker</span>-compose start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止Harbor容器</span></span><br><span class="line"><span class="keyword"># docker</span>-compose stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启Harbor容器</span></span><br><span class="line"><span class="keyword"># docker</span>-compose restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止并删除Harbor容器，加上-v参数可以同时移除挂载在容器上的目录</span></span><br><span class="line"><span class="keyword"># docker</span>-compose down</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建并启动Harbo容器，参数“-d”表示后台运行命令</span></span><br><span class="line"><span class="keyword"># docker</span>-compose up<span class="params"> -d</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>Harbor测试访问</strong></p></blockquote><p>浏览器输入以下地址或者域名访问Harbor的Web界面，默认账号密码：admin/Harbor12345<br><a target="_blank" rel="external nofollow" href="http://192.168.1.130/">http://192.168.1.130</a><br><img data-src="../../../asset/2019/01/harbor-web-ui.png" alt="harbor-web-ui"></p><blockquote><p><strong>将本地镜像Push到Harbor</strong></p></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置Docker客户端允许使用Http协议，如果Nginx更改了的端口映射，需要在以下IP地址后面指定具体的端口号</span></span><br><span class="line"><span class="keyword">#  vim</span> /etc/docker/daemon.json</span><br><span class="line">{</span><br><span class="line">  <span class="string">"insecure-registries"</span>:[<span class="string">"192.168.1.130"</span>]</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新加载Docker的配置文件</span></span><br><span class="line"><span class="keyword"># systemctl</span> daemon-reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启Docker</span></span><br><span class="line"><span class="keyword"># systemctl</span> restart docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拉取Docker官方的Centos镜像</span></span><br><span class="line"><span class="keyword"># docker</span> pull centos:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看镜像列表</span></span><br><span class="line"><span class="keyword"># docker</span> images</span><br><span class="line">REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos                        latest              1e1148e4cc2c        7 weeks ago         202MB</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录Harbor Registry，回车后输入admin用户的帐号信息（admin/Harbor12345）</span></span><br><span class="line"><span class="keyword"># docker</span> login 192.168.1.130</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果不使用默认项目名library，则需要使用admin用户提前登录Harbor的Web界面，手动创建新项目后再进行Push操作</span></span><br><span class="line"><span class="comment"># 给镜像打上相应的标签, 注意标签格式: ip/{project-name}/{image-name}[:tag]</span></span><br><span class="line"><span class="comment"># 项目library只有admin有写的权限</span></span><br><span class="line"><span class="keyword"># docker</span> tag centos:latest 192.168.1.130/library/centos:1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将本地镜像Push到Harbor</span></span><br><span class="line"><span class="keyword"># docker</span> push 192.168.1.130/library/centos:1.0</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>将Harbor镜像Pull到本地</strong></p></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除上面创建的镜像</span></span><br><span class="line"><span class="keyword"># docker</span> rmi centos</span><br><span class="line"><span class="keyword"># docker</span> rm 192.168.1.130/library/centos:1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将Harbor镜像Pull到本地</span></span><br><span class="line"><span class="keyword"># docker</span> pull 192.168.1.130/library/centos:1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看镜像列表</span></span><br><span class="line"><span class="keyword"># docker</span> ps</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>Harbor安装后更改Nginx的端口映射</strong></p></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入Harbor的安装目录</span></span><br><span class="line"><span class="keyword"># cd</span> /usr/<span class="built_in">local</span>/harbor</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止并删除Harbor容器，加上-v参数可以同时移除挂载在容器上的目录</span></span><br><span class="line"><span class="keyword"># docker</span>-compose down</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑compose的配置文件，修改Nginx的80端口映射</span></span><br><span class="line"><span class="keyword"># vim</span> docker-compose.yml</span><br><span class="line"> ports:</span><br><span class="line">      - 8082:80</span><br><span class="line">      - 443:443</span><br><span class="line">      - 4443:4443</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑Harbor的配置文件，修改hostname加上指定的端口号</span></span><br><span class="line"><span class="keyword"># vim</span> harbor.cfg</span><br><span class="line">hostname = 192.168.1.130:8082</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新生成配置文件</span></span><br><span class="line"><span class="keyword"># prepare</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建并启动Harbor容器</span></span><br><span class="line"><span class="keyword"># docker</span>-compose up<span class="params"> -d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看Harbor的容器列表，发现Nginx的端口映射已经更改成功</span></span><br><span class="line"><span class="keyword"># docker</span>-compose ps</span><br><span class="line">harbor-adminserver   /harbor/start.sh                 Up (health: starting)</span><br><span class="line">harbor-core          /harbor/start.sh                 Up (health: starting)</span><br><span class="line">harbor-db            /entrypoint.sh postgres          Up (health: starting)   5432/tcp</span><br><span class="line">harbor-jobservice    /harbor/start.sh                 Up</span><br><span class="line">harbor-<span class="built_in">log</span>           /bin/sh<span class="params"> -c</span> /usr/<span class="built_in">local</span>/bin/ ...   Up (healthy)            127.0.0.1:1514-&gt;10514/tcp</span><br><span class="line">harbor-portal        nginx<span class="params"> -g</span> daemon off;             Up (health: starting)   80/tcp</span><br><span class="line">nginx                nginx<span class="params"> -g</span> daemon off;             Up (health: starting)   0.0.0.0:443-&gt;443/tcp, 0.0.0.0:4443-&gt;4443/tcp, 0.0.0.0:8082-&gt;80/tcp</span><br><span class="line">redis                docker-entrypoint.sh redis ...   Up                      6379/tcp</span><br><span class="line">registry             /entrypoint.sh /etc/regist ...   Up (health: starting)   5000/tcp</span><br><span class="line">registryctl          /harbor/start.sh                 Up (health: starting)</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>生成TLS证书，用于Harbor配置Https</strong></p></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下面以IP：192.168.1.130为例子，实际操作中将命令中的IP地址修改为自己的IP地址即可</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建存放证书的临时目录</span></span><br><span class="line"><span class="keyword"># mkdir</span> ~/cert</span><br><span class="line"><span class="keyword"># cd</span> ~/cert</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建自签名根证书</span></span><br><span class="line"><span class="keyword"># openssl</span> req \<span class="params"></span></span><br><span class="line"><span class="params">    -newkey</span> rsa:4096<span class="params"> -nodes</span><span class="params"> -sha256</span><span class="params"> -keyout</span> ca.key \<span class="params"></span></span><br><span class="line"><span class="params">    -x509</span><span class="params"> -days</span> 10000<span class="params"> -out</span> ca.crt \<span class="params"></span></span><br><span class="line"><span class="params">    -subj</span> <span class="string">"/C=CN/ST=Guangdong/L=Shenzhen/O=test_company/OU=IT/CN=test/emailAddress=test@qq.com"</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword"># ls</span></span><br><span class="line">ca.crt  ca.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 产生证书签名请求</span></span><br><span class="line"><span class="keyword"># openssl</span> req \<span class="params"></span></span><br><span class="line"><span class="params">    -newkey</span> rsa:4096<span class="params"> -nodes</span><span class="params"> -sha256</span><span class="params"> -keyout</span> harbor-registry.key \<span class="params"></span></span><br><span class="line"><span class="params">    -out</span> harbor-registry.csr \<span class="params"></span></span><br><span class="line"><span class="params">    -subj</span> <span class="string">"/C=CN/ST=Guangdong/L=Shenzhen/O=test_company/OU=IT/CN=192.168.1.130/emailAddress=test@qq.com"</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword"># ls</span></span><br><span class="line">ca.crt  ca.key  harbor-registry.csr  harbor-registry.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为Registry主机产生证书</span></span><br><span class="line"><span class="keyword"># echo</span> subjectAltName = IP:192.168.1.130 &gt; extfile.cnf</span><br><span class="line"><span class="keyword"># openssl</span> x509<span class="params"> -req</span><span class="params"> -days</span> 10000<span class="params"> -in</span> harbor-registry.csr<span class="params"> -CA</span> ca.crt<span class="params"> -CAkey</span> ca.key<span class="params"> -CAcreateserial</span><span class="params"> -extfile</span> extfile.cnf<span class="params"> -out</span> harbor-registry.crt</span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword"># ls</span></span><br><span class="line">ca.crt  ca.key  ca.srl  extfile.cnf  harbor-registry.crt  harbor-registry.csr  harbor-registry.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Harbor的证书目录</span></span><br><span class="line"><span class="keyword"># mkdir</span><span class="params"> -p</span> /opt/cert</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝harbor-registry证书到Harbor的证书目录</span></span><br><span class="line"><span class="keyword"># cp</span> harbor-registry.crt /opt/cert/</span><br><span class="line"><span class="keyword"># cp</span> harbor-registry.key /opt/cert/</span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>Harbor安装后配置Https</strong></p></blockquote><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入Harbor的安装目录</span></span><br><span class="line"><span class="keyword"># cd</span> /usr/<span class="built_in">local</span>/harbor</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止并删除Harbor容器，加上-v参数可以同时移除挂载在容器上的目录</span></span><br><span class="line"><span class="keyword"># docker</span>-compose down</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改harbor.cfg配置文件</span></span><br><span class="line"><span class="keyword"># vim</span> /usr/<span class="built_in">local</span>/harbor/harbor.cfg</span><br><span class="line">ui_url_protocol = https</span><br><span class="line">hostname = 192.168.1.130</span><br><span class="line">ssl_cert = /opt/cert/harbor-registry.crt</span><br><span class="line">ssl_cert_key = /opt/cert/harbor-registry.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新生成配置文件</span></span><br><span class="line"><span class="comment"># ./prepare</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 让Docker客户端默认使用Https协议访问Registry，需要去掉“insecure-registries”相关配置项</span></span><br><span class="line"><span class="comment"># 查看daemon.json文件中是否有"insecure-registries":["192.168.1.130"]，如果有则将其删除掉</span></span><br><span class="line"><span class="keyword"># vim</span> /etc/docker/daemon.json</span><br><span class="line">{<span class="string">"insecure-registries"</span>:[<span class="string">""</span>]}</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新加载Docker的配置文件</span></span><br><span class="line"><span class="keyword"># systemctl</span> daemon-reload</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启Docker</span></span><br><span class="line"><span class="keyword"># systemctl</span> restart docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建并启动Harbor容器</span></span><br><span class="line"><span class="keyword"># docker</span>-compose up<span class="params"> -d</span></span><br></pre></td></tr></tbody></table></figure><blockquote><p><strong>测试通过Https协议访问Harbor</strong></p></blockquote><ul><li><p>通过浏览器访问<br>这里首先需要将上面产生的~/cert/ca.crt导入到浏览器的受信任的根证书中，然后就可以通过Https协议访问Harbor的Web界面了，但不能保证所有浏览器都支持。访问地址是：<a target="_blank" rel="external nofollow" href="https://192.168.1.130/">https://192.168.1.130</a></p></li><li><p>通过Docker命令来访问</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建Docker的证书目录，目录名称是IP地址，需要根据自己的情况进行修改</span></span><br><span class="line"><span class="comment"># 特别注意，如果Nginx的443端口映射到了其他端口，以下命令中的目录名称都需要带上具体的Https端口号，例如 "mkdir -p /etc/docker/certs.d/192.168.1.130:8443"</span></span><br><span class="line"><span class="keyword"># mkdir</span><span class="params"> -p</span> /etc/docker/certs.d/192.168.1.130</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将上面产生的ca.crt拷贝到Docker的证书目录下</span></span><br><span class="line"><span class="keyword"># cp</span> ~/cert/ca.crt /etc/docker/certs.d/192.168.1.130</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启Docker</span></span><br><span class="line"><span class="keyword"># systemctl</span> restart docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动Harbor容器</span></span><br><span class="line"><span class="keyword"># docker</span>-compose up<span class="params"> -d</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录Harbor Registry，回车后输入admin用户的帐号信息（admin/Harbor12345）</span></span><br><span class="line"><span class="keyword"># docker</span> login 192.168.1.130</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看镜像列表</span></span><br><span class="line"><span class="keyword"># docker</span> images</span><br><span class="line">REPOSITORY                    TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">centos                        latest              1e1148e4cc2c        7 weeks ago         202MB</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给本地镜像打上标签</span></span><br><span class="line"><span class="keyword"># docker</span> tag centos:latest 192.168.1.130/library/centos:1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将本地镜像Push到Harbor</span></span><br><span class="line"><span class="keyword"># docker</span> push 192.168.1.130/library/centos:1.0</span><br></pre></td></tr></tbody></table></figure></li></ul><blockquote><p><strong>Harbor的坑</strong></p></blockquote><p>安装Harbor的时候，不要更改数据库默认密码，包括Postgresql、Redis，否则Harbor相关组件很有可能启动失败，导致Web界面显示”502 Gateway”错误</p><blockquote><p><strong>参考博客</strong></p></blockquote><ul><li><a target="_blank" rel="external nofollow" href="https://www.cnblogs.com/pangguoping/p/7650014.html">搭建Harbor企业级docker仓库</a></li><li><a target="_blank" rel="external nofollow" href="https://ivanzz1001.github.io/records/post/docker/2018/04/09/docker-harbor-https#23-%E4%B8%BAregistry%E4%B8%BB%E6%9C%BA%E4%BA%A7%E7%94%9F%E8%AF%81%E4%B9%A6">Harbor安装后配置以支持Https</a></li></ul></code></code><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/99d575a6.html" title="Docker 之十六搭建私有仓库管理系统 Harbor">https://www.techgrow.cn/posts/99d575a6.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%AE%B9%E5%99%A8%E5%8C%96/" rel="tag"><i class="fa fa-tag"></i> 容器化</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/c76f5f00.html" rel="prev" title="Docker 之十五 Docker 私有仓库搭建与使用实战"><i class="fa fa-angle-left"></i> Docker 之十五 Docker 私有仓库搭建与使用实战</a></div><div class="post-nav-item"> <a href="/posts/b31f4d18.html" rel="next" title="Docker Compose 入门使用教程">Docker Compose 入门使用教程<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2024</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">1.4m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">21:40</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤 ICP 备 19024664 号</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035 号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/app/api/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/app/api/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/99d575a6.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>