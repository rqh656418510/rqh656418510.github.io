<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CRoboto+Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="/lib/@fortawesome/fontawesome-free/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/animate.css/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="/lib/pace-js/themes/blue/pace-theme-minimal.css"><script src="/lib/pace-js/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.techgrow.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script><meta name="description" content="本文主要介绍 ZooKeeper 的使用教程。"><meta property="og:type" content="article"><meta property="og:title" content="ZooKeeper 入门教程之一"><meta property="og:url" content="https://www.techgrow.cn/posts/23b4218e.html"><meta property="og:site_name" content="Clay 的技术空间"><meta property="og:description" content="本文主要介绍 ZooKeeper 的使用教程。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/zookeeper-1.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/zookeeper-3.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/zookeeper-2.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/zookeeper-4.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/zookeeper-5.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/zookeeper-6.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/zookeeper-7.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/zookeeper-9.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/zookeeper-8.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/zookeeper-15.png"><meta property="og:image" content="https://www.techgrow.cn/asset/2024/12/zookeeper-16.png"><meta property="article:published_time" content="2021-06-25T14:13:45.000Z"><meta property="article:modified_time" content="2021-06-25T14:13:45.000Z"><meta property="article:author" content="Clay"><meta property="article:tag" content="分布式"><meta property="article:tag" content="大数据"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.techgrow.cn/asset/2024/12/zookeeper-1.png"><link rel="canonical" href="https://www.techgrow.cn/posts/23b4218e.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.techgrow.cn/posts/23b4218e.html","path":"posts/23b4218e.html","title":"ZooKeeper 入门教程之一"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>ZooKeeper 入门教程之一 | Clay 的技术空间</title><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-135294383-1"></script><script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-135294383-1","only_pageview":false,"measure_protocol_api_secret":null}</script><script src="/js/third-party/analytics/google-analytics.js"></script><script class="next-config" data-name="baidu_analytics" type="application/json">"84c09b30349a65573c5c642ff336969b"</script><script src="/js/third-party/analytics/baidu-analytics.js"></script><link rel="dns-prefetch" href="https://waline.techgrow.cn"><link rel="stylesheet" type="text/css" href="/css/injector/main.css"><link rel="preload" as="style" href="/css/injector/light.css"><link rel="preload" as="style" href="/css/injector/dark.css"><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><style>.admonition{margin:1.5625em 0;padding:.6rem;overflow:hidden;font-size:.64rem;page-break-inside:avoid;border-left:.3rem solid #42b983;border-radius:.3rem;box-shadow:0 .1rem .4rem rgba(0,0,0,.05),0 0 .05rem rgba(0,0,0,.1);background-color:#fafafa}p.admonition-title{position:relative;margin:-.6rem -.6rem .8em -.6rem!important;padding:.4rem .6rem .4rem 2.5rem;font-weight:700;background-color:rgba(66,185,131,.1)}.admonition-title::before{position:absolute;top:.9rem;left:1rem;width:12px;height:12px;background-color:#42b983;border-radius:50%;content:' '}.info>.admonition-title,.todo>.admonition-title{background-color:rgba(0,184,212,.1)}.attention>.admonition-title,.caution>.admonition-title,.warning>.admonition-title{background-color:rgba(255,145,0,.1)}.error>.admonition-title,.fail>.admonition-title,.failure>.admonition-title,.missing>.admonition-title{background-color:rgba(255,82,82,.1)}.admonition.info,.admonition.todo{border-color:#00b8d4}.admonition.attention,.admonition.caution,.admonition.warning{border-color:#ff9100}.admonition.error,.admonition.fail,.admonition.failure,.admonition.missing{border-color:#ff5252}.info>.admonition-title::before,.todo>.admonition-title::before{background-color:#00b8d4;border-radius:50%}.attention>.admonition-title::before,.caution>.admonition-title::before,.warning>.admonition-title::before{background-color:#ff9100;border-radius:50%}.error>.admonition-title::before,.fail>.admonition-title::before,.failure>.admonition-title::before,.missing>.admonition-title::before{background-color:#ff5252;border-radius:50%}.admonition>:last-child{margin-bottom:0!important}</style><link rel="alternate" href="/atom.xml" title="Clay 的技术空间" type="application/atom+xml"><style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head><body itemscope="" itemtype="http://schema.org/WebPage" class="use-motion"><script src="/lib/jquery/dist/jquery.min.js"></script><script data-pjax="">!function(){var t=window.location.host;if(-1==t.indexOf("127.0.0.1")&&-1==t.indexOf("localhost")){var o=document.createElement("script"),e=window.location.protocol.split(":")[0];o.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(o,n)}}()</script><link rel="stylesheet" href="/lib/aplayer/dist/APlayer.min.css"><div id="aplayer" style="display:none"></div><script src="/lib/aplayer/dist/APlayer.min.js"></script><script src="/lib/aplayer/dist/color-thief.js"></script><script src="/lib/aplayer-init.js"></script><script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script><script>function getTitle(){var t=jQuery("meta[property='og:title']");return t?t.attr("content"):""}function getDesc(){var t=jQuery("meta[property='og:description']");return t?t.attr("content"):""}function randomString(t){for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=e.length,i="",r=0;r<t;++r)i+=e.charAt(Math.floor(Math.random()*n));return i}function initWx(t){wx.config({debug:!1,appId:t.appId,nonceStr:t.nonceStr,signature:t.signature,timestamp:t.timestamp,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]}),wx.ready(function(){wx.onMenuShareTimeline({title:t.title,link:t.link,imgUrl:t.imgUrl,success:function(){}}),wx.onMenuShareAppMessage({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,type:"link",dataUrl:"",success:function(){}}),wx.onMenuShareQQ({title:t.title,desc:t.desc,link:t.link,imgUrl:t.imgUrl,success:function(){},cancel:function(){}})}),wx.error(function(t){})}jQuery(function(){var e=getDesc(),n=getTitle(),i=randomString(16),r=(new Date).getTime(),a=window.location.href,t="https://open.techgrow.cn/api/wechat/js/signature?url="+a+"&noncestr="+i+"&timestamp="+r;jQuery.getJSON(t,function(t){initWx({desc:e,title:n,link:a,nonceStr:i,timestamp:r,signature:t.data,appId:"wx1fcf69355af43d41",imgUrl:"https://www.techgrow.cn/img/wx_share.jpg"})})})</script><div style="display:none"><img src="https://www.techgrow.cn/img/wx_share.jpg" alt=""></div><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">Clay 的技术空间</p><i class="logo-line"></i></a><p class="site-subtitle" itemprop="description">用进废退 | 艺不压身</p></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-search"><a href="/search" rel="section"><i class="fa fa-search fa-fw"></i>搜索</a></li><li class="menu-item menu-item-links"><a href="/links" rel="section"><i class="fas fa-link fa-fw"></i>友链</a></li><li class="menu-item menu-item-readingnotes"><a href="https://www.techgrow.cn/reading/" rel="section"><i class="fa fa-book-open-reader fa-fw"></i>读书笔记</a></li><li class="menu-item menu-item-commentmanage"><a href="https://waline.techgrow.cn/" rel="external nofollow" target="_blank"><i class="fa fa-comment fa-fw"></i>评论管理</a></li></ul></nav></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%A7%E7%BA%B2"><span class="nav-text">大纲</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90"><span class="nav-text">学习资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ZooKeeper-%E4%BB%8B%E7%BB%8D"><span class="nav-text">ZooKeeper 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ZooKeeper-%E7%9A%84%E6%A6%82%E8%BF%B0"><span class="nav-text">ZooKeeper 的概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ZooKeeper-%E7%9A%84%E7%89%B9%E7%82%B9"><span class="nav-text">ZooKeeper 的特点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ZooKeeper-%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="nav-text">ZooKeeper 的工作机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ZooKeeper-%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-text">ZooKeeper 的数据结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ZooKeeper-%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">ZooKeeper 的应用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%9F%E4%B8%80%E5%91%BD%E5%90%8D%E6%9C%8D%E5%8A%A1"><span class="nav-text">统一命名服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%9F%E4%B8%80%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86"><span class="nav-text">统一配置管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%9F%E4%B8%80%E9%9B%86%E7%BE%A4%E7%AE%A1%E7%90%86"><span class="nav-text">统一集群管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BD%AF%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9C%8D%E5%8A%A1"><span class="nav-text">软负载均衡服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8A%A8%E6%80%81%E4%B8%8A%E4%B8%8B%E7%BA%BF"><span class="nav-text">服务器动态上下线</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ZooKeeper-%E5%8D%95%E6%9C%BA%E5%AE%89%E8%A3%85"><span class="nav-text">ZooKeeper 单机安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ZooKeeper-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85"><span class="nav-text">ZooKeeper 集群安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ZooKeeper-%E9%9B%86%E7%BE%A4%E9%80%89%E4%B8%BE"><span class="nav-text">ZooKeeper 集群选举</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%90%AF%E5%8A%A8"><span class="nav-text">集群第一次启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E9%9D%9E%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%90%AF%E5%8A%A8"><span class="nav-text">集群非第一次启动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E9%80%89%E4%B8%BE%E6%9C%BA%E5%88%B6%E6%80%BB%E7%BB%93"><span class="nav-text">集群选举机制总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ZooKeeper-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-text">ZooKeeper 最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2%E5%A4%9A%E5%B0%91%E4%B8%AA%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9"><span class="nav-text">生产环境部署多少个集群节点</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="Clay" src="/img/head.jpg"></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"> <span class="site-state-item-count">708</span> <span class="site-state-item-name">文章</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">53</span> <span class="site-state-item-name">标签</span></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/rqh656418510" title="GitHub → https://github.com/rqh656418510" rel="external nofollow" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="mailto:rong656418510@gmail.com" title="E-Mail → mailto:rong656418510@gmail.com" rel="external nofollow" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="/atom.xml" title="RSS → /atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i> RSS</a></span><span class="links-of-author-item"><a href="/sitemap.xml" title="SiteMap → /sitemap.xml" rel="noopener me"><i class="fa fa-sitemap fa-fw"></i> SiteMap</a></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.techgrow.cn/posts/23b4218e.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/img/head.jpg"><meta itemprop="name" content="Clay"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Clay 的技术空间"><meta itemprop="description" content="专注于 Java 后端、分布式、微服务、云原生、数据库、系统架构、大数据、云计算、虚拟化、人工智能学习的技术博客。"></span><span hidden="" itemprop="post" itemscope="" itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="ZooKeeper 入门教程之一 | Clay 的技术空间"><meta itemprop="description" content="本文主要介绍 ZooKeeper 的使用教程。"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> ZooKeeper 入门教程之一</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-06-25 22:13:45" itemprop="dateCreated datePublished" datetime="2021-06-25T22:13:45+08:00">2021-06-25</time></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">评论数：</span><a title="waline" href="/posts/23b4218e.html#waline" itemprop="discussionUrl"><span class="post-comments-count waline-comment-count" data-path="/posts/23b4218e.html" itemprop="commentCount"></span></a></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>3.9k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 ≈</span> <span>4 分钟</span></span></div></div></header><div class="post-body post-container" itemprop="articleBody" id="readmore-container"><h2 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h2><ul><li><a href="/posts/23b4218e.html">ZooKeeper 入门教程之一</a></li><li><a href="/posts/18340f27.html">ZooKeeper 入门教程之二</a></li><li><a href="/posts/5a68992a.html">ZooKeeper 入门教程之三</a></li><li><a href="/posts/16baf534.html">ZooKeeper 入门教程之四</a></li><li><a href="/posts/b589771.html">ZooKeeper 入门教程之五</a></li><li><a href="/posts/d415f72.html">ZooKeeper 入门教程之六</a></li></ul><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h3><ul><li><a href="/posts/ecc33bf4.html">ZooKeeper 学习路线</a></li><li><a target="_blank" rel="external nofollow" href="https://zookeeper.apache.org/documentation.html">ZooKeeper 官方英文文档</a></li><li><a target="_blank" rel="external nofollow" href="https://zookeeper.net.cn/doc/r3.9.2/index.html">ZooKeeper 官方中文文档</a></li></ul><h2 id="ZooKeeper-介绍"><a href="#ZooKeeper-介绍" class="headerlink" title="ZooKeeper 介绍"></a>ZooKeeper 介绍</h2><h3 id="ZooKeeper-的概述"><a href="#ZooKeeper-的概述" class="headerlink" title="ZooKeeper 的概述"></a>ZooKeeper 的概述</h3><p><a target="_blank" rel="external nofollow" href="https://github.com/apache/zookeeper">Zookeeper</a> 是一个开源的分布式的、为分布式框架提供协调服务的 Apache 项目。</p><span id="more"></span><p><img data-src="../../../asset/2024/12/zookeeper-1.png"></p><h3 id="ZooKeeper-的特点"><a href="#ZooKeeper-的特点" class="headerlink" title="ZooKeeper 的特点"></a>ZooKeeper 的特点</h3><ul><li>(1) Zookeeper 集群：由一个领导者（Leader），多个跟随者（Follower）组成的集群。</li><li>(2) 集群中只要有<strong>半数以上</strong>节点存活，Zookeeper 集群就能正常服务，所以 Zookeeper 适合部署奇数台服务器。</li><li>(3) 全局数据一致：每个 Server 保存一份相同的数据副本，Client 无论连接到哪个 Server，数据都是一致的。</li><li>(4) 更新请求按顺序执行，来自同一个 Client 的更新请求按其发送顺序依次执行。</li><li>(5) 数据更新原子性，一次数据更新要么成功，要么失败。</li><li>(6) 实时性，在一定时间范围内，Client 能读到最新数据。</li><li>(7) 可以保证 CAP 理论中的 CP（一致性与分区容错性）。</li></ul><p><img data-src="../../../asset/2024/12/zookeeper-3.png"></p><h3 id="ZooKeeper-的工作机制"><a href="#ZooKeeper-的工作机制" class="headerlink" title="ZooKeeper 的工作机制"></a>ZooKeeper 的工作机制</h3><p>Zookeeper 从设计模式角度来理解：是一个基于观察者模式设计的分布式服务管理框架，它负责存储和管理观察者都关心的数据，然后接受观察者的注册；一旦这些数据的状态发生变化，Zookeeper 就负责通知已经在 Zookeeper 上注册的那些观察者做出相应的反应。</p><p><img data-src="../../../asset/2024/12/zookeeper-2.png"></p><h3 id="ZooKeeper-的数据结构"><a href="#ZooKeeper-的数据结构" class="headerlink" title="ZooKeeper 的数据结构"></a>ZooKeeper 的数据结构</h3><p>ZooKeeper 数据模型的结构与 Unix 文件系统很类似，整体上可以看作是一棵树，每个节点称做一个 ZNode。每一个 ZNode 默认能够存储 1MB 的数据，每个 ZNode 都可以通过其路径进行唯一标识。</p><p><img data-src="../../../asset/2024/12/zookeeper-4.png"></p><h3 id="ZooKeeper-的应用场景"><a href="#ZooKeeper-的应用场景" class="headerlink" title="ZooKeeper 的应用场景"></a>ZooKeeper 的应用场景</h3><ul><li><p>ZooKeeper 的适用场景</p><ul><li>统一命名服务</li><li>统一配置管理</li><li>统一集群管理</li><li>软负载均衡</li><li>服务器节点动态上下线</li></ul></li><li><p> ZooKeeper 的不适用场景</p><ul><li><code>高吞吐量需求</code>：ZooKeeper 在高吞吐量的场景下可能会成为性能瓶颈，性能受限于单点和写操作。</li><li><code>低延迟要求</code>：由于需要保证一致性，ZooKeeper 可能会导致较高的延迟，不适合对延迟要求严格的系统。</li><li><code>大规模数据存储</code>：ZooKeeper 更适用于小数据量的存储，存储大规模数据时效率较低。</li><li><code>分布式计算</code>：ZooKeeper 不适合进行复杂的分布式计算任务，更多是协调和管理服务。</li><li><code>无强一致性要求的场景</code>：对于不需要强一致性的应用，ZooKeeper 的强一致性保证可能是过度设计。</li><li><code>频繁节点变化</code>：在节点频繁变化的场景下，ZooKeeper 的性能可能会受到影响，尤其在极高频率的情况下。</li><li><code>Leader 单点故障问题</code>：虽然 ZooKeeper 支持主备机制，但其客户端仍依赖一个活跃的 ZooKeeper 节点（Leader），如果集群不可用（比如集群正在选举新的 Leader），系统可能会受到影响。</li><li><code>非常高的并发写操作</code>：由于 ZooKeeper 是以强一致性为基础的，因此在高并发写操作的场景下可能不适合。</li></ul></li></ul><div class="admonition note"><p class="admonition-title">Leader 节点的单点故障问题</p><p>ZooKeeper 集群采用了 ZAB 协议，保证了数据的一致性。在集群中，只有一个 Leader 节点 负责处理所有写请求，其他节点作为 Follower 节点提供读取服务。当 Leader 节点发生故障时，集群会进行选举，选出新的 Leader 节点。这个过程需要一定的时间（通常是几秒到几十秒），在此期间，ZooKeeper 服务可能会不可用或者处于一致性恢复阶段。 因此，虽然 ZooKeeper 是集群化部署的，但在 Leader 节点故障期间，集群仍然可能出现短暂的不可用或一致性恢复的现象，这就相当于一种单点故障。不过，这个故障通常是暂时的，因为选举和恢复机制能够尽快解决问题。</p></div><h4 id="统一命名服务"><a href="#统一命名服务" class="headerlink" title="统一命名服务"></a>统一命名服务</h4><p>在分布式环境下，经常需要对应用 / 服务进行统一命名，以便于识别。例如：IP 不容易记住，而域名容易记住。</p><p><img data-src="../../../asset/2024/12/zookeeper-5.png"></p><h4 id="统一配置管理"><a href="#统一配置管理" class="headerlink" title="统一配置管理"></a>统一配置管理</h4><ul><li><p>分布式环境下，配置文件同步非常常见</p><ul><li>(1) 一般要求在一个集群中，所有节点的配置信息是一致的，比如 Kafka 集群。</li><li>(2) 对配置文件进行修改后，希望能够快速同步到各个节点上。</li></ul></li><li><p>配置管理可交由 ZooKeeper 实现</p><ul><li>(1) 可将配置信息写入 ZooKeeper 上的一个 Znode。</li><li>(2) 各个客户端都监听这个 Znode 的数据变化。</li><li>(3) 一旦 Znode 中的数据被修改，ZooKeeper 将通知各个客户端。</li></ul></li></ul><p><img data-src="../../../asset/2024/12/zookeeper-6.png"></p><h4 id="统一集群管理"><a href="#统一集群管理" class="headerlink" title="统一集群管理"></a>统一集群管理</h4><ul><li><p>分布式环境中，实时掌握每个节点的状态是必要的</p><ul><li>(1) 可以根据节点实时状态做出相应的处理。</li></ul></li><li><p>ZooKeeper 可以实现实时监控节点的状态变化</p><ul><li>(1) 可以将节点信息写入 ZooKeeper 上的一个 ZNode。</li><li>(2) 监听这个 ZNode 就可以获取它的实时状态变化。</li></ul></li></ul><p><img data-src="../../../asset/2024/12/zookeeper-7.png"></p><h4 id="软负载均衡服务"><a href="#软负载均衡服务" class="headerlink" title="软负载均衡服务"></a>软负载均衡服务</h4><p>在 Zookeeper 中记录每台服务器的访问数，让访问数最少的服务器去处理最新的客户端请求。</p><p><img data-src="../../../asset/2024/12/zookeeper-9.png"></p><h4 id="服务器动态上下线"><a href="#服务器动态上下线" class="headerlink" title="服务器动态上下线"></a>服务器动态上下线</h4><ul><li>分布式环境中，客户端能实时感知到服务器上下线的变化。</li></ul><p><img data-src="../../../asset/2024/12/zookeeper-8.png"></p><h2 id="ZooKeeper-单机安装"><a href="#ZooKeeper-单机安装" class="headerlink" title="ZooKeeper 单机安装"></a>ZooKeeper 单机安装</h2><ul><li><a href="/posts/6edb1958.html">Linux 安装 ZooKeeper 单机实例</a></li><li><a href="/posts/1b27acd0.html">Docker 安装 ZooKeeper 单机实例</a></li></ul><h2 id="ZooKeeper-集群安装"><a href="#ZooKeeper-集群安装" class="headerlink" title="ZooKeeper 集群安装"></a>ZooKeeper 集群安装</h2><ul><li><a href="/posts/496af1ce.html">Docker 搭建 ZooKeeper 集群</a></li><li><a href="/posts/98827cf0.html">Linux 单机搭建 Zookeeper 集群</a></li><li><a href="/posts/8ed765da.html">Linux 生产环境搭建 Zookeeper 集群</a></li></ul><h2 id="ZooKeeper-集群选举"><a href="#ZooKeeper-集群选举" class="headerlink" title="ZooKeeper 集群选举"></a>ZooKeeper 集群选举</h2><p>ZooKeeper 集群的选举机制是高频面试题，其中分为第一次启动和非第一次启动两种情况。</p><h4 id="集群第一次启动"><a href="#集群第一次启动" class="headerlink" title="集群第一次启动"></a>集群第一次启动</h4><p><img data-src="../../../asset/2024/12/zookeeper-15.png"></p><ul><li><p>(1) 服务器 1 启动，发起一次选举。服务器 1 投自己一票，此时服务器 1 的票数是一票，不够半数以上（一共有 5 票），选举无法完成，服务器 1 的状态保持为 LOOKING。</p></li><li><p>(2) 服务器 2 启动，再发起一次选举。服务器 1 和 2 分别投自己一票并交换选票信息，<strong>此时服务器 1 发现服务器 2 的 <code>myid</code> 比自己目前投票推举的（服务器 1）大，更改选票为推举服务器 2</strong>。此时服务器 1 的票数是 0 票，服务器 2 的票数是 2 票，两者都没有半数以上的票数，选举无法完成，服务器 1 和 服务器 2 的状态保持 LOOKING。</p></li><li><p>(3) 服务器 3 启动，发起一次选举。此时服务器 1 和 2 都会更改选票为服务器 3。此次投票结果：服务器 1 有 0 票，服务器 2 有 0 票，服务器 3 有 3 票。此时服务器 3 的票数已经超过半数，服务器 3 当选 Leader。服务器 3 将状态更改为 LEADING，服务器 1 和 服务器 2 将状态更改为 FOLLOWING。</p></li><li><p>(4) 服务器 4 启动，发起一次选举。此时服务器 1、2、3 已经不是 LOOKING 状态，不会再更改选票信息。交换选票信息后的结果：服务器 3 有 3 票，服务器 4 有 1 票。此时服务器 4 少数服从多数，更改选票信息为服务器 3，并将自己的状态更改为 FOLLOWING。</p></li><li><p>(5) 服务器 5 启动，跟服务器 4 一样更改选票信息为服务器 3，并将自己的状态更改为 FOLLOWING。</p></li></ul><div class="admonition warning"><p class="admonition-title">特别注意</p><p><strong>一旦 ZooKeeper 集群中已经存在 Leader 节点，那么后面加入集群的节点都只会成为 Follower 节点。</strong></p></div><h4 id="集群非第一次启动"><a href="#集群非第一次启动" class="headerlink" title="集群非第一次启动"></a>集群非第一次启动</h4><p><img data-src="../../../asset/2024/12/zookeeper-16.png"></p><ul><li><p>(1) 当 ZooKeeper 集群中的任意一台服务器出现以下两种情况之一时，就会开始进入 Leader 选举：</p><ul><li>服务器初始化启动。</li><li>服务器运行期间无法和 Leader 保持连接。</li></ul></li><li><p>(2) 当一台服务器进入 Leader 选举流程时，当前集群也可能会处于以下两种状态之一：</p><ul><li><p>集群中本来就已经存在一个 Leader</p><ul><li>对于集群已经存在 Leader 的情况，当服务器试图去选举 Leader 时，会被告知当前服务器的 Leader 信息；对于该服务器来说，仅仅需要和 Leader 服务器建立连接，并进行状态同步即可。</li></ul></li><li><p>集群中确实不存在 Leader</p><ul><li>对于集群不存在 Leader 的情况，整个集群会进入选举流程。</li><li>假设 ZooKeeper 集群由 5 台服务器组成，SID 分别为 1、2、3、4、5，ZXID 分别为 8、8、8、7、7， 并且此时 SID 为 3 的服务器是 Leader。在某一时刻，SID 为 3 和 5 的服务器出现故障，由于 Leader 挂掉了，因此开始进行 Leader 选举。SID 为 1、2、4 的服务器的最终投票情况如下：<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(EPOCH, ZXID, SID ) (EPOCH, ZXID, SID ) (EPOCH, ZXID, SID )</span><br><span class="line">(1, 8, 1)           (1, 8, 2)           (1, 7, 4)</span><br></pre></td></tr></tbody></table></figure></li><li><strong>选举 Leader 的规则</strong>：①EPOCH 大的直接胜出&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;②EPOCH 相同，ZXID（事务 ID）大的胜出&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;③ZXID（事务 ID） 相同，SID（服务器 ID，即 myid） 大的胜出</li><li>选举 Leader 的结果：SID 为 2 的服务器会被选举 Leader，SID 为 1 和 4 的服务器作为 Follower。</li></ul></li></ul></li></ul><h4 id="集群选举机制总结"><a href="#集群选举机制总结" class="headerlink" title="集群选举机制总结"></a>集群选举机制总结</h4><p>ZooKeeper 使用半数投票机制来实现选举，超过半数的投票通过，即通过。</p><ul><li><p>集群第一次启动时的选举规则</p><ul><li>投票过半数时，服务器 ID 大的胜出</li></ul></li><li><p>集群非第一次启动时的选举规则</p><ul><li>(1) EPOCH 大的直接胜出</li><li> (2) EPOCH 相同，事务 ID（ZXID）大的胜出</li><li> (3) 事务 ID（ZXID）相同，服务器 ID（SID）大的胜出</li></ul></li></ul><h3 id="ZooKeeper-最佳实践"><a href="#ZooKeeper-最佳实践" class="headerlink" title="ZooKeeper 最佳实践"></a>ZooKeeper 最佳实践</h3><h4 id="生产环境部署多少个集群节点"><a href="#生产环境部署多少个集群节点" class="headerlink" title="生产环境部署多少个集群节点"></a>生产环境部署多少个集群节点</h4><p>在生产环境中，ZooKeeper 集群应该部署奇数个节点，这是考虑到 ZooKeeper 使用半数投票机制来实现选举，超过半数的投票通过即通过，其他考虑因素还有半数写入。生产最佳实践如下：</p><ul><li>10 台服务器：3 个 ZooKeeper 节点</li><li> 20 台服务器：5 个 ZooKeeper 节点</li><li> 100 台服务器：11 个 ZooKeeper 节点</li><li> 200 台服务器：11 个 ZooKeeper 节点</li></ul><p>对于 ZooKeeper 集群，节点数多的好处是可以提高可靠性，其坏处是增加了通信延时。</p><div id="readmore-expansion" class="pjax"></div><link rel="stylesheet" type="text/css" href="https://qiniu.techgrow.cn/readmore/dist/hexo.css"><script data-pjax="" src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script><script data-pjax="">var isMobile=navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),allowMobile=!1;if(!isMobile||isMobile&&allowMobile)try{var plugin=new ReadmorePlugin;plugin.init({type:"hexo",id:"readmore-container",name:"全栈技术驿站",blogId:"96641-5333172926158-056",qrcode:"https://www.techgrow.cn/img/wx_mp_qr.png",keyword:"Tech",random:"1",height:"auto",expires:"365",lockToc:"yes",interval:"30",baseUrl:"",execute:"yes",tocSelector:""})}catch(e){console.warn("readmore plugin occurred error: "+e.name+" | "+e.message)}</script></div><footer class="post-footer"><div class="reward-container"><div>支持一根棒棒糖！</div> <button> 赞赏</button><div class="post-reward"><div> <img src="/img/pay_wx.png" alt="Clay 微信"> <span>微信</span></div><div> <img src="/img/pay_zfb.png" alt="Clay 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"> <strong>本文作者：</strong> Clay</li><li class="post-copyright-link"> <strong>本文链接：</strong> <a href="https://www.techgrow.cn/posts/23b4218e.html" title="ZooKeeper 入门教程之一">https://www.techgrow.cn/posts/23b4218e.html</a></li><li class="post-copyright-license"> <strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="contactme"><div class="social-list"><div class="social-item"><span class="icon"><i class="fab fa-weixin"></i></span> <span class="label">欢迎添加博主微信，请备注 "博客"，届时会邀请您加入百人微信群</span><br> <img src="/img/wx_account_qr.png"></div></div></div><div class="post-tags"><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"><i class="fa fa-tag"></i> 分布式</a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" rel="tag"><i class="fa fa-tag"></i> 大数据</a></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/9f128424.html" rel="prev" title="初探前端框架 Vue2 之四"><i class="fa fa-angle-left"></i> 初探前端框架 Vue2 之四</a></div><div class="post-nav-item"> <a href="/posts/adff4cba.html" rel="next" title="RabbitMQ 入门教程之九">RabbitMQ 入门教程之九<i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments" id="waline"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> Copyright © 2018 – <span itemprop="copyrightYear">2025</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Clay</span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i></span> <span>站点总字数：</span> <span title="站点总字数">1.9m</span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span>站点阅读时长 ≈</span> <span title="站点阅读时长">28:09</span></span></div><div id="site-runtime"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span><span id="runtime"></span></div><script language="javascript">function isPC(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=0;n<t.length;n++)if(0<e.indexOf(t[n]))return!1;return!0}function siteTime(e,t){window.setTimeout("siteTime(openOnPC, start)",1e3);var n=36e5,o=24*n;t=new Date("2018-12-27 08:00:00");var i=new Date,r=(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i-t),a=Math.floor(r/31536e6),s=Math.floor(r/o-365*a),d=Math.floor((r-(365*a+s)*o)/n),l=Math.floor((r-(365*a+s)*o-d*n)/6e4),u=Math.floor((r-(365*a+s)*o-d*n-6e4*l)/1e3);document.getElementById("runtime").innerHTML="Powered by Hexo & Docker | "+a+" 年 "+s+" 日 "+d+" 小时 "+l+" 分钟 "+u+" 秒 "}var showOnMobile=!1,openOnPC=isPC(),start=new Date;siteTime(openOnPC,start),openOnPC||showOnMobile||(document.getElementById("site-runtime").style.display="none")</script><div class="beian"> <span><img src="/img/gonganbeian.png" alt=""></span> <span><a href="https://beian.miit.gov.cn/" rel="external nofollow" target="_blank">粤ICP备 19024664号-1</a></span> <span>|&nbsp;</span> <span><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44011302004035" rel="external nofollow" target="_blank">粤公网安备 44011302004035号</a></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i></span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span></span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span><span class="toggle-line"></span><span class="toggle-line"></span></div><div class="sidebar-dimmer"></div> <a href="https://github.com/rqh656418510" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="external nofollow" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script size="200" alpha="0.5" zindex="-1" src="/lib/ribbon.js/dist/ribbon.min.js"></script><script src="/lib/animejs/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/lib/@next-theme/pjax/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script><script src="/lib/medium-zoom/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script><script src="/lib/lozad/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script><script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"/lib/pdfobject/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script><script src="/js/third-party/tags/pdf.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"/lib/mermaid/dist/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script data-pjax="" async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://www.techgrow.cn/lib/darkmode/darkmode@1.5.7.min.js"></script><script>
var options = {
  bottom: '64px',
  right: '30px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#282828',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script><script src="https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js"></script><script>
    var qiniu_domain = "https://oss.techgrow.cn";
    var qiniu_token_url = "https://open.techgrow.cn/api/oss/qiniu/token/upload";
    var qiniu_debug = "true" === "false";

    // date format
    Date.prototype.format = function (fmt) {
      var o = {
        "M+": this.getMonth() + 1,
        "d+": this.getDate(),
        "h+": this.getHours(),
        "m+": this.getMinutes(),
        "s+": this.getSeconds(),
        "q+": Math.floor((this.getMonth() + 3) / 3),
        "S": this.getMilliseconds()
      };
      if (/(y+)/.test(fmt)) {
        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
      }
      for (var k in o) {
        if (new RegExp("(" + k + ")").test(fmt)) {
          fmt = fmt.replace(
            RegExp.$1,
            (RegExp.$1.length == 1)
              ? (o[k])
              : (("00" + o[k]).substr(("" + o[k]).length))
          );
        }
      }
      return fmt;
    }

    // generate uuid
    function uuid() {
      var s = [];
      var hexDigits = "0123456789abcdef";
      for (var i = 0; i < 36; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
      }
      s[14] = "4";
      s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);
      s[8] = s[13] = s[18] = s[23] = "-";
      var uuid = s.join("");
      return uuid;
    }

    // sync get request
    function syncGet(url) {
      var xhr = null;
      if (window.XMLHttpRequest) {
        xhr = new XMLHttpRequest();
      } else {
        xhr = new ActiveXObject("Microsoft.XMLHTTP");
      }
      xhr.open('GET', url, false);
      xhr.send();
      return xhr;
    }

    // get upload file path
    function getUploadFilePath() {
      var now = new Date();
      var name = uuid().replace(/-/g, "");
      var nowStr = now.format("/yyyy/MM/dd/");
      return "uploads" + nowStr + name;
    }

    // get qiniu upload token
    function getUploadToken() {
      try {
        var xhr = syncGet(qiniu_token_url);
        var responseStatus = xhr.status;
        var responseJson = JSON.parse(xhr.responseText);
        if (responseStatus === 200) {
          return responseJson.data;
        } else if (responseStatus === 403) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，非法请求来源！");
        } else if (responseStatus === 429) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，上传过于频繁！");
        } else if (responseStatus === 500) {
          alert(responseJson.msg || "图片上传失败，无法获取UploadToken，系统内部出错！");
        } else {
          alert("图片上传失败，无法获取UploadToken，未知Http响应状态码！");
        }
      } catch (err) {
        if (qiniu_debug) {
          console.error(err);
        }
        alert("图片上传失败，无法获取UploadToken，未知错误！");
      }
      return null;
    }

    // qiniu upload image
    async function qiniuUploadImage(file) {
      var image_path = null;
      await uploadImage(file).then(function onFulfilled(res) {
        image_path = res;
      }).catch(function onRejected(err) {
        if (qiniu_debug) {
          console.error(err);
        }
      });
      return image_path;
    }

    // upload image
    function uploadImage(file) {
      return new Promise((resolve, reject) => {
        var config = null;
        var putExtra = null;
        var token = getUploadToken();
        var key = getUploadFilePath();
        // upload init
        var observable = qiniu.upload(file, key, token, putExtra, config);
        // upload start
        observable.subscribe({
          next(res) {
            // upload progress
          },
          error(err) {
            // upload falied
            reject("falied to upload image for qiniu: " + err.name);
          },
          complete(res) {
            // upload successed
            resolve(qiniu_domain + "/" + key);
          }
        });
      });
    }
  </script><script class="next-config" data-name="waline" type="application/json">{"lang":"zh-CN","enable":true,"serverURL":"https://waline.techgrow.cn","cssUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css","commentCount":true,"pageview":false,"copyright":false,"allowUploadImage":true,"libUrl":"https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.js","locale":{"placeholder":"支持匿名评论啦，若希望及时收到博主的反馈，建议登录评论或者在上方的邮箱输入框留下邮箱地址哦 (๑•̀ㅂ•́)و✧"},"dark":"body.darkmode--activated","emoji":["https://www.techgrow.cn/lib/@waline/emojis/1.0.1/weibo"],"meta":["nick","mail","link"],"login":"enable","pageSize":10,"qiniuDebug":false,"qiniuDomain":"https://oss.techgrow.cn","qiniuTokenUrl":"https://open.techgrow.cn/api/oss/qiniu/token/upload","qiniuLibUrl":"https://www.techgrow.cn/lib/qiniu/qiniu@3.3.1.min.js","el":"#waline","comment":true,"path":"/posts/23b4218e.html"}</script><link rel="stylesheet" href="https://www.techgrow.cn/lib/@waline/client/client@2.5.1.min.css"><script>
document.addEventListener('page:loaded', () => {
  if (!CONFIG.waline.allowUploadImage) {
    CONFIG.waline.imageUploader = false;
  }
  else if (CONFIG.waline.qiniuDomain && CONFIG.waline.qiniuTokenUrl) {
    CONFIG.waline.imageUploader = qiniuUploadImage;
  } else {
   CONFIG.waline.imageUploader = true;
  }
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script><div class="moon-menu"><div class="moon-menu-items"><div id="moon-menu-item-back2bottom" class="moon-menu-item"><i class="fas fa-chevron-down"></i></div><div id="moon-menu-item-back2top" class="moon-menu-item"><i class="fas fa-chevron-up"></i></div></div><div class="moon-menu-button"><svg class="moon-menu-bg"><circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle><circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle></svg><div class="moon-menu-content"><div class="moon-menu-icon"><i class="fas fa-ellipsis-v"></i></div><div class="moon-menu-text"></div></div></div></div><script src="/js/injector.js"></script><div class="comments" id="waline-comments" style="display:none"></div><script>function isMobile(){var i=navigator.userAgent.toLowerCase(),e="ipad"==i.match(/ipad/i),a="iphone os"==i.match(/iphone os/i),o="midp"==i.match(/midp/i),n="rv:1.2.3.4"==i.match(/rv:1.2.3.4/i),r="ucweb"==i.match(/ucweb/i),c="android"==i.match(/android/i),l="windows ce"==i.match(/windows ce/i),d="windows mobile"==i.match(/windows mobile/i);return!!(e||a||o||n||r||c||l||d)}var openOnMobile=isMobile(),showOnMobile=!1,aplayerEnable=!0;jQuery(document).ready(function(){aplayerEnable&&(openOnMobile&&!showOnMobile||jQuery("#aplayer").css("display","block"))}),jQuery(window).on("load",function(){aplayerEnable&&jQuery(".aplayer\\-icon.aplayer\\-icon\\-lrc").trigger("click")})</script></body></html>